
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>jenkins pipleline | Stan Zhou&#39;s Hexo Technical Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stan Zhou">
    

    
    <meta name="description" content="An Example of Declarative Pipeline:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687">
<meta name="keywords" content="Jenkins,Devops,CD&#x2F;CI,Pileline,Blue Ocean">
<meta property="og:type" content="article">
<meta property="og:title" content="jenkins pipleline">
<meta property="og:url" content="http://223.95.78.227/2019/07/26/jenkins-bule-ocean/index.html">
<meta property="og:site_name" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:description" content="An Example of Declarative Pipeline:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://i.imgur.com/9vXmWEx.png">
<meta property="og:image" content="https://i.imgur.com/nT7HPpR.png">
<meta property="og:image" content="https://i.imgur.com/xRBayPL.png">
<meta property="og:image" content="https://i.imgur.com/QOlR9f3.png">
<meta property="og:image" content="https://i.imgur.com/JKFI18a.png">
<meta property="og:image" content="https://i.imgur.com/r9Lcscp.png">
<meta property="og:image" content="https://i.imgur.com/pcRUia1.png">
<meta property="og:image" content="https://i.imgur.com/HqdwQaB.png">
<meta property="og:image" content="https://i.imgur.com/lbHccu0.png">
<meta property="og:image" content="https://i.imgur.com/yLSxMZI.png">
<meta property="og:image" content="https://i.imgur.com/8iAt69F.png">
<meta property="og:image" content="https://i.imgur.com/7fqNbdX.png">
<meta property="og:image" content="https://i.imgur.com/rc05gg4.png">
<meta property="og:image" content="https://i.imgur.com/82ksxy9.png">
<meta property="og:image" content="https://i.imgur.com/KIxaHqF.png">
<meta property="og:image" content="https://i.imgur.com/Gm6EcNy.png">
<meta property="og:updated_time" content="2019-07-26T12:01:53.864Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jenkins pipleline">
<meta name="twitter:description" content="An Example of Declarative Pipeline:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687">
<meta name="twitter:image" content="https://i.imgur.com/9vXmWEx.png">
<meta name="twitter:creator" content="@stanosaka">

    
    <link rel="alternative" href="/atom.xml" title="Stan Zhou&#39;s Hexo Technical Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/toad.ico">
    
    
    <link rel="apple-touch-icon" href="/img/toadman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/toadman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/toadman.png" alt="Stan Zhou&#39;s Hexo Technical Blog" title="Stan Zhou&#39;s Hexo Technical Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Stan Zhou&#39;s Hexo Technical Blog">Stan Zhou&#39;s Hexo Technical Blog</a></h1>
				<h2 class="blog-motto">Innovation Evangelist</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:223.95.78.227">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/07/26/jenkins-bule-ocean/" title="jenkins pipleline" itemprop="url">jenkins pipleline</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-07-26T11:59:33.000Z" itemprop="datePublished"> Published 2019-07-26</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#An-Example-of-Declarative-Pipeline"><span class="toc-number">1.</span> <span class="toc-text">An Example of Declarative Pipeline:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequentail-stages"><span class="toc-number">1.1.</span> <span class="toc-text">Sequentail stages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Parallel-stages"><span class="toc-number">1.2.</span> <span class="toc-text">Parallel stages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STEPS"><span class="toc-number">1.3.</span> <span class="toc-text">STEPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Script"><span class="toc-number">1.4.</span> <span class="toc-text">Script</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="An-Example-of-Declarative-Pipeline"><a href="#An-Example-of-Declarative-Pipeline" class="headerlink" title="An Example of Declarative Pipeline:"></a>An Example of Declarative Pipeline:</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">       node &#123;</span><br><span class="line">           label &apos;master&apos;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">       stage(&apos;Build&apos;) &#123;</span><br><span class="line">           steps &#123;</span><br><span class="line">               sh &apos;mvn clean verify -DskipITs=true&apos;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       stage (&apos;Static Code Analysis&apos;) &#123;</span><br><span class="line">           steps &#123;</span><br><span class="line">               sh &apos;mvn clean verify sonar:sonar&apos;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       stage (&apos;Publish to Artifactory&apos;) &#123;</span><br><span class="line">           steps &#123;</span><br><span class="line">               script &#123;</span><br><span class="line">                   def server = Artifactory.server &apos;Default Artifactory&apos;</span><br><span class="line">                   def uploadSpec = &quot;&quot;&quot;&#123;</span><br><span class="line">                       &quot;files&quot;: [</span><br><span class="line">                           &#123;</span><br><span class="line">                               &quot;pattern&quot;: &quot;target/*.war&quot;,</span><br><span class="line">                               &quot;target&quot;: &quot;helloworld/$&#123;BUILD_NUMBER&#125;/&quot;,</span><br><span class="line">                               &quot;pattern&quot;: &quot;Unit-Tested=Yes&quot;,</span><br><span class="line">                           &#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;&quot;&quot;&quot;</span><br><span class="line">                    server.upload(uploadSpec)</span><br><span class="line">		&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">**Jenkinsfile**</span><br><span class="line">A Jenkinsfile is a file that contains Pipeline code.</span><br><span class="line"></span><br><span class="line">## Declarative Pipeline Syntax</span><br><span class="line">**Sections**</span><br><span class="line"></span><br><span class="line">Sections in Declarative Pipeline Syntax can contain one or more Directive or Steps.</span><br><span class="line">### Agent</span><br><span class="line">- The *agent* section defines where the whole Pipleline, or a specific stage, runs. It is positioned right at the beginnning of the *pipeline &#123; &#125;* block the is compolsory.</span><br><span class="line">- can also use it inside the *stage* directive, but that&apos;s optional.</span><br><span class="line">The *agent* section allow specific parameters to suit various use-cases.</span><br><span class="line"></span><br><span class="line">**any**</span><br><span class="line"></span><br><span class="line">Use *agent any* inside your *pipleine &#123;&#125;* block, or *stage* directive, to run them on any agent available in Jenkins.</span><br><span class="line">![A pipleline&#123;&#125;Block with agent any](https://i.imgur.com/6ByXXdT.png)</span><br><span class="line"></span><br><span class="line">**none**</span><br><span class="line"></span><br><span class="line">Use *agent node* inside your *pipeline &#123;&#125;* block to stop any global agent from running your pipeline. In such case, each *stage* directive inside your pipeline must have its *agent* section.</span><br><span class="line">![A Pipeline&#123;&#125;Block with Agnet None](https://i.imgur.com/MQIQ9ID.png)</span><br><span class="line"></span><br><span class="line">**label**</span><br><span class="line"></span><br><span class="line">Run your complete pipeline, or stage, on an agent available in Jenkins with specific label.</span><br><span class="line">![A pipeline&#123;&#125; block with agent &#123; label &apos;....&apos;&#125; section](https://i.imgur.com/fw2xBh7.png)</span><br><span class="line"></span><br><span class="line">**node**</span><br><span class="line"></span><br><span class="line">Run your complete pipeline, or stage, on an agent available in Jenkins with s specific label. The behavior is similar to the *label* parameter. Howerver, the *node* parameter allows you to specify additional options such as *customWorkspace*. Workspace, or Jenkins Pipeline workspace, is a reserved directory on your Jenkins agent, where all your source code is downloaded and where your builds are performed.</span><br><span class="line"></span><br><span class="line">![agent node customWorkspace section](https://i.imgur.com/jtj39sB.png)</span><br><span class="line"></span><br><span class="line">**docker**</span><br><span class="line"></span><br><span class="line">Run your complete pipeline, or stage, inside a docker container. The container will be dynamically spawned on a pre-configured docker host.</span><br><span class="line"></span><br><span class="line">The *docker* option also takes an *args* parameter that allows you to pass arguments directly to the *docker run* command.</span><br><span class="line"></span><br><span class="line">![An agent section with docker parameter](https://i.imgur.com/oINFaFW.png)</span><br><span class="line"></span><br><span class="line">**dockerfile**</span><br><span class="line"></span><br><span class="line">Run your pipeline, or stage, inside a conatiner build from a *dockerfile*. To use this option, the *jenkinsfile* and the *dockerfile* should be present inside the root of your source code.</span><br><span class="line"></span><br><span class="line">![agent section with dockerfile](https://i.imgur.com/M2e1Xq0.png)</span><br><span class="line"></span><br><span class="line">**post**</span><br><span class="line"></span><br><span class="line">The *post* section allows you to run additional *setps* after running a pipeline or a stage.</span><br><span class="line">![a post section at the end of a pipeline](https://i.imgur.com/xctaUYY.png)</span><br><span class="line"></span><br><span class="line">![add specific conditions to post section](https://i.imgur.com/wmfuirh.png)</span><br><span class="line"></span><br><span class="line">**stages**</span><br><span class="line"></span><br><span class="line">The *stages* section contains a sequence of one or more *stage* directives. It&apos;s used to segregate a sinle or a collection of *stage* directives form the rest of the code.</span><br><span class="line"></span><br><span class="line">The *stages* section has no parameters and gets used at least once in the pipeline.</span><br><span class="line"></span><br><span class="line">**steps**</span><br><span class="line"></span><br><span class="line">The *steps* section contains one or more steps that should run inside a *stage* directive. The *steps* section is used to segrate a single or a collection of steps from the rest of the code inside a *stage* directive.</span><br><span class="line">![a pipeline&#123;&#125; block with steps section](https://i.imgur.com/FxgpLwC.png)</span><br><span class="line"></span><br><span class="line">### Directives</span><br><span class="line">Directives are supporting actors that give direction, set conditions, and provide assistance to the steps of your pipeline in order to archieve the required purpose. In the following section we will see all the *Directives* that are available to you with the Declarative Pipeline Syntax.</span><br><span class="line"></span><br><span class="line">**environment**</span><br><span class="line">The *environment* directive is used to specify a set of key value pairs that are available as environment variables for all the steps of your pipeline, or only for the steps of a specific stage, depending on where you place the *environment* directive.</span><br><span class="line"></span><br><span class="line">![pipeline block with environment section](https://i.imgur.com/g07NWDy.png)</span><br><span class="line"></span><br><span class="line">**options**</span><br><span class="line">The *options* directive allows you to define pipeline-specific *options* from within the pipeline.</span><br><span class="line"></span><br><span class="line">1. buildDiscarder</span><br><span class="line">Allows you to keep a certain number of recent builds run.</span><br></pre></td></tr></table></figure>
<p>// Will keep the last 10 Pipeline logs and artifacts in Jenkins.<br>options {<br>   biuldDiscarder(logRotator(numToKeepStr: ‘10’))<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2. disableConcurrentBuilds</span><br><span class="line">Disallows concurrent executions of the Pipeline.</span><br><span class="line">To understand the usage of this option, imagine a situation. You have a Pipeline in Jenkins Blue Ocean that’s triggered on every push on your source code repository. Moreover, you have a single build agent to run your Pipeline.</span><br><span class="line"></span><br><span class="line">Now, if there are multiple pushes to the repository in a short duration of time (say three different pushes at once), then there is a pipeline for every push (say, Pipelines #1, #2, and #3). However, since we have a single build agent, Pipelines #2 and #3 wait in a queue with Pipeline #1 running. Pipelines #2 and #3 run whenever the build agent is free again.</span><br><span class="line"></span><br><span class="line">To disable this functionality, and discard everything that’s in the queue, you should use the disableConcurrentBuilds option. The following option is useful to perform incremental builds.</span><br></pre></td></tr></table></figure></p>
<p>options {<br>   disableConcurrentBuilds ()<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. newContainerPerStage</span><br><span class="line"></span><br><span class="line">The *newContainerPerStage* option is used inside an agent section that employs the docker or dockerfile parameters.</span><br><span class="line"></span><br><span class="line">When specified, each stage runs in a new container on the same docker host, as opposed to all stages utilizing the same container.</span><br><span class="line"></span><br><span class="line">This option only works with an *agent* section defined at the top-level of your *Pipeline &#123;&#125;* block.</span><br><span class="line"></span><br><span class="line">4. preserveStashes</span><br><span class="line">In Jenkins, you can pass artifacts between stages. You do it using stash. The *preserveStashes* option allows you to preserve stashes of the completed Pipelines. It’s useful if you have to re-run a stage from a completed Pipeline.</span><br></pre></td></tr></table></figure></p>
<p>// Preserver stashes from the most recent completed Pipeline.<br>options {<br>   perserveStashes()<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">or</span><br></pre></td></tr></table></figure></p>
<p>// Preserve stashes from the ten most recent completed Pipelines.<br>options {<br>   perserveStashes(10)<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">5. retry</span><br><span class="line">The retry option allows you to retry a Pipeline, or a stage, on failure.</span><br><span class="line">![retry](https://i.imgur.com/ifB8mza.png)</span><br><span class="line"></span><br><span class="line">6. skipDefaultCheckout</span><br><span class="line">The *skipDefaultCheckout* option is another handy choice. In Jenkins Declarative Pipeline, the source code by default gets checked out in every *stage* directive of a Pipeline.</span><br><span class="line"></span><br><span class="line">Use this option to skip checking out source code in a given *stage* directive.</span><br><span class="line"></span><br><span class="line">![block with skipDefaultCheckout options](https://i.imgur.com/hLjjGBF.png)</span><br><span class="line"></span><br><span class="line">7. timeout</span><br><span class="line">The *timeout* option allows you to set a timeout period for your Pipeline run. If the pipeline run teimes out the duration defined using a *timeout*, Jenkins aborts the Pipeline.</span><br><span class="line"></span><br><span class="line">It is possible to use the timeout option at the Pipeline or stage level.</span><br><span class="line"></span><br><span class="line">![timeout option](https://i.imgur.com/Kv5XzMK.png)</span><br><span class="line"></span><br><span class="line">There are times when a pipeline that’s waiting for a process runs forever, generating huge logs and bringing down Jenkins server. The timeout option comes handy in such cases.</span><br><span class="line"></span><br><span class="line">8. timestamps</span><br><span class="line">The *timestamps* option prepend all lines of the console log with a timestamp. The following option is useful in debugging issues where you would need the time of execution of a specific command as evidence.</span><br><span class="line"></span><br><span class="line">It is possible to use the *timestamps* option at the Pipeline or stage level.</span><br><span class="line"></span><br><span class="line">![timestamps](https://i.imgur.com/QBq3HBf.png)</span><br><span class="line"></span><br><span class="line">### Parameters</span><br><span class="line">The *parameters* directive allows a user to provide a list of specific parameters when triggering a Pipeline.</span><br><span class="line"></span><br><span class="line">Following are the types of available parameters that I find useful.</span><br><span class="line"></span><br><span class="line">1. string</span><br><span class="line"></span><br><span class="line">Use the *string* parameter to pass a string.</span><br><span class="line">![string](https://i.imgur.com/QIBJjWM.png)</span><br><span class="line"></span><br><span class="line">2. text</span><br><span class="line"></span><br><span class="line">Use the *text* parameter to pass a multiline text.</span><br><span class="line">![text](https://i.imgur.com/vSrmP5T.png)</span><br><span class="line"></span><br><span class="line">3. booleanParam</span><br><span class="line"></span><br><span class="line">Use the *booleanParam* parameter to pass true for false.</span><br><span class="line">![booleanParam](https://i.imgur.com/AVmdPvS.png)</span><br><span class="line"></span><br><span class="line">4. choice</span><br><span class="line"></span><br><span class="line">Use the *choice* parameter to allow you to choose from a set of values, and them pass it to the pipeline</span><br><span class="line">![choice](https://i.imgur.com/bzZ8FsZ.png)</span><br><span class="line"></span><br><span class="line">5. file</span><br><span class="line"></span><br><span class="line">A *file* parameter allows you to specify a file to upload that your pipeline might require.</span><br><span class="line">![file](https://i.imgur.com/zXmC4BJ.png)</span><br><span class="line"></span><br><span class="line">### Triggers</span><br><span class="line">The *triggers* directive defines the various ways to rigger a pipeline.</span><br><span class="line"></span><br><span class="line">Pipelines created using Jenkins Blue Ocean may not require triggers, since such Pipelines are triggered using webhooks configured on the source code repository (Git/GitHub/GitLab).</span><br><span class="line"></span><br><span class="line">Following are the two triggers directives that might be useful, in some scenarios, for your Continuous Delivery pipeline.</span><br><span class="line">1. cron</span><br><span class="line">The *cron* trigger accepts a cron-style string to define a regular interval at which the piepleine shoulde be re-triggered, for example:</span><br></pre></td></tr></table></figure></p>
<p>pipeline {<br>    agent any<br>    triggers {<br>       cron(‘H <em>/4 </em> * 1-5’)<br>    }</p>
<pre><code>stages {
   stage(&apos;Long running test&apos;) {
      steps {
         // Do something
      }
   }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">2. upstream</span><br><span class="line">The *upstream* trigger allows you to define a comma-sparated list of jobs and a threshold. When any of the jobs from the list finishes with the defined threshold, your pipeline gets triggererd. This feature is useful if your CI and CD Pipelines are two separate Jenkins Pipelines.</span><br><span class="line">![upstream](https://i.imgur.com/TOK46DZ.png)</span><br><span class="line"></span><br><span class="line">### Stage</span><br><span class="line">A pipeline stage contains one or more *steps* to achieve a task, for example: Build, Unit-Test, Staic Code Analysis, etc. The *stage* directive contains one or more *steps* sections, an *agent* section (optional), and other stage-related directives.</span><br><span class="line">In the previous sections, you have already seen many examples demonstrating the stage directive. It is possible to run multiple stage directives in sequence, in parallel, or a combination of both. You’ll see it shortly.</span><br><span class="line"></span><br><span class="line">### tools</span><br><span class="line">A *tools** directive allows you to install a tool on your agent automatically. It can be defined inside a *pipeline &#123;&#125;* or a *stage &#123;&#125;* block.</span><br><span class="line">![](https://i.imgur.com/NtZHRhQ.png)</span><br><span class="line"></span><br><span class="line">For the tools directive to work, the respective tool must be pre-configured in Jenkins under **Manage Jenkins**-&gt; **Global Tool Configuraton**. However, the tools directive gets ingnored if you put an *agent none* section in the *pipeline &#123;&#125;* block.</span><br><span class="line"></span><br><span class="line">As of today, only the following tools work in Declarative Pipeline:</span><br><span class="line">- maven</span><br><span class="line">- jdk</span><br><span class="line">- gradle</span><br><span class="line"></span><br><span class="line">### input</span><br><span class="line">The *input* directive allows the Pipleine to prompt for input. The *input* directive works with the *stage* directive. When used, the *stage* directive pauses and wait for your input, and when you provide the input, the stage then continues to run.</span><br><span class="line">![input options table](https://i.imgur.com/qrWOh2L.png)</span><br><span class="line"></span><br><span class="line">![input code](https://i.imgur.com/AQuF2fa.png)</span><br><span class="line"></span><br><span class="line">### when</span><br><span class="line">The *when* directive allows your Pipeline to decide whether a *stage* directive should be run based on some conditions.</span><br><span class="line"></span><br><span class="line">The *when* directive must contain at least one condition. If the *when* directive contains more than one condition, all the chould conditions must return true for the stage to execute.</span><br><span class="line"></span><br><span class="line">1. branch</span><br><span class="line">Run a *stage* directive only if the branch that’s being built matches the branch pattern provided.</span><br><span class="line">![branch condition](https://i.imgur.com/ofJR2Gl.png)</span><br><span class="line"></span><br><span class="line">The *Performance Testing* stage in this Pipeline runs for all branches that start with a *release*-string. Example: *release-beta, release-1.0.0.1*.</span><br><span class="line"></span><br><span class="line">2. buildingTag</span><br><span class="line">The *buildingTag* option allows you to run a stage only if the Pipeline is building a tag.</span><br><span class="line">![buildingTag](https://i.imgur.com/378lFdP.png)</span><br><span class="line"></span><br><span class="line">3. tag</span><br><span class="line">The *tag* option allows you to run a *stage* directive only if the *TAG_NAME* variable matches the pattern provided.</span><br><span class="line"></span><br><span class="line">If you provide an empty pattern, and your Pipeline is building some tag, then the *tag* option behaves the same as a *buildingTag()*.</span><br><span class="line"></span><br><span class="line">![tag](https://i.imgur.com/JZ4zMRT.png)</span><br><span class="line"></span><br><span class="line">To the *tag* option, you can add a *comparator* parameter to define how a given pattern must get evaluated. The options for the *comparator* parameter include *EQUALS* for simple string comparison, *GLOB* (the default) for an ANT style path glob, *orREGEXP* for regular expression matching.</span><br><span class="line"></span><br><span class="line">![comarator](https://i.imgur.com/JbP9Liu.png)</span><br><span class="line"></span><br><span class="line">The Publish stage in the above Pipeline runs if the tags being built match anything between release-0.0.0.0-nightly and release-9.9.9.9-nightly.</span><br><span class="line"></span><br><span class="line">4. changelog</span><br><span class="line">The *changelog* option allows you to execute a *stage* directive only if the Pipeline’s SCM changelog contains a specific regular expression pattern. The SCM changelog contains information about the list of modified files, the branch of the repository where the respective files were modified, the user who made the changes, and more.</span><br><span class="line"></span><br><span class="line">![changelog](https://i.imgur.com/9uUBGHD.png)</span><br><span class="line"></span><br><span class="line">5. changeset</span><br><span class="line">The *changeset* option allows you to execute a *stage* directive if the Pipeline’s SCM changeset contains one or more files matching the given string or glob. The SCM changeset is a list of modified files relating to a commit.</span><br><span class="line"></span><br><span class="line">![changeset](https://i.imgur.com/13dSS1R.png)</span><br><span class="line"></span><br><span class="line">By default the matching is case-insensitive; to make case-sensitive, use the *caseSensitive* parameter.</span><br></pre></td></tr></table></figure></p>
<p>when { changeset glob: “Simlulator_SAS.*”, caseSensitive: true }<br><code>`</code></p>
<ol start="6">
<li>environment<br>The <em>environment</em> option allows you to execute a <em>stage</em> directive only when a specific environment variable is set to the given value. To give you an example use-case, let us assume that you have multiple geographical regions where you are required to deploy your successfully tested artifacts—let’s say, apac and japac. And, for all these environments, the deployment steps are different. So, using the <em>when</em> directive with <em>environment</em> condition, you can design your pipeline as shown here.</li>
</ol>
<p><img src="https://i.imgur.com/9vXmWEx.png" alt="environment"></p>
<ol start="7">
<li>equals<br>The <em>equals</em> option allows you to execute a <em>stage</em> directive only when an expected value equals the real value.</li>
</ol>
<p><img src="https://i.imgur.com/nT7HPpR.png" alt="equals"></p>
<ol start="8">
<li><p>expression<br>The <em>expression</em> option allows you to run a stage only when the specified Groovy expression holds true.<br><img src="https://i.imgur.com/xRBayPL.png" alt="expression"></p>
</li>
<li><p>not<br>Use the <em>not</em> option to execute a <em>stage</em> directive when all of the nested conditions are true and must contain at least one condition.<br><img src="https://i.imgur.com/QOlR9f3.png" alt="not"></p>
</li>
<li><p>allOf<br>Use the <em>allOf</em> option to execute a <em>stage</em> directive when all of the nested conditions are true and must contain at least one condition.<br><img src="https://i.imgur.com/JKFI18a.png" alt=""></p>
</li>
<li><p>anyOf<br>Use the <em>anyOf</em> option to execute a <em>stage</em> directive when at least one of the nested conditions are true and must contain at least one condition.</p>
</li>
</ol>
<p><img src="https://i.imgur.com/r9Lcscp.png" alt=""></p>
<ol start="12">
<li>Evaluate When Before Entering the Stage’s Agent<br>By default the when condition for a stage directive gets evaluated after entering the agent defined for the stage.To change this behavior, use the beforeAgent option within the when {} block.</li>
</ol>
<p><img src="https://i.imgur.com/pcRUia1.png" alt=""></p>
<h2 id="Sequentail-stages"><a href="#Sequentail-stages" class="headerlink" title="Sequentail stages"></a>Sequentail stages</h2><p>Multiple <em>stage</em> directives in Declarative Pipeline can be defined in sequence. A <em>stage</em> directive can contain only one <em>steps {}, parallen {},</em> or <em>stages {}</em> block.</p>
<ol>
<li>Simple Sequential Stages<br><img src="https://i.imgur.com/HqdwQaB.png" alt="Simple sequential stages figure"></li>
</ol>
<p><img src="https://i.imgur.com/lbHccu0.png" alt="Simple sequential stages code"></p>
<p>The <em>pipeline {}</em> block compulsory has a <em>stages {}</em> block. All the <em>stage</em> directives that should run in the sequence are defined inside the <em>stages {}</em> block, one after the other.</p>
<ol start="2">
<li>Nested sequential stages<br>In Declarative Pipeline, it is possible to nest multiple stage directives that are in sequence inside another stage directive.<br><img src="https://i.imgur.com/yLSxMZI.png" alt="Nested sequential stages figure"><br><img src="https://i.imgur.com/8iAt69F.png" alt="Nested sequential stages code"><br>Notice the two <em>stage</em> directives that are in sequence (highlighted in bold) are not placed directly inside the parent <em>stage (‘Stage 1.2’) {…}</em> block. But, they are first added to a <em>stages {}</em> block, which is them placed inside the <em>stage (‘Stage 1.2’) {…}</em> block.</li>
</ol>
<h2 id="Parallel-stages"><a href="#Parallel-stages" class="headerlink" title="Parallel stages"></a>Parallel stages</h2><p>It is possible to define multiple <em>stage</em> directives in Declarative Pipeline to run in parallel with one another.<br>A <em>stage</em> directive can contain only one <em>steps {}, parallen {},</em> or <em>stages {}</em> block. Also, the nested stages cannot contain further parallel stages.</p>
<p>A <em>stage</em> directive that contains a <em>parallen {}</em> block cannot contain <em>agent</em> or <em>tools</em> sections since they are not applicable without the <em>steps {}</em> block.</p>
<ol>
<li>Simple parallel stages<br><img src="https://i.imgur.com/7fqNbdX.png" alt="Simple parallel stages figure"><br><img src="https://i.imgur.com/rc05gg4.png" alt="Simple parallel stages code"><br>The pipeline {} block compulsory has a stages {} block. All the stage directives that should run in parallel are defined one after the other inside a parallel {} block. The parallel {} block is then defined inside the parent stage {} block.</li>
<li>Nested parallel stages<br>In Declarative Pipeline, it is possible to nest multiple stage directives that are in parallel inside another stage directive.<br><img src="https://i.imgur.com/82ksxy9.png" alt="Nested parallel stages figure"><br><img src="https://i.imgur.com/KIxaHqF.png" alt="Nested parallel stages code "></li>
</ol>
<h2 id="STEPS"><a href="#STEPS" class="headerlink" title="STEPS"></a>STEPS</h2><p>There are a large number of steps available for Jenkins. You can find them at <a href="https://jenkins.io/doc/pipeline/steps/">https://jenkins.io/doc/pipeline/steps/</a></p>
<p>Every new Jenkins Plugin that’s compatible with the Scripted Pipeline adds a new step to the list of steps. However, not all of the steps available for Jenkins are compatible with the Declarative Pipeline. The ones that are compatible are available as a step inside the Visual Pipeline Editor.</p>
<p>To make the incompatible steps work with Declarative Pipeline, you need to enclose them inside the script {} block, also called the script step.</p>
<p>However, if you are creating a pipeline using the Visual Pipeline Editor, the script step is available as Run Arbitrary Pipeline Script inside the list of Steps.</p>
<h2 id="Script"><a href="#Script" class="headerlink" title="Script"></a>Script</h2><p>In simple terms, the script {} block allows you to execute a Scripted Pipeline inside a Declarative Pipeline.</p>
<p><img src="https://i.imgur.com/Gm6EcNy.png" alt="script"></p>
<p>There is no limit to the size of Scripted Pipeline you can run inside the script {} block. However, it is recommended to move anything bigger than a few lines to Shared Libraries. Also, any piece of code that is common across multiple pipelines must be moved to Shared Libraries.In the final chapter, you’ll learn to extend your Jenkins Blue Ocean pipelines or, shall we say, the Declarative Pipeline, using the script step and Shared Libraries.</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Jenkins/">Jenkins</a><a href="/tags/Devops/">Devops</a><a href="/tags/CD-CI/">CD/CI</a><a href="/tags/Pileline/">Pileline</a><a href="/tags/Blue-Ocean/">Blue Ocean</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://223.95.78.227/2019/07/26/jenkins-bule-ocean/" data-title="jenkins pipleline | Stan Zhou&#39;s Hexo Technical Blog" data-tsina="undefined" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2019/07/23/LinuxSystemAdmin/"  title="LinuxSystemAdmin">
 <strong>下一篇：</strong><br/> 
 <span>LinuxSystemAdmin
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#An-Example-of-Declarative-Pipeline"><span class="toc-number">1.</span> <span class="toc-text">An Example of Declarative Pipeline:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequentail-stages"><span class="toc-number">1.1.</span> <span class="toc-text">Sequentail stages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Parallel-stages"><span class="toc-number">1.2.</span> <span class="toc-text">Parallel stages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STEPS"><span class="toc-number">1.3.</span> <span class="toc-text">STEPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Script"><span class="toc-number">1.4.</span> <span class="toc-text">Script</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="stanosaka" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Devops/" title="Devops">Devops<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/aws/" title="aws">aws<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/centos/" title="centos">centos<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/CD-CI/" title="CD/CI">CD/CI<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tomcat/" title="tomcat">tomcat<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/saltstack/" title="saltstack">saltstack<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/zabbix/" title="zabbix">zabbix<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ec2/" title="ec2">ec2<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/backup/" title="backup">backup<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/agile/" title="agile">agile<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/software-development/" title="software development">software development<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/agile-development/" title="agile development">agile development<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ansbile/" title="ansbile">ansbile<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://zety.com/mycv/00root" target="_blank" title="Stan&#39;s resume">Stan&#39;s resume</a>
            
          </li>
        
          <li>
            
            	<a href="https://cloud.ibm.com/docs/tutorials?topic=solution-tutorials-tutorials" target="_blank" title="IBM cloud solution tutorial">IBM cloud solution tutorial</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.tecmint.com" target="_blank" title="Linux Howto's Guide">Tecmint</a>
            
          </li>
        
          <li>
            
            	<a href="http://rogerdudler.github.io/git-guide" target="_blank" title="Git commands">Git commands</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" title="Dockerfile reference">Dockerfile reference</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2mTQr8l" target="_blank" title="Linux Command line cheat sheet">Linux Command line cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2EPHxze" target="_blank" title="PowerShell Basic Cheat Sheet">PowerShell Basic Cheat Sheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://stanchou.wordpress.com" target="_blank" title="Stan&#39;s wordpress">Stan&#39;s wordpress</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.00root.com" target="_blank" title="Stan&#39;s gitbook">Stan&#39;s gitbook</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.gitbook.com/book/yeasy/docker_practice/details" target="_blank" title="Learn Docker">Learn Docker</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.unixhot.com/page/ops" target="_blank" title="运维知识体系">运维知识体系</a>
            
          </li>
        
          <li>
            
            	<a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" title="sed cheatsheet">sed cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://obsavus1p.bkt.clouddn.com/vim_cheat_sheet_for_programmers_print.png" target="_blank" title="vim cheatsheet">vim cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/aws-samples" target="_blank" title="AWS Samples">AWS Samples</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/bikrambora/devlab-launchpad" target="_blank" title="Welcome to Dev Labs">Dev Labs</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.lib.uts.edu.au" target="_blank" title="shoujin.wang@student.uts.edu.au">UTS Library</a>
            
          </li>
        
          <li>
            
            	<a href="https://7esl.com" target="_blank" title="ESL">ESL</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Stan live in Sydney. <br/>
			I am a lifelong technology learner.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/stanosaka" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6724938" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/stanosaka" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/stan.osaka" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/00root" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/btw01v" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/stan-22-82" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:devops@cwzhou.win" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="Stan Zhou">Stan Zhou</a>
		
		
		</p>
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>


        
  	    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
               if (window.mermaid) {
                  mermaid.initialize({theme: 'forest'});
               }
            </script>
        



<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
