
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Jenkins Pipeline | Stan Zhou&#39;s Hexo Technical Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stan Zhou">
    

    
    <meta name="description" content="An Example of Declarative Pipeline:123456789101112131415161718192021222324252627282930313233343536pipeline &amp;#123;    agent &amp;#123;       node &amp;#123;           label &apos;master&apos;       &amp;#125;    &amp;#125;    s">
<meta name="keywords" content="Jenkins,Devops,CD&#x2F;CI,Pipeline,Blue Ocean">
<meta property="og:type" content="article">
<meta property="og:title" content="Jenkins Pipeline">
<meta property="og:url" content="http://223.95.78.227/2019/07/29/jenkins-blue-ocean/index.html">
<meta property="og:site_name" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:description" content="An Example of Declarative Pipeline:123456789101112131415161718192021222324252627282930313233343536pipeline &amp;#123;    agent &amp;#123;       node &amp;#123;           label &apos;master&apos;       &amp;#125;    &amp;#125;    s">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://i.imgur.com/6ByXXdT.png">
<meta property="og:image" content="https://i.imgur.com/MQIQ9ID.png">
<meta property="og:image" content="https://i.imgur.com/fw2xBh7.png">
<meta property="og:image" content="https://i.imgur.com/jtj39sB.png">
<meta property="og:image" content="https://i.imgur.com/oINFaFW.png">
<meta property="og:image" content="https://i.imgur.com/M2e1Xq0.png">
<meta property="og:image" content="https://i.imgur.com/xctaUYY.png">
<meta property="og:image" content="https://i.imgur.com/wmfuirh.png">
<meta property="og:image" content="https://i.imgur.com/FxgpLwC.png">
<meta property="og:image" content="https://i.imgur.com/g07NWDy.png">
<meta property="og:image" content="https://i.imgur.com/ifB8mza.png">
<meta property="og:image" content="https://i.imgur.com/hLjjGBF.png">
<meta property="og:image" content="https://i.imgur.com/Kv5XzMK.png">
<meta property="og:image" content="https://i.imgur.com/QBq3HBf.png">
<meta property="og:image" content="https://i.imgur.com/QIBJjWM.png">
<meta property="og:image" content="https://i.imgur.com/vSrmP5T.png">
<meta property="og:image" content="https://i.imgur.com/AVmdPvS.png">
<meta property="og:image" content="https://i.imgur.com/bzZ8FsZ.png">
<meta property="og:image" content="https://i.imgur.com/zXmC4BJ.png">
<meta property="og:image" content="https://i.imgur.com/TOK46DZ.png">
<meta property="og:image" content="https://i.imgur.com/NtZHRhQ.png">
<meta property="og:image" content="https://i.imgur.com/qrWOh2L.png">
<meta property="og:image" content="https://i.imgur.com/AQuF2fa.png">
<meta property="og:image" content="https://i.imgur.com/ofJR2Gl.png">
<meta property="og:image" content="https://i.imgur.com/378lFdP.png">
<meta property="og:image" content="https://i.imgur.com/JZ4zMRT.png">
<meta property="og:image" content="https://i.imgur.com/JbP9Liu.png">
<meta property="og:image" content="https://i.imgur.com/9uUBGHD.png">
<meta property="og:image" content="https://i.imgur.com/13dSS1R.png">
<meta property="og:image" content="https://i.imgur.com/9vXmWEx.png">
<meta property="og:image" content="https://i.imgur.com/nT7HPpR.png">
<meta property="og:image" content="https://i.imgur.com/xRBayPL.png">
<meta property="og:image" content="https://i.imgur.com/QOlR9f3.png">
<meta property="og:image" content="https://i.imgur.com/JKFI18a.png">
<meta property="og:image" content="https://i.imgur.com/r9Lcscp.png">
<meta property="og:image" content="https://i.imgur.com/pcRUia1.png">
<meta property="og:image" content="https://i.imgur.com/HqdwQaB.png">
<meta property="og:image" content="https://i.imgur.com/lbHccu0.png">
<meta property="og:image" content="https://i.imgur.com/yLSxMZI.png">
<meta property="og:image" content="https://i.imgur.com/8iAt69F.png">
<meta property="og:image" content="https://i.imgur.com/7fqNbdX.png">
<meta property="og:image" content="https://i.imgur.com/rc05gg4.png">
<meta property="og:image" content="https://i.imgur.com/82ksxy9.png">
<meta property="og:image" content="https://i.imgur.com/KIxaHqF.png">
<meta property="og:image" content="https://i.imgur.com/Gm6EcNy.png">
<meta property="og:image" content="https://i.imgur.com/pFaHQuZ.png">
<meta property="og:image" content="https://i.imgur.com/nUi1uKk.png">
<meta property="og:image" content="https://i.imgur.com/RKOm2V2.png">
<meta property="og:image" content="https://i.imgur.com/6NOb5kY.png">
<meta property="og:image" content="https://i.imgur.com/fBKsY4k.png">
<meta property="og:image" content="https://i.imgur.com/SOXKlCZ.png">
<meta property="og:image" content="https://i.imgur.com/FR5koOy.png">
<meta property="og:image" content="https://i.imgur.com/zdRO91W.png">
<meta property="og:image" content="https://i.imgur.com/yguB0hB.png">
<meta property="og:image" content="https://i.imgur.com/ZtwyY00.png">
<meta property="og:image" content="https://i.imgur.com/8QGv9eH.png">
<meta property="og:image" content="https://i.imgur.com/1wyyhNT.png">
<meta property="og:image" content="https://i.imgur.com/e0XDMmW.png">
<meta property="og:image" content="https://i.imgur.com/O5Do1D7.png">
<meta property="og:image" content="https://i.imgur.com/Skz6Yg7.png">
<meta property="og:image" content="https://i.imgur.com/X1ogakY.png">
<meta property="og:image" content="https://i.imgur.com/zg4Jc5G.png">
<meta property="og:image" content="https://i.imgur.com/2HYkBP5.png">
<meta property="og:image" content="https://i.imgur.com/2HYkBP5.png">
<meta property="og:image" content="https://i.imgur.com/HAq6sYq.png">
<meta property="og:image" content="https://i.imgur.com/vXUpngZ.png">
<meta property="og:image" content="https://i.imgur.com/9W9fTUQ.png">
<meta property="og:image" content="https://i.imgur.com/l3VMpHu.png">
<meta property="og:image" content="https://i.imgur.com/id9vL50.png">
<meta property="og:image" content="https://i.imgur.com/Ec4LinF.png">
<meta property="og:image" content="https://i.imgur.com/kUvGGZM.jpg">
<meta property="og:image" content="https://i.imgur.com/63ETSbk.png">
<meta property="og:updated_time" content="2019-07-29T05:01:26.031Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jenkins Pipeline">
<meta name="twitter:description" content="An Example of Declarative Pipeline:123456789101112131415161718192021222324252627282930313233343536pipeline &amp;#123;    agent &amp;#123;       node &amp;#123;           label &apos;master&apos;       &amp;#125;    &amp;#125;    s">
<meta name="twitter:image" content="https://i.imgur.com/6ByXXdT.png">
<meta name="twitter:creator" content="@stanosaka">

    
    <link rel="alternative" href="/atom.xml" title="Stan Zhou&#39;s Hexo Technical Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/toad.ico">
    
    
    <link rel="apple-touch-icon" href="/img/toadman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/toadman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/toadman.png" alt="Stan Zhou&#39;s Hexo Technical Blog" title="Stan Zhou&#39;s Hexo Technical Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Stan Zhou&#39;s Hexo Technical Blog">Stan Zhou&#39;s Hexo Technical Blog</a></h1>
				<h2 class="blog-motto">Innovation Evangelist</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:223.95.78.227">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/07/29/jenkins-blue-ocean/" title="Jenkins Pipeline" itemprop="url">Jenkins Pipeline</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-07-29T01:00:54.000Z" itemprop="datePublished"> Published 2019-07-29</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#An-Example-of-Declarative-Pipeline"><span class="toc-number">1.</span> <span class="toc-text">An Example of Declarative Pipeline:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Declarative-Pipeline-Syntax"><span class="toc-number">1.1.</span> <span class="toc-text">Declarative Pipeline Syntax</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Agent"><span class="toc-number">1.1.1.</span> <span class="toc-text">Agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Directives"><span class="toc-number">1.1.2.</span> <span class="toc-text">Directives</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Parameters"><span class="toc-number">1.1.3.</span> <span class="toc-text">Parameters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Triggers"><span class="toc-number">1.1.4.</span> <span class="toc-text">Triggers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stage"><span class="toc-number">1.1.5.</span> <span class="toc-text">Stage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tools"><span class="toc-number">1.1.6.</span> <span class="toc-text">tools</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#input"><span class="toc-number">1.1.7.</span> <span class="toc-text">input</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#when"><span class="toc-number">1.1.8.</span> <span class="toc-text">when</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequentail-stages"><span class="toc-number">1.2.</span> <span class="toc-text">Sequentail stages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Parallel-stages"><span class="toc-number">1.3.</span> <span class="toc-text">Parallel stages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STEPS"><span class="toc-number">1.4.</span> <span class="toc-text">STEPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Script"><span class="toc-number">1.5.</span> <span class="toc-text">Script</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Shared-Library"><span class="toc-number">2.</span> <span class="toc-text">Shared Library</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Setting-up-Jenkins-Blue-Ocean"><span class="toc-number">3.</span> <span class="toc-text">Setting up Jenkins Blue Ocean</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-up-Blue-Ocean-using-docker"><span class="toc-number">3.1.</span> <span class="toc-text">Setting up Blue Ocean using docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run-Jenkins-blue-ocrean-behind-a-reverse-proxy"><span class="toc-number">3.2.</span> <span class="toc-text">Run Jenkins blue ocrean behind a reverse proxy</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Creating-Pipeline"><span class="toc-number">4.</span> <span class="toc-text">Creating Pipeline</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Using-the-pipeline-creation-wizard-configure-Jenkins-Blue-Ocean-with-various-types-of-source-code-repositories"><span class="toc-number">5.</span> <span class="toc-text">Using the pipeline creation wizard, configure Jenkins Blue Ocean with various types of source code repositories.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Using-the-Visual-Pipeline-Editor-to-design-Pipeline"><span class="toc-number">6.</span> <span class="toc-text">Using the Visual Pipeline Editor to design Pipeline.</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Issue"><span class="toc-number">6.1.</span> <span class="toc-text">Issue</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="An-Example-of-Declarative-Pipeline"><a href="#An-Example-of-Declarative-Pipeline" class="headerlink" title="An Example of Declarative Pipeline:"></a>An Example of Declarative Pipeline:</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">       node &#123;</span><br><span class="line">           label <span class="string">'master'</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">       stage(<span class="string">'Build'</span>) &#123;</span><br><span class="line">           steps &#123;</span><br><span class="line">               sh <span class="string">'mvn clean verify -DskipITs=true'</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       stage (<span class="string">'Static Code Analysis'</span>) &#123;</span><br><span class="line">           steps &#123;</span><br><span class="line">               sh <span class="string">'mvn clean verify sonar:sonar'</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       stage (<span class="string">'Publish to Artifactory'</span>) &#123;</span><br><span class="line">           steps &#123;</span><br><span class="line">               script &#123;</span><br><span class="line">                   def server = Artifactory.server <span class="string">'Default Artifactory'</span></span><br><span class="line">                   def uploadSpec = <span class="string">""</span><span class="string">"&#123;</span></span><br><span class="line"><span class="string">                       "</span>files<span class="string">": [</span></span><br><span class="line"><span class="string">                           &#123;</span></span><br><span class="line"><span class="string">                               "</span>pattern<span class="string">": "</span>target/*.war<span class="string">",</span></span><br><span class="line"><span class="string">                               "</span>target<span class="string">": "</span>helloworld/<span class="variable">$&#123;BUILD_NUMBER&#125;</span>/<span class="string">",</span></span><br><span class="line"><span class="string">                               "</span>pattern<span class="string">": "</span>Unit-Tested=Yes<span class="string">",</span></span><br><span class="line"><span class="string">                           &#125;</span></span><br><span class="line"><span class="string">                        ]</span></span><br><span class="line"><span class="string">                    &#125;"</span><span class="string">""</span></span><br><span class="line">                    server.upload(uploadSpec)</span><br><span class="line">		&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Jenkinsfile</strong><br>A Jenkinsfile is a file that contains Pipeline code.</p>
<h2 id="Declarative-Pipeline-Syntax"><a href="#Declarative-Pipeline-Syntax" class="headerlink" title="Declarative Pipeline Syntax"></a>Declarative Pipeline Syntax</h2><p><strong>Sections</strong></p>
<p>Sections in Declarative Pipeline Syntax can contain one or more Directive or Steps.</p>
<h3 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h3><ul>
<li>The <em>agent</em> section defines where the whole Pipleline, or a specific stage, runs. It is positioned right at the beginnning of the <em>pipeline { }</em> block the is compolsory.</li>
<li>can also use it inside the <em>stage</em> directive, but that’s optional.<br>The <em>agent</em> section allow specific parameters to suit various use-cases.</li>
</ul>
<p><strong>any</strong></p>
<p>Use <em>agent any</em> inside your <em>pipleine {}</em> block, or <em>stage</em> directive, to run them on any agent available in Jenkins.<br><img src="https://i.imgur.com/6ByXXdT.png" alt="A pipleline{}Block with agent any"></p>
<p><strong>none</strong></p>
<p>Use <em>agent node</em> inside your <em>pipeline {}</em> block to stop any global agent from running your pipeline. In such case, each <em>stage</em> directive inside your pipeline must have its <em>agent</em> section.<br><img src="https://i.imgur.com/MQIQ9ID.png" alt="A Pipeline{}Block with Agnet None"></p>
<p><strong>label</strong></p>
<p>Run your complete pipeline, or stage, on an agent available in Jenkins with specific label.<br><img src="https://i.imgur.com/fw2xBh7.png" alt="A pipeline{} block with agent { label &#39;....&#39;} section"></p>
<p><strong>node</strong></p>
<p>Run your complete pipeline, or stage, on an agent available in Jenkins with s specific label. The behavior is similar to the <em>label</em> parameter. Howerver, the <em>node</em> parameter allows you to specify additional options such as <em>customWorkspace</em>. Workspace, or Jenkins Pipeline workspace, is a reserved directory on your Jenkins agent, where all your source code is downloaded and where your builds are performed.</p>
<p><img src="https://i.imgur.com/jtj39sB.png" alt="agent node customWorkspace section"></p>
<p><strong>docker</strong></p>
<p>Run your complete pipeline, or stage, inside a docker container. The container will be dynamically spawned on a pre-configured docker host.</p>
<p>The <em>docker</em> option also takes an <em>args</em> parameter that allows you to pass arguments directly to the <em>docker run</em> command.</p>
<p><img src="https://i.imgur.com/oINFaFW.png" alt="An agent section with docker parameter"></p>
<p><strong>dockerfile</strong></p>
<p>Run your pipeline, or stage, inside a conatiner build from a <em>dockerfile</em>. To use this option, the <em>jenkinsfile</em> and the <em>dockerfile</em> should be present inside the root of your source code.</p>
<p><img src="https://i.imgur.com/M2e1Xq0.png" alt="agent section with dockerfile"></p>
<p><strong>post</strong></p>
<p>The <em>post</em> section allows you to run additional <em>setps</em> after running a pipeline or a stage.<br><img src="https://i.imgur.com/xctaUYY.png" alt="a post section at the end of a pipeline"></p>
<p><img src="https://i.imgur.com/wmfuirh.png" alt="add specific conditions to post section"></p>
<p><strong>stages</strong></p>
<p>The <em>stages</em> section contains a sequence of one or more <em>stage</em> directives. It’s used to segregate a sinle or a collection of <em>stage</em> directives form the rest of the code.</p>
<p>The <em>stages</em> section has no parameters and gets used at least once in the pipeline.</p>
<p><strong>steps</strong></p>
<p>The <em>steps</em> section contains one or more steps that should run inside a <em>stage</em> directive. The <em>steps</em> section is used to segrate a single or a collection of steps from the rest of the code inside a <em>stage</em> directive.<br><img src="https://i.imgur.com/FxgpLwC.png" alt="a pipeline{} block with steps section"></p>
<h3 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h3><p>Directives are supporting actors that give direction, set conditions, and provide assistance to the steps of your pipeline in order to archieve the required purpose. In the following section we will see all the <em>Directives</em> that are available to you with the Declarative Pipeline Syntax.</p>
<p><strong>environment</strong><br>The <em>environment</em> directive is used to specify a set of key value pairs that are available as environment variables for all the steps of your pipeline, or only for the steps of a specific stage, depending on where you place the <em>environment</em> directive.</p>
<p><img src="https://i.imgur.com/g07NWDy.png" alt="pipeline block with environment section"></p>
<p><strong>options</strong><br>The <em>options</em> directive allows you to define pipeline-specific <em>options</em> from within the pipeline.</p>
<ol>
<li><p>buildDiscarder<br>Allows you to keep a certain number of recent builds run.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// Will keep the last 10 Pipeline logs and artifacts in Jenkins.</span><br><span class="line">options &#123;</span><br><span class="line">   biuldDiscarder(logRotator(numToKeepStr: &apos;10&apos;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>disableConcurrentBuilds<br>Disallows concurrent executions of the Pipeline.<br>To understand the usage of this option, imagine a situation. You have a Pipeline in Jenkins Blue Ocean that’s triggered on every push on your source code repository. Moreover, you have a single build agent to run your Pipeline.</p>
</li>
</ol>
<p>Now, if there are multiple pushes to the repository in a short duration of time (say three different pushes at once), then there is a pipeline for every push (say, Pipelines #1, #2, and #3). However, since we have a single build agent, Pipelines #2 and #3 wait in a queue with Pipeline #1 running. Pipelines #2 and #3 run whenever the build agent is free again.</p>
<p>To disable this functionality, and discard everything that’s in the queue, you should use the disableConcurrentBuilds option. The following option is useful to perform incremental builds.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">options &#123;    </span><br><span class="line">   disableConcurrentBuilds ()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>newContainerPerStage</li>
</ol>
<p>The <em>newContainerPerStage</em> option is used inside an agent section that employs the docker or dockerfile parameters.</p>
<p>When specified, each stage runs in a new container on the same docker host, as opposed to all stages utilizing the same container.</p>
<p>This option only works with an <em>agent</em> section defined at the top-level of your <em>Pipeline {}</em> block.</p>
<ol start="4">
<li>preserveStashes<br>In Jenkins, you can pass artifacts between stages. You do it using stash. The <em>preserveStashes</em> option allows you to preserve stashes of the completed Pipelines. It’s useful if you have to re-run a stage from a completed Pipeline.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// Preserver stashes from the most recent completed Pipeline.</span><br><span class="line">options &#123;</span><br><span class="line">   perserveStashes()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>or<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// Preserve stashes from the ten most recent completed Pipelines.</span><br><span class="line">options &#123;</span><br><span class="line">   perserveStashes(10)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="5">
<li><p>retry<br>The retry option allows you to retry a Pipeline, or a stage, on failure.<br><img src="https://i.imgur.com/ifB8mza.png" alt="retry"></p>
</li>
<li><p>skipDefaultCheckout<br>The <em>skipDefaultCheckout</em> option is another handy choice. In Jenkins Declarative Pipeline, the source code by default gets checked out in every <em>stage</em> directive of a Pipeline.</p>
</li>
</ol>
<p>Use this option to skip checking out source code in a given <em>stage</em> directive.</p>
<p><img src="https://i.imgur.com/hLjjGBF.png" alt="block with skipDefaultCheckout options"></p>
<ol start="7">
<li>timeout<br>The <em>timeout</em> option allows you to set a timeout period for your Pipeline run. If the pipeline run teimes out the duration defined using a <em>timeout</em>, Jenkins aborts the Pipeline.</li>
</ol>
<p>It is possible to use the timeout option at the Pipeline or stage level.</p>
<p><img src="https://i.imgur.com/Kv5XzMK.png" alt="timeout option"></p>
<p>There are times when a pipeline that’s waiting for a process runs forever, generating huge logs and bringing down Jenkins server. The timeout option comes handy in such cases.</p>
<ol start="8">
<li>timestamps<br>The <em>timestamps</em> option prepend all lines of the console log with a timestamp. The following option is useful in debugging issues where you would need the time of execution of a specific command as evidence.</li>
</ol>
<p>It is possible to use the <em>timestamps</em> option at the Pipeline or stage level.</p>
<p><img src="https://i.imgur.com/QBq3HBf.png" alt="timestamps"></p>
<h3 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h3><p>The <em>parameters</em> directive allows a user to provide a list of specific parameters when triggering a Pipeline.</p>
<p>Following are the types of available parameters that I find useful.</p>
<ol>
<li>string</li>
</ol>
<p>Use the <em>string</em> parameter to pass a string.<br><img src="https://i.imgur.com/QIBJjWM.png" alt="string"></p>
<ol start="2">
<li>text</li>
</ol>
<p>Use the <em>text</em> parameter to pass a multiline text.<br><img src="https://i.imgur.com/vSrmP5T.png" alt="text"></p>
<ol start="3">
<li>booleanParam</li>
</ol>
<p>Use the <em>booleanParam</em> parameter to pass true for false.<br><img src="https://i.imgur.com/AVmdPvS.png" alt="booleanParam"></p>
<ol start="4">
<li>choice</li>
</ol>
<p>Use the <em>choice</em> parameter to allow you to choose from a set of values, and them pass it to the pipeline<br><img src="https://i.imgur.com/bzZ8FsZ.png" alt="choice"></p>
<ol start="5">
<li>file</li>
</ol>
<p>A <em>file</em> parameter allows you to specify a file to upload that your pipeline might require.<br><img src="https://i.imgur.com/zXmC4BJ.png" alt="file"></p>
<h3 id="Triggers"><a href="#Triggers" class="headerlink" title="Triggers"></a>Triggers</h3><p>The <em>triggers</em> directive defines the various ways to rigger a pipeline.</p>
<p>Pipelines created using Jenkins Blue Ocean may not require triggers, since such Pipelines are triggered using webhooks configured on the source code repository (Git/GitHub/GitLab).</p>
<p>Following are the two triggers directives that might be useful, in some scenarios, for your Continuous Delivery pipeline.</p>
<ol>
<li><p>cron<br>The <em>cron</em> trigger accepts a cron-style string to define a regular interval at which the piepleine shoulde be re-triggered, for example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    triggers &#123;</span><br><span class="line">       cron(&apos;H */4 * * 1-5&apos;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">       stage(&apos;Long running test&apos;) &#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">             // Do something</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>upstream<br>The <em>upstream</em> trigger allows you to define a comma-sparated list of jobs and a threshold. When any of the jobs from the list finishes with the defined threshold, your pipeline gets triggererd. This feature is useful if your CI and CD Pipelines are two separate Jenkins Pipelines.<br><img src="https://i.imgur.com/TOK46DZ.png" alt="upstream"></p>
</li>
</ol>
<h3 id="Stage"><a href="#Stage" class="headerlink" title="Stage"></a>Stage</h3><p>A pipeline stage contains one or more <em>steps</em> to achieve a task, for example: Build, Unit-Test, Staic Code Analysis, etc. The <em>stage</em> directive contains one or more <em>steps</em> sections, an <em>agent</em> section (optional), and other stage-related directives.<br>In the previous sections, you have already seen many examples demonstrating the stage directive. It is possible to run multiple stage directives in sequence, in parallel, or a combination of both. You’ll see it shortly.</p>
<h3 id="tools"><a href="#tools" class="headerlink" title="tools"></a>tools</h3><p>A <em>tools** directive allows you to install a tool on your agent automatically. It can be defined inside a </em>pipeline {}<em> or a </em>stage {}* block.<br><img src="https://i.imgur.com/NtZHRhQ.png" alt=""></p>
<p>For the tools directive to work, the respective tool must be pre-configured in Jenkins under <strong>Manage Jenkins</strong>-&gt; <strong>Global Tool Configuraton</strong>. However, the tools directive gets ingnored if you put an <em>agent none</em> section in the <em>pipeline {}</em> block.</p>
<p>As of today, only the following tools work in Declarative Pipeline:</p>
<ul>
<li>maven</li>
<li>jdk</li>
<li>gradle</li>
</ul>
<h3 id="input"><a href="#input" class="headerlink" title="input"></a>input</h3><p>The <em>input</em> directive allows the Pipleine to prompt for input. The <em>input</em> directive works with the <em>stage</em> directive. When used, the <em>stage</em> directive pauses and wait for your input, and when you provide the input, the stage then continues to run.<br><img src="https://i.imgur.com/qrWOh2L.png" alt="input options table"></p>
<p><img src="https://i.imgur.com/AQuF2fa.png" alt="input code"></p>
<h3 id="when"><a href="#when" class="headerlink" title="when"></a>when</h3><p>The <em>when</em> directive allows your Pipeline to decide whether a <em>stage</em> directive should be run based on some conditions.</p>
<p>The <em>when</em> directive must contain at least one condition. If the <em>when</em> directive contains more than one condition, all the chould conditions must return true for the stage to execute.</p>
<ol>
<li>branch<br>Run a <em>stage</em> directive only if the branch that’s being built matches the branch pattern provided.<br><img src="https://i.imgur.com/ofJR2Gl.png" alt="branch condition"></li>
</ol>
<p>The <em>Performance Testing</em> stage in this Pipeline runs for all branches that start with a <em>release</em>-string. Example: <em>release-beta, release-1.0.0.1</em>.</p>
<ol start="2">
<li><p>buildingTag<br>The <em>buildingTag</em> option allows you to run a stage only if the Pipeline is building a tag.<br><img src="https://i.imgur.com/378lFdP.png" alt="buildingTag"></p>
</li>
<li><p>tag<br>The <em>tag</em> option allows you to run a <em>stage</em> directive only if the <em>TAG_NAME</em> variable matches the pattern provided.</p>
</li>
</ol>
<p>If you provide an empty pattern, and your Pipeline is building some tag, then the <em>tag</em> option behaves the same as a <em>buildingTag()</em>.</p>
<p><img src="https://i.imgur.com/JZ4zMRT.png" alt="tag"></p>
<p>To the <em>tag</em> option, you can add a <em>comparator</em> parameter to define how a given pattern must get evaluated. The options for the <em>comparator</em> parameter include <em>EQUALS</em> for simple string comparison, <em>GLOB</em> (the default) for an ANT style path glob, <em>orREGEXP</em> for regular expression matching.</p>
<p><img src="https://i.imgur.com/JbP9Liu.png" alt="comarator"></p>
<p>The Publish stage in the above Pipeline runs if the tags being built match anything between release-0.0.0.0-nightly and release-9.9.9.9-nightly.</p>
<ol start="4">
<li>changelog<br>The <em>changelog</em> option allows you to execute a <em>stage</em> directive only if the Pipeline’s SCM changelog contains a specific regular expression pattern. The SCM changelog contains information about the list of modified files, the branch of the repository where the respective files were modified, the user who made the changes, and more.</li>
</ol>
<p><img src="https://i.imgur.com/9uUBGHD.png" alt="changelog"></p>
<ol start="5">
<li>changeset<br>The <em>changeset</em> option allows you to execute a <em>stage</em> directive if the Pipeline’s SCM changeset contains one or more files matching the given string or glob. The SCM changeset is a list of modified files relating to a commit.</li>
</ol>
<p><img src="https://i.imgur.com/13dSS1R.png" alt="changeset"></p>
<p>By default the matching is case-insensitive; to make case-sensitive, use the <em>caseSensitive</em> parameter.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; changeset glob: &quot;Simlulator_SAS.*&quot;, caseSensitive: true &#125;</span><br></pre></td></tr></table></figure></p>
<ol start="6">
<li>environment<br>The <em>environment</em> option allows you to execute a <em>stage</em> directive only when a specific environment variable is set to the given value. To give you an example use-case, let us assume that you have multiple geographical regions where you are required to deploy your successfully tested artifacts—let’s say, apac and japac. And, for all these environments, the deployment steps are different. So, using the <em>when</em> directive with <em>environment</em> condition, you can design your pipeline as shown here.</li>
</ol>
<p><img src="https://i.imgur.com/9vXmWEx.png" alt="environment"></p>
<ol start="7">
<li>equals<br>The <em>equals</em> option allows you to execute a <em>stage</em> directive only when an expected value equals the real value.</li>
</ol>
<p><img src="https://i.imgur.com/nT7HPpR.png" alt="equals"></p>
<ol start="8">
<li><p>expression<br>The <em>expression</em> option allows you to run a stage only when the specified Groovy expression holds true.<br><img src="https://i.imgur.com/xRBayPL.png" alt="expression"></p>
</li>
<li><p>not<br>Use the <em>not</em> option to execute a <em>stage</em> directive when all of the nested conditions are true and must contain at least one condition.<br><img src="https://i.imgur.com/QOlR9f3.png" alt="not"></p>
</li>
<li><p>allOf<br>Use the <em>allOf</em> option to execute a <em>stage</em> directive when all of the nested conditions are true and must contain at least one condition.<br><img src="https://i.imgur.com/JKFI18a.png" alt=""></p>
</li>
<li><p>anyOf<br>Use the <em>anyOf</em> option to execute a <em>stage</em> directive when at least one of the nested conditions are true and must contain at least one condition.</p>
</li>
</ol>
<p><img src="https://i.imgur.com/r9Lcscp.png" alt=""></p>
<ol start="12">
<li>Evaluate When Before Entering the Stage’s Agent<br>By default the when condition for a stage directive gets evaluated after entering the agent defined for the stage.To change this behavior, use the beforeAgent option within the when {} block.</li>
</ol>
<p><img src="https://i.imgur.com/pcRUia1.png" alt=""></p>
<h2 id="Sequentail-stages"><a href="#Sequentail-stages" class="headerlink" title="Sequentail stages"></a>Sequentail stages</h2><p>Multiple <em>stage</em> directives in Declarative Pipeline can be defined in sequence. A <em>stage</em> directive can contain only one <em>steps {}, parallen {},</em> or <em>stages {}</em> block.</p>
<ol>
<li>Simple Sequential Stages<br><img src="https://i.imgur.com/HqdwQaB.png" alt="Simple sequential stages figure"></li>
</ol>
<p><img src="https://i.imgur.com/lbHccu0.png" alt="Simple sequential stages code"></p>
<p>The <em>pipeline {}</em> block compulsory has a <em>stages {}</em> block. All the <em>stage</em> directives that should run in the sequence are defined inside the <em>stages {}</em> block, one after the other.</p>
<ol start="2">
<li>Nested sequential stages<br>In Declarative Pipeline, it is possible to nest multiple stage directives that are in sequence inside another stage directive.<br><img src="https://i.imgur.com/yLSxMZI.png" alt="Nested sequential stages figure"><br><img src="https://i.imgur.com/8iAt69F.png" alt="Nested sequential stages code"><br>Notice the two <em>stage</em> directives that are in sequence (highlighted in bold) are not placed directly inside the parent <em>stage (‘Stage 1.2’) {…}</em> block. But, they are first added to a <em>stages {}</em> block, which is them placed inside the <em>stage (‘Stage 1.2’) {…}</em> block.</li>
</ol>
<h2 id="Parallel-stages"><a href="#Parallel-stages" class="headerlink" title="Parallel stages"></a>Parallel stages</h2><p>It is possible to define multiple <em>stage</em> directives in Declarative Pipeline to run in parallel with one another.<br>A <em>stage</em> directive can contain only one <em>steps {}, parallen {},</em> or <em>stages {}</em> block. Also, the nested stages cannot contain further parallel stages.</p>
<p>A <em>stage</em> directive that contains a <em>parallen {}</em> block cannot contain <em>agent</em> or <em>tools</em> sections since they are not applicable without the <em>steps {}</em> block.</p>
<ol>
<li>Simple parallel stages<br><img src="https://i.imgur.com/7fqNbdX.png" alt="Simple parallel stages figure"><br><img src="https://i.imgur.com/rc05gg4.png" alt="Simple parallel stages code"><br>The pipeline {} block compulsory has a stages {} block. All the stage directives that should run in parallel are defined one after the other inside a parallel {} block. The parallel {} block is then defined inside the parent stage {} block.</li>
<li>Nested parallel stages<br>In Declarative Pipeline, it is possible to nest multiple stage directives that are in parallel inside another stage directive.<br><img src="https://i.imgur.com/82ksxy9.png" alt="Nested parallel stages figure"><br><img src="https://i.imgur.com/KIxaHqF.png" alt="Nested parallel stages code "></li>
</ol>
<h2 id="STEPS"><a href="#STEPS" class="headerlink" title="STEPS"></a>STEPS</h2><p>There are a large number of steps available for Jenkins. You can find them at <a href="https://jenkins.io/doc/pipeline/steps/">https://jenkins.io/doc/pipeline/steps/</a></p>
<p>Every new Jenkins Plugin that’s compatible with the Scripted Pipeline adds a new step to the list of steps. However, not all of the steps available for Jenkins are compatible with the Declarative Pipeline. The ones that are compatible are available as a step inside the Visual Pipeline Editor.</p>
<p>To make the incompatible steps work with Declarative Pipeline, you need to enclose them inside the script {} block, also called the script step.</p>
<p>However, if you are creating a pipeline using the Visual Pipeline Editor, the script step is available as Run Arbitrary Pipeline Script inside the list of Steps.</p>
<h2 id="Script"><a href="#Script" class="headerlink" title="Script"></a>Script</h2><p>In simple terms, the script {} block allows you to execute a Scripted Pipeline inside a Declarative Pipeline.</p>
<p><img src="https://i.imgur.com/Gm6EcNy.png" alt="script"></p>
<p>There is no limit to the size of Scripted Pipeline you can run inside the script {} block. However, it is recommended to move anything bigger than a few lines to Shared Libraries. Also, any piece of code that is common across multiple pipelines must be moved to Shared Libraries.In the final chapter, you’ll learn to extend your Jenkins Blue Ocean pipelines or, shall we say, the Declarative Pipeline, using the script step and Shared Libraries.</p>
<h1 id="Shared-Library"><a href="#Shared-Library" class="headerlink" title="Shared Library"></a>Shared Library</h1><p>A Jenkins Shared Library is an external source control repository containing your complex Groovy code. It acts like a function that could be used on-demand inside your Declarative Pipeline.</p>
<p><em>A Groovy Script (example.groovy)Inside Jenkins Shared Library Repository:</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def greet(message) &#123;</span><br><span class="line">   echo &quot;Hello $&#123;message&#125;, welcome to Jenkins Blue Ocean.&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>Jenkins Declarative Pipeline Utilizing the Shared Library:</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Library(&apos;Example_shared_Library&apos;) _</span><br><span class="line"></span><br><span class="line">pipeline &#123;</span><br><span class="line">  agent none</span><br><span class="line">  stage (&apos;Example&apos;) &#123;</span><br><span class="line">     steps &#123;</span><br><span class="line">        script &#123;</span><br><span class="line">           example.greet &apos;Readers&apos;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="Setting-up-Jenkins-Blue-Ocean"><a href="#Setting-up-Jenkins-Blue-Ocean" class="headerlink" title="Setting up Jenkins Blue Ocean"></a>Setting up Jenkins Blue Ocean</h1><h2 id="Setting-up-Blue-Ocean-using-docker"><a href="#Setting-up-Blue-Ocean-using-docker" class="headerlink" title="Setting up Blue Ocean using docker"></a>Setting up Blue Ocean using docker</h2><p><strong>Downloading the latest Jenkins Blue Ocean</strong></p>
<ol>
<li><p>docker pull jenkinsci/blueocean</p>
</li>
<li><p>To list the downloaded docker image: docker images</p>
</li>
</ol>
<p>Docker containers generate and use data. When a container gets deleted, its relevant data also gets lost.<br>To make the data persistent, we use docker volumes.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker volume create jenkins_home</span><br><span class="line">docker volume ls</span><br><span class="line">docker volume inspect jenkins_home <span class="comment">#get detailed info about docker volume</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Run-Jenkins-blue-ocrean-behind-a-reverse-proxy"><a href="#Run-Jenkins-blue-ocrean-behind-a-reverse-proxy" class="headerlink" title="Run Jenkins blue ocrean behind a reverse proxy"></a>Run Jenkins blue ocrean behind a reverse proxy</h2><ol>
<li><p>Run a Jenkins container</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name jenkins -v jenkins_home:/var/jenkins_home jenkinsci/blueocean</span><br></pre></td></tr></table></figure>
</li>
<li><p>Download the docker image for Nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p>Spawn a Dockr container for Nginx. Also, link the nginx container to the jenkins container using the <em>–link</em> option.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name ngingx -p 80:80 --link jenkins nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p>Get inside the Ningx container using the <em>docker exec</em> command</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it ningx /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>Update the Ubuntu package lists<br><code>apt-get update</code></p>
</li>
<li>Install vim text editor<br><code>apt-get install vim</code></li>
<li><p>Take the backup of the default.conf file inside /etc/nginx/conf.d/</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp etc/ningx/conf.d/default.conf etc/nginx/conf.d/default.conf.backup</span><br></pre></td></tr></table></figure>
</li>
<li><p>Next, replace the content of the default.conf file with the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">upstream jenkins &#123;</span><br><span class="line">  server jenkins:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name jenkins.example.com;</span><br><span class="line">  </span><br><span class="line">  location / &#123;</span><br><span class="line">     proxy_pass         http://jenkins;</span><br><span class="line">     proxy_set_header   Host <span class="variable">$host</span>;</span><br><span class="line">     proxy_set_header   X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">     proxy_set_header   X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">     proxy_set_header   X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Exit the Nginx container.<br><code>exit</code></p>
</li>
<li>Restart the Nginx container.<br><code>docker restart nginx</code></li>
<li>Run the following docker command to fetch the content of initialAdminPassword file.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it jenkins /bin/bash -c \ <span class="string">"cat /var/jenkins_home/secrets/initialAdminPassword"</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Creating-Pipeline"><a href="#Creating-Pipeline" class="headerlink" title="Creating Pipeline"></a>Creating Pipeline</h1><p><strong>Prerequisites</strong>     </p>
<ol>
<li>fork <a href="https://github.com/Apress/beginning-jenkins-blue-ocean/tree/master/Ch03/example-maven-project">example maven project</a></li>
<li>pulling the docker image for jenkins agent<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nikhilpathania/jenkins_ssh_agent</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>The docker image is based on Ubuntu and comes with Git,Java JDK, Maven, and sshd installed.<br>The image also contains a user account named <em>jenkins</em>.</p>
<p><strong>Creating credentials for the docker image in Jenkins</strong><br>Add credentials inside Jenkins that allow it to interact with the docker image nikhilpathania/jenkins_ssh_agent</p>
<ol>
<li>Classic Jenkins dashboard -&gt; Credentials-&gt; System-&gt; Global credential (unrestricted).</li>
<li>Add Credentials</li>
<li>Options<ol>
<li>Kind: Username with password</li>
<li>Username: the username to interact with the docker image: jenkins</li>
<li>Password: the password to interact with the docker image: jenkins</li>
<li>ID: add a meaningful name to recognize these credentials.</li>
<li>Descritpion: Add a meaningful description for these credentials.<br><img src="https://i.imgur.com/pFaHQuZ.png" alt="configuring the credential"><br><strong>Installing the docker plugin</strong><br>To spawn on-demand docker containers serving as Jenkins agents, need to install the docker plugin<br><img src="https://i.imgur.com/nUi1uKk.png" alt="Installing the Docker Plugin for Jenkins">   </li>
</ol>
</li>
</ol>
<p><strong>Configuring the docker plugin</strong><br>Manage Jenkins-&gt; Configure System-&gt; Cloud-&gt; Add a new cloud-&gt; Docker</p>
<p>Options to configure:</p>
<ol>
<li>Docker Host URI: This is the URL used by Jenkins to talk to the docker host.</li>
</ol>
<hr>
<p><strong>ENABLING DOCKER REMOTE API (CRITICAL)</strong><br>The Docker remote API allows external applications to communicate with the Docker server using REST APIs . Jenkins (through the Docker Plugin) uses the docker remote API to communicate with a docker host.</p>
<p>To enable the Docker remote API on your Docker host, you’ll need to modify Docker’s configuration file. Depending on your OS version and the way you have installed Docker on your machine, you might need to choose the right configuration file to modify. Shown here are two methods that work on Ubuntu. Try them one by one.</p>
<p><strong>Modifying the docker.conf File</strong><br>Follow these steps to modify the docker.conf file :</p>
<ol>
<li>Log in to your docker server; make sure you have sudo privileges.</li>
</ol>
<ol start="2">
<li>Execute the following command to edit the file docker.conf :</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/init/docker.conf</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Inside the docker.conf file, go to the line containing “DOCKER_OPTS=” .</li>
</ol>
<p>You’ll find “DOCKER_OPTS=” variable at multiple places inside the docker.conf file. Use the DOCKER_OPTS= that is available under the pre-start script or script section.</p>
<ol start="4">
<li>Set the value of DOCKER_OPTS as shown here. Do not copy and paste; type it all in a single line.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOCKER_OPTS=&apos;-H tcp://0.0.0.0:4243 -H unix:///var/run/docker.sock&apos;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>The above setting binds the Docker server to the UNIX socket as well on TCP port 4243.</p>
<p>“0.0.0.0” makes Docker engine accept connections from anywhere. If you would like your Docker server to accept connections only from your Jenkins server, then replace “0.0.0.0” with your Jenkins Server IP.</p>
<ol start="5">
<li>Restart the Docker server using the following command:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="6">
<li>To check if the configuration has worked, execute the following command. It lists all the images currently present on your Docker server.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET http://&lt;Docker Server IP&gt;:4243/images/json</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="7">
<li>If this command does not return a meaningful output, try the next method.</li>
</ol>
<p><strong>Modifying the docker.service File</strong><br>Follow these steps to modify the docker.service file :</p>
<ol>
<li>Execute the following command to edit the docker.service file.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /lib/systemd/system/docker.service</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="2">
<li>Inside the docker.service file, go to the line containing ExecStart= and set its value as shown here. Do not copy and paste; type it all in a single line.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExecStart=/usr/bin/dockerd -H fd:// -H tcp://0.0.0.0:4243</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>The above setting binds the docker server to the UNIX socket as well on TCP port 4243.</p>
<p>“0.0.0.0” makes the Docker engine accept connections from anywhere. If you would like your Docker server to accept connections only from your Jenkins server, then replace “0.0.0.0” with your Jenkins Server IP.</p>
<ol start="3">
<li>Execute the following command to make the Docker demon notice the modified configuration:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="4">
<li>Restart the Docker server using the below command:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="5">
<li>To check if the configuration has worked, execute the following command. It lists all the images currently present on your Docker server.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET http://&lt;Docker Server IP&gt;:4243/images/json</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<ol start="2">
<li>Server Credentials: If your docker host requireds a login, you need to add the credentials to Jenkins using the <strong>Add</strong> button. However, do nothing if you are using a docker host that’s running your Jenkins server container.</li>
<li>Test Connection: Click on this to test the communication between your Jenkins server and the docker host. You should see the docker version and the API version [4] if the connection is successful.</li>
<li>Enabled: A checkbox to enable/disable the current configuration.<br><img src="https://i.imgur.com/RKOm2V2.png" alt="Configuring the Docker host URI and testing the connection"></li>
</ol>
<p><strong>Add Docker Template</strong> button. Click on it to configure the docker image that Jenkins shoudl use to spawn container.<br><img src="https://i.imgur.com/6NOb5kY.png" alt="docker template figure"></p>
<ol>
<li>Labels: The label that you type in under the Labels field gets used inside your Pipeline to define agents for your stages. In this way, Jenkins knows that it has to use docker to spawn agents. </li>
<li>Enabled: This checkbox is used to enable/disable the current configuration. </li>
<li>Docker Image: Add the name of the docker image that should be used to spawn agents containers. </li>
<li>Remote File System Root: This is the directory inside the container that holds the workspace of the Pipeline that runs inside it. </li>
<li>Usage: We would like only to build pipelines that have the right agent label, in our case it is docker.</li>
<li>Connect method : Choose to Connect with SSH option to allow Jenkins to connect with the container using the SSH protocol.</li>
<li>SSH Key: Choose use configured SSH credentials from the options to use the SSH credentials as the preferred mode of authentication.</li>
<li>SSH Credentials: From the list of options choose the credentials that you have created earlier, in the section: Creating Credentials for the Docker Image in Jenkins.</li>
<li>Host Key Verification Strategy: Choose Non verifying Verification Strategy to keep things simple. However, this is not the recommended setting for a production Jenkins server.<h1 id="Using-the-pipeline-creation-wizard-configure-Jenkins-Blue-Ocean-with-various-types-of-source-code-repositories"><a href="#Using-the-pipeline-creation-wizard-configure-Jenkins-Blue-Ocean-with-various-types-of-source-code-repositories" class="headerlink" title="Using the pipeline creation wizard, configure Jenkins Blue Ocean with various types of source code repositories."></a>Using the pipeline creation wizard, configure Jenkins Blue Ocean with various types of source code repositories.</h1><h1 id="Using-the-Visual-Pipeline-Editor-to-design-Pipeline"><a href="#Using-the-Visual-Pipeline-Editor-to-design-Pipeline" class="headerlink" title="Using the Visual Pipeline Editor to design Pipeline."></a>Using the Visual Pipeline Editor to design Pipeline.</h1></li>
</ol>
<ul>
<li>Downloads the source code from the Github repository</li>
<li>Performs a build and some testing</li>
<li>Publishes the testing results under the Pipeline’s Test page</li>
<li>Uploads the built artifact to Henkins Blue Ocean</li>
</ul>
<p><strong>Assigning a global agent</strong><br>The pipeline that you are going to create should have two stages, and each stage is supposed to run inside a docker<br>container. You’ll define the agents for each stage sparately in the stage’s settings.<br>Therefore, let’s keep the Pipeline’s global agent setting to none.<br><img src="https://i.imgur.com/fBKsY4k.png" alt="Assigning a global agent"></p>
<p><strong>Creating a build &amp; test stage</strong><br>Type in the name <strong>Build &amp; Test</strong> for your stage.<br><img src="https://i.imgur.com/SOXKlCZ.png" alt="Naming your stage"></p>
<p><strong>Adding steps</strong><br>Let’s add some steps to our <strong>Build &amp; Test</strong> stage.<br><img src="https://i.imgur.com/FR5koOy.png" alt="Adding a new step"><br><strong>Adding a shell script setp</strong><br>Our source code is a Maven project, and we would like to build and test it using an mvn command, which eventually<br>gets executed inside a shell on the Jenkins agent.<br><img src="https://i.imgur.com/zdRO91W.png" alt="Adding a shell script step"><br>Paste the below code which is a maven command to build, test, and create a package out of your source code.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -Dmaven.test,failure,ignore clean package</span><br></pre></td></tr></table></figure></p>
<p><strong>Adding a stash step to pass artifact between stages</strong><br>Add another step to stash the build package and the testing report generated by the maven command.<br>Look for the step <strong>Stash some files to be used later in the build</strong><br><img src="https://i.imgur.com/yguB0hB.png" alt="Adding a Stash step"></p>
<p>Add the name “build-test-artifacts” fro your stash using the Name<em> field, which is mandatory.<br>Add the following to the Included field: **/target/surefire-reports/TEST-</em>.xml,target/*.jar</p>
<p>With this configuration you are telling Jenkins to stash any .jar file (build package) from the target directory,<br>and the TEST-*.xml file(test report) from the <code>**/target/surefire-reports/</code> directory on the build agent.<br><img src="https://i.imgur.com/ZtwyY00.png" alt="configuring a Stash step"></p>
<p>piple line code so far:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&apos;Build &amp; Test&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &apos;mvn -Dmaven.test.failure.ignore clean package&apos;</span><br><span class="line">                stash(name: &apos;build-test-artifacts&apos;, \</span><br><span class="line">                includes: &apos;**/target/surefire-reports/TEST-*.xml,target/*.jar&apos;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Assigning an agent for the build &amp; test stage</strong><br>You’ll assign a build agent for your <strong>Build &amp; Test</strong> stage. The agent is going to be a docker container that will be spawn automatically by Jenkins. ONce the stage is complete, Jenkins will destroy the container.<br><img src="https://i.imgur.com/8QGv9eH.png" alt="assigning an agent to a stage"><br>With the following configuration, Jenkins looks for an agent with the label <strong>docker</strong>. Remember the section, wherein you configured the docker plugin in Jenkins. You specified the label <strong>docker</strong> while configure the <strong>Docker Agent<br>Template</strong>.</p>
<p><strong>Creating a report &amp; publish stage</strong><br>Add another stage named <strong>Report &amp; Publish</strong> that will publish the testing results on the <strong>Test</strong> page of the Pipeline and that will publish the build package on the <strong>Artifacts</strong> page of the pipeline.<br><img src="https://i.imgur.com/1wyyhNT.png" alt="Naming your stage"></p>
<p><strong>Adding an un-stash step</strong><br>Before we do anything in the <strong>Report &amp; Publish</strong> stage. it is first crucial to un-stash the files that were stashed<br>in the previous stage. So let’s add step to un-stash a stash from the previous stage.<br><img src="https://i.imgur.com/e0XDMmW.png" alt="Adding a restore files previously stashed step"><br>You’ll see a text field Name* where you should paste the name of your stash precisely as it was defined during its<br>creation.<br><img src="https://i.imgur.com/O5Do1D7.png" alt="Configuring the Restore files previously stashed step"></p>
<p><strong>Report testing results</strong><br>The stash contains a JUnit test results .xml file that you’ll publish on the pipeline’s Test page. For this, we need<br>to add a step named <strong>Archive Junit-formatted test results</strong></p>
<p>Use the TestResults<em> field to provide Jenkins with the path to your JUnit test result file. In our case, it is<br>`**/target/surefire-reports/TEST-</em>.xml`</p>
<p><img src="https://i.imgur.com/Skz6Yg7.png" alt="Configuring an Archive Junit-formatted test results step"></p>
<p><strong>Upload artifacts to blue ocean</strong><br>Add a step that will upload the build package to the Pipleine’s Artifacts page. From the un-stashed files, you also<br>have a .jar file that is the build package.</p>
<p>To upload it to the Pipeline Artifacts page, use the <strong>Archive the artifacts</strong> step.<br>Use the Artifacts<em> filed to provide Jenkins with the path to your build package file. In our case, it is target/</em>.jar.Also, tick the option OnlyIfSuccessful to upload the artifacts only if the Pipeline status is green or yellow.<br><img src="https://i.imgur.com/X1ogakY.png" alt="Configuring the Archive the Artifacts step"> </p>
<p><strong>Assigning an aget for the report &amp; publish stage</strong><br>you’ll assign a build agent for your Report &amp; Publish stage. The agent is going to be a docker container that will be spawn automatically by Jenkins. Once the stage is complete, Jenkins will destroy the container.</p>
<p><img src="https://i.imgur.com/zg4Jc5G.png" alt="Assigning an agent to a stage"></p>
<p>You are new done with creating the pipeline. To save the changes, click on the Save button.</p>
<p>When you click on the <strong>Save</strong> button, Jenkins in the back end converts your UI configurations into a Jenkinsfile that follows the Declarative Pipeline Syntax.</p>
<p><img src="https://i.imgur.com/2HYkBP5.png" alt="Committing your pipeline configurations changes"></p>
<p><strong>Run an artifactory server</strong><br>To spawn an Artifactory server with docker. Artifactory is a popular tool to manage and version control software build artifacts. </p>
<ol>
<li>Log in to your docker host</li>
<li>docker volume create –name artifactory_data</li>
<li>docker pull docker.bintray.io/jfrog/artifactory-oss:latest  # downloading the latest version of Artifactory community edition</li>
<li>docker run –name artifactory -d -v artifactory_data:/var/opt/jfrog/ -p 8081:8081 docker.bintray.io/jfrog/artifactory-oss:latest</li>
<li>access your Artifactory server: http://&lt;Docker_host_ip&gt;:8081/artifactory/webapp/#/home</li>
<li>using the admin credentials (username: admin, and password as password). Note the default example repository in Artifactory named example-repo-local.</li>
</ol>
<p><strong>Installing the artifactory plugin for jenkins</strong><br>Manage Jenkins-&gt; Manage Plugins-&gt; Artifactory</p>
<p><strong>Configuring the artifactory plugin in jenkins</strong><br><img src="https://i.imgur.com/2HYkBP5.png" alt="configuring the artifactory plugin"></p>
<p><strong>Creating a Publish to Artifactory Stage (Parallel Stage)</strong><br>Add a stage in parallel to existing <strong>Report &amp; Publish</strong> stage.<br><img src="https://i.imgur.com/HAq6sYq.png" alt="creating a new stage"><br><img src="https://i.imgur.com/vXUpngZ.png" alt="naming your stage"><br>Your new stage first downloads the stash files from the previous stage, and then it publishes the built artifacts to<br>the Artifactory server.</p>
<p><strong>Adding a scripted pipeline step</strong><br>does two things</p>
<ol>
<li>it fetches the stash files from the previous stage.</li>
<li>it runs a filespec that uploads the build package to the Artifactory server.<br><img src="https://i.imgur.com/9W9fTUQ.png" alt="add a scripted pipeline step"><br>Script to Un-Stash Built Artifacts and Upload Them to the Artifactory Server<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">unstash &apos;build-test-artifacts&apos;</span><br><span class="line">def server = Artifactory.server &apos;Artifactory&apos;</span><br><span class="line">def uploadSpec = &quot;&quot;&quot;&#123;</span><br><span class="line">  &quot;files&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;pattern&quot;: &quot;target/*.jar&quot;,</span><br><span class="line">      &quot;target&quot;: &quot;example-repo-local/$&#123;BRANCH_NAME&#125;/$&#123;BUILD_NUMBER&#125;/&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;&quot;&quot;&quot;</span><br><span class="line">server.upload(uploadSpec)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">███████╗██╗  ██╗██████╗ ██╗      █████╗ ██╗███╗   ██╗</span><br><span class="line">██╔════╝╚██╗██╔╝██╔══██╗██║     ██╔══██╗██║████╗  ██║</span><br><span class="line">█████╗   ╚███╔╝ ██████╔╝██║     ███████║██║██╔██╗ ██║</span><br><span class="line">██╔══╝   ██╔██╗ ██╔═══╝ ██║     ██╔══██║██║██║╚██╗██║</span><br><span class="line">███████╗██╔╝ ██╗██║     ███████╗██║  ██║██║██║ ╚████║</span><br><span class="line">╚══════╝╚═╝  ╚═╝╚═╝     ╚══════╝╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝</span><br></pre></td></tr></table></figure>
<p>The code line unstash ‘build-test-artifacts’ downloads the previously stashed package. The rest of the code is a Filespec that uploads the target/*jar file, which is our built package file, to the Artifactory server on the repository example-repo-local.</p>
<p>Notice that the target path contains Jenkins Global variables, ${BRANCH_NAME} and ${BUILD_NUMBER}, representing the branch name and build number, respectively. Doing so uploads the built artifacts to a unique path on Artifactory every single time a pipeline runs.</p>
<p><strong>Assigning an Agent for the Publish to Artifactory Stage</strong><br>you’ll assign a build agent for your Publish to Artifactory stage. The agent is going to be the docker container that gets spawned automatically by Jenkins. Once the stage is complete, Jenkins destroys the container.<br><img src="https://i.imgur.com/l3VMpHu.png" alt="Assigning an agent to a stage"></p>
<p>Final pipeline code:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent none</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(&apos;Build &amp; Test&apos;) &#123;</span><br><span class="line">      agent &#123;</span><br><span class="line">        node &#123;</span><br><span class="line">          label &apos;docker&apos;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        sh &apos;mvn -Dmaven.test.failure.ignore clean package&apos;</span><br><span class="line">        stash(name: &apos;build-test-artifacts&apos;, includes: &apos;**/target/surefire-reports/TEST-*.xml,target/*.jar&apos;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Report &amp; Publish&apos;) &#123;</span><br><span class="line">      parallel &#123;</span><br><span class="line">        stage(&apos;Report &amp; Publish&apos;) &#123;</span><br><span class="line">          agent &#123;</span><br><span class="line">            node &#123;</span><br><span class="line">              label &apos;docker&apos;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">          steps &#123;</span><br><span class="line">            unstash &apos;build-test-artifacts&apos;</span><br><span class="line">            junit &apos;**/target/surefire-reports/TEST-*.xml&apos;</span><br><span class="line">            archiveArtifacts(artifacts: &apos;target/*.jar&apos;, onlyIfSuccessful: true)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&apos;Publish to Artifactory&apos;) &#123;</span><br><span class="line">          agent &#123;</span><br><span class="line">            node &#123;</span><br><span class="line">              label &apos;docker&apos;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">          steps &#123;</span><br><span class="line">            script &#123;</span><br><span class="line">              unstash &apos;build-test-artifacts&apos;</span><br><span class="line"></span><br><span class="line">              def server = Artifactory.server &apos;Artifactory&apos;</span><br><span class="line">              def uploadSpec = &quot;&quot;&quot;&#123;</span><br><span class="line">                &quot;files&quot;: [</span><br><span class="line">                  &#123;</span><br><span class="line">                    &quot;pattern&quot;: &quot;target/*.jar&quot;,</span><br><span class="line">                    &quot;target&quot;: &quot;example-repo-local/$&#123;BRANCH_NAME&#125;/$&#123;BUILD_NUMBER&#125;/&quot;</span><br><span class="line">                  &#125;</span><br><span class="line">                ]</span><br><span class="line">              &#125;&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">              server.upload(uploadSpec)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://i.imgur.com/id9vL50.png" alt="Committing your pipeline configurations changes"><br><img src="https://i.imgur.com/Ec4LinF.png" alt="build artifact uploaded to Artifactory"></p>
<p><strong>Running a pipeline for a pull requrest</strong><br>Jenkins Blue Ocean can detect pull requests on your Github repositories and run a pipeline with it for you. The<br>pipeline run result (fail/pass/canceled) gets reported back to your source code repository.</p>
<p>The person who is reponsible for accepting the pull request can then decide based on the pipeline run result whether<br>he should merge the new changes into the destination branch or not.<br><img src="https://i.imgur.com/kUvGGZM.jpg" alt="pull request"></p>
<h2 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h2><p>pull requests not showing<br>fix by: <img src="https://i.imgur.com/63ETSbk.png" alt=""></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Jenkins/">Jenkins</a><a href="/tags/Devops/">Devops</a><a href="/tags/CD-CI/">CD/CI</a><a href="/tags/Pipeline/">Pipeline</a><a href="/tags/Blue-Ocean/">Blue Ocean</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://223.95.78.227/2019/07/29/jenkins-blue-ocean/" data-title="Jenkins Pipeline | Stan Zhou&#39;s Hexo Technical Blog" data-tsina="undefined" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2019/08/03/vagrant/" title="vagrant">
  <strong>上一篇：</strong><br/>
  <span>
  vagrant</span>
</a>
</div>


<div class="next">
<a href="/2019/07/23/LinuxSystemAdmin/"  title="LinuxSystemAdmin">
 <strong>下一篇：</strong><br/> 
 <span>LinuxSystemAdmin
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#An-Example-of-Declarative-Pipeline"><span class="toc-number">1.</span> <span class="toc-text">An Example of Declarative Pipeline:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Declarative-Pipeline-Syntax"><span class="toc-number">1.1.</span> <span class="toc-text">Declarative Pipeline Syntax</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Agent"><span class="toc-number">1.1.1.</span> <span class="toc-text">Agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Directives"><span class="toc-number">1.1.2.</span> <span class="toc-text">Directives</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Parameters"><span class="toc-number">1.1.3.</span> <span class="toc-text">Parameters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Triggers"><span class="toc-number">1.1.4.</span> <span class="toc-text">Triggers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stage"><span class="toc-number">1.1.5.</span> <span class="toc-text">Stage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tools"><span class="toc-number">1.1.6.</span> <span class="toc-text">tools</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#input"><span class="toc-number">1.1.7.</span> <span class="toc-text">input</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#when"><span class="toc-number">1.1.8.</span> <span class="toc-text">when</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequentail-stages"><span class="toc-number">1.2.</span> <span class="toc-text">Sequentail stages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Parallel-stages"><span class="toc-number">1.3.</span> <span class="toc-text">Parallel stages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STEPS"><span class="toc-number">1.4.</span> <span class="toc-text">STEPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Script"><span class="toc-number">1.5.</span> <span class="toc-text">Script</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Shared-Library"><span class="toc-number">2.</span> <span class="toc-text">Shared Library</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Setting-up-Jenkins-Blue-Ocean"><span class="toc-number">3.</span> <span class="toc-text">Setting up Jenkins Blue Ocean</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-up-Blue-Ocean-using-docker"><span class="toc-number">3.1.</span> <span class="toc-text">Setting up Blue Ocean using docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run-Jenkins-blue-ocrean-behind-a-reverse-proxy"><span class="toc-number">3.2.</span> <span class="toc-text">Run Jenkins blue ocrean behind a reverse proxy</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Creating-Pipeline"><span class="toc-number">4.</span> <span class="toc-text">Creating Pipeline</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Using-the-pipeline-creation-wizard-configure-Jenkins-Blue-Ocean-with-various-types-of-source-code-repositories"><span class="toc-number">5.</span> <span class="toc-text">Using the pipeline creation wizard, configure Jenkins Blue Ocean with various types of source code repositories.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Using-the-Visual-Pipeline-Editor-to-design-Pipeline"><span class="toc-number">6.</span> <span class="toc-text">Using the Visual Pipeline Editor to design Pipeline.</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Issue"><span class="toc-number">6.1.</span> <span class="toc-text">Issue</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="stanosaka" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Devops/" title="Devops">Devops<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/aws/" title="aws">aws<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/centos/" title="centos">centos<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/CD-CI/" title="CD/CI">CD/CI<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tomcat/" title="tomcat">tomcat<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/saltstack/" title="saltstack">saltstack<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/zabbix/" title="zabbix">zabbix<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ec2/" title="ec2">ec2<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/backup/" title="backup">backup<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Pipeline/" title="Pipeline">Pipeline<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/agile/" title="agile">agile<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/software-development/" title="software development">software development<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/agile-development/" title="agile development">agile development<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://zety.com/mycv/00root" target="_blank" title="Stan&#39;s resume">Stan&#39;s resume</a>
            
          </li>
        
          <li>
            
            	<a href="https://cloud.ibm.com/docs/tutorials?topic=solution-tutorials-tutorials" target="_blank" title="IBM cloud solution tutorial">IBM cloud solution tutorial</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/aws-samples" target="_blank" title="AWS Samples">AWS Samples</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/bikrambora/devlab-launchpad" target="_blank" title="Welcome to Dev Labs">Dev Labs</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/ansible/ansible-examples" target="_blank" title="Ansible GitHub repo">Ansible GitHub repo</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" title="Ansible Best Practices">Ansible Best Practices</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.python.org/" target="_blank" title="Python doc">Python doc</a>
            
          </li>
        
          <li>
            
            	<a href="http://rogerdudler.github.io/git-guide" target="_blank" title="Git commands">Git commands</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" title="Dockerfile reference">Dockerfile reference</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2mTQr8l" target="_blank" title="Linux Command line cheat sheet">Linux Command line cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2EPHxze" target="_blank" title="PowerShell Basic Cheat Sheet">PowerShell Basic Cheat Sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" title="sed cheatsheet">sed cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://obsavus1p.bkt.clouddn.com/vim_cheat_sheet_for_programmers_print.png" target="_blank" title="vim cheatsheet">vim cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.gitbook.com/book/yeasy/docker_practice/details" target="_blank" title="Learn Docker">Learn Docker</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.unixhot.com/page/ops" target="_blank" title="运维知识体系">运维知识体系</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.tecmint.com/" target="_blank" title="tecmint">tecmint</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.lib.uts.edu.au" target="_blank" title="shoujin.wang@student.uts.edu.au">UTS Library</a>
            
          </li>
        
          <li>
            
            	<a href="https://7esl.com" target="_blank" title="ESL">ESL</a>
            
          </li>
        
          <li>
            
            	<a href="https://stanchou.wordpress.com" target="_blank" title="Stan&#39;s wordpress">Stan&#39;s wordpress</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.00root.com" target="_blank" title="Stan&#39;s gitbook">Stan&#39;s gitbook</a>
            
          </li>
        
          <li>
            
            	<a href="https://api.ipify.org" target="_blank" title="Your IP address">Your IP address</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/stanosaka/oreilly_sql_fundamentals_for_data/blob/master/notes_and_slides/sql_fundamentals_notes.md" target="_blank" title="sql fundamentials">sql fundamentials</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Stan live in Sydney. <br/>
			I am a lifelong technology learner.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/stanosaka" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6724938" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/stanosaka" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/stan.osaka" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/00root" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/btw01v" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/stan-22-82" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:devops@cwzhou.win" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="Stan Zhou">Stan Zhou</a>
		
		
		</p>
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>


        
  	    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
               if (window.mermaid) {
                  mermaid.initialize({theme: 'forest'});
               }
            </script>
        



<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
