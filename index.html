
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Stan Zhou&#39;s Hexo Technical Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stan Zhou">
    

    
    <meta name="description" content="Infrastructure as code">
<meta property="og:type" content="website">
<meta property="og:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:url" content="http://223.95.78.227/index.html">
<meta property="og:site_name" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:description" content="Infrastructure as code">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta name="twitter:description" content="Infrastructure as code">
<meta name="twitter:creator" content="@stanosaka">

    
    <link rel="alternative" href="/atom.xml" title="Stan Zhou&#39;s Hexo Technical Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/toad.ico">
    
    
    <link rel="apple-touch-icon" href="/img/toadman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/toadman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/toadman.png" alt="Stan Zhou&#39;s Hexo Technical Blog" title="Stan Zhou&#39;s Hexo Technical Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Stan Zhou&#39;s Hexo Technical Blog">Stan Zhou&#39;s Hexo Technical Blog</a></h1>
				<h2 class="blog-motto">Innovation Evangelist</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:223.95.78.227">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2020/04/26/puppet/" title="puppet" itemprop="url">puppet</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2020-04-26T12:41:23.000Z" itemprop="datePublished"> Published 2020-04-26</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Puppet-Code-Directory-Layout"><a href="#Puppet-Code-Directory-Layout" class="headerlink" title="Puppet Code Directory Layout"></a>Puppet Code Directory Layout</h1><p>environments/production/:<br>manifests/:Puppet manifests<br>modules/: Puppet modules<br>data/: Hiera data<br>hiera.yaml: Hiera configuration</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2020/03/16/i3/" title="i3" itemprop="url">i3</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2020-03-16T03:53:08.000Z" itemprop="datePublished"> Published 2020-03-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <table>
<thead>
<tr>
<th>Key</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$mod+shift+direction</td>
<td style="text-align:center">swap two windows</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/i3-linux/">i3, linux</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2020/03/03/spacemacs/" title="spacemacs" itemprop="url">spacemacs</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2020-03-02T23:08:10.664Z" itemprop="datePublished"> Published 2020-03-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <table>
<thead>
<tr>
<th>Key</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SPC p f</td>
<td style="text-align:center">search find in the same project</td>
</tr>
<tr>
<td>SPC p p</td>
<td style="text-align:center">open project</td>
</tr>
<tr>
<td>SPC w m</td>
<td style="text-align:center">max the current windows</td>
</tr>
<tr>
<td>ALT ;</td>
<td style="text-align:center">uncomment</td>
</tr>
<tr>
<td>gcc</td>
<td style="text-align:center">comment out a line</td>
</tr>
<tr>
<td>gc</td>
<td style="text-align:center">comment out highlighted text</td>
</tr>
<tr>
<td>SPC w /</td>
<td style="text-align:center">vertical</td>
</tr>
<tr>
<td>SPC w -</td>
<td style="text-align:center">horizontal</td>
</tr>
<tr>
<td>SPC f e d</td>
<td style="text-align:center">edit spacemacs profile</td>
</tr>
<tr>
<td>SPC f f</td>
<td style="text-align:center">open file</td>
</tr>
<tr>
<td>SPC w c</td>
<td style="text-align:center">close the window</td>
</tr>
<tr>
<td>SPC t l</td>
<td style="text-align:center">toggle lines</td>
</tr>
<tr>
<td>C-x h</td>
<td style="text-align:center">select the entire buffer</td>
</tr>
<tr>
<td>C-h m</td>
<td style="text-align:center">show available commands for the current modes</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h1 id="Stage-files-and-commit"><a href="#Stage-files-and-commit" class="headerlink" title="Stage files and commit"></a>Stage files and commit</h1><table>
<thead>
<tr>
<th>Key</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SPC g s</td>
<td style="text-align:center">show Magit status view</td>
</tr>
<tr>
<td>j k</td>
<td style="text-align:center">position the cursor on a file</td>
</tr>
<tr>
<td>TAB</td>
<td style="text-align:center">show and hide the diff for the file</td>
</tr>
<tr>
<td>s</td>
<td style="text-align:center">stage a file (u to unstage fa file and x to discard changes to a file)</td>
</tr>
<tr>
<td>cc</td>
<td style="text-align:center">commit</td>
</tr>
<tr>
<td>,c</td>
<td style="text-align:center">finish the commit message</td>
</tr>
<tr>
<td>p u</td>
<td style="text-align:center">Push to upstream</td>
</tr>
</tbody>
</table>
<h1 id="Org-mode"><a href="#Org-mode" class="headerlink" title="Org mode"></a>Org mode</h1><table>
<thead>
<tr>
<th>Key</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>M-x org-mode</td>
<td style="text-align:center">enable Org mode</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h1 id="tumx"><a href="#tumx" class="headerlink" title="tumx"></a>tumx</h1><table>
<thead>
<tr>
<th>Key</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>prefix :setw synchronize-panes off</td>
<td style="text-align:center">stop sending same command for all paines in windows</td>
</tr>
<tr>
<td>prefix r</td>
<td style="text-align:center">reload the tmux configuration</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/spacemacs/">spacemacs</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2020/02/26/monitoring/" title="monitoring" itemprop="url">monitoring</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2020-02-26T10:52:07.000Z" itemprop="datePublished"> Published 2020-02-26</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Frontend-Monitoring"><a href="#Frontend-Monitoring" class="headerlink" title="Frontend Monitoring"></a>Frontend Monitoring</h1><h2 id="Two-approaches-to-frontend-monitoring"><a href="#Two-approaches-to-frontend-monitoring" class="headerlink" title="Two approaches to frontend monitoring"></a>Two approaches to frontend monitoring</h2><ul>
<li>real user monitoring (RUM)</li>
<li>synthetic<ul>
<li>tools: webpagetest.org<br><strong>Browsers expose page performance metrics visa the Navigation Timing API</strong></li>
</ul>
</li>
</ul>
<h1 id="Application-Monitoring"><a href="#Application-Monitoring" class="headerlink" title="Application Monitoring"></a>Application Monitoring</h1><p><strong>Application Performance Monitoring(APM) Tools</strong></p>
<ul>
<li>StatsD is a tool used to add metrics inside of your code.</li>
</ul>
<h1 id="Telegraf-InfluxDB-Grafana"><a href="#Telegraf-InfluxDB-Grafana" class="headerlink" title="Telegraf, InfluxDB + Grafana"></a>Telegraf, InfluxDB + Grafana</h1><ul>
<li><p>Grafana: Grafana is “The open platform for beautiful analytics and monitoring.” It makes it easy to create dashboards for displaying data from many sources, particularly time-series data. It works with several different data sources such as Graphite, Elasticsearch, InfluxDB, and OpenTSDB. We’re going to use this as our main front end for visualizing our network statistics.</p>
</li>
<li><p>InfluxDB: InfluxDB is “…a data store for any use case involving large amounts of timestamped data.” This is where we’re going to store our network statistics. It is designed for exactly this use-case, where metrics are collected over time.</p>
</li>
<li><p>Telegraf: Telegraf is “…a plugin-driven server agent for collecting and reporting metrics.” This can collect data from a wide variety of sources, e.g. system statistics, API calls, DB queries, and SNMP. It can then send those metrics to a variety of datastores, e.g. Graphite, OpenTSDB, Datadog, Librato. Telegraf is maintained by InfluxData, the people behind InfluxDB. So it has very good support for writing data to InfluxDB.</p>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2020/02/09/SRE/" title="SRE" itemprop="url">SRE</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2020-02-09T01:10:52.000Z" itemprop="datePublished"> Published 2020-02-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Implementing-SLOs"><a href="#Implementing-SLOs" class="headerlink" title="Implementing SLOs"></a>Implementing SLOs</h1><p>Service level objectives (SLOs) specify a target level for the reliability of your service.<br>SLOs are key to making data-driven decisions about reliability, they’re at the core of SRE practices.</p>
<p>SLOs are a tool to help determin what engineering work to prioritize.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/SRE/">SRE</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/09/28/photography/" title="photography" itemprop="url">photography</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-09-27T14:44:32.492Z" itemprop="datePublished"> Published 2019-09-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>Exposure</strong>: Aperture, ISO speed, and shutter speed are the three core controls that manipulate exposure. </p>
<p><strong>Camera metering</strong>: The engine that assesses light and exposure. </p>
<p><strong>Depth of field</strong>: An important characteristic that influences our perception of space.</p>
<h2 id="Understanding-exposure"><a href="#Understanding-exposure" class="headerlink" title="Understanding exposure"></a>Understanding exposure</h2><h3 id="Exposure-triangle"><a href="#Exposure-triangle" class="headerlink" title="Exposure triangle"></a>Exposure triangle</h3><p><img src="https://i.imgur.com/qViBe1j.jpg" alt="the exposure triangle"><br><strong>Shutter speed</strong>: Controls the duration of the exposure</p>
<p>The shutter spped, or exposure time, refers to how long this light is permitted to enter the camera.</p>
<p>Range of Shutter Speeds<br>SHUTTER SPEED|TYPICAL EXAMPLE<br>—|—<br>1 to 30+ seconds|To take specialty night and low-light photos on a tripod<br>1/2 to 2 seconds|To add a silky look to flowing water landscape photos on a tripod for enhanced depth of field<br>1/30 to 1/2 second|To add motion blur to the background of moving-subject, carefully taken, handheld photos with stabilization<br>1/250 to 1/50 second|To take typical handheld photos without substantial zoom<br>1/500 to 1/250 second|To freeze everyday sports/action, in moving-subject, handheld photos with substantial zoom (telephoto lens)<br>1/8000 to 1/1000 second|To freeze extremely fast, up-close subject motion</p>
<p><em>Note that the range in shutter speeds spans a 100,000× ratio between the shortest exposure and longest exposure, enabling cameras with this capability to record a wide variety of subject motion.</em></p>
<p><strong>Aperture</strong>: Controls the area through which light can enter your camera<br>A camera’s aperture setting controls the width of the opening that lets light into your camera lens.<br>We measure a camera’s aperture using an f-stop value, which can be counterintuitive because the area of the opening increases as the f-stop decreases. For example, when photographers say they’re “stopping down” or “opening up” their lens, they’re referring to increasing and decreasing the f-stop value, respectively<br><img src="https://i.imgur.com/BSiRQZX.jpg" alt="F-stop values and the corresponding aperture area"></p>
<p><strong>ISO speed</strong>: Controls the sensitivity of your camera’s sensor to a given amount of light</p>
<p><img src="https://i.imgur.com/5R1Mq0c.png" alt="Typical Focal Lengths and Their Uses"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/09/26/pipeline/" title="pipeline" itemprop="url">pipeline</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-09-26T04:48:03.587Z" itemprop="datePublished"> Published 2019-09-26</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Pipeline</p>
<p>Represents a part of:</p>
<ul>
<li>Software delivery</li>
<li>Quality assurance process</li>
</ul>
<p>Benefits:</p>
<ul>
<li>Operation grouping</li>
<li>Visibility</li>
<li>Feedback<br><strong>Automated deployment pipeline</strong><br>3 stages:<br>code change-&gt; Continuous Integration-&gt; Automated acceptance testing-&gt; Configuration management</li>
</ul>
<ol>
<li>Continuous Integration<br>The continuous integration phase provides the first feedback to the developers. It checks out the code from the repository, compiles it, runs unit tests and verifies the code quality. If any step fails the pipeline execution is stopped and the first thing the developer should do is fix the continuous integration build. The continuous integration pipeline is usually the starting point.</li>
</ol>
<ul>
<li>first feedback</li>
<li>checks code</li>
<li>starting point</li>
<li>simple to setup</li>
</ul>
<ol start="2">
<li>Automated acceptance testing</li>
</ol>
<ul>
<li>Suites of tests</li>
<li>A quality gate</li>
<li>Pipeline execution is stopped if test fails</li>
<li>Prevents movement</li>
<li>Lot of confusion</li>
</ul>
<p><img src="https://i.imgur.com/KGWFQPx.png" alt="Agile testing matrix"></p>
<ol>
<li>Acceptance testing</li>
</ol>
<ul>
<li>Represent functional requirements</li>
<li>Wrtten in the form of stories or examples</li>
</ul>
<ol start="2">
<li>Unit Testing</li>
</ol>
<ul>
<li>Provide the high-quality software</li>
<li>Minimize the number of bugs</li>
</ul>
<ol start="3">
<li>Exploratory Testing</li>
</ol>
<ul>
<li>Manual black-box testing</li>
<li>Breaks or improves the system</li>
</ul>
<ol start="4">
<li>Non-functional testing</li>
</ol>
<ul>
<li>Represent properties:<ul>
<li>Performance</li>
<li>Scalability</li>
<li>Security</li>
</ul>
</li>
</ul>
<ol start="3">
<li>Configuration management</li>
</ol>
<ul>
<li>Replaces the manual operations</li>
<li>Responsible for tracking and controlling changes</li>
<li>Solution to the problems</li>
<li>Enable storing configuration files<br>Configuration management is a solution to the problems posed by manually deploying and configuring applications on the production. Configuration management tools enables storing configuration files in the version control system and tracking every change that was made on the production servers.</li>
</ul>
<p><strong>Technical and development prerequisites</strong></p>
<ul>
<li>Automated build, test, package, and deploy operations</li>
<li>Quick pipeline execution</li>
<li>Quick failure recovery</li>
<li>Zero-downtime deployment</li>
<li>Trunk-based deployment</li>
</ul>
<p><strong>Building the continuous delivery process</strong><br>Jenkins</p>
<ul>
<li>Popular automation server</li>
<li>Helps create automated sequence of scripts</li>
<li>Plugin-oriented</li>
</ul>
<p>Ansible<br>Helps with:</p>
<ul>
<li>Software provisioning</li>
<li>Configuration management</li>
<li>Application deployment</li>
</ul>
<p>Java</p>
<ul>
<li>Most popular programming language</li>
<li>Develop with the Spring framework</li>
<li>Gradle-build tool<br>Jenkins is by far the most popular automation server on the market. It helps to create continuous integration and continuous delivery pipelines and in general any other automated sequence of scripts. Highly plug-in oriented it has a greater community which constantly extends it with new features. Another one is Ansible. Ansible is an automation tool that helps with software provisioning configuration management and application deployment. Next comes Java. Java has been the most popular programming language for years, that is why it is being used for most code examples. Together with Java, most companies develop with the Spring framework so we used it to create a simple web service needed to explain some concepts. Gradle is used as a build tool. It is less popular than Maven however trending much faster.</li>
</ul>
<p><strong>Pipeline elements</strong></p>
<ul>
<li>Basic elements</li>
<li>Stage - Logical separation</li>
<li>Setp - Used to visualize process<br><img src="https://i.imgur.com/J7xJ8KG.png" alt="elements"></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">   //agent any</span><br><span class="line">   agent &#123;</span><br><span class="line">      label &apos;linux&apos;</span><br><span class="line">   &#125;</span><br><span class="line">   stages &#123;</span><br><span class="line">      stage(&apos;First Stage&apos;) &#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">              echo &apos;Step 1. Hello World&apos;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      stage(&apos;Second Stage&apos;) &#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">              echo &apos;Step 2. Second time Hello&apos;</span><br><span class="line">              echo &apos;Step 3. Third time Hello&apos;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   post &#123;</span><br><span class="line">     always &#123;</span><br><span class="line">        echo &quot;Pipeline executed!&quot;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Define pipeline structure<br>A declarative pipeline is always specified inside the pipeline block and contains sections, directives and steps. </li>
</ul>
<p>A declarative pipeline has a simplified and opinionated syntax on top of the pipeline sub-system.</p>
<p><strong>Sections</strong></p>
<ul>
<li>Keywords are:<ul>
<li>Agent-defines on which agent the pipeline or the stage will be executed</li>
<li>Stages-defines the stages of the pipeline</li>
<li>Step</li>
<li>Post-defines the post build steps</li>
</ul>
</li>
</ul>
<p>Sections define the pipeline structure and usually contain one or more directives or steps. They are defined with the key words, stages, step and post.</p>
<p>Stages defines a series of one or more stage directives.</p>
<p>Steps defines a series of one or more step instructions.</p>
<p>Steps are the most fundamental part of the pipeline they define the operations that are executed so they actually tell Jenkins what to do.</p>
<p>Defined using:</p>
<ul>
<li>sh: executes the shell command</li>
<li>custom</li>
<li>script</li>
</ul>
<p>Posts defines a series of one or more step instructions that are run at the end of the pipeline build.</p>
<p><strong>Directives</strong></p>
<ul>
<li>Expresses the configuration of a pipeline or its parts</li>
<li>Defined by:<ul>
<li>Agent: specifies where the execution takes place</li>
<li>Triggers: define automated ways to trigger the pipeline and can use cron to set the time based scheduling</li>
<li>Options: specified pipeline specific options</li>
<li>Environment: deinfes a set of key values used a s environment variables</li>
<li>Parameters: define a list of user input parameters</li>
<li>Tools: defines the tools configured on Jenkins</li>
<li>Stage: allows for logical grouping of steps; contains steps and agent </li>
<li>When: determines whether the stage should be executed depending on the given condition</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">   agent any</span><br><span class="line">   tools &#123;</span><br><span class="line">      maven &apos;M3&apos;</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   parameters &#123;</span><br><span class="line">      string(name: &apos;VERSION&apos;,</span><br><span class="line">          defaultValue: &apos;1.0.0&apos;,</span><br><span class="line">          description: &apos;What is the version to build?&apos;)</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   stages &#123;</span><br><span class="line">      stage(&apos;Build&apos;)&#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">             sh &quot;./build.sh $&#123;params.VERSION&#125;&quot;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Commit-Pipeline"><a href="#Commit-Pipeline" class="headerlink" title="Commit Pipeline"></a>Commit Pipeline</h2><ul>
<li>Basic continuous integration process</li>
<li>Results in a report about the build</li>
<li>Runs after each change in the code</li>
<li>Consume a reasonable amount of resources</li>
<li>Starting point</li>
</ul>
<p>Since it runs after every change in the code, the build should take no more than five minutes and should consume a reasonable amount of resources. The commit phase is always the starting point of the continuous delivery process and it provides the most important feedback cycle in the development process.</p>
<p>In the commit phase a developer checks in the code to the repository.<br>The continuous integration server detects the change and the build starts.<br>The most fundamental commit pipeline contains three stages </p>
<ul>
<li>checkout</li>
<li>compile</li>
<li>unit test</li>
</ul>
<h2 id="Code-Quality-Stages"><a href="#Code-Quality-Stages" class="headerlink" title="Code Quality Stages"></a>Code Quality Stages</h2><p><strong>Extending continuous integration</strong></p>
<ul>
<li>The most widely used are: Code coverage and Static analysis</li>
</ul>
<p><strong>Code coverage</strong></p>
<ul>
<li>Scenario:<ul>
<li>Nobody writes unit tests</li>
<li>Passes all the builds</li>
</ul>
</li>
<li>Solution:<ul>
<li>Add coverage code tools</li>
</ul>
</li>
<li>Creates report</li>
<li>Make build fail<br><strong>Available tools</strong></li>
<li>JaCoCo</li>
<li>Clover</li>
<li>Cobertura<br><strong>Static Code Analysis</strong></li>
<li>Checks without execution</li>
<li>Checks number of rules</li>
<li>Rules apply to wide range of aspects</li>
<li>Popular tools are Checkstyle, FindBugs, and PMD</li>
</ul>
<p><strong>SonarQube</strong></p>
<ul>
<li>Quality management tool</li>
<li>An alternative</li>
<li>Aggregates different code analysis frameworks</li>
<li>Has own dashboards</li>
<li>User friendly web interface</li>
</ul>
<h2 id="Triggers-and-notifications"><a href="#Triggers-and-notifications" class="headerlink" title="Triggers and notifications"></a>Triggers and notifications</h2><p><strong>Triggers</strong></p>
<ul>
<li>Automatic action to start the build</li>
<li>Manay options to choose from</li>
<li>Three types:<ul>
<li>External</li>
<li>Polling SCM</li>
<li>Scheduled build<br><strong>External Trigger</strong></li>
</ul>
</li>
<li>Natural to understand</li>
<li>Starts the build after it’s called by the notifier</li>
</ul>
<p>GitHub -&gt; trigger-&gt; Jenkins</p>
<p><strong>Polling SCM</strong></p>
<ul>
<li>Periodically calls Github</li>
<li>Sound counter-intuitive<br>Polling SCM trigger is less intuitive.<br><img src="https://i.imgur.com/s6L2bbo.png" alt="Polling SCM figure"><br>Jenkins periodically calls GitHub and checks if there were any push to the repository. Then it starts the build.</li>
</ul>
<p><strong>Scheduled build</strong></p>
<ul>
<li>Jenkins runs the build periodically</li>
<li>No communication with any system</li>
<li>Implementation of scheduled build is same as polling SCM</li>
<li>Used for the commit pipeline</li>
</ul>
<p><strong>Notifications</strong></p>
<ul>
<li>Lot</li>
</ul>
<h2 id="Team-development-strategies"><a href="#Team-development-strategies" class="headerlink" title="Team development strategies"></a>Team development strategies</h2><p><strong>Development workflows</strong></p>
<ul>
<li>Put the code into the repostitory</li>
<li>Depends on many factors</li>
<li>Classify into three types:<ul>
<li><img src="https://i.imgur.com/WXIl9qU.png" alt="Trunk-based workflow"></li>
<li><img src="https://i.imgur.com/Oiury7J.png" alt="Branching workflow"></li>
<li><img src="https://i.imgur.com/5Uo3Ac9.png" alt="Forking workflow"><br><strong>Feature toggle</strong><br>Feature toggle is a technique that is an alternative to maintaining multiple source code branches such that the feature can be tested before it is completed and ready for use. It is used to disable the feature for users but enables it for developers while testing. Feature toggles are essentially variables used in conditional statements the simplest implementation of feature toggles are flags and the if statements.</li>
</ul>
</li>
</ul>
<p><strong>acceptance testing</strong><br>Acceptance testing is a test performed to determine if business requirements or contracts are met. </p>
<ul>
<li>Invovles black-box testing</li>
<li>Imply the acceptance of the software delivery</li>
<li>Also called UAT</li>
<li>Rely on manual steps</li>
<li>Reaonable to run them as programmed repeatable operations<br><strong>Artifact repository</strong><br>While the source control management stores the source code the artifact repository is dedicated for storing software binary artifacts, for example, compiled libraries or components later used to build a complete application.</li>
<li>Store binaries on a separate server due to:<ul>
<li>File size</li>
<li>Versions</li>
<li>Revision mapping</li>
<li>Packages</li>
<li>Access Control</li>
<li>Clients</li>
<li>Use cases<br><img src="https://i.imgur.com/5gDLWLc.png" alt="working"><br><strong>private docker registry</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p certs</span><br><span class="line"></span><br><span class="line">openssl req \\n  -newkey rsa:4096 -nodes -sha256 -keyout certs/domain.key \\n  -x509 -days 365 -out certs/domain.crt</span><br><span class="line"></span><br><span class="line">docker run -d -p 5000:5000 --restart=always --name registry -v `pwd`/auth:/auth -e &quot;REGISTRY_AUTH=htpasswd&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/passwords -v `pwd`/certs:/certs -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key registry:2</span><br><span class="line"></span><br><span class="line">docker tag ubuntu_with_python stanosaka/ubuntu_with_python:1</span><br><span class="line">docker push stanosaka/ubuntu_with_python:1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><strong>Acceptance test in pipeline</strong><br><img src="https://i.imgur.com/06nJoTO.png" alt="process"></p>
<ol>
<li>The developer pushes a code change to Github.</li>
<li>Jenkins detects the change, triggers the build and checks out the current code.</li>
<li>Jenkins executes the commit phase and builds the Docker image</li>
<li>Jenkins pushes the image to Docker Registry</li>
<li>Jenkins runs the Docker container in the staging environment</li>
</ol>
<p><strong>Configuration management</strong></p>
<ul>
<li>Process of controlling configuration changes</li>
<li>Used to refer to the software and the hardware</li>
</ul>
<p>Application Configuration| Infrastructre Configuration<br>Decides how the system works| Server infrastructure and environment configuration<br>Expressed in the form of flags| Takes care of the deployment process<br><img src="https://i.imgur.com/L4k4cb0.png" alt="working"><br><strong>Traits</strong></p>
<ul>
<li>Automation</li>
<li>Version Control</li>
<li>Incremental changes</li>
<li>Server provisioning</li>
<li>Security</li>
<li>Simplicity</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/pipeline/">pipeline</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/09/20/anatomy-of-containers/" title="anatomy-of-containers" itemprop="url">anatomy-of-containers</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-09-20T00:05:28.000Z" itemprop="datePublished"> Published 2019-09-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Anatomy-of-containers"><a href="#Anatomy-of-containers" class="headerlink" title="Anatomy of containers"></a>Anatomy of containers</h1><p>Containers are specially encapsulated and secured processes running on the host system.</p>
<p>Containers leverage a lot of features and primitives available in the Linux OS. The most important ones are</p>
<ul>
<li>namespaces</li>
<li>cgroups</li>
</ul>
<p>All processes running in containers share the same Linux kernel of the underlying host operating system. This is fundamentally different compared with VMs, as each VM contains its own full-blown operating system.</p>
<p>Difference:</p>
<table>
<thead>
<tr>
<th></th>
<th>Container</th>
<th>VMs</th>
</tr>
</thead>
<tbody>
<tr>
<td>startup times</td>
<td>milliseconds</td>
<td>several seconds</td>
</tr>
<tr>
<td>goal</td>
<td>ephemeral</td>
<td>long-living</td>
</tr>
</tbody>
</table>
<p><img src="https://i.imgur.com/3ReVPcO.png" alt="high level architecture of Docker"><br>On the lower part of the the preceding figure, we have the Linux operating system with its cgroups, namespaces, and layer capabilities as well as other functionality that we do not need to explicitly mention here. Then, there is an intermediary layer composed of <strong>containerd</strong> and <strong>runc</strong>. On top of all that now sits the Docker engine. The Docker engine offers a RESTful interface to the outside world that can be accessed by any tool, such as the Docker CLI, Docker for Mac, and Docker for Windows or Kubernetes to just name a few.</p>
<h2 id="Namespaces"><a href="#Namespaces" class="headerlink" title="Namespaces"></a>Namespaces</h2><p>A namespace is an abstraction of global resources such as filesystems, network access, process tree (also named PID namespace) or the system group IDs, and user IDs.<br><img src="https://i.imgur.com/GVSkK6z.png" alt="virtual FS"><br>The PID namespace is what keeps processes in one container from seeing or interacting with processes in another container. A process might have the apparent PID 1 inside a container, but if we examine it from the host system, it would have an ordinary PID, say 334:<br><img src="https://i.imgur.com/zhefA3P.png" alt="Process tree on a Docker host"></p>
<h2 id="Control-groups-cgroups"><a href="#Control-groups-cgroups" class="headerlink" title="Control groups (cgroups)"></a>Control groups (cgroups)</h2><p>Linux cgroups are used to limit, manage, and isolate resource usage of collections of processes running on a system.<br>Resources are CPU time, system memory, network bandwidth, or combinations of there resources, and so on.</p>
<p>Using cgroups, admins can limit the resources that containers can consume.With this, one can avoid, for example, the classical noisy neighbor problem, where a rogue process running in a container consumes all CPU time or reserves massive amounts of RAM and, as such, starves all the other processes running on the host, whether they’re containerized or not.</p>
<h2 id="Union-filesystem-UnionFS"><a href="#Union-filesystem-UnionFS" class="headerlink" title="Union filesystem (UnionFS)"></a>Union filesystem (UnionFS)</h2><p>The UnionFS forms the backbone of what is known as container images.<br>UnionFS is mainly used on Linux and allows files and directories of distinct filesystems to be overlaid and with it form a single coherent file system.In this context, the individual filesystems are called branches. Contents of directories that have the same path within the merged branches will be seen together in a single merged directory, within the new, virtual filesystem. When merging branches, the priority between the branches is specified. In that way, when two branches contain the same file, the one with the higher priority is seen in the final FS.</p>
<h2 id="Container-plumbing"><a href="#Container-plumbing" class="headerlink" title="Container plumbing"></a>Container plumbing</h2><p>The basement on top of which the Docker engine is built; we can also call it the container plumbing and is formed by the two component—runc and containerd.</p>
<h2 id="Runc"><a href="#Runc" class="headerlink" title="Runc"></a>Runc</h2><p>Runc is a lightweight, portable container runtime. It provides full support for Linux namespaces as well as native support for all security features available on Linux, such as SELinux, AppArmor, seccomp, and cgroups.</p>
<p>Runc is a tool for spawning and running containers according to the Open Container Initiative (OCI) specification.</p>
<h2 id="Containerd"><a href="#Containerd" class="headerlink" title="Containerd"></a>Containerd</h2><p>Runc is a low-level implementation of a container runtime; containerd builds on top of it, and adds higher-level features, such as image transfer and storage, container execution, and supervision, as well as network and storage attachments.</p>
<h1 id="Creating-and-managing-container-images"><a href="#Creating-and-managing-container-images" class="headerlink" title="Creating and managing container images"></a>Creating and managing container images</h1><h2 id="The-layered-filesystem"><a href="#The-layered-filesystem" class="headerlink" title="The layered filesystem"></a>The layered filesystem</h2><p><img src="https://i.imgur.com/Np4zxp1.jpg" alt="stack of layers"><br>The layers of a container image are all immutable. Immutable means that once generated, the layer cannot ever be changed. The only possible operation affecting the layer is the physical deletion of it.<br><img src="https://i.imgur.com/CkLp7N6.jpg" alt="A sample custom image based on Alpine and Nginx"><br>Each layer only contains the delta of changes in regard to the previous set of layers. The content of each layer is mapped to a special folder on the host system, which is usually a subfolder of /var/lib/docker/.</p>
<p>Since layers are immutable, they can be cached without ever becoming stale. This is a big advantage.</p>
<h2 id="The-writable-container-layer"><a href="#The-writable-container-layer" class="headerlink" title="The writable container layer"></a>The writable container layer</h2><p><img src="https://i.imgur.com/Gio85pZ.jpg" alt="the writable container layer"><br><img src="https://i.imgur.com/E80YSMK.jpg" alt="Multiple containers sharing the same image layers"><br>The container layer is marked as read/write. Another advantage of the immutability of image layers is that they can be shared among many containers created from this image. All that is needed is a thin, writable container layer for each container.</p>
<p>This technique, of course, results in a tremendous reduction of resources that are consumed. Furthermore, this helps to decrease the loading time of a container since only a thin container layer has to be created once the image layers have been loaded into memory, which only happens for the first container.</p>
<h2 id="Copy-on-write"><a href="#Copy-on-write" class="headerlink" title="Copy-on-write"></a>Copy-on-write</h2><p>Docker uses the copy-on-write technique when dealing with images. Copy-on-write is a strategy of sharing and copying files for maximum efficiency. If a layer uses a file or folder that is available in one of the low-lying layers, then it just uses it. If, on the other hand, a layer wants to modify, say, a file from a low-lying layer, then it first copies this file up to the target layer and then modifies it.<br><img src="https://i.imgur.com/hTj3sG0.jpg" alt="copy-on-write"><br>The second layer wants to modify <strong>File 2</strong>, which is present in the base layer. Thus, it copied it up and then modified it. Now, let’s say that we’re sitting in the top layer of the preceding figure. This layer will use <strong>File 1</strong> from the base layer and <strong>File 2</strong> and <strong>File 3</strong> from the second layer.</p>
<h2 id="Creating-images"><a href="#Creating-images" class="headerlink" title="Creating images"></a>Creating images</h2><p>Three ways to create a new container image on your system.</p>
<ol>
<li><p>Interactive image creation<br>start with a base image that we want to use as a template and run a container of it interactively. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">$ docker container run -it --name sample alpine /bin/sh</span><br><span class="line"></span><br><span class="line">#By default, the alpine container does not have the ping tool installed. Let&apos;s assume we want to create a new custom image that has ping installed. </span><br><span class="line"></span><br><span class="line"># apk update &amp;&amp; apk add iputils</span><br><span class="line"> # ping 127.0.0.1</span><br><span class="line">PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.060 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.054 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.059 ms</span><br><span class="line">^C</span><br><span class="line">$ docker container ls -a | grep sample</span><br><span class="line">#If we want to see what has changed in our container in relation to the base image</span><br><span class="line">$ docker container diff sample</span><br><span class="line">C /var</span><br><span class="line">C /var/cache</span><br><span class="line">C /var/cache/apk</span><br><span class="line">A /var/cache/apk/APKINDEX.00740ba1.tar.gz</span><br><span class="line">A /var/cache/apk/APKINDEX.d8b2a6f4.tar.gz</span><br><span class="line">C /bin</span><br><span class="line">C /bin/ping</span><br><span class="line">C /bin/ping6</span><br><span class="line">A /bin/traceroute6</span><br><span class="line">C /lib</span><br><span class="line">C /lib/apk</span><br><span class="line">C /lib/apk/db</span><br><span class="line">C /lib/apk/db/triggers</span><br><span class="line">C /lib/apk/db/installed</span><br><span class="line">C /lib/apk/db/scripts.tar</span><br><span class="line">C /usr</span><br><span class="line">C /usr/sbin</span><br><span class="line">C /usr/sbin/arping</span><br><span class="line">A /usr/sbin/clockdiff</span><br><span class="line">A /usr/sbin/rarpd</span><br><span class="line">A /usr/sbin/setcap</span><br><span class="line">A /usr/sbin/tracepath</span><br><span class="line">A /usr/sbin/tracepath6</span><br><span class="line">A /usr/sbin/ninfod</span><br><span class="line">A /usr/sbin/getcap</span><br><span class="line">A /usr/sbin/tftpd</span><br><span class="line">A /usr/sbin/getpcaps</span><br><span class="line">A /usr/sbin/ipg</span><br><span class="line">A /usr/sbin/rdisc</span><br><span class="line">A /usr/sbin/capsh</span><br><span class="line">C /usr/lib</span><br><span class="line">A /usr/lib/libcap.so.2</span><br><span class="line">A /usr/lib/libcap.so.2.27</span><br><span class="line">C /etc</span><br><span class="line">C /etc/apk</span><br><span class="line">C /etc/apk/world</span><br><span class="line">C /root</span><br><span class="line">A /root/.ash_history</span><br><span class="line"></span><br><span class="line">#In the preceding list, A stands for added, and C for changed. If we had any deleted files, then those would be prefixed with D.</span><br><span class="line">#use the docker container commit command to persist our modifications and create a new image from them:</span><br><span class="line">$ docker container commit sample my-alpine</span><br><span class="line">sha256:31da02222ee7102dd755692bd498c6b170f11ffeb81ca700a4d12c0e5de9b913</span><br><span class="line"></span><br><span class="line">## If we want to see how our custom image has been built</span><br><span class="line">$ docker image history my-alpine</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">31da02222ee7        38 seconds ago      /bin/sh                                         1.76MB</span><br><span class="line">961769676411        4 weeks ago         /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot;]              0B</span><br><span class="line">&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) ADD file:fe64057fbb83dccb9…   5.58MB</span><br><span class="line">#The first layer in the preceding list is the one that we just created by adding the iputils package.</span><br></pre></td></tr></table></figure>
</li>
<li><p>Using Dockerfiles<br>The Dockerfile is a text file that is usually literally called Dockerfile. It contains instructions on how to build a custom container image. It is a declarative way of building images.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FROM python:2.7</span><br><span class="line">RUN mkdir -p /app</span><br><span class="line">WORKDIR /app</span><br><span class="line">COPY ./requirements.txt /app/</span><br><span class="line">RUN pip install -r requirements.txt</span><br><span class="line">CMD [&quot;python&quot;, &quot;main.py&quot;]</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="https://i.imgur.com/NMD2UG5.jpg" alt="the relation of Dockerfile and layers in an image"></p>
<p><strong>The FROM keyword</strong><br>Every DOckerfile starts with the FROM keyword. With it, we define which base image we want to start building our custom image from. If build starting with CentOS 7:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7</span><br></pre></td></tr></table></figure></p>
<p>If we really want to start from scratch:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM scratch</span><br></pre></td></tr></table></figure></p>
<p>FROM scratch is a no-op in the Dockerfile, and as such does not generate a layer in the resulting container image.</p>
<p><strong>The RUN keyword</strong><br>The argument for RUN is any valid Linux command, such as the following:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN yum install -y wget</span><br></pre></td></tr></table></figure></p>
<p>If we use more than one line, we need to put a backslash () at the end of the lines to indicate to the shell that the command continues on the next line.<br><strong>The COPY and ADD keywords</strong><br>add some content to an existing base image to make it a custom image. Most of the time, these are a few source files of, say, a web application or a few binaries of a compiled application.</p>
<p>These two keywords are used to copy files and folders from the host into the image that we’re building. The two keywords are very similar, with the exception that the ADD keyword also lets us copy and unpack TAR files, as well as provide a URL as a source for the files and folders to copy.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">COPY . /app</span><br><span class="line">COPY ./web /app/web</span><br><span class="line">COPY sample.txt /data/my-sample.txt</span><br><span class="line">ADD sample.tar /app/bin/</span><br><span class="line">ADD http://example.com/sample.txt /data/</span><br></pre></td></tr></table></figure></p>
<p>In the preceding lines of code:</p>
<ul>
<li>The first line copies all files and folders from the current directory recursively to the /app folder inside the container image</li>
<li>The second line copies everything in the web subfolder to the target folder, /app/web</li>
<li>The third line copies a single file, sample.txt, into the target folder, /data, and at the same time, renames it to my-sample.txt</li>
<li>The fourth statement unpacks the sample.tar file into the target folder, /app/bin</li>
<li>Finally, the last statement copies the remote file, sample.txt, into the target file, /data</li>
</ul>
<p>Wildcards are allowed in the source path. For example, the following statement copies all files starting with sample to the mydir folder inside the image:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPY ./sample* /mydir/</span><br></pre></td></tr></table></figure></p>
<p>From a security perspective, it is important to know that by default, all files and folders inside the image will have a user ID (UID) and a group ID (GID) of 0. The good thing is that for both ADD and COPY, we can change the ownership that the files will have inside the image using the optional –chown flag, as follows:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD --chown=11:22 ./data/files* /app/data/</span><br></pre></td></tr></table></figure></p>
<p>The preceding statement will copy all files starting with the name web and put them into the /app/data folder in the image, and at the same time assign user 11 and group 22 to these files.</p>
<p>Instead of numbers, one could also use names for the user and group, but then these entities would have to be already defined in the root filesystem of the image at /etc/passwd and /etc/group respectively, otherwise the build of the image would fail.</p>
<p><strong>The WORKDIR keyword</strong><br>The WORKDIR keyword defines the working directory or context that is used when a container is run from our custom image. So, if I want to set the context to the /app/bin folder inside the image, my expression in the Dockerfile would have to look as follows:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /app/bin</span><br></pre></td></tr></table></figure></p>
<p>All activity that happens inside the image after the preceding line will use this directory as the working directory. It is very important to note that the following two snippets from a Dockerfile are not the same:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN cd /app/bin</span><br><span class="line">RUN touch sample.txt</span><br></pre></td></tr></table></figure></p>
<p>Compare the preceding code with the following code:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /app/bin</span><br><span class="line">RUN touch sample.txt</span><br></pre></td></tr></table></figure></p>
<p>The former will create the file in the root of the image filesystem, while the latter will create the file at the expected location in the /app/bin folder. Only the WORKDIR keyword sets the context across the layers of the image. The cd command alone is not persisted across layers.</p>
<p><strong>The CMD and ENTRYPOINT keywords</strong><br>While all other keywords defined for a Dockerfile are executed at the time the image is built by the Docker builder, these two are actually definitions of what will happen when a container is started from the image we define. When the container runtime starts a container, it needs to know what the process or application will be that has to run inside this container. That is exactly what CMD and ENTRYPOINT are used for—to tell Docker what the start process is and how to start that process.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ping 8.8.8.8 -c 3</span><br></pre></td></tr></table></figure>
<p>ping is the command and 8.8.8.8 -c 3 are the parameters to this command.</p>
<p>ENTRYPOINT is used to define the command of the expression while CMD is used to define the parameters for the command. Thus, a Dockerfile using alpine as the base image and defining ping as the process to run in the container could look as follows:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:latest</span><br><span class="line">ENTRYPOINT [&quot;ping&quot;]</span><br><span class="line">CMD [&quot;8.8.8.8&quot;, &quot;-c&quot;, &quot;3&quot;]</span><br></pre></td></tr></table></figure></p>
<p>For both ENTRYPOINT and CMD, the values are formatted as a JSON array of strings, where the individual items correspond to the tokens of the expression that are separated by whitespace. This the preferred way of defining CMD and ENTRYPOINT. It is also called the exec form.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ docker image build -t pinger .</span><br><span class="line">$ docker container run --rm -it pinger</span><br><span class="line">PING 8.8.8.8 (8.8.8.8): 56 data bytes</span><br><span class="line">64 bytes from 8.8.8.8: seq=0 ttl=56 time=5.612 ms</span><br><span class="line">64 bytes from 8.8.8.8: seq=1 ttl=56 time=4.389 ms</span><br><span class="line">64 bytes from 8.8.8.8: seq=2 ttl=56 time=6.592 ms</span><br><span class="line">#The beauty of this is that I can now override the CMD part that I have defined in the Dockerfile</span><br><span class="line">#This will now cause the container to ping the loopback for 5 seconds.</span><br><span class="line"></span><br><span class="line">$ docker container run --rm -it pinger -w 5 127.0.0.1</span><br><span class="line">PING 127.0.0.1 (127.0.0.1): 56 data bytes</span><br><span class="line">64 bytes from 127.0.0.1: seq=0 ttl=64 time=0.077 ms</span><br><span class="line">64 bytes from 127.0.0.1: seq=1 ttl=64 time=0.087 ms</span><br><span class="line">64 bytes from 127.0.0.1: seq=2 ttl=64 time=0.090 ms</span><br><span class="line">64 bytes from 127.0.0.1: seq=3 ttl=64 time=0.082 ms</span><br><span class="line">64 bytes from 127.0.0.1: seq=4 ttl=64 time=0.081 ms</span><br><span class="line"></span><br><span class="line">#If we want to override what&apos;s defined in the ENTRYPOINT in the Dockerfile, we need to use the --entrypoint parameter in the docker container run expression.</span><br><span class="line">docker container run --rm -it --entrypoint /bin/sh pinger</span><br><span class="line">/ # exit</span><br><span class="line"></span><br><span class="line">FROM alpine:latest</span><br><span class="line">CMD wget -O - http://www.google.com</span><br><span class="line"></span><br><span class="line">## If you leave ENTRYPOINT undefined, then it will have the default value of /bin/sh -c, and whatever is the value of CMD will be passed as a string to the shell command. The preceding definition would thereby result in entering following process to run inside the container:</span><br><span class="line">/bin/sh -c &quot;wget -O - http://www.google.com&quot;</span><br><span class="line"></span><br><span class="line">Consequently, /bin/sh is the main process running inside the container, and it will start a new child process to run the wget utility.</span><br></pre></td></tr></table></figure></p>
<p><img src="https://i.imgur.com/98sfbpv.jpg" alt="the image build process visualized"></p>
<h2 id="Multistep-builds"><a href="#Multistep-builds" class="headerlink" title="Multistep builds"></a>Multistep builds</h2><p>With a size of 176 MB, the resulting image is way too big. In the end, it is just a Hello World application. The reason for it being so big is that the image not only contains the Hello World binary, but also all the tools to compile and link the application from the source code. But this is really not desirable when running the application, say, in production. Ideally, we only want to have the resulting binary in the image and not a whole SDK.</p>
<p>It is precisely for this reason that we should define Dockerfiles as multistage. We have some stages that are used to build the final artifacts and then a final stage where we use the minimal necessary base image and copy the artifacts into it. This results in very small images. Have a look at this revised Dockerfile:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:3.7 AS build</span><br><span class="line">RUN apk update &amp;&amp; apk add --update alpine-sdk</span><br><span class="line">RUN mkdir /app</span><br><span class="line">WORKDIR /app</span><br><span class="line">COPY . /app</span><br><span class="line">RUN mkdir bin</span><br><span class="line">RUN gcc hello.c -o bin/hello</span><br><span class="line"></span><br><span class="line">FROM alpine:3.7</span><br><span class="line">COPY --from=build /app/bin/hello /app/hello</span><br><span class="line">CMD /app/hello</span><br></pre></td></tr></table></figure>
<p>Here, we have a first stage with an alias build that is used to compile the application, and then the second stage uses the same base image alpine:3.7, but does not install the SDK, and only copies the binary from the build stage, using the –from parameter, into this final image.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker image ls |grep hello-world</span><br><span class="line">hello-world-small                                              latest                                     46bb8c275fda        About a minute ago   4.22MB</span><br><span class="line">hello-world                                                    latest                                     75339d9c269f        7 minutes ago        178MB</span><br></pre></td></tr></table></figure></p>
<p>We have been able to reduce the size from 178 MB down to 4 MB. This is reduction in size by a factor of 40. A smaller image size has many advantages, such as a smaller attack surface area for hackers, reduced memory and disk consumption, faster startup times of the corresponding containers, and a reduction of the bandwidth needed to download the image from a registry, such as Docker Hub.</p>
<h2 id="Dockerfile-best-practices"><a href="#Dockerfile-best-practices" class="headerlink" title="Dockerfile best practices"></a>Dockerfile best practices</h2><ul>
<li>First and foremost, we need to consider that containers are meant to be ephemeral. By ephemeral, we mean that a container can be stopped and destroyed and a new one built and put in place with an absolute minimum of setup and configuration. That means that we should try hard to keep the time that is needed to initialize the application running inside the container at a minimum, as well as the time needed to terminate or clean up the application.</li>
<li>we should order the individual commands in the Dockerfile so that we leverage caching as much as possible. Building a layer of an image can take a considerable amount of time, sometimes many seconds or even minutes. While developing an application, we will have to build the container image for our application multiple times. We want to keep the build times at a minimum.</li>
</ul>
<blockquote>
<p>When we’re rebuilding a previously built image, the only layers that are rebuilt are the ones that have changed, but if one layer needs to be rebuilt, all subsequent layers also need to be rebuilt. This is very important to remember. Consider the following example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FROM node:9.4</span><br><span class="line">RUN mkdir -p /app</span><br><span class="line">WORKDIR /app</span><br><span class="line">COPY . /app</span><br><span class="line">RUN npm install</span><br><span class="line">CMD [&quot;npm&quot;, &quot;start&quot;]</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>In this example, the npm install command on line five of the Dockerfile usually takes the longest. A classical Node.js application has many external dependencies, and those are all downloaded and installed in this step. This can take minutes until it is done. Therefore, we want to avoid running npm install each time we rebuild the image, but a developer changes their source code all the time during development of the application. That means that line four, the result of the COPY command, changes all the time and this layer has to be rebuilt each time. But as we discussed previously, that also means that all subsequent layers have to be rebuilt, which in this case includes the npm install command. To avoid this, we can slightly modify the Dockerfile and have the following:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM node:9.4</span><br><span class="line">RUN mkdir -p /app</span><br><span class="line">WORKDIR /app</span><br><span class="line">COPY package.json /app/</span><br><span class="line">RUN npm install</span><br><span class="line">COPY . /app</span><br><span class="line">CMD [&quot;npm&quot;, &quot;start&quot;]</span><br></pre></td></tr></table></figure></p>
<p>What we have done here is that, on line four, we only copy the single file that the npm install command needs as a source, which is the package.json file. This file rarely changes in a typical development process. As a consequence, the npm install command also has to be executed only when the package.json file changes. All the remaining, frequently changed content is added to the image after the npm install command.</p>
<ul>
<li>A further best practice is to keep the number of layers that make up your image relatively small. The more layers an image has, the more the graph driver needs to work to consolidate the layers into a single root filesystem for the corresponding container. Of course, this takes time, and thus the fewer layers an image has, the faster the startup time for the container can be.<blockquote>
<p>The easiest way to reduce the number of layers is to combine multiple individual RUN commands into a single one—for example, say that we had the following in a Dockerfile:</p>
</blockquote>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN apt-get update</span><br><span class="line">RUN apt-get install -y ca-certificates</span><br><span class="line">RUN rm -rf /var/lib/apt/lists/*</span><br></pre></td></tr></table></figure>
<p>We could combine these into a single concatenated expression, as follows:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN apt-get update \</span><br><span class="line">   &amp;&amp; apt-get install -y ca-certificates \</span><br><span class="line">   &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></pre></td></tr></table></figure></p>
<p>The former will generate three layers in the resulting image, while the latter only creates a single layer.</p>
<p>The next three best practices all result in smaller images. Why is this important? Smaller images reduce the time and bandwidth needed to download the image from a registry. They also reduce the amount of disk space needed to store a copy locally on the Docker host and the memory needed to load the image. Finally, smaller images also means a smaller attack surface for hackers. Here are the best practices mentioned:</p>
<ol>
<li><p>The first best practice that helps to reduce the image size is to use a .dockerignore file. We want to avoid copying unnecessary files and folders into an image to keep it as lean as possible. A .dockerignore file works in exactly the same way as a .gitignore file, for those who are familiar with Git. In a .dockerignore file, we can configure patterns to exclude certain files or folders from being included in the context when building the image.</p>
</li>
<li><p>The next best practice is to avoid installing unnecessary packages into the filesystem of the image. Once again, this is to keep the image as lean as possible.</p>
</li>
<li><p>Last but not least, it is recommended that you use multistage builds so that the resulting image is as small as possible and only contains the absolute minimum needed to run your application or application service. </p>
</li>
</ol>
<h1 id="3-Saving-and-loading-images"><a href="#3-Saving-and-loading-images" class="headerlink" title="3. Saving and loading images"></a>3. Saving and loading images</h1><p>The third way to create a new container image is by importing or loading it from a file. A container image is nothing more than a tarball. To demonstrate this, we can use the docker image save command to export an existing image to a tarball:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker image save -o ./backup/my-alpine.tar my-alpine</span><br><span class="line">$ docker image load -i ./backup/my-alpine.tar</span><br></pre></td></tr></table></figure></p>
<h1 id="Running-in-production"><a href="#Running-in-production" class="headerlink" title="Running in production"></a>Running in production</h1><p><strong>Blue-green deployments</strong><br>In blue-green deployments, the current version of the application service, called blue, handles all the application traffic. We then install the new version of the application service, called green, on the production system. The new service is not yet wired with the rest of the application.</p>
<p>Once green is installed, one can execute smoke tests against this new service and, if those succeed, the router can be configured to funnel all traffic that previously went to blue to the new service, green. The behavior of green is then observed closely and, if all success criteria are met, blue can be decommissioned. But if, for some reason, green shows some unexpected or unwanted behavior, the router can be reconfigured to return all traffic to blue. Green can then be removed and fixed, and a new blue-green deployment can be executed with the corrected version:<br><img src="https://i.imgur.com/bWC8uLg.png" alt="blue-green deployment"></p>
<p><strong>Canary releases</strong><br>Canary releases are releases where we have the current version of the application service and the new version installed on the system in parallel. As such, they resemble blue-green deployments. At first, all traffic is still routed through the current version. We then configure a router so that it funnels a small percentage, say 1%, of the overall traffic to the new version of the application service. The behavior of the new service is then monitored closely to find out whether or not it works as expected. If all the criteria for success are met, then the router is configured to funnel more traffic, say 5% this time, through the new service. Again, the behavior of the new service is closely monitored and, if it is successful, more and more traffic is routed to it until we reach 100%. Once all traffic is routed to the new service and it has been stable for some time, the old version of the service can be decommissioned.</p>
<h1 id="System-management"><a href="#System-management" class="headerlink" title="System management"></a>System management</h1><h2 id="Pruning-unused-resources"><a href="#Pruning-unused-resources" class="headerlink" title="Pruning unused resources"></a>Pruning unused resources</h2><p><strong>Listing resource consumption</strong><br>$ docker system df</p>
<h1 id="in-verbose-mode"><a href="#in-verbose-mode" class="headerlink" title="in verbose mode"></a>in verbose mode</h1><p>$ docker system df -v<br><strong>Pruning containers</strong></p>
<h1 id="regain-unused-system-resources"><a href="#regain-unused-system-resources" class="headerlink" title="regain unused system resources"></a>regain unused system resources</h1><p>$ docker container prune # remove all containers from the system that are not in running status<br>$ docker container prune -f # skip confirmation step</p>
<h1 id="remove-all-containers-from-system-even-the-running-ones"><a href="#remove-all-containers-from-system-even-the-running-ones" class="headerlink" title="remove all containers from system, even the running ones"></a>remove all containers from system, even the running ones</h1><p>$ docker container rm -f $(docker container ls -aq)<br><strong>Pruning images</strong><br>$ docker image prune</p>
<h1 id="avoid-Docker-asking-for-a-confirmation"><a href="#avoid-Docker-asking-for-a-confirmation" class="headerlink" title="avoid Docker asking for a confirmation"></a>avoid Docker asking for a confirmation</h1><p>$ docker image prune -f</p>
<h1 id="Sometimes-we-do-not-just-want-to-remove-orphaned-image-layers-but-all-images-that-are-not-currently-in-use-on-our-system-For-this-we-can-use-the-a-or-–all-flag"><a href="#Sometimes-we-do-not-just-want-to-remove-orphaned-image-layers-but-all-images-that-are-not-currently-in-use-on-our-system-For-this-we-can-use-the-a-or-–all-flag" class="headerlink" title="Sometimes we do not just want to remove orphaned image layers but all images that are not currently in use on our system. For this, we can use the -a (or –all) flag:"></a>Sometimes we do not just want to remove orphaned image layers but all images that are not currently in use on our system. For this, we can use the -a (or –all) flag:</h1><p>$ docker image prune –force –all<br><strong>Pruning volumes</strong><br>$ docker volume prune<br>A useful flag when pruning volumes is the -f or –filter flag which allows us to specify the set of volumes which we’re considering for pruning<br>$ docker volume prune –filter ‘label=demo’<br><strong>Pruning network</strong><br>will remove the networks on which currently no container or service is attached.<br>$ docker network prune<br><strong>Pruning everything</strong><br>$ docker system prune</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/docker/">docker</a><a href="/tags/containers/">containers</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/09/19/apache-cloudstack/" title="apache-cloudstack" itemprop="url">apache-cloudstack</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-09-19T12:56:11.000Z" itemprop="datePublished"> Published 2019-09-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="What-is-Apache-CloudStack"><a href="#What-is-Apache-CloudStack" class="headerlink" title="What is Apache CloudStack"></a>What is Apache CloudStack</h1><ul>
<li>Top level Apache Software Foundation project for cloud computing</li>
<li>Cloud computing framework to deploy IaaS cloud- private, public or hybrid</li>
<li>Supports all popular hypervisors for virtualization</li>
<li>Written in Java. Provides APIs and web GUI for management and administration</li>
</ul>
<h2 id="Key-features"><a href="#Key-features" class="headerlink" title="Key features"></a>Key features</h2><ul>
<li>Rich management interface</li>
<li>Powerful API</li>
<li>Dynamic workload management</li>
<li>Secure, configurable and extensible architecture<br><img src="https://i.imgur.com/J7Jm1XC.png" alt="architecuture"></li>
</ul>
<h2 id="Key-components-terminology"><a href="#Key-components-terminology" class="headerlink" title="Key components/terminology"></a>Key components/terminology</h2><ul>
<li>Region<ul>
<li>Largest Organizational Unit with a CloudStack Deployment</li>
<li>Consists of one or more zones</li>
</ul>
</li>
<li>Zone<ul>
<li>Consists of one or more pods</li>
<li>Contains one or more primary storage servers</li>
<li>Consists of a secondary storage</li>
</ul>
</li>
<li>Pod<ul>
<li>Contains one or more clusters</li>
<li>Contains primary storage servers</li>
</ul>
</li>
<li>Cluster<ul>
<li>Consists of a group of identical hosts running a common hypervisor</li>
<li>Contins one or more primary storage servers</li>
</ul>
</li>
<li>Host<ul>
<li>Smallest orgnizational unit within a Cloustack deployment</li>
<li>Has hypervisor to manage the guest VMs</li>
<li>Provides the computing resources that run guest VMs.</li>
</ul>
</li>
<li>Primary storage<br>iSCSI; NFS; Ceph; Gluster;  Local FileSystem</li>
<li>Secondary storage<br>Templates;  ISO images;   Disk volume; snapshots</li>
</ul>
<hr>
<p>Recap</p>
<ul>
<li>Cloud computing is more efficient than traditional IT infrastructure deployment and management</li>
<li>Cloud can be deployed in public, private and hybrid configurations</li>
<li>Cloud services can be provided as IaaS, PaaS or SaaS.</li>
<li>Apache CloudStack is an open source IaaS cloud platform</li>
<li>Apache CloudStack si very robust, extensible and open platform</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/cloudstack/">cloudstack</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand blog" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/09/12/networking/" title="networking" itemprop="url">networking</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-09-12T08:37:21.000Z" itemprop="datePublished"> Published 2019-09-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="IP-subnetting"><a href="#IP-subnetting" class="headerlink" title="IP subnetting"></a>IP subnetting</h1><p><strong>Subnetting part 1</strong><br>IP address</p>
<ul>
<li>Subnet address </li>
<li>1st Host address </li>
<li>Last Host address </li>
<li>Broadcast address </li>
</ul>
<p>Two methods</p>
<ul>
<li>Method 1 - Binary Method</li>
<li>Method 2 - Quick Method</li>
</ul>
<p><img src="https://i.imgur.com/GFUUIuH.png" alt="Typical example"></p>
<ul>
<li><p>What IP address would router1 be configured with if it is to use the first ip address in the same subnet as PC1?</p>
</li>
<li><p>What broadcast address is use by PC1?</p>
</li>
<li><p>What ip address would Router1 be configured with if it is to use the last IP address in the same Subnet as PC1?</p>
</li>
<li><p>What subnet is PC1 part of?</p>
</li>
</ul>
<p><strong>Binary Rules</strong></p>
<p>Network/subnet address </p>
<ul>
<li>Fill the host portion of an address with binary 0’s </li>
</ul>
<p>Broadcast address </p>
<ul>
<li>Fill the host portion of an address with binary 1’s </li>
</ul>
<p>First Host</p>
<ul>
<li>Fill the host portion of an address with binary 0’s except for the last bit which is set to binary 1</li>
</ul>
<p>Last Host</p>
<ul>
<li>Fill the host portion of an address with binary 1’s except for the last bit which is set to binary 0</li>
</ul>
<p>3rd example<br>172.16.129.1/17</p>
<p>172.16.1|000 0001.0000 0001<br>subnet = 172.16.1000 0000.0000 0000=172.16.128.0<br>Broadcast= 172.16.1111 1111.1111 1111=172.16.255.255<br>1st host=172.16.128.1<br>last host=172.16.255.254</p>
<p><strong>Shortcut table</strong><br>128|64|32|16|8|4|2|1<br>128|192|224|240|248|252|254|255</p>
<p>Tip: the first line shows the decimal values for the binary numbers of an octet<br>10000000=128   00010000=16</p>
<p>Second row, subtract the value in the frist row from 256<br>256-128=128    256-32=224   256-64=192  256-1=255</p>
<p><strong>Binary odometer:(0-255)</strong><br>10.1.1.254+1=10.1.1.255<br>10.1.1.255+1=10.1.2.0<br>10.1.2.0+1=10.1.2.1<br>or in reverse:<br>10.1.2.0-1=10.1.1.255</p>
<p>Broadcast address = Next Network -1<br>First host = subnet +1<br>last host = broadcast -1<br>What subnet is this host on?<br>What is a last host?</p>
<p><strong>Subnetting part 2</strong><br>creat multiple subnets</p>
<p>Subnet this network into at least 10 subnets<br>Subnet this network into subnets each having 10 host</p>
<h1 id="Azure-VMs-networking"><a href="#Azure-VMs-networking" class="headerlink" title="Azure VMs networking"></a>Azure VMs networking</h1><p>Priority: the lower the number, the higher the priority.</p>
<h1 id="ipcalc-in-linux"><a href="#ipcalc-in-linux" class="headerlink" title="ipcalc in linux"></a>ipcalc in linux</h1><p>ipcalc 13.75.0.0/16<br>Address:   13.75.0.0            00001101.01001011. 00000000.00000000<br>Netmask:   255.255.0.0 = 16     11111111.11111111. 00000000.00000000<br>Wildcard:  0.0.255.255          00000000.00000000. 11111111.11111111<br>=&gt;<br>Network:   13.75.0.0/16         00001101.01001011. 00000000.00000000<br>HostMin:   13.75.0.1            00001101.01001011. 00000000.00000001<br>HostMax:   13.75.255.254        00001101.01001011. 11111111.11111110<br>Broadcast: 13.75.255.255        00001101.01001011. 11111111.11111111<br>Hosts/Net: 65534                 Class A</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/networking/">networking</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="stanosaka" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Devops/" title="Devops">Devops<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/aws/" title="aws">aws<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/centos/" title="centos">centos<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/CD-CI/" title="CD/CI">CD/CI<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tomcat/" title="tomcat">tomcat<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/saltstack/" title="saltstack">saltstack<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/zabbix/" title="zabbix">zabbix<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ec2/" title="ec2">ec2<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/backup/" title="backup">backup<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Pipeline/" title="Pipeline">Pipeline<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Blue-Ocean/" title="Blue Ocean">Blue Ocean<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/SRE/" title="SRE">SRE<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/agile/" title="agile">agile<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://kupczynski.info/2018/04/18/spacemacs.html" target="_blank" title="Learning Spacemacs">Learning Spacemacs</a>
            
          </li>
        
          <li>
            
            	<a href="https://cloud.ibm.com/docs/tutorials?topic=solution-tutorials-tutorials" target="_blank" title="IBM cloud solution tutorial">IBM cloud solution tutorial</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/aws-samples" target="_blank" title="AWS Samples">AWS Samples</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/bikrambora/devlab-launchpad" target="_blank" title="Welcome to Dev Labs">Dev Labs</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/ansible/ansible-examples" target="_blank" title="Ansible GitHub repo">Ansible GitHub repo</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" title="Ansible Best Practices">Ansible Best Practices</a>
            
          </li>
        
          <li>
            
            	<a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" title="kubectl cheat sheet">kubectl cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://rogerdudler.github.io/git-guide" target="_blank" title="Git commands">Git commands</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" title="Dockerfile reference">Dockerfile reference</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2mTQr8l" target="_blank" title="Linux Command line cheat sheet">Linux Command line cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2EPHxze" target="_blank" title="PowerShell Basic Cheat Sheet">PowerShell Basic Cheat Sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" title="sed cheatsheet">sed cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://obsavus1p.bkt.clouddn.com/vim_cheat_sheet_for_programmers_print.png" target="_blank" title="vim cheatsheet">vim cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.gitbook.com/book/yeasy/docker_practice/details" target="_blank" title="Learn Docker">Learn Docker</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.unixhot.com/page/ops" target="_blank" title="运维知识体系">运维知识体系</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.tecmint.com/" target="_blank" title="tecmint">tecmint</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.lib.uts.edu.au" target="_blank" title="shoujin.wang@student.uts.edu.au">UTS Library</a>
            
          </li>
        
          <li>
            
            	<a href="https://7esl.com" target="_blank" title="ESL">ESL</a>
            
          </li>
        
          <li>
            
            	<a href="https://stanchou.wordpress.com" target="_blank" title="Stan&#39;s wordpress">Stan&#39;s wordpress</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.00root.com" target="_blank" title="Stan&#39;s gitbook">Stan&#39;s gitbook</a>
            
          </li>
        
          <li>
            
            	<a href="https://api.ipify.org" target="_blank" title="Your IP address">Your IP address</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/stanosaka/oreilly_sql_fundamentals_for_data/blob/master/notes_and_slides/sql_fundamentals_notes.md" target="_blank" title="sql fundamentials">sql fundamentials</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.nerdfonts.com" target="_blank" title="Nred Fonts">Nred Fonts</a>
            
          </li>
        
          <li>
            
            	<a href="http://cb.vu/unixtoolbox.xhtml" target="_blank" title="UNIX TOOLBOX">UNIX TOOLBOX</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/Ben-PH/spacemacs-cheatsheet" target="_blank" title="spacemacs-cheatsheet">spacemacs-cheatsheet</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Stan living in Sydney. <br/>
			I am a lifelong technology learner.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/stanosaka" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6724938" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/stanosaka" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/stan.osaka" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/00root" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/btw01v" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/stan-22-82" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:devops@cwzhou.win" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="Stan Zhou">Stan Zhou</a>
		
		
		</p>
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>


        
  	    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
               if (window.mermaid) {
                  mermaid.initialize({theme: 'forest'});
               }
            </script>
        












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
