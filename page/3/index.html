
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Stan Zhou&#39;s Hexo Technical Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stan Zhou">
    

    
    <meta name="description" content="Infrastructure as code">
<meta property="og:type" content="website">
<meta property="og:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:url" content="http://223.95.78.227/page/3/index.html">
<meta property="og:site_name" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:description" content="Infrastructure as code">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta name="twitter:description" content="Infrastructure as code">
<meta name="twitter:creator" content="@stanosaka">

    
    <link rel="alternative" href="/atom.xml" title="Stan Zhou&#39;s Hexo Technical Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/toad.ico">
    
    
    <link rel="apple-touch-icon" href="/img/toadman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/toadman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/toadman.png" alt="Stan Zhou&#39;s Hexo Technical Blog" title="Stan Zhou&#39;s Hexo Technical Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Stan Zhou&#39;s Hexo Technical Blog">Stan Zhou&#39;s Hexo Technical Blog</a></h1>
				<h2 class="blog-motto">Innovation Evangelist</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:223.95.78.227">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/10/newvocabulary/" title="New Vocabulary" itemprop="url">New Vocabulary</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-10T01:07:36.000Z" itemprop="datePublished"> Published 2019-05-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>revolve around</strong> phrasal verb</p>
<h3 id="revolved-around-revolving-around-revolves-around"><a href="#revolved-around-revolving-around-revolves-around" class="headerlink" title="revolved around; revolving around; revolves around"></a>revolved around; revolving around; revolves around</h3><h3 id="Definition-of-revolve-around"><a href="#Definition-of-revolve-around" class="headerlink" title="Definition of revolve around"></a>Definition of revolve around</h3><ol>
<li>: to move around (something) in a path that is similar to a circle<br>The planets revolve around the sun.</li>
<li>: to have (someone or something) as a main subject or interest<br>The discussion revolved around the question of repairing the roads.<br>His life revolves around playing basketball.<br>He thinks the world revolves around him.<blockquote>
<p>Instead, public cloud expenses revolve around monthly operating expenses(OpEx)</p>
</blockquote>
</li>
</ol>
<hr>
<p><strong>contractual</strong> adjective</p>
<h3 id="of-relating-to-or-constituting-a-contract"><a href="#of-relating-to-or-constituting-a-contract" class="headerlink" title="of, relating to, or constituting a contract"></a>of, relating to, or constituting a contract</h3><p><strong>commitment</strong> noun<br>Definition of commitment</p>
<ol>
<li>a : an agreement or pledge to do something in the future<blockquote>
<p>//a commitment to improve conditions at the prison<br>especially : an engagement to assume a financial obligation at a future date<br>b : something pledged<br>the commitment of troops to the war<br>c : the state or an instance of being obligated or emotionally impelled<br>//a commitment to a cause</p>
</blockquote>
</li>
<li>a : an act of committing to a charge or trust: such as<br>(1) : a consignment to a penal or mental institution<blockquote>
<p>//filed a petition for commitment<br>(2) : an act of referring a matter to a legislative committee<br>b : MITTIMUS</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>This lack of contractual commitment helps increase the agility of IT operations and lowers financial risks associated with innovative technologies.</p>
</blockquote>
<hr>
<p><strong>procurement</strong> noun</p>
<h3 id="the-act-or-process-of-procuring"><a href="#the-act-or-process-of-procuring" class="headerlink" title="the act or process of procuring"></a>the act or process of procuring</h3><hr>
<p><strong>conversely</strong> adverb</p>
<h3 id="Definition-of-conversely"><a href="#Definition-of-conversely" class="headerlink" title="Definition of conversely"></a>Definition of conversely</h3><p>: in a contrasting or opposite way —used to introduce a statement that contrasts with a previous statement or presents a differing interpretation or possibility</p>
<blockquote>
<p>If more resources are needed to support a growing cloud presence, you can get these resources on demand and pay for them only when needed. <strong>Conversely</strong>,</p>
</blockquote>
<h2 id="if-fewer-resources-are-required-you-can-run-less-and-play-for-only-what-you-need"><a href="#if-fewer-resources-are-required-you-can-run-less-and-play-for-only-what-you-need" class="headerlink" title="if fewer resources are required, you can run less and play for only what you need."></a>if fewer resources are required, you can run less and play for only what you need.</h2><p><strong>stringent</strong> adjective</p>
<h3 id="marked-by-rigor-strictness-or-severity-especially-with-regard-to-rule-or-standard"><a href="#marked-by-rigor-strictness-or-severity-especially-with-regard-to-rule-or-standard" class="headerlink" title="marked by rigor, strictness, or severity especially with regard to rule or standard"></a>marked by rigor, strictness, or severity especially with regard to rule or standard</h3><blockquote>
<p>Because you can focus on the security of your resources and the cloud provider can focus on their security responsibilities (such as physical security and hypervisor security), the resulting infrastructure can meet <strong>stringent</strong> levels of security.</p>
</blockquote>
<hr>
<p><strong>perk</strong> noun</p>
<h3 id="bonus-cumshaw-dividend-donative-extra-gratuity-gravy-gravy-train-lagniappe-perquisite-throw-in-tip"><a href="#bonus-cumshaw-dividend-donative-extra-gratuity-gravy-gravy-train-lagniappe-perquisite-throw-in-tip" class="headerlink" title="bonus, cumshaw, dividend, donative, extra, gratuity, gravy, gravy train, lagniappe, perquisite, throw-in, tip"></a>bonus, cumshaw, dividend, donative, extra, gratuity, gravy, gravy train, lagniappe, perquisite, throw-in, tip</h3><blockquote>
<p>the salary’s not great, but the perks make up for it</p>
</blockquote>
<hr>
<p><strong>doggo</strong> </p>
<h3 id="A-dog-would-be-called-a-“doggo”-or-“pupper”-in-DoggoLingo"><a href="#A-dog-would-be-called-a-“doggo”-or-“pupper”-in-DoggoLingo" class="headerlink" title="A dog would be called a “doggo” or “pupper” in DoggoLingo."></a>A dog would be called a “doggo” or “pupper” in DoggoLingo.</h3><blockquote>
<p>Doggo friendly</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/English/">English</a><a href="/tags/vocabulary/">vocabulary</a><a href="/tags/words/">words</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/08/beginningDevOpsWithDocker/" title="Beginning DevOps with Docker" itemprop="url">Beginning DevOps with Docker</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-08T13:20:43.000Z" itemprop="datePublished"> Published 2019-05-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="https://docs.00root.com">see</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Devops/">Devops</a><a href="/tags/Docker/">Docker</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/08/vim/" title="vim" itemprop="url">vim</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-08T12:13:36.000Z" itemprop="datePublished"> Published 2019-05-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Multiple-file-edit"><a href="#Multiple-file-edit" class="headerlink" title="Multiple file edit"></a>Multiple file edit</h3><p>Open multiple files in separate tab via <code>vim -p file1.txt file2.txt</code>.<br>If already open just use <code>:tabe file2.txt</code>.<br>Just 1gt, 2gt, use <code>gt</code> to view.<br>Close tabs using <code>:tabc</code></p>
<h3 id="Replace-string-globally"><a href="#Replace-string-globally" class="headerlink" title="Replace string globally"></a>Replace string globally</h3><p>:%s/release1/release2/g</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/vim/">vim</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/08/JenkinsForProfessionals/" title="Jenkins For Professionals" itemprop="url">Jenkins For Professionals</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-08T11:26:40.000Z" itemprop="datePublished"> Published 2019-05-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Jenkins-for-Professionals"><a href="#Jenkins-for-Professionals" class="headerlink" title="Jenkins for Professionals"></a>Jenkins for Professionals</h1><h2 id="Jenkins’s-architecture"><a href="#Jenkins’s-architecture" class="headerlink" title="Jenkins’s architecture"></a>Jenkins’s architecture</h2><p>Github repository –&gt; Master -&gt; slave<br>                             -&gt; slave</p>
<p>Why distributed architecture for Jenkins?</p>
<ul>
<li>Sometime, several different environments needed</li>
<li>If a larger project gets build, a single server cannot handle entire load<br>Jenkins Master:</li>
<li>Scheduling jobs</li>
<li>Communicating with the slaves</li>
<li>Monitor the slaves</li>
<li>Present the results</li>
<li>Master can also execute build jobs</li>
</ul>
<p>Jenkins Slave:</p>
<ul>
<li>Communicates with Jenkins Master</li>
<li>Can run in different OS</li>
<li>Execute jobs</li>
<li>Flexibility</li>
</ul>
<h2 id="Jenkins-Freestyle-job"><a href="#Jenkins-Freestyle-job" class="headerlink" title="Jenkins Freestyle job"></a>Jenkins Freestyle job</h2><ul>
<li>Central feature of Jenkins</li>
<li>Using jenkins UI to create a CI Pipeline</li>
</ul>
<p><a href="https://github.com/ravikiran-srini/springExample">https://github.com/ravikiran-srini/springExample</a></p>
<h2 id="Scheduling-a-Jenkins-job"><a href="#Scheduling-a-Jenkins-job" class="headerlink" title="Scheduling a Jenkins job"></a>Scheduling a Jenkins job</h2><ul>
<li>Scheduling is one of the options of a Build Trigger</li>
<li>Use CRON expressions to schedule a job<ul>
<li>Each line consists of 5 fields sparated by TAB or whitespace</li>
<li>MINUTE HOUR DOM MONTH DOW<br>0 refers to Sunday</li>
</ul>
</li>
<li>To specify multiple values, use the following:<ul>
<li><ul>
<li>for all valid values</li>
</ul>
</li>
<li>0-9 specify a range of values</li>
<li>2,3,4,5 to enumerate multiple values</li>
</ul>
</li>
<li>Use Hash system for automatic balancing<ul>
<li>Use H H <em> </em> <em> instead of 0 0 </em> <em> </em></li>
</ul>
</li>
<li>Use aliases like @yearly, @monthly, @weekly<ul>
<li>@hourly is the same as H <em> </em> <em> </em></li>
</ul>
</li>
</ul>
<p>Under Source Code Management of Project,<br>in Build Triggers, tick Build periodically, put five starts.</p>
<h2 id="Triggering-builds-remotely"><a href="#Triggering-builds-remotely" class="headerlink" title="Triggering builds remotely"></a>Triggering builds remotely</h2><p>Build Triggers-&gt; tick ‘Tigger build remotely’, put Authenication Token value.</p>
<h2 id="Parameterizing-build"><a href="#Parameterizing-build" class="headerlink" title="Parameterizing build"></a>Parameterizing build</h2><ul>
<li>Allow you to prompt users for one or more inputs</li>
<li>Each parameter has a name and a value</li>
<li>Can be accessed using $paramater or %parameter%</li>
<li>‘Build Now’ will be replaced by “Build with Parameters”</li>
</ul>
<p>Types of Parameters</p>
<ul>
<li>Boolean Parameter</li>
<li>Choice Parameter</li>
<li>Credentials Parameter</li>
<li>File Parameter</li>
<li>List Subversion tags</li>
<li>Password Parameter</li>
<li>Run Parameter</li>
<li>String Parameter</li>
</ul>
<h2 id="Creating-a-user"><a href="#Creating-a-user" class="headerlink" title="Creating a user"></a>Creating a user</h2><h2 id="Installing-Plugins"><a href="#Installing-Plugins" class="headerlink" title="Installing Plugins"></a>Installing Plugins</h2><p>Plugin name: Role-based Authorization Strategy</p>
<h2 id="Implementing-Role-based-access"><a href="#Implementing-Role-based-access" class="headerlink" title="Implementing Role based access"></a>Implementing Role based access</h2><p>Enabling role based access<br>Manage Jenkins-&gt; Configure Global Security, tick ‘Enable security’<br>Authorization select ‘Role-Based Strategy’</p>
<p>Under Manage Jenkins you will have a new ‘Manage and Assign Roles’-&gt; Manage roles</p>
<p>In ‘Global roles’ add role ‘team’ with overall read permission.<br>In “Project roles” add role ‘dev’ with ‘Pattern’ ‘Dev.*’, and tick all the boxes.<br>Same for ‘test’ and ‘ops’.<br><img src="https://i.imgur.com/MSJOKSL.png" alt="ManageRoles"></p>
<h3 id="Assign-Roles"><a href="#Assign-Roles" class="headerlink" title="Assign Roles"></a>Assign Roles</h3><p>Click “Assign Roles”, in ‘Global roles’ add ‘dev’, ‘test’ and ‘ops’ into group ‘team’.<br>Under ‘Item roles’ add user ‘dev’,’test’ and ‘ops’ and assign to its own role. </p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="https://i.imgur.com/ml63iH6.png" alt="AssignRoles"></h2><h2 id="Jenkins-in-Docker"><a href="#Jenkins-in-Docker" class="headerlink" title="Jenkins in Docker"></a>Jenkins in Docker</h2><h3 id="Running-jenkins-in-docker"><a href="#Running-jenkins-in-docker" class="headerlink" title="Running jenkins in docker"></a>Running jenkins in docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull jenkins</span><br><span class="line">docker run -p 8080:8080 -p 50000:50000 jenkins</span><br></pre></td></tr></table></figure>
<h3 id="Persisting-Jenkins-data-in-a-Volume"><a href="#Persisting-Jenkins-data-in-a-Volume" class="headerlink" title="Persisting Jenkins data in a Volume"></a>Persisting Jenkins data in a Volume</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker volume create volume1</span><br><span class="line">docker volume volume ls</span><br><span class="line">docker run -p 8080:8080 -p 50000:50000 -v  volume1:/var/jenkins_home jenkins #v means bond a volume</span><br></pre></td></tr></table></figure>
<p><code>docker stop $(docker ps -aq) #stop all the containers</code><br><code>docker rm $(docker ps -aq) #remove the container</code></p>
<h3 id="Running-multiple-Jenkins-instances-in-Docker"><a href="#Running-multiple-Jenkins-instances-in-Docker" class="headerlink" title="Running multiple Jenkins instances in Docker"></a>Running multiple Jenkins instances in Docker</h3><p><img src="https://i.imgur.com/0yAeBkU.png" alt="demo"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:8080 -p 50000:50000 -v  volume1:/var/jenkins_home jenkins</span><br><span class="line">docker run -p 8081:8080 -p 50001:50000 -v  volume1:/var/jenkins_home jenkins</span><br></pre></td></tr></table></figure></p>
<h2 id="Jenkins-Plugins"><a href="#Jenkins-Plugins" class="headerlink" title="Jenkins Plugins"></a>Jenkins Plugins</h2><h3 id="Create-build-monitor-view"><a href="#Create-build-monitor-view" class="headerlink" title="Create build monitor view"></a>Create build monitor view</h3><p>Install pugin: build monitor view</p>
<h3 id="Using-catlight"><a href="#Using-catlight" class="headerlink" title="Using catlight"></a>Using <a href="https://catlight.io">catlight</a></h3><p><strong>Catlight</strong></p>
<ul>
<li>A notification app for developers</li>
<li>Available for wind, mac &amp; Linux os</li>
<li>Monitor Busg, tasks, builds</li>
<li>See status in the tray and get notified</li>
<li>This is a jenkins plugin</li>
</ul>
<h3 id="Using-Jenkins-CLI"><a href="#Using-Jenkins-CLI" class="headerlink" title="Using Jenkins CLI"></a>Using Jenkins CLI</h3><ul>
<li>Jenkins has a built-in CLI<br>Manage Jenkins-&gt; Jenkins CLI-&gt; Download jenkins-cli.jar</li>
</ul>
<p><code>java -jar jenkins-cli.jar -s http://localhost:8080/ build pipeline -f --username stanadmin --password mario54321</code></p>
<p>Change ‘Configure Global Security’ -&gt; ‘Authorization’-&gt; Logged-in users can do anything-Allow anonymous read access</p>
<p><code>java -jar jenkins-cli.jar -s http://localhost:8080/ build Parameterized-build -f -p environment=&#39;dev&#39;</code></p>
<h3 id="Jenkins-Multibranch-Pipeline"><a href="#Jenkins-Multibranch-Pipeline" class="headerlink" title="Jenkins Multibranch Pipeline"></a>Jenkins Multibranch Pipeline</h3><ul>
<li>Implement different Jenkinsfile for different branches<br>New iteam-&gt; Select Multibranch Pipline-&gt; Scan multibranch pipleline Now<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git remote add proj1 https://github.com/szhouchoice/springExample.git</span><br><span class="line">git branch</span><br><span class="line">git branch -a</span><br><span class="line">git branch feature2</span><br><span class="line">git checkout feature2 # Switched to branch &apos;feature2&apos;</span><br><span class="line">git push origin feature2</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Integrating-Jenkins-with-Slack"><a href="#Integrating-Jenkins-with-Slack" class="headerlink" title="Integrating Jenkins with Slack"></a>Integrating Jenkins with Slack</h3><p>Install: Jenkins-&gt;Plugin Manager-&gt; Slack Notification</p>
<h3 id="Jenkins-Metrics-and-Trends"><a href="#Jenkins-Metrics-and-Trends" class="headerlink" title="Jenkins Metrics and Trends"></a>Jenkins Metrics and Trends</h3><p><strong>Build History Metrics Plugin</strong></p>
<ul>
<li>Mean Time To Failure (MTTF)</li>
<li>Mean Time To Recovery (MTTR)</li>
<li>Standard Deviation<br>Install: Plugin Manager-&gt;Build history metrics<br><img src="https://i.imgur.com/C9aaE74.png" alt="Build History Metrics"><br><strong>Global Build Stats</strong><br>Install: Plugin Manager-&gt;global-build-stats<br>Manage Jenkins-&gt;Global Build Stats-&gt;Initalize stats-&gt;Create new chart-&gt;<br>Title: foobar<br>600*400<br>Hourly<br>24 hours<br><img src="https://i.imgur.com/tRfhyNR.png" alt="Global Build Stats"></li>
</ul>
<h2 id="Introduction-to-Jenkins-Pipeline"><a href="#Introduction-to-Jenkins-Pipeline" class="headerlink" title="Introduction to Jenkins Pipeline"></a>Introduction to Jenkins Pipeline</h2><ul>
<li>A suite of plugins that support continuous delivery pipelines</li>
<li>They provide tools for modeling delivery pipelines as</li>
<li>Definition is written into a text file called ‘Jenkinsfile’</li>
</ul>
<p>Benefits of pipelines</p>
<ul>
<li>Automatically creates a Pipeline build process</li>
<li>Code review of the Pipeline</li>
<li>Audit trail of the Pipeline </li>
<li>Single source of truth</li>
</ul>
<p>Declarative vs Scripted Pipeline </p>
<ul>
<li>Jenkinsfile can be written using:<ul>
<li>Declarative</li>
<li>Scripted</li>
</ul>
</li>
<li>Declarative is a more recent feature<ul>
<li>provides rich syntactical feature</li>
<li>designed to make reading &amp; writing Pipelines easier</li>
</ul>
</li>
</ul>
<p>Why pipeline?</p>
<ul>
<li>Pipelines add a powerful set of automation tolls onto Jenkins</li>
<li>Features of Pipeline are:<ul>
<li>Pipelines are implemented in code </li>
<li>Pipelines support complex real-world CD requirements</li>
<li>Pipelines can survive both planned and unplanned restarts</li>
<li>Pipeline plugin supports custom extensions</li>
<li>Pipelines can stop and wait</li>
</ul>
</li>
</ul>
<h2 id="Pipeline-concepts"><a href="#Pipeline-concepts" class="headerlink" title="Pipeline concepts"></a>Pipeline concepts</h2><ul>
<li>Pipeline</li>
<li>Node</li>
<li>Stage: build, test, deploy</li>
<li>Step</li>
</ul>
<p>Declarative Pipeline syntax<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pipeline&#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages&#123;</span><br><span class="line">    stage(&apos;Build&apos;)&#123;</span><br><span class="line">	steps &#123;</span><br><span class="line">	   //</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Test&apos;)&#123;</span><br><span class="line">	steps &#123;</span><br><span class="line">	   //</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Deploy&apos;)&#123;</span><br><span class="line">	steps &#123;</span><br><span class="line">	   //</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Declarative Pipeline syntax<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">  stage(&apos;Build&apos;)&#123;</span><br><span class="line">    //</span><br><span class="line">  &#125;</span><br><span class="line">  stage(&apos;Test&apos;)&#123;</span><br><span class="line">    //</span><br><span class="line">  &#125;</span><br><span class="line">  stage(&apos;Deploy&apos;)&#123;</span><br><span class="line">   //</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Creating-a-simple-Pipeline"><a href="#Creating-a-simple-Pipeline" class="headerlink" title="Creating a simple Pipeline"></a>Creating a simple Pipeline</h2><ul>
<li>Pipeline can be created in any of the following ways:<ul>
<li>Blue Ocean</li>
<li>Through Classic UI</li>
<li>In SCM(Source Code Managment)</li>
</ul>
</li>
</ul>
<h2 id="Building-a-project-with-jenkins-pipeline"><a href="#Building-a-project-with-jenkins-pipeline" class="headerlink" title="Building a project with jenkins pipeline"></a>Building a project with jenkins pipeline</h2><p>pipeline script:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pipeline&#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages&#123;</span><br><span class="line">    stage(&apos;Build&apos;)&#123;</span><br><span class="line">        steps &#123;</span><br><span class="line">           bat &quot;rm -rf springExample&quot;</span><br><span class="line">           bat &quot;git clone https://github.com/ravikiran-srini/springExample.git&quot;</span><br><span class="line">           bat &quot;mvn clean -f springExample&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Test&apos;)&#123;</span><br><span class="line">        steps &#123;</span><br><span class="line">           bat &quot;mvn test -f springExample&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Deploy&apos;)&#123;</span><br><span class="line">        steps &#123;</span><br><span class="line">           bat &quot;mvn package -f springExample&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Building-a-Pipeline-with-Jenkinsfile"><a href="#Building-a-Pipeline-with-Jenkinsfile" class="headerlink" title="Building a Pipeline with Jenkinsfile"></a>Building a Pipeline with Jenkinsfile</h2><p>Jenkinsfile</p>
<ul>
<li>Complex Pipelines are difficult to write and maintain</li>
<li>You can write Jenkinsfile in an IDE and commit to source control</li>
</ul>
<ol>
<li><p>In <a href="https://github.com/szhouchoice/springExample">https://github.com/szhouchoice/springExample</a> add a Jenksinsfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(&apos;Build&apos;) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        sh &apos;mvn clean&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Test&apos;) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        sh &apos;mvn test&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Deploy&apos;) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        sh &apos;mvn package&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Pipeline<br><img src="https://i.imgur.com/EsJCtWv.png" alt="Pipeline script from SCM"></p>
</li>
</ol>
<h2 id="Using-environment-variables"><a href="#Using-environment-variables" class="headerlink" title="Using environment variables"></a>Using environment variables</h2><p><strong>Environment variables</strong></p>
<ul>
<li>Jenkins exposes environment variables through the variable ‘env’</li>
<li>Entire list of environment variables is accessible from <a href="localhost:8080/pipeline-syntax/globals#env">env variables</a></li>
</ul>
<p>example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&apos;stage1&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo &quot;Build ID: $&#123;env.BUILD_ID&#125;, Jenkins URL: $&#123;env.JENKINS_URL&#125;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Console Ouput:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Started by user Stan Zhou</span><br><span class="line">Running in Durability level: MAX_SURVIVABILITY</span><br><span class="line">[Pipeline] Start of Pipeline</span><br><span class="line">[Pipeline] node</span><br><span class="line">Running on Jenkins in /Users/szhou/.jenkins/workspace/stanpipeline</span><br><span class="line">[Pipeline] &#123;</span><br><span class="line">[Pipeline] stage</span><br><span class="line">[Pipeline] &#123; (stage1)</span><br><span class="line">[Pipeline] echo</span><br><span class="line">Build ID: 1, Jenkins URL: http://localhost:8080/</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // node</span><br><span class="line">[Pipeline] End of Pipeline</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure></p>
<h2 id="Setting-environment-variables"><a href="#Setting-environment-variables" class="headerlink" title="Setting environment variables"></a>Setting environment variables</h2><ul>
<li>Declarative Pipeline<ul>
<li>use ‘environment’ directive</li>
</ul>
</li>
<li>Scripted Pipeline<ul>
<li>use ‘withEnv’ step</li>
</ul>
</li>
<li>environment directive in top-level pipeline block will apply to all steps</li>
<li>environment directive within a stage will only apply with the stage</li>
</ul>
<p>example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    environment &#123;</span><br><span class="line">        mainenv = &apos;test&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&apos;stage1&apos;) &#123;</span><br><span class="line">            environment &#123;</span><br><span class="line">                subenv = &apos;test1&apos;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo mainenv</span><br><span class="line">                echo subenv</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&apos;stage2&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo mainenv</span><br><span class="line">                echo subenv  # will pro error</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="Jenkins-Blue-Ocean"><a href="#Jenkins-Blue-Ocean" class="headerlink" title="Jenkins Blue Ocean"></a>Jenkins Blue Ocean</h1><h2 id="Getting-started-with-blue-ocean"><a href="#Getting-started-with-blue-ocean" class="headerlink" title="Getting started with blue ocean"></a>Getting started with blue ocean</h2><p>What is blue ocean?</p>
<ul>
<li>Blue Ocean refefines the user experience of Jenkins</li>
<li>Features of Blue Ocean are:<ul>
<li>Visualization</li>
<li>Pipeline editor</li>
<li>Personalization</li>
<li>Precision</li>
<li>Native integration for branch</li>
</ul>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Jenkins/">Jenkins</a><a href="/tags/Devops/">Devops</a><a href="/tags/CD-CI/">CD/CI</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/06/git/" title="Complete Git and Github Masterclass" itemprop="url">Complete Git and Github Masterclass</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-05T14:25:42.000Z" itemprop="datePublished"> Published 2019-05-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Complete-Git-and-Github-Masterclass"><a href="#Complete-Git-and-Github-Masterclass" class="headerlink" title="Complete Git and Github Masterclass"></a>Complete Git and Github Masterclass</h1><h2 id="How-Git-works-3-main-states-of-artifact"><a href="#How-Git-works-3-main-states-of-artifact" class="headerlink" title="How Git works - 3 main states of artifact"></a>How Git works - 3 main states of artifact</h2><p>Modified: Here, the artifact goes through chaneg made by the user</p>
<p>Staged: Here, the user/developer adds the artifact to Git index or staging area</p>
<p>Committed: Here, the artifact gets safely stored in Gt database.</p>
<h2 id="3-sections-of-a-Git-project"><a href="#3-sections-of-a-Git-project" class="headerlink" title="3 sections of a Git project"></a>3 sections of a Git project</h2><p>Working directory: this is the root directory of your Git project</p>
<p>Staging area: Also called index, this is where all related changes are build up</p>
<p>Commit area: this is where all artifacts are stacked safely in Git Database</p>
<h2 id="3-ways-of-setting-up-Git-repository"><a href="#3-ways-of-setting-up-Git-repository" class="headerlink" title="3 ways of setting up Git repository"></a>3 ways of setting up Git repository</h2><p>From scratch: we will create a repository from absolutely blank state</p>
<p>Existing project: here we will convert an existing unversioned project to a Git repository</p>
<p>By Copying: we will copy an existing Git repository from Github</p>
<h2 id="Git-Help-system"><a href="#Git-Help-system" class="headerlink" title="Git Help system"></a>Git Help system</h2><p><code>git help -a</code> and <code>git help -g</code> list available subcommands and some concept guides</p>
<h2 id="What-is-Fork-and-how-to-do-it"><a href="#What-is-Fork-and-how-to-do-it" class="headerlink" title="What is Fork and how to do it"></a>What is Fork and how to do it</h2><p>What it means: Creating a project from another existing project</p>
<p>Encouragement: encourages project advancement &amp; collaboration</p>
<p>Contribution: encourages outside contribution</p>
<p>Updates: Forks can updated</p>
<p>Command <code>git status</code>: tells us the status of the working directory and staging area</p>
<p>Command <code>git log</code>: displays committed snapshots or commit history</p>
<p><img src="https://i.imgur.com/NKpsqvI.png" alt="Real world branching scenario"></p>
<h2 id="Git-branching"><a href="#Git-branching" class="headerlink" title="Git branching"></a>Git branching</h2><p>Show branch: <code>git branch</code></p>
<p>Create a new branch: <code>git branch demobranch</code></p>
<p>Switch to the new branch: <code>git checkout demobranch</code></p>
<h2 id="Undoing-changes-in-a-Git-repository"><a href="#Undoing-changes-in-a-Git-repository" class="headerlink" title="Undoing changes in a Git repository"></a>Undoing changes in a Git repository</h2><h3 id="Checking-out-commits-in-a-Git-repository"><a href="#Checking-out-commits-in-a-Git-repository" class="headerlink" title="Checking out commits in a Git repository"></a>Checking out commits in a Git repository</h3><p><code>vim robot.txt</code></p>
<p>Express git add and commit command:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git commit -am <span class="string">"1st commit - robot.txt"</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">log</span> --oneline</span><br><span class="line"></span><br><span class="line">git check 265fbe5</span><br></pre></td></tr></table></figure>
<p>Create a new branch:</p>
<p><code>git checkout -b newbranch</code></p>
<p>Switch branch:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line"></span><br><span class="line">git checkout newbranch</span><br></pre></td></tr></table></figure>
<h3 id="Checking-out-files-in-a-Git-repository"><a href="#Checking-out-files-in-a-Git-repository" class="headerlink" title="Checking out files in a Git repository"></a>Checking out files in a Git repository</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --oneline</span><br><span class="line"></span><br><span class="line">git checkout bb3d025 checkoutfile.txt</span><br><span class="line"></span><br><span class="line">git checkout HEAD checkoutfile.txt</span><br><span class="line"></span><br><span class="line">git status</span><br></pre></td></tr></table></figure>
<h3 id="Reverting-changes-in-a-Git-repository"><a href="#Reverting-changes-in-a-Git-repository" class="headerlink" title="Reverting changes in a Git repository"></a>Reverting changes in a Git repository</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git add . </span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">"commit file to revert"</span></span><br><span class="line"></span><br><span class="line">git revert HEAD</span><br></pre></td></tr></table></figure>
<h3 id="Resetting-Git-repository"><a href="#Resetting-Git-repository" class="headerlink" title="Resetting Git repository"></a>Resetting Git repository</h3><p><code>git reset --hard</code></p>
<blockquote>
<p>resets the staging area and working directory to match the most recent commit.</p>
</blockquote>
<p><img src="https://i.imgur.com/XxVvIOm.png" alt="git reset --hard"></p>
<p><code>git reset --hard hash_vaule</code></p>
<blockquote>
<p>moves the current branch id backward to commit id we are using and reset the both the staging area and work dir to match, this destroy not the current change and both the commit id as well.</p>
</blockquote>
<p><img src="https://i.imgur.com/hDkx3Z8.png" alt="git reset --hard hash_vaule"></p>
<h3 id="Cleaning-Git-repository"><a href="#Cleaning-Git-repository" class="headerlink" title="Cleaning Git repository"></a>Cleaning Git repository</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git clean -n</span><br><span class="line"></span><br><span class="line">git clean -f</span><br><span class="line"></span><br><span class="line">git clean -fd</span><br><span class="line"></span><br><span class="line">vim .gitignore</span><br><span class="line"></span><br><span class="line">git add .gitignore</span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">"committing .gitignore"</span></span><br><span class="line"></span><br><span class="line">git clean -xf</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  ####  ######   ######  ##     ## ######## </span></span><br><span class="line"><span class="comment">#   ##  ##    ## ##    ## ##     ## ##       </span></span><br><span class="line"><span class="comment">#   ##  ##       ##       ##     ## ##       </span></span><br><span class="line"><span class="comment">#   ##   ######   ######  ##     ## ######   </span></span><br><span class="line"><span class="comment">#   ##        ##       ## ##     ## ##       </span></span><br><span class="line"><span class="comment">#   ##  ##    ## ##    ## ##     ## ##       </span></span><br><span class="line"><span class="comment">#  ####  ######   ######   #######  ######## </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  ██╗███████╗███████╗██╗   ██╗███████╗</span></span><br><span class="line"><span class="comment">#  ██║██╔════╝██╔════╝██║   ██║██╔════╝</span></span><br><span class="line"><span class="comment">#  ██║███████╗███████╗██║   ██║█████╗  </span></span><br><span class="line"><span class="comment">#  ██║╚════██║╚════██║██║   ██║██╔══╝  </span></span><br><span class="line"><span class="comment">#  ██║███████║███████║╚██████╔╝███████╗</span></span><br><span class="line"><span class="comment">#  ╚═╝╚══════╝╚══════╝ ╚═════╝ ╚══════╝</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>If github ask for username and password:</p>
<blockquote>
<p><code>git remote set-url origin git@github.com:szhouchoice/EffectiveDevOpsTerraform.git</code></p>
</blockquote>
<p><img src="https://i.imgur.com/iIbiZSY.png" alt="git flow"></p>
<p><strong>Merge branch into master</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ...develop some code...</span><br><span class="line">$ git add –A</span><br><span class="line">$ git commit –m &quot;Some commit message&quot;</span><br><span class="line">$ git checkout master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br><span class="line">$ git merge new-branch</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">git add foobar/foobar.php</span><br><span class="line">git status</span><br><span class="line">git reset HEAD foobar/foobar.php ## unstaged changes after reset</span><br><span class="line">git diff</span><br><span class="line">git log</span><br><span class="line"></span><br><span class="line">## branching and merging</span><br><span class="line">git checkout -b newfunction</span><br><span class="line">vim foobar</span><br><span class="line">git add *</span><br><span class="line">git diff</span><br><span class="line">git commit -m &quot;Adds newfunction&quot;</span><br><span class="line">git log</span><br><span class="line">git checkout master</span><br><span class="line">git merge newfunction</span><br><span class="line">git branch -D newfunction</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/git/">git</a><a href="/tags/github/">github</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/05/amazon-linux2/" title="amazon linux 2" itemprop="url">amazon linux 2</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-05T10:46:16.000Z" itemprop="datePublished"> Published 2019-05-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Amazon-Linux-2"><a href="#Amazon-Linux-2" class="headerlink" title="Amazon Linux 2"></a>Amazon Linux 2</h3><p>Change hostname use init-cloud:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/cloud/cloud.cfg.d/11_changehostname.cfg</span><br><span class="line"><span class="comment">#cloud-config</span></span><br><span class="line">preserve_hostname: <span class="literal">false</span></span><br><span class="line">hostname: myhostname</span><br><span class="line">fqdn: myhostname.example.com</span><br><span class="line">manage_etc_hosts: <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<p>By Command:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl <span class="built_in">set</span>-hostname foobar.localdomain</span><br><span class="line">sed -i <span class="string">'1s/localhost/foobar/1'</span> /etc/hosts|sed -i <span class="string">'1s/localhost/foobar/2'</span> /etc/hosts</span><br></pre></td></tr></table></figure></p>
<p>Extra Library:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user ~]$ amazon-linux-extras list</span><br><span class="line">[ec2-user ~]$ sudo amazon-linux-extras install topic=version topic=version</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/aws/">aws</a><a href="/tags/linux/">linux</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/05/docker/" title="docker" itemprop="url">docker</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-05T06:47:47.000Z" itemprop="datePublished"> Published 2019-05-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>what is docker</strong></p>
<ul>
<li>Open platform</li>
<li>Build, ship, and run applications</li>
<li>Popular because:<ul>
<li>Flexible</li>
<li>Lightweight</li>
<li>Interchangeable</li>
<li>Portable</li>
<li>Scalable<h2 id="List-Docker-CLI-commands"><a href="#List-Docker-CLI-commands" class="headerlink" title="List Docker CLI commands"></a>List Docker CLI commands</h2></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">docker</span><br><span class="line">docker container --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Display Docker version and info</span></span><br><span class="line">docker --version</span><br><span class="line">docker version</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"><span class="comment">## Execute Docker image</span></span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment">## List Docker images</span></span><br><span class="line">docker image ls</span><br><span class="line"></span><br><span class="line"><span class="comment">## List Docker containers (running, all, all in quiet mode)</span></span><br><span class="line">docker container ls</span><br><span class="line">docker container ls --all</span><br><span class="line">docker container ls -aq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker build -t friendlyhello .  <span class="comment"># Create image using this directory's Dockerfile</span></span><br><span class="line">docker run -p 4000:80 friendlyhello  <span class="comment"># Run "friendlyhello" mapping port 4000 to 80</span></span><br><span class="line">docker run -d -p 4000:80 friendlyhello         <span class="comment"># Same thing, but in detached mode</span></span><br><span class="line">docker container ls                                <span class="comment"># List all running containers</span></span><br><span class="line">docker container ls -a             <span class="comment"># List all containers, even those not running</span></span><br><span class="line">docker container stop &lt;<span class="built_in">hash</span>&gt;           <span class="comment"># Gracefully stop the specified container</span></span><br><span class="line">docker container <span class="built_in">kill</span> &lt;<span class="built_in">hash</span>&gt;         <span class="comment"># Force shutdown of the specified container</span></span><br><span class="line">docker container rm &lt;<span class="built_in">hash</span>&gt;        <span class="comment"># Remove specified container from this machine</span></span><br><span class="line">docker container rm $(docker container ls -a -q)         <span class="comment"># Remove all containers</span></span><br><span class="line">docker image ls -a                             <span class="comment"># List all images on this machine</span></span><br><span class="line">docker image rm &lt;image id&gt;            <span class="comment"># Remove specified image from this machine</span></span><br><span class="line">docker image rm $(docker image ls -a -q)   <span class="comment"># Remove all images from this machine</span></span><br><span class="line">docker login             <span class="comment"># Log in this CLI session using your Docker credentials</span></span><br><span class="line">docker tag &lt;image&gt; username/repository:tag  <span class="comment"># Tag &lt;image&gt; for upload to registry</span></span><br><span class="line">docker push username/repository:tag            <span class="comment"># Upload tagged image to registry</span></span><br><span class="line">docker run username/repository:tag                   <span class="comment"># Run image from a registry</span></span><br></pre></td></tr></table></figure>
<h1 id="Beginning-Devops-with-Docker"><a href="#Beginning-Devops-with-Docker" class="headerlink" title="Beginning Devops with Docker"></a>Beginning Devops with Docker</h1><h2 id="Chapter-1-Images-and-Containers"><a href="#Chapter-1-Images-and-Containers" class="headerlink" title="Chapter 1. Images and Containers"></a>Chapter 1. Images and Containers</h2><p><strong>Virtualization versus Containerization</strong><br><img src="https://i.imgur.com/KKfsLxn.png" alt="virtual machine block diagram"><br>In virtual machines, the physical hardware is abstracted, therefore we have may server running on one server. Virtual machines do sometimes take time to start up and are expensive in capacity (they can be GBs in size), although the greatest advantage they have over containers is the ability to run different Linux distributions such as CentOS instead of just Ubuntu.</p>
<p><img src="https://i.imgur.com/rWfUi8x.png" alt="containerization"><br>In containerization, it is only the app layer (where code and dependencies are packaged) that is abstracted, making it possible for many containers to run on the same OS kernel but on separate user space.</p>
<p>Containers use less space and boot fast.</p>
<ul>
<li>Describe how Docker improves a DevOps workflow<br>Normally, we have two pieces to a working application: the project code base and the provisioning script. The code base is the application code. It is managed by version control and hosted in GitHub, among other platforms.<br><img src="https://i.imgur.com/7bpoPrj.png" alt="Docker implements"><br>The <strong>Dockerfile</strong> takes the place of the provisioning script. The two combined (project code and Dockerfile) make a <strong>Docker image</strong>. A Docker image can be run as an application. This running application sourced from a Docker image is called a <strong>Docker container</strong>.</li>
</ul>
<p><strong>Basic Docker Terminal Commands</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker info ## displays system-wide information</span><br><span class="line">docker search &lt;term&gt; (foir example. docker search ubuntu) ##searches Docker Hub for Images</span><br><span class="line">docker pull ## pulls an image from the registry to your local machine eg docker pull ubuntu</span><br><span class="line">docker images ## lists the Docker images we have locally</span><br><span class="line">docker run &lt;image&gt; #will check whether the image by the name hello-world exists locally,if the image is</span><br><span class="line">not local, it will be pulled form the default registry, Docker Hub, and run as a container, by default</span><br><span class="line"></span><br><span class="line">docker ps ## lists the running containers</span><br><span class="line">docker stop &lt;container ID&gt;  ## stop the container </span><br><span class="line">docker rm &lt;container ID&gt; ## Delete the container and the image</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Interpret Dockerfile syntax</li>
<li>Build images</li>
<li>Set up containers and images</li>
<li>Set up a local dynamic environment</li>
<li>Run applications in Docker containers</li>
<li>Obtain a basic overview of how Docker manages images via Docker Hub</li>
<li>Deploy a Docker image to Docker Hub</li>
</ul>
<p><strong>The Dockerfile</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8-jre-alpine</span><br><span class="line"></span><br><span class="line">ENV SPRING_OUTPUT_ANSI_ENABLED=ALWAYS \</span><br><span class="line">    JHIPSTER_SLEEP=0 \</span><br><span class="line">    JAVA_OPTS=&quot;&quot;</span><br><span class="line"></span><br><span class="line">CMD echo &quot;The application will start in $&#123;JHIPSTER_SLEEP&#125;s...&quot; &amp;&amp; \</span><br><span class="line">    sleep $&#123;JHIPSTER_SLEEP&#125; &amp;&amp; \</span><br><span class="line">    java $&#123;JAVA_OPTS&#125; -Djava.security.egd=file:/dev/./urandom -jar /app.war</span><br><span class="line"></span><br><span class="line">EXPOSE 8080 5701/udp</span><br><span class="line"></span><br><span class="line">ADD *.war /app.war</span><br></pre></td></tr></table></figure></p>
<p>The <strong>FROM</strong> instruction specifies the base image to use while initializing the build. Here, we specify open JDK 8 as our Java runtime.</p>
<p>The <strong>ENV</strong> instruction is used to set environment variables, and the <strong>CMD</strong> instruction is used to specify commands to be executed.</p>
<p>The <strong>EXPOSE</strong> instruction is used to specify the port that the container listens to during runtime.</p>
<p><strong>useful commands for Docker and Docker compose</strong><br><img src="https://i.imgur.com/FAExCVU.png" alt="commands1"><br><img src="https://i.imgur.com/LtTRrfD.png" alt="commands2"></p>
<h2 id="Docker-compose"><a href="#Docker-compose" class="headerlink" title="Docker-compose"></a>Docker-compose</h2><p><strong>Sample docker-compose file that will start a Rdis database on port 5000</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: &apos;3&apos;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">     - &quot;5000:5000&quot;</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br></pre></td></tr></table></figure></p>
<p>The first line of the <em>docker-compose</em> file should be the version of the <em>docker-compose</em> tool. </p>
<p>Then we need to specify all the necessary services that we need for our application to run. They should be defined in the <em>services:</em> section.</p>
<p>We can also define multiple services inside here, giving a name to each (<em>web</em> and <em>redis</em>).</p>
<p>This is followed by how to build the <em>service</em> (either via a command to build or referring a Dockerfile). </p>
<p>If the application needs any port access, we can configure it using <em>5000:5000</em> (that is internal port: external port). </p>
<p>Then, we have to specify the volume information. This basically tells <em>docker-compose</em> to serve the files from the location specified.   </p>
<p>Once we have specified the services required for our application, then we can start the application via <em>docker-compose</em>. This will start your entire application along with the services, and expose the <em>services</em> on the port specified. </p>
<p>With <em>docker-compose</em>, we can perform the following operations:</p>
<ul>
<li><strong>Start</strong>: docker-compose -f &lt;docker_file&gt; up</li>
<li><p><strong>Stop</strong>: docker-compose -f &lt;docker_file&gt; down<br>We can also perform the following operations:</p>
</li>
<li><p><strong>List the running services and their status</strong>: <em>docker ps</em></p>
</li>
<li><strong>Logs</strong>: <em>docker log &lt;container_id&gt;</em></li>
</ul>
<h2 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h2><p>A single deployable component is called a <strong>pod</strong> in Kubernetes. This can be as simple as a running process in the container. A group of pods can be combined together to form a <strong>deployment</strong>. </p>
<p>The following code is a sample Kubernetes file that will start a Nginx server:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginxsvc</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    name: http</span><br><span class="line">  - port: 443</span><br><span class="line">    protocol: TCP</span><br><span class="line">    name: https</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>Start with an <em>apiVersion</em> in a Kubernetes deployment file.</p>
</li>
<li><p>Followed by the type, which takes either a pod, deployment, namespace, ingress (load balancing the pods), role, and many more.</p>
</li>
</ol>
<p>Ingress forms a layer between the services and the internet so that all the inbound connections are controlled or configured with the ingress controller before sending them to Kubernetes services on the cluster. On the other hand, the egress controller controls or configures services going out of the Kubernetes cluster.</p>
<ol start="3">
<li><p>This is followed by the metadata information, such as the type of environments, the application name (nginxsvc), and labels (Kubernetes uses this information to identify and segregate the pods). Kubernetes uses this metadata information to identify the particular pods or a group of pods, and we can manage the instances with this metadata. This is one of the key differences with docker-compose, where docker-compose doesn’t have the flexibility of defining the metadata about the containers.</p>
</li>
<li><p>This is followed by the spec, where we define the specification of the images or our application. We can also define the pull strategy for our images as well as define the environment variables along with the exposed ports. We can define the resource limitations on the machine (or VM) for a particular service. They provide health checks, that is, each service is monitored for the health and when some services fail, they are immediately replaced by newer ones. They also provide service discovery out of the box, by assigning each pod an IP, which makes it easier for the services to identify and interact with them. They also provide a better dashboard, to visualize your architecture and the status of the application. You can do most of the management via this dashboard, such as checking the status, logs, scale up, or down the services, and so on.</p>
</li>
</ol>
<h2 id="Docker-ps-command"><a href="#Docker-ps-command" class="headerlink" title="Docker ps command"></a>Docker ps command</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker ps --format <span class="string">"table &#123;&#123;.ID&#125;&#125; \t &#123;&#123;.Image&#125;&#125; \t &#123;&#123;.Ports&#125;&#125; \t &#123;&#123;.Names&#125;&#125;"</span></span><br><span class="line">CONTAINER ID         IMAGE                   PORTS                                                NAMES</span><br><span class="line">7d3a6d518e8e         jenkinsci/blueocean     0.0.0.0:8080-&gt;8080/tcp, 0.0.0.0:50000-&gt;50000/tcp     jenkins</span><br><span class="line">9655eb0e836e         alpine                                                                       quotes</span><br><span class="line">root@stan-OptiPlex-380:~|⇒  docker ps --format <span class="string">"table &#123;&#123;.ID&#125;&#125; \t &#123;&#123;.Names &#125;&#125; \t &#123;&#123;.Status&#125;&#125;"</span></span><br><span class="line">CONTAINER ID         NAMES               STATUS</span><br><span class="line">7d3a6d518e8e         jenkins             Up 2 minutes</span><br><span class="line">9655eb0e836e         quotes              Up 4 hours</span><br></pre></td></tr></table></figure>
<h2 id="Docker-networking"><a href="#Docker-networking" class="headerlink" title="Docker networking"></a>Docker networking</h2><p>-Mostly used types</p>
<ul>
<li>Bridge networks<ul>
<li>The default network driver</li>
<li>Applications run in standalone containers that need to communicate</li>
</ul>
</li>
<li>Overlay networks:<ul>
<li>Connect multiple Docker daemons together</li>
<li>Enable swarm services to communicate with each other</li>
</ul>
</li>
</ul>
<p><strong>Docker basic networking</strong></p>
<ul>
<li>Step 1: create a network and volume</li>
</ul>
<p>Listing and creating a network:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br><span class="line">docker network create net1</span><br></pre></td></tr></table></figure></p>
<p>Listing and creating a volume:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker volume ls</span><br><span class="line">docker volume create --driver=local --name=volume1</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>Step 2: start docker containers</p>
<ul>
<li>Starting docker containers:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=container1 -v volume1:/opt --network=net1 busybox sh</span><br><span class="line">docker run -it --name=container2 -v volume1:/opt --network=net1 busybox sh</span><br><span class="line">#-t is used for interactive session and t will give you the terminal</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Step 3: test connectivity between these containers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ping container2</span><br><span class="line">PING container2 (172.19.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.19.0.3: seq=0 ttl=64 time=0.170 ms</span><br><span class="line">64 bytes from 172.19.0.3: seq=1 ttl=64 time=0.134 ms</span><br><span class="line">64 bytes from 172.19.0.3: seq=2 ttl=64 time=0.133 ms</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>Overlay networking</strong></p>
<p><strong>What does an overlay network do?</strong></p>
<ul>
<li>Containers only connect to other containers on the same network </li>
<li>Connecting to containers on other hosts requires that the container publish the needed port </li>
<li>Overlay network allows containers running on different hosts to connect on a private network<br><img src="https://i.imgur.com/KjgJtA0.png" alt="overlay networking"></li>
<li>Step 1: Initiate docker swarm<blockquote>
<p>Host1: Check networks and initiate docker swarm:<br> docker network ls<br> docker swarm init<br>Host2: Initiate swarm worker and check its networks:<br> docker swarm join –toaken foobar 192.168.10.91:2377<br> docker network ls</p>
</blockquote>
</li>
<li><p>Step 2: Create overlay network and spin a docker container on host1</p>
<blockquote>
<p>Create an overlay network:<br> docker network create -d overlay –atachable=true swarmnet</p>
<ul>
<li>List networks:<br>docker network ls</li>
<li>Spin a Docker container:<br>docker run -itd –name container1 –network swarmnet busybox</li>
</ul>
</blockquote>
</li>
<li><p>Step 3: Spin a container on host2 and check its networks</p>
<blockquote>
<p>List networks:<br> docker network ls</p>
<ul>
<li>Spin a Docker container:<br>docker run -itd –name container2 –network swarmnet busybox</li>
<li>List networks and see new network:<br>docker network ls</li>
</ul>
</blockquote>
</li>
<li><p>Step 4: Login to the containers check its networks and sing each other</p>
<blockquote>
<p>Host1: Log in to the container, check IPs, and ping container on Host2:<br>   docker exec -it container1 sh<br>   ifconfig<br>   ping container2<br>Host2:  Log in to the container, check IPs, and ping container on Host1:<br>   docker exec -it container2 sh<br>   ifconfig<br>   ping container1</p>
</blockquote>
</li>
</ul>
<h1 id="upload-that-new-image-to-dockerhub"><a href="#upload-that-new-image-to-dockerhub" class="headerlink" title="upload that new image to dockerhub"></a>upload that new image to dockerhub</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag helloworld stanosaka/helloworld</span><br><span class="line">docker push stanosaka/helloworld</span><br></pre></td></tr></table></figure>
<p>Cleaning up containers:We can clean up everything by stopping and removing all containers with these two handy one-line commands:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop $(docker ps -a -q)</span><br><span class="line">$ docker system prune</span><br></pre></td></tr></table></figure></p>
<h1 id="Amazon-web-services-and-docker-development"><a href="#Amazon-web-services-and-docker-development" class="headerlink" title="Amazon web services and docker development"></a>Amazon web services and docker development</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install     apt-transport-https     ca-certificates     curl</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key</span><br><span class="line">add-apt-repository    &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span><br><span class="line">   $(lsb_release -cs) \</span><br><span class="line">   stable&quot;</span><br><span class="line">apt update</span><br><span class="line">apt-get install docker-ce docker-ce-cli containerd.io</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl status docker</span><br><span class="line"></span><br><span class="line">root@ip-172-31-6-219:~# cat dockerfile</span><br><span class="line">FROM ubuntu:16.04</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RUN apt update</span><br><span class="line">RUN apt install -y apache2</span><br><span class="line">RUN echo &quot;Welcome to my web site&quot; &gt; /var/www/html/index.html</span><br><span class="line">CMD /usr/sbin/apache2ctl -D FOREGROUND</span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker info</span><br><span class="line">docker run -it --detach=true ubuntu bash</span><br><span class="line">docker ps</span><br><span class="line">docker renmae nervous_visvesvaraya newname</span><br><span class="line">docker network inspect newnet|less</span><br><span class="line">docker network connect newnet newname</span><br><span class="line">docker inspect newname|less</span><br><span class="line">ping 172.18.0.2</span><br><span class="line">ping 172.17.0.2</span><br><span class="line">docker build -t &quot;webserver&quot; .</span><br><span class="line">docker images</span><br><span class="line">docker run -d -p 80:80 webserver /usr/sbin/apache2ctl -D FOREGROUND</span><br><span class="line">docker ps</span><br><span class="line">curl localhost</span><br><span class="line"> aws iam create-service-linked-role --aws-service-name ecs.amazonaws.com</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Role&quot;: &#123;</span><br><span class="line">        &quot;AssumeRolePolicyDocument&quot;: &#123;</span><br><span class="line">            &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">            &quot;Statement&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Action&quot;: [</span><br><span class="line">                        &quot;sts:AssumeRole&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">                    &quot;Principal&quot;: &#123;</span><br><span class="line">                        &quot;Service&quot;: [</span><br><span class="line">                            &quot;ecs.amazonaws.com&quot;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;RoleId&quot;: &quot;AROAYYRUPCKTK7Z2M2PLO&quot;,</span><br><span class="line">        &quot;CreateDate&quot;: &quot;2019-09-02T02:28:51Z&quot;,</span><br><span class="line">        &quot;RoleName&quot;: &quot;AWSServiceRoleForECS&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/aws-service-role/ecs.amazonaws.com/&quot;,</span><br><span class="line">        &quot;Arn&quot;: &quot;arn:aws:iam::602479202982:role/aws-service-role/ecs.amazonaws.com/AWSServiceRoleForECS&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Working-with-ecs-throught-the-aws-cli"><a href="#Working-with-ecs-throught-the-aws-cli" class="headerlink" title="Working with ecs throught the aws cli"></a>Working with ecs throught the aws cli</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aws ecs list-clusters</span><br><span class="line">aws ecs describe-clusters</span><br><span class="line">aws ecs create-cluster --cluster-name newcluster</span><br></pre></td></tr></table></figure>
<p><strong>Configure ECS to authenticate with Docker Hub</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#1.ssh to ecs server</span><br><span class="line">cd /etc/ecs</span><br><span class="line">[root@ip-172-31-13-18 ecs]# vim ecs.config</span><br><span class="line">ECS_ENGINE_AUTH_TYPE=docker</span><br><span class="line">ECS_ENGINE_AUTH_DATA=&#123;&quot;https://index.docker.io/v1/&quot;:&#123;&quot;username&quot;:&quot;foobar&quot;,&quot;password&quot;:&quot;badpassword&quot;,&quot;email&quot;:&quot;foo.bar@gmail.com&quot;&#125;&#125;</span><br><span class="line">[root@ip-172-31-13-18 ecs]# stop ecs</span><br><span class="line">ecs stop/waiting</span><br><span class="line">[root@ip-172-31-13-18 ecs]# start ecs</span><br><span class="line">ecs start/running, process 4996</span><br><span class="line">[root@ip-172-31-13-18 ecs]# docker inspect ecs-agent|grep ECS_DATADIR</span><br><span class="line">                &quot;ECS_DATADIR=/data&quot;,</span><br><span class="line">#2. make repo private in docker hub</span><br><span class="line">#3. configure in aws console about ecs</span><br></pre></td></tr></table></figure></p>
<p><strong>working with ec2 container registry (ECR)</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aws ecr get-login help</span><br><span class="line">docker login -u AWS -p badpassword https://602479202982.dkr.ecr.ap-southeast-2.amazonaws.com</span><br><span class="line">docker images</span><br><span class="line">docker tag c0a44e0f3831 602479202982.dkr.ecr.ap-southeast-2.amazonaws.com/myrepo</span><br><span class="line">docker push 602479202982.dkr.ecr.ap-southeast-2.amazonaws.com/myrepo</span><br></pre></td></tr></table></figure></p>
<h2 id="Docker-registry"><a href="#Docker-registry" class="headerlink" title="Docker registry"></a>Docker registry</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --restart always --name registry registry:2</span><br><span class="line">docker pull hello-world</span><br><span class="line">docker tag hello-world localhost:5000/hello-world</span><br><span class="line">docker push localhost:5000/hello-world</span><br><span class="line">docker exec -it registry /bin/sh</span><br><span class="line">docker images</span><br><span class="line">docker rmi hello-world</span><br><span class="line">docker rmi localhost:5000/hello-world</span><br><span class="line">docker images</span><br><span class="line">docker pull localhost:5000/hello-world</span><br><span class="line">docker run \</span><br><span class="line">  -d \</span><br><span class="line">  -e ENV_DOCKER_REGISTRY_HOST=registry \</span><br><span class="line">  -e ENV_DOCKER_REGISTRY_PORT=5000 \</span><br><span class="line">  -p 8080:80 \</span><br><span class="line">  --link registry:registry \</span><br><span class="line">  konradkleine/docker-registry-frontend:v2</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/docker/">docker</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/06/redhat/" title="redhat" itemprop="url">redhat</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2017-09-06T07:49:54.000Z" itemprop="datePublished"> Published 2017-09-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Issue-1"><a href="#Issue-1" class="headerlink" title="Issue 1."></a>Issue 1.</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost stan]<span class="comment"># yum install -y ntp</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">There are no enabled repos.</span><br><span class="line"> Run <span class="string">"yum repolist all"</span> to see the repos you have.</span><br><span class="line"> You can <span class="built_in">enable</span> repos with yum-config-manager --<span class="built_in">enable</span> &lt;repo&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve:"></a>Solve:</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]<span class="comment"># mkdir /cdrom</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mount /dev/cdrom /cdrom</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># pwd</span></span><br><span class="line">/etc/yum.repos.d</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># vim dvd.repo</span></span><br><span class="line">[dvd-source]</span><br><span class="line">name=RHEL 7.2 dvd repo</span><br><span class="line">baseurl=file:///cdrom</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum repolist</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">dvd-source                                                                                     | 4.1 kB  00:00:00</span><br><span class="line">(1/2): dvd-source/group_gz                                                                     | 136 kB  00:00:00</span><br><span class="line">(2/2): dvd-source/primary_db                                                                   | 3.6 MB  00:00:00</span><br><span class="line">repo id                                             repo name                                                   status</span><br><span class="line">dvd-source                                          RHEL 7.2 dvd repo                                           4,620</span><br><span class="line">repolist: 4,620</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum install rpm-build</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package rpm-build.x86_64 0:4.11.3-17.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl(Thread::Queue) <span class="keyword">for</span> package: rpm-build-4.11.3-17.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: system-rpm-config <span class="keyword">for</span> package: rpm-build-4.11.3-17.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package perl-Thread-Queue.noarch 0:3.02-2.el7 will be installed</span><br><span class="line">---&gt; Package redhat-rpm-config.noarch 0:9.1.0-68.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: dwz &gt;= 0.4 <span class="keyword">for</span> package: redhat-rpm-config-9.1.0-68.el7.noarch</span><br><span class="line">--&gt; Processing Dependency: perl-srpm-macros <span class="keyword">for</span> package: redhat-rpm-config-9.1.0-68.el7.noarch</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package dwz.x86_64 0:0.11-3.el7 will be installed</span><br><span class="line">---&gt; Package perl-srpm-macros.noarch 0:1-8.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">======================================================================================================================</span><br><span class="line"> Package                          Arch                  Version                       Repository                 Size</span><br><span class="line">======================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> rpm-build                        x86_64                4.11.3-17.el7                 dvd-source                144 k</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> dwz                              x86_64                0.11-3.el7                    dvd-source                 99 k</span><br><span class="line"> perl-Thread-Queue                noarch                3.02-2.el7                    dvd-source                 17 k</span><br><span class="line"> perl-srpm-macros                 noarch                1-8.el7                       dvd-source                4.7 k</span><br><span class="line"> redhat-rpm-config                noarch                9.1.0-68.el7                  dvd-source                 77 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">======================================================================================================================</span><br><span class="line">Install  1 Package (+4 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 341 k</span><br><span class="line">Installed size: 734 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                 1.9 MB/s | 341 kB  00:00:00</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : perl-Thread-Queue-3.02-2.el7.noarch                                                                1/5</span><br><span class="line">  Installing : dwz-0.11-3.el7.x86_64                                                                              2/5</span><br><span class="line">  Installing : perl-srpm-macros-1-8.el7.noarch                                                                    3/5</span><br><span class="line">  Installing : redhat-rpm-config-9.1.0-68.el7.noarch                                                              4/5</span><br><span class="line">  Installing : rpm-build-4.11.3-17.el7.x86_64                                                                     5/5</span><br><span class="line">dvd-source/productid                                                                           | 1.6 kB  00:00:00</span><br><span class="line">  Verifying  : redhat-rpm-config-9.1.0-68.el7.noarch                                                              1/5</span><br><span class="line">  Verifying  : rpm-build-4.11.3-17.el7.x86_64                                                                     2/5</span><br><span class="line">  Verifying  : perl-srpm-macros-1-8.el7.noarch                                                                    3/5</span><br><span class="line">  Verifying  : dwz-0.11-3.el7.x86_64                                                                              4/5</span><br><span class="line">  Verifying  : perl-Thread-Queue-3.02-2.el7.noarch                                                                5/5</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  rpm-build.x86_64 0:4.11.3-17.el7</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  dwz.x86_64 0:0.11-3.el7                  perl-Thread-Queue.noarch 0:3.02-2.el7  perl-srpm-macros.noarch 0:1-8.el7</span><br><span class="line">  redhat-rpm-config.noarch 0:9.1.0-68.el7</span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/redhat/">redhat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/nginx01/" title="Nginx Deploy" itemprop="url">Nginx Deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T04:31:14.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Install-Nginx"><a href="#Install-Nginx" class="headerlink" title="Install Nginx"></a>Install Nginx</h2><h3 id="Install-Nginx-Package"><a href="#Install-Nginx-Package" class="headerlink" title="Install Nginx Package"></a>Install Nginx Package</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@huoq bin]<span class="comment"># yum install pcre pcre-devel -y</span></span><br><span class="line">check by:</span><br><span class="line">[root@huoq bin]<span class="comment"># rpm -qa pcre pcre-devel</span></span><br><span class="line">pcre-devel-8.32-15.el7_2.1.x86_64</span><br><span class="line">pcre-8.32-15.el7_2.1.x86_64</span><br><span class="line">[root@huoq tools]<span class="comment"># yum install -y openssl-devel openssl</span></span><br></pre></td></tr></table></figure>
<h3 id="Install-Nginx-1"><a href="#Install-Nginx-1" class="headerlink" title="Install Nginx"></a>Install Nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.6.3.tar.gz</span><br><span class="line">useradd nginx -s /sbin/nologin -M</span><br><span class="line">tar xf nginx-1.6.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.6.3/</span><br><span class="line">./configure --user=nginx --group=nginx --prefix=/application/nginx-1.6.3 --with-http_stub_status_module --with-http_ssl_module</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s /application/nginx-1.6.3 /application/nginx</span><br><span class="line">vim /application/nginx/conf/nginx.conf</span><br><span class="line">worker_processes  4;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">   </span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    upstream web_pools &#123;</span><br><span class="line">        server 127.0.0.1:8081;</span><br><span class="line">        server 127.0.0.1:8082;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            proxy_pass http://web_pools;</span><br><span class="line">        &#125;</span><br><span class="line">        location /nginx_status &#123;</span><br><span class="line">                stub_status on;</span><br><span class="line">                access_log off;</span><br><span class="line">                allow 127.0.0.1;</span><br><span class="line">                deny all;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/application/nginx/sbin/nginx -t</span><br><span class="line">vim /etc/init.d/nginx</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#chkconfig: - 85 15</span></span><br><span class="line"><span class="comment">#description: this script use to manage nginx process.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#set -x</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"></span><br><span class="line">procnum=`ps -ef |grep <span class="string">"/application/nginx/sbin/nginx"</span>|grep -v <span class="string">"grep"</span>|wc -l`</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  /application/nginx/sbin/nginx</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"$?"</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  failure</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 4</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  /application/nginx/sbin/nginx -s stop</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"$?"</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  failure</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 3</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">  start)</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  stop)</span><br><span class="line">  stop</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  restart)</span><br><span class="line">  stop</span><br><span class="line">  sleep 1</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  reload)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  /application/nginx/sbin/nginx -s reload</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is not running!please start nginx first..."</span></span><br><span class="line">  <span class="built_in">exit</span> 2</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  status)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is running..."</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is not running..."</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  *)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage : nginx [ start|stop|reload|restart|status ]"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">  ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">chmod +x /etc/init.d/nginx</span><br><span class="line">chkconfig nginx on</span><br><span class="line">/etc/init.d/nginx start</span><br><span class="line">Starting nginx:                                      [  OK  ]</span><br><span class="line">/etc/init.d/nginx status</span><br><span class="line">nginx is running...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/nginx/">nginx</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/tomcat01/" title="tomcat deploy" itemprop="url">tomcat deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T00:10:37.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="tomcat-deploy-on-centos"><a href="#tomcat-deploy-on-centos" class="headerlink" title="tomcat deploy on centos"></a>tomcat deploy on centos</h2><h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><h3 id="JDK下载："><a href="#JDK下载：" class="headerlink" title="JDK下载："></a>JDK下载：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate --no-cookies --header <span class="string">"Cookie: oraclelicense=accept-securebackup-cookie"</span> http://download.oracle.com/otn-pub/java/jdk/7u79-b15/jdk-7u79-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat下载"><a href="#Tomcat下载" class="headerlink" title="Tomcat下载:"></a><a href="http://tomcat.apache.org/">Tomcat下载</a>:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://toad.cwzhou.win/pub/apache-tomcat-7.0.70.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="部署java环境"><a href="#部署java环境" class="headerlink" title="部署java环境"></a>部署java环境</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tar xf jdk-8u91-linux-x64.tar.gz -C /application/</span><br><span class="line"></span><br><span class="line">ln -s /application/jdk1.8.0/ /application/jdk</span><br><span class="line">cp /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="comment"># sed -i.ori '$a export JAVA_HOME=/application/jdk\nexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH\nexport CLASSPATH=.$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$JAVA_HOME/lib/tools.jar' /etc/profile</span></span><br><span class="line"></span><br><span class="line">vimdiff /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<h2 id="Install-tomcat"><a href="#Install-tomcat" class="headerlink" title="Install tomcat"></a>Install tomcat</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tar xf apache-tomcat-8.0.27.tar.gz -C /application/</span><br><span class="line">ln -s /application/apache-tomcat-8.0.27 /application/tomcat</span><br><span class="line"><span class="built_in">echo</span>  <span class="string">'export TOMCAT_HOME=/application/tomcat'</span>&gt;&gt;/etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">chown -R root.root /application/jdk/ /application/tomcat/</span><br><span class="line">[root@tomcat ~]<span class="comment"># tail -4 /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> TOMCAT_HOME=/application/tomcat</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat目录介绍"><a href="#Tomcat目录介绍" class="headerlink" title="Tomcat目录介绍"></a>Tomcat目录介绍</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/tomcat/</span></span><br><span class="line">[root@tomcat tomcat]<span class="comment"># tree -L 1</span></span><br><span class="line">.</span><br><span class="line">├── bin <span class="comment">#→用以启动、关闭Tomcat或者其它功能的脚本（.bat文件和.sh文件）</span></span><br><span class="line">├── conf <span class="comment">#→用以配置Tomcat的XML及DTD文件</span></span><br><span class="line">├── lib <span class="comment">#→存放web应用能访问的JAR包</span></span><br><span class="line">├── LICENSE</span><br><span class="line">├── logs <span class="comment">#→Catalina和其它Web应用程序的日志文件</span></span><br><span class="line">├── NOTICE</span><br><span class="line">├── RELEASE-NOTES</span><br><span class="line">├── RUNNING.txt</span><br><span class="line">├── temp <span class="comment">#→临时文件</span></span><br><span class="line">├── webapps <span class="comment">#→Web应用程序根目录</span></span><br><span class="line">└── work <span class="comment">#→用以产生有JSP编译出的Servlet的.java和.class文件</span></span><br><span class="line">7 directories, 4 files</span><br><span class="line">[root@tomcat tomcat]<span class="comment"># cd webapps/</span></span><br><span class="line">[root@tomcat webapps]<span class="comment"># ll</span></span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 14 root root 4096 Oct 5 12:09 docs <span class="comment">#→tomcat帮助文档</span></span><br><span class="line">drwxr-xr-x 6 root root 4096 Oct 5 12:09 examples <span class="comment">#→web应用实例</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 host-manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct 5 12:09 ROOT <span class="comment">#→默认网站根目录</span></span><br></pre></td></tr></table></figure>
<h2 id="Tomcat多实例及集群架构"><a href="#Tomcat多实例及集群架构" class="headerlink" title="Tomcat多实例及集群架构"></a>Tomcat多实例及集群架构</h2><h3 id="Tomcat多实例"><a href="#Tomcat多实例" class="headerlink" title="Tomcat多实例"></a>Tomcat多实例</h3><p>复制Tomcat目录<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_1</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_2</span></span><br></pre></td></tr></table></figure></p>
<p>修改配置文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat application]<span class="comment"># mkdir -p /data/www/www/ROOT</span></span><br><span class="line">[root@tomcat application]<span class="comment"># cp /application/tomcat/webapps/memtest/meminfo.jsp /data/www/www/ROOT/</span></span><br><span class="line">sed -i <span class="string">'22s#8005#8011#;71s#8080#8081#;125s#appBase=".*"# appBase="/data/www/www"#'</span> /application/tomcat7_1/conf/server.xml</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'22s#8005#8012#;71s#8080#8082#;125s#appBase=".*"# appBase="/data/www/www"#'</span> /application/tomcat7_2/conf/server.xml</span><br></pre></td></tr></table></figure></p>
<h3 id="jvm调优"><a href="#jvm调优" class="headerlink" title="jvm调优"></a>jvm调优</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim catalina.sh insert</span></span><br><span class="line">JAVA_OPTS=<span class="string">"-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m -XX:MaxPermSize=512m"</span></span><br></pre></td></tr></table></figure>
<h3 id="service-startup-script"><a href="#service-startup-script" class="headerlink" title="service startup script"></a>service startup script</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/init.d</span><br><span class="line"></span><br><span class="line">vim tomcat</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># des: Tomcat Start Stop Restart</span></span><br><span class="line"><span class="comment"># processname: tomcat</span></span><br><span class="line"><span class="comment"># chkconfig: 234 20 80</span></span><br><span class="line">JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME</span><br><span class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line">CATALINA_HOME=/application/tomcat</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line">chkconfig --add tomcat</span><br><span class="line">chkconfig --level 234 tomcat on</span><br><span class="line">chkconfig --list tomcat</span><br><span class="line">groupadd tomcat</span><br><span class="line">useradd -g tomcat -d /home/tomcat -s /bin/sh tomcat</span><br><span class="line"><span class="built_in">cd</span> /etc/init.d/</span><br><span class="line"></span><br><span class="line">chown tomcat:tomcat  tomcat</span><br><span class="line"></span><br><span class="line">chmod +x tomcat</span><br><span class="line">service tomcat start</span><br><span class="line"></span><br><span class="line">check the <span class="built_in">log</span>:</span><br><span class="line">tail /application/tomcat/logs/catalina.out</span><br></pre></td></tr></table></figure>
<h3 id="Remove-default-content"><a href="#Remove-default-content" class="headerlink" title="Remove default content:"></a>Remove default content:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /root/apache-tomcat-7.0.70.tar.gz</span><br><span class="line">vim /tmp/run01.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> docs examples host-manager manager ROOT/RELEASE-NOTES.txt </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                rm -rf /application/tomcat7_<span class="variable">$i</span>/webapps/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Change-folder-ownership-and-permissions"><a href="#Change-folder-ownership-and-permissions" class="headerlink" title="Change folder ownership and permissions:"></a>Change folder ownership and permissions:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chown -R tomcat.tomcat /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run02.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> logs temp </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run03.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> bin webapps conf </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod 770 /application/tomcat7_<span class="variable">$i</span>/conf/catalina.policy; <span class="keyword">done</span></span><br><span class="line">vim /tmp/run04.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> catalina.properties context.xml logging.properties server.xml tomcat-users.xml web.xml</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/conf/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Remove-Server-Banner"><a href="#Remove-Server-Banner" class="headerlink" title="Remove Server Banner"></a>Remove Server Banner</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /application/tomcat/lib</span><br><span class="line">mkdir -p org/apache/catalina/util/</span><br><span class="line">jar xf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">ll org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">vim org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">server.info=Secure Web server</span><br><span class="line">server.number=1.0.0.0</span><br><span class="line">server.built=Jan 01 2000 00:00:00 UTC</span><br><span class="line">jar uf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">rm -rf /application/tomcat/lib/org</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/tomcat/">tomcat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/2/"><span></span>Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="stanosaka" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Devops/" title="Devops">Devops<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/aws/" title="aws">aws<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/centos/" title="centos">centos<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/CD-CI/" title="CD/CI">CD/CI<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tomcat/" title="tomcat">tomcat<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/saltstack/" title="saltstack">saltstack<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/zabbix/" title="zabbix">zabbix<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ec2/" title="ec2">ec2<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/backup/" title="backup">backup<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Pipeline/" title="Pipeline">Pipeline<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/agile/" title="agile">agile<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/software-development/" title="software development">software development<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://zety.com/mycv/00root" target="_blank" title="Stan&#39;s resume">Stan&#39;s resume</a>
            
          </li>
        
          <li>
            
            	<a href="https://cloud.ibm.com/docs/tutorials?topic=solution-tutorials-tutorials" target="_blank" title="IBM cloud solution tutorial">IBM cloud solution tutorial</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/aws-samples" target="_blank" title="AWS Samples">AWS Samples</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/bikrambora/devlab-launchpad" target="_blank" title="Welcome to Dev Labs">Dev Labs</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/ansible/ansible-examples" target="_blank" title="Ansible GitHub repo">Ansible GitHub repo</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" title="Ansible Best Practices">Ansible Best Practices</a>
            
          </li>
        
          <li>
            
            	<a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" title="kubectl cheat sheet">kubectl cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://rogerdudler.github.io/git-guide" target="_blank" title="Git commands">Git commands</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" title="Dockerfile reference">Dockerfile reference</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2mTQr8l" target="_blank" title="Linux Command line cheat sheet">Linux Command line cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2EPHxze" target="_blank" title="PowerShell Basic Cheat Sheet">PowerShell Basic Cheat Sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" title="sed cheatsheet">sed cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://obsavus1p.bkt.clouddn.com/vim_cheat_sheet_for_programmers_print.png" target="_blank" title="vim cheatsheet">vim cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.gitbook.com/book/yeasy/docker_practice/details" target="_blank" title="Learn Docker">Learn Docker</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.unixhot.com/page/ops" target="_blank" title="运维知识体系">运维知识体系</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.tecmint.com/" target="_blank" title="tecmint">tecmint</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.lib.uts.edu.au" target="_blank" title="shoujin.wang@student.uts.edu.au">UTS Library</a>
            
          </li>
        
          <li>
            
            	<a href="https://7esl.com" target="_blank" title="ESL">ESL</a>
            
          </li>
        
          <li>
            
            	<a href="https://stanchou.wordpress.com" target="_blank" title="Stan&#39;s wordpress">Stan&#39;s wordpress</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.00root.com" target="_blank" title="Stan&#39;s gitbook">Stan&#39;s gitbook</a>
            
          </li>
        
          <li>
            
            	<a href="https://api.ipify.org" target="_blank" title="Your IP address">Your IP address</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/stanosaka/oreilly_sql_fundamentals_for_data/blob/master/notes_and_slides/sql_fundamentals_notes.md" target="_blank" title="sql fundamentials">sql fundamentials</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Stan live in Sydney. <br/>
			I am a lifelong technology learner.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/stanosaka" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6724938" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/stanosaka" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/stan.osaka" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/00root" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/btw01v" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/stan-22-82" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:devops@cwzhou.win" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="Stan Zhou">Stan Zhou</a>
		
		
		</p>
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>


        
  	    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
               if (window.mermaid) {
                  mermaid.initialize({theme: 'forest'});
               }
            </script>
        












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
