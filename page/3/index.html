
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Stan Zhou&#39;s Hexo Technical Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stan Zhou">
    

    
    <meta name="description" content="Infrastructure as code">
<meta property="og:type" content="website">
<meta property="og:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:url" content="http://223.95.78.227/page/3/index.html">
<meta property="og:site_name" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:description" content="Infrastructure as code">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta name="twitter:description" content="Infrastructure as code">
<meta name="twitter:creator" content="@stanosaka">

    
    <link rel="alternative" href="/atom.xml" title="Stan Zhou&#39;s Hexo Technical Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/toad.ico">
    
    
    <link rel="apple-touch-icon" href="/img/toadman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/toadman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/toadman.png" alt="Stan Zhou&#39;s Hexo Technical Blog" title="Stan Zhou&#39;s Hexo Technical Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Stan Zhou&#39;s Hexo Technical Blog">Stan Zhou&#39;s Hexo Technical Blog</a></h1>
				<h2 class="blog-motto">Innovation Evangelist</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:223.95.78.227">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/06/redhat/" title="redhat" itemprop="url">redhat</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2017-09-06T07:49:54.000Z" itemprop="datePublished"> Published 2017-09-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Issue-1"><a href="#Issue-1" class="headerlink" title="Issue 1."></a>Issue 1.</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost stan]<span class="comment"># yum install -y ntp</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">There are no enabled repos.</span><br><span class="line"> Run <span class="string">"yum repolist all"</span> to see the repos you have.</span><br><span class="line"> You can <span class="built_in">enable</span> repos with yum-config-manager --<span class="built_in">enable</span> &lt;repo&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve:"></a>Solve:</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]<span class="comment"># mkdir /cdrom</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mount /dev/cdrom /cdrom</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># pwd</span></span><br><span class="line">/etc/yum.repos.d</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># vim dvd.repo</span></span><br><span class="line">[dvd-source]</span><br><span class="line">name=RHEL 7.2 dvd repo</span><br><span class="line">baseurl=file:///cdrom</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum repolist</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">dvd-source                                                                                     | 4.1 kB  00:00:00</span><br><span class="line">(1/2): dvd-source/group_gz                                                                     | 136 kB  00:00:00</span><br><span class="line">(2/2): dvd-source/primary_db                                                                   | 3.6 MB  00:00:00</span><br><span class="line">repo id                                             repo name                                                   status</span><br><span class="line">dvd-source                                          RHEL 7.2 dvd repo                                           4,620</span><br><span class="line">repolist: 4,620</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum install rpm-build</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package rpm-build.x86_64 0:4.11.3-17.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl(Thread::Queue) <span class="keyword">for</span> package: rpm-build-4.11.3-17.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: system-rpm-config <span class="keyword">for</span> package: rpm-build-4.11.3-17.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package perl-Thread-Queue.noarch 0:3.02-2.el7 will be installed</span><br><span class="line">---&gt; Package redhat-rpm-config.noarch 0:9.1.0-68.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: dwz &gt;= 0.4 <span class="keyword">for</span> package: redhat-rpm-config-9.1.0-68.el7.noarch</span><br><span class="line">--&gt; Processing Dependency: perl-srpm-macros <span class="keyword">for</span> package: redhat-rpm-config-9.1.0-68.el7.noarch</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package dwz.x86_64 0:0.11-3.el7 will be installed</span><br><span class="line">---&gt; Package perl-srpm-macros.noarch 0:1-8.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">======================================================================================================================</span><br><span class="line"> Package                          Arch                  Version                       Repository                 Size</span><br><span class="line">======================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> rpm-build                        x86_64                4.11.3-17.el7                 dvd-source                144 k</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> dwz                              x86_64                0.11-3.el7                    dvd-source                 99 k</span><br><span class="line"> perl-Thread-Queue                noarch                3.02-2.el7                    dvd-source                 17 k</span><br><span class="line"> perl-srpm-macros                 noarch                1-8.el7                       dvd-source                4.7 k</span><br><span class="line"> redhat-rpm-config                noarch                9.1.0-68.el7                  dvd-source                 77 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">======================================================================================================================</span><br><span class="line">Install  1 Package (+4 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 341 k</span><br><span class="line">Installed size: 734 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                 1.9 MB/s | 341 kB  00:00:00</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : perl-Thread-Queue-3.02-2.el7.noarch                                                                1/5</span><br><span class="line">  Installing : dwz-0.11-3.el7.x86_64                                                                              2/5</span><br><span class="line">  Installing : perl-srpm-macros-1-8.el7.noarch                                                                    3/5</span><br><span class="line">  Installing : redhat-rpm-config-9.1.0-68.el7.noarch                                                              4/5</span><br><span class="line">  Installing : rpm-build-4.11.3-17.el7.x86_64                                                                     5/5</span><br><span class="line">dvd-source/productid                                                                           | 1.6 kB  00:00:00</span><br><span class="line">  Verifying  : redhat-rpm-config-9.1.0-68.el7.noarch                                                              1/5</span><br><span class="line">  Verifying  : rpm-build-4.11.3-17.el7.x86_64                                                                     2/5</span><br><span class="line">  Verifying  : perl-srpm-macros-1-8.el7.noarch                                                                    3/5</span><br><span class="line">  Verifying  : dwz-0.11-3.el7.x86_64                                                                              4/5</span><br><span class="line">  Verifying  : perl-Thread-Queue-3.02-2.el7.noarch                                                                5/5</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  rpm-build.x86_64 0:4.11.3-17.el7</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  dwz.x86_64 0:0.11-3.el7                  perl-Thread-Queue.noarch 0:3.02-2.el7  perl-srpm-macros.noarch 0:1-8.el7</span><br><span class="line">  redhat-rpm-config.noarch 0:9.1.0-68.el7</span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/redhat/">redhat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/nginx01/" title="Nginx Deploy" itemprop="url">Nginx Deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T04:31:14.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Install-Nginx"><a href="#Install-Nginx" class="headerlink" title="Install Nginx"></a>Install Nginx</h2><h3 id="Install-Nginx-Package"><a href="#Install-Nginx-Package" class="headerlink" title="Install Nginx Package"></a>Install Nginx Package</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@huoq bin]<span class="comment"># yum install pcre pcre-devel -y</span></span><br><span class="line">check by:</span><br><span class="line">[root@huoq bin]<span class="comment"># rpm -qa pcre pcre-devel</span></span><br><span class="line">pcre-devel-8.32-15.el7_2.1.x86_64</span><br><span class="line">pcre-8.32-15.el7_2.1.x86_64</span><br><span class="line">[root@huoq tools]<span class="comment"># yum install -y openssl-devel openssl</span></span><br></pre></td></tr></table></figure>
<h3 id="Install-Nginx-1"><a href="#Install-Nginx-1" class="headerlink" title="Install Nginx"></a>Install Nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.6.3.tar.gz</span><br><span class="line">useradd nginx -s /sbin/nologin -M</span><br><span class="line">tar xf nginx-1.6.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.6.3/</span><br><span class="line">./configure --user=nginx --group=nginx --prefix=/application/nginx-1.6.3 --with-http_stub_status_module --with-http_ssl_module</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s /application/nginx-1.6.3 /application/nginx</span><br><span class="line">vim /application/nginx/conf/nginx.conf</span><br><span class="line">worker_processes  4;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">   </span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    upstream web_pools &#123;</span><br><span class="line">        server 127.0.0.1:8081;</span><br><span class="line">        server 127.0.0.1:8082;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            proxy_pass http://web_pools;</span><br><span class="line">        &#125;</span><br><span class="line">        location /nginx_status &#123;</span><br><span class="line">                stub_status on;</span><br><span class="line">                access_log off;</span><br><span class="line">                allow 127.0.0.1;</span><br><span class="line">                deny all;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/application/nginx/sbin/nginx -t</span><br><span class="line">vim /etc/init.d/nginx</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#chkconfig: - 85 15</span></span><br><span class="line"><span class="comment">#description: this script use to manage nginx process.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#set -x</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"></span><br><span class="line">procnum=`ps -ef |grep <span class="string">"/application/nginx/sbin/nginx"</span>|grep -v <span class="string">"grep"</span>|wc -l`</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  /application/nginx/sbin/nginx</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"$?"</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  failure</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 4</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  /application/nginx/sbin/nginx -s stop</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"$?"</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  failure</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 3</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">  start)</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  stop)</span><br><span class="line">  stop</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  restart)</span><br><span class="line">  stop</span><br><span class="line">  sleep 1</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  reload)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  /application/nginx/sbin/nginx -s reload</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is not running!please start nginx first..."</span></span><br><span class="line">  <span class="built_in">exit</span> 2</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  status)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is running..."</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is not running..."</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  *)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage : nginx [ start|stop|reload|restart|status ]"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">  ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">chmod +x /etc/init.d/nginx</span><br><span class="line">chkconfig nginx on</span><br><span class="line">/etc/init.d/nginx start</span><br><span class="line">Starting nginx:                                      [  OK  ]</span><br><span class="line">/etc/init.d/nginx status</span><br><span class="line">nginx is running...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/nginx/">nginx</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/tomcat01/" title="tomcat deploy" itemprop="url">tomcat deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T00:10:37.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="tomcat-deploy-on-centos"><a href="#tomcat-deploy-on-centos" class="headerlink" title="tomcat deploy on centos"></a>tomcat deploy on centos</h2><h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><h3 id="JDK下载："><a href="#JDK下载：" class="headerlink" title="JDK下载："></a>JDK下载：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate --no-cookies --header <span class="string">"Cookie: oraclelicense=accept-securebackup-cookie"</span> http://download.oracle.com/otn-pub/java/jdk/7u79-b15/jdk-7u79-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat下载"><a href="#Tomcat下载" class="headerlink" title="Tomcat下载:"></a><a href="http://tomcat.apache.org/">Tomcat下载</a>:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://toad.cwzhou.win/pub/apache-tomcat-7.0.70.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="部署java环境"><a href="#部署java环境" class="headerlink" title="部署java环境"></a>部署java环境</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tar xf jdk-8u91-linux-x64.tar.gz -C /application/</span><br><span class="line"></span><br><span class="line">ln -s /application/jdk1.8.0/ /application/jdk</span><br><span class="line">cp /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="comment"># sed -i.ori '$a export JAVA_HOME=/application/jdk\nexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH\nexport CLASSPATH=.$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$JAVA_HOME/lib/tools.jar' /etc/profile</span></span><br><span class="line"></span><br><span class="line">vimdiff /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<h2 id="Install-tomcat"><a href="#Install-tomcat" class="headerlink" title="Install tomcat"></a>Install tomcat</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tar xf apache-tomcat-8.0.27.tar.gz -C /application/</span><br><span class="line">ln -s /application/apache-tomcat-8.0.27 /application/tomcat</span><br><span class="line"><span class="built_in">echo</span>  <span class="string">'export TOMCAT_HOME=/application/tomcat'</span>&gt;&gt;/etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">chown -R root.root /application/jdk/ /application/tomcat/</span><br><span class="line">[root@tomcat ~]<span class="comment"># tail -4 /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> TOMCAT_HOME=/application/tomcat</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat目录介绍"><a href="#Tomcat目录介绍" class="headerlink" title="Tomcat目录介绍"></a>Tomcat目录介绍</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/tomcat/</span></span><br><span class="line">[root@tomcat tomcat]<span class="comment"># tree -L 1</span></span><br><span class="line">.</span><br><span class="line">├── bin <span class="comment">#→用以启动、关闭Tomcat或者其它功能的脚本（.bat文件和.sh文件）</span></span><br><span class="line">├── conf <span class="comment">#→用以配置Tomcat的XML及DTD文件</span></span><br><span class="line">├── lib <span class="comment">#→存放web应用能访问的JAR包</span></span><br><span class="line">├── LICENSE</span><br><span class="line">├── logs <span class="comment">#→Catalina和其它Web应用程序的日志文件</span></span><br><span class="line">├── NOTICE</span><br><span class="line">├── RELEASE-NOTES</span><br><span class="line">├── RUNNING.txt</span><br><span class="line">├── temp <span class="comment">#→临时文件</span></span><br><span class="line">├── webapps <span class="comment">#→Web应用程序根目录</span></span><br><span class="line">└── work <span class="comment">#→用以产生有JSP编译出的Servlet的.java和.class文件</span></span><br><span class="line">7 directories, 4 files</span><br><span class="line">[root@tomcat tomcat]<span class="comment"># cd webapps/</span></span><br><span class="line">[root@tomcat webapps]<span class="comment"># ll</span></span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 14 root root 4096 Oct 5 12:09 docs <span class="comment">#→tomcat帮助文档</span></span><br><span class="line">drwxr-xr-x 6 root root 4096 Oct 5 12:09 examples <span class="comment">#→web应用实例</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 host-manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct 5 12:09 ROOT <span class="comment">#→默认网站根目录</span></span><br></pre></td></tr></table></figure>
<h2 id="Tomcat多实例及集群架构"><a href="#Tomcat多实例及集群架构" class="headerlink" title="Tomcat多实例及集群架构"></a>Tomcat多实例及集群架构</h2><h3 id="Tomcat多实例"><a href="#Tomcat多实例" class="headerlink" title="Tomcat多实例"></a>Tomcat多实例</h3><p>复制Tomcat目录<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_1</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_2</span></span><br></pre></td></tr></table></figure></p>
<p>修改配置文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat application]<span class="comment"># mkdir -p /data/www/www/ROOT</span></span><br><span class="line">[root@tomcat application]<span class="comment"># cp /application/tomcat/webapps/memtest/meminfo.jsp /data/www/www/ROOT/</span></span><br><span class="line">sed -i <span class="string">'22s#8005#8011#;71s#8080#8081#;125s#appBase=".*"# appBase="/data/www/www"#'</span> /application/tomcat7_1/conf/server.xml</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'22s#8005#8012#;71s#8080#8082#;125s#appBase=".*"# appBase="/data/www/www"#'</span> /application/tomcat7_2/conf/server.xml</span><br></pre></td></tr></table></figure></p>
<h3 id="jvm调优"><a href="#jvm调优" class="headerlink" title="jvm调优"></a>jvm调优</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim catalina.sh insert</span></span><br><span class="line">JAVA_OPTS=<span class="string">"-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m -XX:MaxPermSize=512m"</span></span><br></pre></td></tr></table></figure>
<h3 id="service-startup-script"><a href="#service-startup-script" class="headerlink" title="service startup script"></a>service startup script</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/init.d</span><br><span class="line"></span><br><span class="line">vim tomcat</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># des: Tomcat Start Stop Restart</span></span><br><span class="line"><span class="comment"># processname: tomcat</span></span><br><span class="line"><span class="comment"># chkconfig: 234 20 80</span></span><br><span class="line">JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME</span><br><span class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line">CATALINA_HOME=/application/tomcat</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line">chkconfig --add tomcat</span><br><span class="line">chkconfig --level 234 tomcat on</span><br><span class="line">chkconfig --list tomcat</span><br><span class="line">groupadd tomcat</span><br><span class="line">useradd -g tomcat -d /home/tomcat -s /bin/sh tomcat</span><br><span class="line"><span class="built_in">cd</span> /etc/init.d/</span><br><span class="line"></span><br><span class="line">chown tomcat:tomcat  tomcat</span><br><span class="line"></span><br><span class="line">chmod +x tomcat</span><br><span class="line">service tomcat start</span><br><span class="line"></span><br><span class="line">check the <span class="built_in">log</span>:</span><br><span class="line">tail /application/tomcat/logs/catalina.out</span><br></pre></td></tr></table></figure>
<h3 id="Remove-default-content"><a href="#Remove-default-content" class="headerlink" title="Remove default content:"></a>Remove default content:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /root/apache-tomcat-7.0.70.tar.gz</span><br><span class="line">vim /tmp/run01.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> docs examples host-manager manager ROOT/RELEASE-NOTES.txt </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                rm -rf /application/tomcat7_<span class="variable">$i</span>/webapps/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Change-folder-ownership-and-permissions"><a href="#Change-folder-ownership-and-permissions" class="headerlink" title="Change folder ownership and permissions:"></a>Change folder ownership and permissions:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chown -R tomcat.tomcat /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run02.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> logs temp </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run03.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> bin webapps conf </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod 770 /application/tomcat7_<span class="variable">$i</span>/conf/catalina.policy; <span class="keyword">done</span></span><br><span class="line">vim /tmp/run04.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> catalina.properties context.xml logging.properties server.xml tomcat-users.xml web.xml</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/conf/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Remove-Server-Banner"><a href="#Remove-Server-Banner" class="headerlink" title="Remove Server Banner"></a>Remove Server Banner</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /application/tomcat/lib</span><br><span class="line">mkdir -p org/apache/catalina/util/</span><br><span class="line">jar xf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">ll org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">vim org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">server.info=Secure Web server</span><br><span class="line">server.number=1.0.0.0</span><br><span class="line">server.built=Jan 01 2000 00:00:00 UTC</span><br><span class="line">jar uf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">rm -rf /application/tomcat/lib/org</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/tomcat/">tomcat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/17/nginx/" title="optimize nginx performance" itemprop="url">optimize nginx performance</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-17T03:45:29.000Z" itemprop="datePublished"> Published 2016-10-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="1-优化worker进程个数"><a href="#1-优化worker进程个数" class="headerlink" title="1.优化worker进程个数"></a>1.优化worker进程个数</h3><p>查看cpu总核数<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep processor /proc/cpuinfo|wc -l</span></span><br><span class="line">2 <span class="comment">#表示为1颗CPU四核</span></span><br></pre></td></tr></table></figure></p>
<p>查看CPU总颗数：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep 'physical id' /proc/cpuinfo|sort|uniq|wc -l</span></span><br><span class="line">1 <span class="comment">#对physical id去重计数，表示1颗cpu</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim nginx.conf</span></span><br><span class="line">worker_processes 2;</span><br><span class="line"><span class="comment"># /application/nginx/sbin/nginx -t</span></span><br><span class="line"><span class="comment"># /application/nginx/sbin/nginx -s reload</span></span><br></pre></td></tr></table></figure>
<h3 id="2-访问日志配置实战"><a href="#2-访问日志配置实战" class="headerlink" title="2.访问日志配置实战"></a>2.访问日志配置实战</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">'21,23 s/#//gp'</span> ../conf/nginx.conf.default</span><br><span class="line">log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line"><span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line"><span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">vim nginx.con</span><br><span class="line">error_log  logs/error.log;</span><br><span class="line">...</span><br><span class="line">http &#123;</span><br><span class="line">...</span><br><span class="line">log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">		  <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">		  <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">access_log  logs/access.log  main;</span><br><span class="line">   </span><br><span class="line">...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>Nginx访问日志轮询切割<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /server/script/cut_nginx_log.sh</span></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">Dateformat=`date +%Y%m%d`</span><br><span class="line">Basedir=<span class="string">"/application/nginx"</span></span><br><span class="line">Nginxlogdir=<span class="string">"<span class="variable">$Basedir</span>/logs"</span></span><br><span class="line">Logname=<span class="string">"access"</span></span><br><span class="line">[ -d <span class="variable">$Nginxlogdir</span> ] &amp;&amp; <span class="built_in">cd</span> <span class="variable">$Nginxlogdir</span> || <span class="built_in">exit</span> 1</span><br><span class="line">[ -f <span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span> ]|| exit1</span><br><span class="line">/bin/mv <span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span> <span class="variable">$&#123;Dateformat&#125;</span>_<span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span></span><br><span class="line"><span class="variable">$Basedir</span>/sbin/nginx -s reload</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /var/spool/cron/root &lt;&lt;EOF</span><br><span class="line"><span class="comment">#cut nginx access log by cwzhou</span></span><br><span class="line">00 00 * * * /bin/sh /server/script/cut_nginx_log.sh &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#check result</span></span><br><span class="line"><span class="comment">#crontab -l</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Nginx并发连接数量"><a href="#Nginx并发连接数量" class="headerlink" title="Nginx并发连接数量"></a>Nginx并发连接数量</h3><blockquote>
<p>Reference <a href="http://nginx.org/en/docs/http/ngx_http_limit_conn_module.html">ngx_http_limit_conn_module</a><br>1.限制单ip并发连接数<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.conf</span><br><span class="line">...</span><br><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    limit_conn_zone <span class="variable">$binary_remote_addr</span> zone=addr:10m;</span><br><span class="line">    server&#123;</span><br><span class="line">	...</span><br><span class="line">	location / &#123;</span><br><span class="line">		...</span><br><span class="line">		limit_conn addr 1; <span class="comment">#限制单ip的并发连接为1</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ab -c 1 -n 10 http://10.0.0.3/  <span class="comment">#模拟并发连接1,访问10次服务器</span></span><br><span class="line"><span class="comment"># -c为并发数 -n为请求书 10.0.0.3为nginx的Ip地址</span></span><br></pre></td></tr></table></figure>
<p>应用场景之一是服务器下载：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /download/ &#123;</span><br><span class="line">	limit_conn add 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.限制虚拟主机总连接数<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.conf</span><br><span class="line">...</span><br><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    limit_conn_zone <span class="variable">$binary_remote_addr</span> zone=addr:10m;</span><br><span class="line">    limit_conn_zone <span class="variable">$server_name</span> zone=perserver:10m;</span><br><span class="line"></span><br><span class="line">    server&#123;</span><br><span class="line">	...</span><br><span class="line">	location / &#123;</span><br><span class="line">		...</span><br><span class="line">		limit_conn perserver 2; <span class="comment">#限制虚拟主机连接数为2</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/nginx/">nginx</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/13/sysadmintool/" title="system admin tools" itemprop="url">system admin tools</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-13T05:23:04.000Z" itemprop="datePublished"> Published 2016-10-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="system-admin-tool"><a href="#system-admin-tool" class="headerlink" title="system admin tool"></a>system admin tool</h2><p><a href="http://blog.chinaunix.net/uid-10915175-id-3246219.html%22iostat%E4%BB%8B%E7%BB%8D%22">iostat介绍</a><br><a href="http://blog.chinaunix.net/uid-10915175-id-4543091.html">全能系统监控工具dstat </a><br>most use:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@toad pxe]<span class="comment"># dstat -cmsdnl -D sda3 -N lo,eth0 100 5</span></span><br></pre></td></tr></table></figure></p>
<p>网络监控工具<br>本地服务器的网卡吞吐量：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptraf -d eth0</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># both</span></span><br><span class="line">wget ftp://ftp.netperf.org/netperf/netperf-2.7.0.tar.gz</span><br><span class="line">tar xf netperf-2.7.0.tar.gz</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务端：</span></span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># netserver</span></span><br><span class="line">Starting netserver with host <span class="string">'IN(6)ADDR_ANY'</span> port <span class="string">'12865'</span> and family AF_UNSPEC</span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># lsof -i :12865</span></span><br><span class="line">COMMAND     PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME</span><br><span class="line">netserver 18230 root    3u  IPv6 2815424      0t0  TCP *:12865 (LISTEN)</span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># ethtool eth0 |grep -i speed</span></span><br><span class="line">        Speed: 1000Mb/s</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端</span></span><br><span class="line">root@kali:~/Downloads/netperf-2.7.0<span class="comment">#  netperf -H 192.168.199.231 -l 60</span></span><br><span class="line">MIGRATED TCP STREAM TEST from 0.0.0.0 () port 0 AF_INET to 192.168.199.231 () port 0 AF_INET</span><br><span class="line">Recv   Send    Send</span><br><span class="line">Socket Socket  Message  Elapsed</span><br><span class="line">Size   Size    Size     Time     Throughput</span><br><span class="line">bytes  bytes   bytes    secs.    10^6bits/sec</span><br><span class="line"></span><br><span class="line">87380  16384  16384    60.02      94.13</span><br><span class="line">root@kali:~/Downloads/netperf-2.7.0<span class="comment"># ethtool eth0 |grep -i speed</span></span><br><span class="line">        Speed: 100Mb/s</span><br></pre></td></tr></table></figure>
<p>Netperf缺省情况下进行TCP批量传输，即-t TCP_STREAM。测试过程中，netperf向netserver发送批量的TCP数据分组，以确定数据传输过程中的吞吐量：<br> 从netperf的结果输出中，我们可以知道以下的一些信息：<br>1）    远端系统（即server）使用大小为87380字节的socket接收缓冲<br>2）    本地系统（即client）使用大小为16384字节的socket发送缓冲<br>3）    向远端系统发送的测试分组大小为16384字节<br>4）    测试经历的时间为60秒<br>5）    吞吐量的测试结果为94.13Mbits/秒</p>
<blockquote>
<p>Reference <a href="https://www.ibm.com/developerworks/cn/linux/l-netperf/">netperf 与网络性能测量</a></p>
</blockquote>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/system-admin/">system admin</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/12/zabbix/" title="zabbix" itemprop="url">zabbix</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-12T04:54:53.000Z" itemprop="datePublished"> Published 2016-10-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="zabbix"><a href="#zabbix" class="headerlink" title="zabbix"></a>zabbix</h2><table>
<thead>
<tr>
<th></th>
<th>IP address</th>
<th>Roles</th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>192.168.0.49(chatswood)</td>
<td>zabbix server</td>
<td>Centos 6.8 Zabbix 2.4.8</td>
<td></td>
</tr>
<tr>
<td></td>
<td>192.168.0.80(macadamina)</td>
<td>zabbix agent</td>
<td>Centos 6.8 Zabbix 2.4.8</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="server-setup"><a href="#server-setup" class="headerlink" title="server setup"></a>server setup</h2> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-server -y</span><br><span class="line">tar xf zabbix-2.4.8.tar.gz</span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8</span><br><span class="line">./configure --prefix=/opt/zabbix --<span class="built_in">enable</span>-server --<span class="built_in">enable</span>-agent --with-mysql</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">yum install httpd php-devel php php-mbstring -y</span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line"><span class="built_in">cd</span> /opt/zabbix/</span><br><span class="line">mv etc&#123;,_bak&#125;</span><br><span class="line">/bin/cp -rf etc_bak/ etc</span><br><span class="line">[root@chatswood ~]<span class="comment"># cat /opt/zabbix/etc/zabbix_server.conf|egrep -v "^#|^$"</span></span><br><span class="line">LogFile=/tmp/zabbix_server.log</span><br><span class="line">PidFile=/tmp/zabbix_server.pid</span><br><span class="line">DBSocket=/tmp/mysql.sock</span><br><span class="line">DBHost=chatswood</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=123456</span><br><span class="line">Timeout=30</span><br><span class="line">[root@chatswood ~]<span class="comment"># cat /opt/zabbix/etc/zabbix_agentd.conf|egrep -v "^#|^$"</span></span><br><span class="line">PidFile=/tmp/zabbix_agentd.pid</span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=chatswood</span><br><span class="line">ServerActive=chatswood</span><br><span class="line">Hostname=chatswood</span><br><span class="line">Timeout=30</span><br><span class="line"></span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line"><span class="comment"># mysql</span></span><br><span class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8;</span><br><span class="line">mysql&gt; grant all on zabbix.* to zabbix@<span class="string">'192.168.0.49'</span> identified by <span class="string">'123456'</span>;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8/database/mysql</span><br><span class="line">mysql zabbix &lt; ./schema.sql -p</span><br><span class="line">mysql zabbix &lt; ./images.sql -p</span><br><span class="line">mysql zabbix &lt; ./data.sql -p</span><br><span class="line"><span class="comment">## test database</span></span><br><span class="line">mysql -u zabbix -p -h192.168.0.49</span><br><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a zabbix user</span></span><br><span class="line">groupadd -g 508 zabbix</span><br><span class="line">useradd -g 508 -u 508 zabbix -M -s /sbin/nologin</span><br><span class="line"></span><br><span class="line">/opt/zabbix/sbin/zabbix_server -c /opt/zabbix/etc/zabbix_server.conf</span><br><span class="line">ps aux|grep zabbix</span><br><span class="line">/opt/zabbix/sbin/zabbix_agentd -c /opt/zabbix/etc/zabbix_agentd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">/opt/zabbix/bin/zabbix_get -s chatswood -k proc.num[]</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8</span><br><span class="line">mkdir /var/www/html/zabbix</span><br><span class="line">/bin/cp -rf frontends/php/* /var/www/html/zabbix/</span><br><span class="line">vim /etc/php.ini</span><br><span class="line">date.timezone = Asia/Shanghai</span><br><span class="line">post_max_size = 18M</span><br><span class="line">max_execution_time = 350</span><br><span class="line">max_input_time = 350</span><br><span class="line"></span><br><span class="line">yum install php-gd php-xml php-mysql php-bcmath -y</span><br><span class="line">/etc/init.d/httpd restart</span><br><span class="line">ps aux|grep apache</span><br><span class="line">/usr/sbin/ntpdate 3.cn.pool.ntp.org</span><br><span class="line">chown -R apache /var/www/html/zabbix/</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="agent-setup"><a href="#agent-setup" class="headerlink" title="agent setup"></a>agent setup</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line">./configure --prefix=/opt/zabbix --<span class="built_in">enable</span>-agent --with-net-snmp</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">groupadd -g 508 zabbix</span><br><span class="line">useradd -g 508 -u 508 zabbix -M -s /sbin/nologin</span><br><span class="line">cat /opt/zabbix/etc/zabbix_agentd.conf|egrep -v <span class="string">"^#|^$"</span></span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=chatswood</span><br><span class="line">ServerActive=chatswood</span><br><span class="line">Hostname=macadamina</span><br><span class="line"></span><br><span class="line">/opt/zabbix/sbin/zabbix_agentd -c /opt/zabbix/etc/zabbix_agentd.conf</span><br><span class="line">ps aux|grep zabbix</span><br><span class="line">lsof|grep zabbix</span><br></pre></td></tr></table></figure>
<p>Access <a href="http://192.168.0.49/zabbix">http://192.168.0.49/zabbix</a>,<br>default username: admin<br>password: zabbix</p>
<hr>
<h2 id="issue"><a href="#issue" class="headerlink" title="issue"></a>issue</h2><hr>
<p>checking for mysql_config… /usr/bin/mysql_config<br>checking for main in -lmysqlclient… no<br>configure: error: Not found mysqlclient library</p>
<p>#yum -y install mysql-devel</p>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/zabbix/">zabbix</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/10/web-security/" title="web security" itemprop="url">web security</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-10T00:03:50.000Z" itemprop="datePublished"> Published 2016-10-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="web安全"><a href="#web安全" class="headerlink" title="web安全"></a>web安全</h1><h3 id="Table-of-contents"><a href="#Table-of-contents" class="headerlink" title="Table of contents"></a>Table of contents</h3><p>You can insert a table of contents using the marker <code>[TOC]</code>:</p>
<p>[TOC]</p>
<h2 id="使用iptables防护网站安全"><a href="#使用iptables防护网站安全" class="headerlink" title="使用iptables防护网站安全"></a>使用iptables防护网站安全</h2><blockquote>
<p><strong>只允许特定流量通过，禁用其他流量</strong></p>
</blockquote>
<blockquote>
<ul>
<li>permit ssh<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>permit DNS<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -l INPUT 1 -p tcp --sport 53 -j ACCEPT</span><br><span class="line">iptables -l INPUT 1 -p udp --sport 53 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>permit service<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -l INPUT 1 -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>forbid all others<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -j DROP</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@toad ~]<span class="comment"># netstat -tn</span></span><br><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State</span><br><span class="line">tcp        0      0 192.168.199.231:61094       101.200.31.147:443          TIME_WAIT</span><br><span class="line">tcp        0     64 192.168.199.231:22          60.186.174.98:61241         ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.199.231:41795       192.168.199.1:445           ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.199.231:22          60.186.174.98:50722         ESTABLISHED</span><br><span class="line">tcp        0      0 ::1:19187                   ::1:10010                   TIME_WAIT</span><br><span class="line"></span><br><span class="line">[root@toad ~]<span class="comment"># netstat -tn|grep 192.168.199.231|awk '&#123;print $5&#125;'|awk -F ":" '&#123;print $1&#125;'|sort|uniq -c|sort -r -n</span></span><br><span class="line">      2 60.186.174.98</span><br><span class="line">      2 101.200.31.147</span><br><span class="line">      1 192.168.199.1</span><br><span class="line">[root@toad ~]<span class="comment"># iptables -l INPUT 1 -s 60.186.174.98 -j DROP</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="AIDE入侵检测系统"><a href="#AIDE入侵检测系统" class="headerlink" title="AIDE入侵检测系统"></a>AIDE入侵检测系统</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#install aide</span></span><br><span class="line">yum install -y aide</span><br><span class="line"></span><br><span class="line"><span class="comment">#config aide</span></span><br><span class="line">vim /etc/aide.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#init aide database</span></span><br><span class="line">aide --init</span><br><span class="line">mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#check monitor file</span></span><br><span class="line">aide --check</span><br><span class="line"></span><br><span class="line"><span class="comment">#update aide database</span></span><br><span class="line">aide --update</span><br><span class="line"></span><br><span class="line"><span class="comment">#setup cron job</span></span><br><span class="line">crontab -e</span><br><span class="line">* 3 * * * /usr/sbin/aide --check|mail -s <span class="string">"AIDE report "</span> sizemore@gmail.com</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/linux/">linux</a><a href="/tags/web-security/">web security</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/29/syd/" title="syd" itemprop="url">syd</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-09-29T05:05:01.000Z" itemprop="datePublished"> Published 2016-09-29</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Sydney"><a href="#Sydney" class="headerlink" title="Sydney"></a>Sydney</h1><p><img src="http://obsavus1p.bkt.clouddn.com/sydneyvision2030.jpg" alt="enter image description here"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/sydney/">sydney</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/21/ubuntu/" title="ubuntu" itemprop="url">ubuntu</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-09-21T13:19:19.000Z" itemprop="datePublished"> Published 2016-09-21</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Setup-Java-Development-Environment-in-Ubuntu"><a href="#Setup-Java-Development-Environment-in-Ubuntu" class="headerlink" title="Setup Java Development Environment in Ubuntu"></a>Setup Java Development Environment in Ubuntu</h1><p>Ubuntu: ubuntu-16.04-desktop-amd64</p>
<h2 id="Install-Oracle-Java-on-Ubuntu-Linux"><a href="#Install-Oracle-Java-on-Ubuntu-Linux" class="headerlink" title="Install Oracle Java on Ubuntu Linux"></a>Install Oracle Java on Ubuntu Linux</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get upgrade -y</span></span><br><span class="line"><span class="comment"># apt-get install ssh -y</span></span><br></pre></td></tr></table></figure>
<h2 id="1-Check-to-see-if-your-Ubuntu-Linux-operating-system-architecture-is-32-bit-or-64-bit"><a href="#1-Check-to-see-if-your-Ubuntu-Linux-operating-system-architecture-is-32-bit-or-64-bit" class="headerlink" title="1. Check to see if your Ubuntu Linux operating system architecture is 32-bit or 64-bit"></a>1. Check to see if your Ubuntu Linux operating system architecture is 32-bit or 64-bit</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@stan-virtual-machine:~<span class="comment"># file /sbin/init</span></span><br><span class="line">/sbin/init: symbolic link to /lib/systemd/systemd</span><br><span class="line">root@stan-virtual-machine:~<span class="comment"># file /lib/systemd/systemd</span></span><br><span class="line">/lib/systemd/systemd: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="keyword">for</span> GNU/Linux 2.6.32, BuildID[sha1]=03b9d43299696aa6b67b92f1225fa6045b978cb2, stripped</span><br></pre></td></tr></table></figure>
<h2 id="2-Check-if-you-have-Java-installed-on-your-system"><a href="#2-Check-if-you-have-Java-installed-on-your-system" class="headerlink" title="2. Check if you have Java installed on your system"></a>2. Check if you have Java installed on your system</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@stan-virtual-machine:~<span class="comment"># java -version</span></span><br><span class="line">The program <span class="string">'java'</span> can be found <span class="keyword">in</span> the following packages:</span><br><span class="line"> * default-jre</span><br><span class="line"> * gcj-5-jre-headless</span><br><span class="line"> * openjdk-8-jre-headless</span><br><span class="line"> * gcj-4.8-jre-headless</span><br><span class="line"> * gcj-4.9-jre-headless</span><br><span class="line"> * openjdk-9-jre-headless</span><br><span class="line">Try: apt install &lt;selected package&gt;</span><br></pre></td></tr></table></figure>
<h2 id="3-Completely-remove-the-OpenJDK-JRE-from-your-system-and-create-a-directory-to-hold-your-Oracle-Java-JDK-JRE-binaries"><a href="#3-Completely-remove-the-OpenJDK-JRE-from-your-system-and-create-a-directory-to-hold-your-Oracle-Java-JDK-JRE-binaries" class="headerlink" title="3. Completely remove the OpenJDK/JRE from your system and create a directory to hold your Oracle Java JDK/JRE binaries."></a>3. Completely remove the OpenJDK/JRE from your system and create a directory to hold your Oracle Java JDK/JRE binaries.</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@stan-virtual-machine:~<span class="comment"># apt-get purge openjdk-\*</span></span><br><span class="line">root@stan-virtual-machine:~<span class="comment"># mkdir -p /usr/local/java</span></span><br></pre></td></tr></table></figure>
<p>Go to link: <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a><br>download <a href="http://download.oracle.com/otn-pub/java/jdk/8u101-b13/jdk-8u101-linux-x64.tar.gz">http://download.oracle.com/otn-pub/java/jdk/8u101-b13/jdk-8u101-linux-x64.tar.gz</a><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@stan-virtual-machine:/home/stan/Downloads<span class="comment"># cp -r jdk-8u101-linux-x64.tar.gz /usr/local/java</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tar xvzf jdk-8u101-linux-x64.tar.gz</span></span><br><span class="line"><span class="comment"># vim /etc/profile     #add into end of the file</span></span><br><span class="line">JAVA_HOME=/usr/<span class="built_in">local</span>/java/jdk1.8.0_101</span><br><span class="line">JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME</span><br><span class="line"><span class="built_in">export</span> JRE_HOME</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line"><span class="comment"># update-alternatives --install "/usr/bin/java" "java" "/usr/local/java/jdk1.8.0_101/jre/bin/java" 1</span></span><br><span class="line"><span class="comment"># update-alternatives --install "/usr/bin/javac" "javac" "/usr/local/java/jdk1.8.0_101/bin/javac" 1</span></span><br><span class="line"><span class="comment"># update-alternatives --set java /usr/local/java/jdk1.8.0_101/jre/bin/java</span></span><br><span class="line"><span class="comment"># update-alternatives --set javac /usr/local/java/jdk1.8.0_101/bin/javac</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p>
<h2 id="4-Check"><a href="#4-Check" class="headerlink" title="4.Check"></a>4.Check</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@stan-virtual-machine:/usr/<span class="built_in">local</span>/java<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">"1.8.0_101"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_101-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.101-b13, mixed mode)</span><br><span class="line">root@stan-virtual-machine:/usr/<span class="built_in">local</span>/java<span class="comment"># javac -version</span></span><br><span class="line">javac 1.8.0_101</span><br></pre></td></tr></table></figure>
<hr>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/ubuntu/">ubuntu</a><a href="/tags/java/">java</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/18/saltstackminion/" title="saltstack minion" itemprop="url">saltstack minion</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-09-18T07:58:08.000Z" itemprop="datePublished"> Published 2016-09-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="1-Install-minion"><a href="#1-Install-minion" class="headerlink" title="1. Install minion:"></a>1. Install minion:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@chatswood ~]<span class="comment"># rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-6.noarch.rpm</span></span><br><span class="line">Retrieving http://mirrors.aliyun.com/epel/epel-release-latest-6.noarch.rpm</span><br><span class="line">warning: /var/tmp/rpm-tmp.nKEP1w: Header V3 RSA/SHA256 Signature, key ID 0608b895: NOKEY</span><br><span class="line">Preparing...                <span class="comment">########################################### [100%]</span></span><br><span class="line">   1:epel-release           <span class="comment">########################################### [100%]</span></span><br><span class="line">   </span><br><span class="line">[root@chatswood ~]<span class="comment"># yum install -y salt-minion</span></span><br><span class="line">[root@chatswood ~]<span class="comment"># chkconfig salt-minion on</span></span><br></pre></td></tr></table></figure>
<h3 id="2-Configuration"><a href="#2-Configuration" class="headerlink" title="2. Configuration:"></a>2. Configuration:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@chatswood ~]<span class="comment"># sed -n 16p /etc/salt/minion</span></span><br><span class="line"><span class="comment">#master: salt</span></span><br><span class="line">[root@chatswood ~]<span class="comment"># sed -i '16s#\#master: salt#master: 192.168.0.100#' /etc/salt/minion</span></span><br><span class="line">[root@chatswood ~]<span class="comment"># sed -n 16p /etc/salt/minion</span></span><br><span class="line">master: 192.168.0.100</span><br><span class="line">[root@chatswood ~]<span class="comment"># cat /etc/hosts</span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.0.100   toad</span><br><span class="line">192.168.0.168   salt-minion01</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line">[root@chatswood ~]<span class="comment"># /etc/init.d/salt-minion start</span></span><br></pre></td></tr></table></figure>
<p>On salt master side:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@toad tomcat-formula]<span class="comment"># cat /etc/hosts</span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.0.100   toad</span><br><span class="line">192.168.0.168   salt-minion01</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line">[root@toad tomcat-formula]<span class="comment"># service salt-master restart</span></span><br><span class="line">Stopping salt-master daemon:                               [  OK  ]</span><br><span class="line">Starting salt-master daemon:                               [  OK  ]</span><br><span class="line">[root@toad tomcat-formula]<span class="comment"># salt-key</span></span><br><span class="line">Accepted Keys:</span><br><span class="line">macadamina</span><br><span class="line">salt-minion01</span><br><span class="line">Denied Keys:</span><br><span class="line">Unaccepted Keys:</span><br><span class="line">chatswood</span><br><span class="line">Rejected Keys:</span><br><span class="line">[root@toad tomcat-formula]<span class="comment"># salt-key -A</span></span><br><span class="line">The following keys are going to be accepted:</span><br><span class="line">Unaccepted Keys:</span><br><span class="line">chatswood</span><br><span class="line">Proceed? [n/Y] Y</span><br><span class="line">Key <span class="keyword">for</span> minion chatswood accepted.</span><br><span class="line">[root@toad tomcat-formula]<span class="comment"># salt-key</span></span><br><span class="line">Accepted Keys:</span><br><span class="line">chatswood</span><br><span class="line">macadamina</span><br><span class="line">salt-minion01</span><br><span class="line">Denied Keys:</span><br><span class="line">Unaccepted Keys:</span><br><span class="line">Rejected Keys:</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/saltstack/">saltstack</a><a href="/tags/minion/">minion</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/2/"><span></span>Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="stanosaka" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Devops/" title="Devops">Devops<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/aws/" title="aws">aws<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/centos/" title="centos">centos<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/CD-CI/" title="CD/CI">CD/CI<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tomcat/" title="tomcat">tomcat<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/saltstack/" title="saltstack">saltstack<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/zabbix/" title="zabbix">zabbix<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ec2/" title="ec2">ec2<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/backup/" title="backup">backup<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/agile/" title="agile">agile<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/software-development/" title="software development">software development<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/agile-development/" title="agile development">agile development<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ansbile/" title="ansbile">ansbile<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Codecommit/" title="Codecommit">Codecommit<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://zety.com/mycv/00root" target="_blank" title="Stan&#39;s resume">Stan&#39;s resume</a>
            
          </li>
        
          <li>
            
            	<a href="https://cloud.ibm.com/docs/tutorials?topic=solution-tutorials-tutorials" target="_blank" title="IBM cloud solution tutorial">IBM cloud solution tutorial</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.tecmint.com" target="_blank" title="Linux Howto's Guide">Tecmint</a>
            
          </li>
        
          <li>
            
            	<a href="https://stanchou.wordpress.com" target="_blank" title="Stan&#39;s wordpress">Stan&#39;s wordpress</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.00root.com" target="_blank" title="Stan&#39;s gitbook">Stan&#39;s gitbook</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.gitbook.com/book/yeasy/docker_practice/details" target="_blank" title="Learn Docker">Learn Docker</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.unixhot.com/page/ops" target="_blank" title="运维知识体系">运维知识体系</a>
            
          </li>
        
          <li>
            
            	<a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" title="sed cheatsheet">sed cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://obsavus1p.bkt.clouddn.com/vim_cheat_sheet_for_programmers_print.png" target="_blank" title="vim cheatsheet">vim cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/aws-samples" target="_blank" title="AWS Samples">AWS Samples</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/bikrambora/devlab-launchpad" target="_blank" title="Welcome to Dev Labs">Dev Labs</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.lib.uts.edu.au" target="_blank" title="shoujin.wang@student.uts.edu.au">UTS Library</a>
            
          </li>
        
          <li>
            
            	<a href="https://7esl.com" target="_blank" title="ESL">ESL</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Stan live in Sydney. <br/>
			I am a lifelong technology learner.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/stanosaka" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6724938" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/stanosaka" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/stan.osaka" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/00root" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/btw01v" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/stan-22-82" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:devops@cwzhou.win" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="Stan Zhou">Stan Zhou</a>
		
		
		</p>
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>


        
  	    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
               if (window.mermaid) {
                  mermaid.initialize({theme: 'forest'});
               }
            </script>
        












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
