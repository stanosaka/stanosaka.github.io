
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Stan Zhou&#39;s Hexo Technical Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stan Zhou">
    

    
    <meta name="description" content="Infrastructure as code">
<meta property="og:type" content="website">
<meta property="og:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:url" content="http://223.95.78.227/page/3/index.html">
<meta property="og:site_name" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:description" content="Infrastructure as code">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta name="twitter:description" content="Infrastructure as code">
<meta name="twitter:creator" content="@stanosaka">

    
    <link rel="alternative" href="/atom.xml" title="Stan Zhou&#39;s Hexo Technical Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/toad.ico">
    
    
    <link rel="apple-touch-icon" href="/img/toadman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/toadman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/toadman.png" alt="Stan Zhou&#39;s Hexo Technical Blog" title="Stan Zhou&#39;s Hexo Technical Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Stan Zhou&#39;s Hexo Technical Blog">Stan Zhou&#39;s Hexo Technical Blog</a></h1>
				<h2 class="blog-motto">Innovation Evangelist</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:223.95.78.227">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/06/git/" title="Complete Git and Github Masterclass" itemprop="url">Complete Git and Github Masterclass</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-05T14:25:42.000Z" itemprop="datePublished"> Published 2019-05-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Complete-Git-and-Github-Masterclass"><a href="#Complete-Git-and-Github-Masterclass" class="headerlink" title="Complete Git and Github Masterclass"></a>Complete Git and Github Masterclass</h1><h2 id="How-Git-works-3-main-states-of-artifact"><a href="#How-Git-works-3-main-states-of-artifact" class="headerlink" title="How Git works - 3 main states of artifact"></a>How Git works - 3 main states of artifact</h2><p>Modified: Here, the artifact goes through chaneg made by the user</p>
<p>Staged: Here, the user/developer adds the artifact to Git index or staging area</p>
<p>Committed: Here, the artifact gets safely stored in Gt database.</p>
<h2 id="3-sections-of-a-Git-project"><a href="#3-sections-of-a-Git-project" class="headerlink" title="3 sections of a Git project"></a>3 sections of a Git project</h2><p>Working directory: this is the root directory of your Git project</p>
<p>Staging area: Also called index, this is where all related changes are build up</p>
<p>Commit area: this is where all artifacts are stacked safely in Git Database</p>
<h2 id="3-ways-of-setting-up-Git-repository"><a href="#3-ways-of-setting-up-Git-repository" class="headerlink" title="3 ways of setting up Git repository"></a>3 ways of setting up Git repository</h2><p>From scratch: we will create a repository from absolutely blank state</p>
<p>Existing project: here we will convert an existing unversioned project to a Git repository</p>
<p>By Copying: we will copy an existing Git repository from Github</p>
<h2 id="Git-Help-system"><a href="#Git-Help-system" class="headerlink" title="Git Help system"></a>Git Help system</h2><p><code>git help -a</code> and <code>git help -g</code> list available subcommands and some concept guides</p>
<h2 id="What-is-Fork-and-how-to-do-it"><a href="#What-is-Fork-and-how-to-do-it" class="headerlink" title="What is Fork and how to do it"></a>What is Fork and how to do it</h2><p>What it means: Creating a project from another existing project</p>
<p>Encouragement: encourages project advancement &amp; collaboration</p>
<p>Contribution: encourages outside contribution</p>
<p>Updates: Forks can updated</p>
<p>Command <code>git status</code>: tells us the status of the working directory and staging area</p>
<p>Command <code>git log</code>: displays committed snapshots or commit history</p>
<p><img src="https://i.imgur.com/NKpsqvI.png" alt="Real world branching scenario"></p>
<h2 id="Git-branching"><a href="#Git-branching" class="headerlink" title="Git branching"></a>Git branching</h2><p>Show branch: <code>git branch</code></p>
<p>Create a new branch: <code>git branch demobranch</code></p>
<p>Switch to the new branch: <code>git checkout demobranch</code></p>
<h2 id="Undoing-changes-in-a-Git-repository"><a href="#Undoing-changes-in-a-Git-repository" class="headerlink" title="Undoing changes in a Git repository"></a>Undoing changes in a Git repository</h2><h3 id="Checking-out-commits-in-a-Git-repository"><a href="#Checking-out-commits-in-a-Git-repository" class="headerlink" title="Checking out commits in a Git repository"></a>Checking out commits in a Git repository</h3><p><code>vim robot.txt</code></p>
<p>Express git add and commit command:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git commit -am <span class="string">"1st commit - robot.txt"</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">log</span> --oneline</span><br><span class="line"></span><br><span class="line">git check 265fbe5</span><br></pre></td></tr></table></figure>
<p>Create a new branch:</p>
<p><code>git checkout -b newbranch</code></p>
<p>Switch branch:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line"></span><br><span class="line">git checkout newbranch</span><br></pre></td></tr></table></figure>
<h3 id="Checking-out-files-in-a-Git-repository"><a href="#Checking-out-files-in-a-Git-repository" class="headerlink" title="Checking out files in a Git repository"></a>Checking out files in a Git repository</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --oneline</span><br><span class="line"></span><br><span class="line">git checkout bb3d025 checkoutfile.txt</span><br><span class="line"></span><br><span class="line">git checkout HEAD checkoutfile.txt</span><br><span class="line"></span><br><span class="line">git status</span><br></pre></td></tr></table></figure>
<h3 id="Reverting-changes-in-a-Git-repository"><a href="#Reverting-changes-in-a-Git-repository" class="headerlink" title="Reverting changes in a Git repository"></a>Reverting changes in a Git repository</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git add . </span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">"commit file to revert"</span></span><br><span class="line"></span><br><span class="line">git revert HEAD</span><br></pre></td></tr></table></figure>
<h3 id="Resetting-Git-repository"><a href="#Resetting-Git-repository" class="headerlink" title="Resetting Git repository"></a>Resetting Git repository</h3><p><code>git reset --hard</code></p>
<blockquote>
<p>resets the staging area and working directory to match the most recent commit.</p>
</blockquote>
<p><img src="https://i.imgur.com/XxVvIOm.png" alt="git reset --hard"></p>
<p><code>git reset --hard hash_vaule</code></p>
<blockquote>
<p>moves the current branch id backward to commit id we are using and reset the both the staging area and work dir to match, this destroy not the current change and both the commit id as well.</p>
</blockquote>
<p><img src="https://i.imgur.com/hDkx3Z8.png" alt="git reset --hard hash_vaule"></p>
<h3 id="Cleaning-Git-repository"><a href="#Cleaning-Git-repository" class="headerlink" title="Cleaning Git repository"></a>Cleaning Git repository</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git clean -n</span><br><span class="line"></span><br><span class="line">git clean -f</span><br><span class="line"></span><br><span class="line">git clean -fd</span><br><span class="line"></span><br><span class="line">vim .gitignore</span><br><span class="line"></span><br><span class="line">git add .gitignore</span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">"committing .gitignore"</span></span><br><span class="line"></span><br><span class="line">git clean -xf</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  ####  ######   ######  ##     ## ######## </span></span><br><span class="line"><span class="comment">#   ##  ##    ## ##    ## ##     ## ##       </span></span><br><span class="line"><span class="comment">#   ##  ##       ##       ##     ## ##       </span></span><br><span class="line"><span class="comment">#   ##   ######   ######  ##     ## ######   </span></span><br><span class="line"><span class="comment">#   ##        ##       ## ##     ## ##       </span></span><br><span class="line"><span class="comment">#   ##  ##    ## ##    ## ##     ## ##       </span></span><br><span class="line"><span class="comment">#  ####  ######   ######   #######  ######## </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  ██╗███████╗███████╗██╗   ██╗███████╗</span></span><br><span class="line"><span class="comment">#  ██║██╔════╝██╔════╝██║   ██║██╔════╝</span></span><br><span class="line"><span class="comment">#  ██║███████╗███████╗██║   ██║█████╗  </span></span><br><span class="line"><span class="comment">#  ██║╚════██║╚════██║██║   ██║██╔══╝  </span></span><br><span class="line"><span class="comment">#  ██║███████║███████║╚██████╔╝███████╗</span></span><br><span class="line"><span class="comment">#  ╚═╝╚══════╝╚══════╝ ╚═════╝ ╚══════╝</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>If github ask for username and password:</p>
<blockquote>
<p><code>git remote set-url origin git@github.com:szhouchoice/EffectiveDevOpsTerraform.git</code></p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/git/">git</a><a href="/tags/github/">github</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/05/amazon-linux2/" title="amazon linux 2" itemprop="url">amazon linux 2</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-05T10:46:16.000Z" itemprop="datePublished"> Published 2019-05-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Amazon-Linux-2"><a href="#Amazon-Linux-2" class="headerlink" title="Amazon Linux 2"></a>Amazon Linux 2</h3><p>Change hostname use init-cloud:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/cloud/cloud.cfg.d/11_changehostname.cfg</span><br><span class="line"><span class="comment">#cloud-config</span></span><br><span class="line">preserve_hostname: <span class="literal">false</span></span><br><span class="line">hostname: myhostname</span><br><span class="line">fqdn: myhostname.example.com</span><br><span class="line">manage_etc_hosts: <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<p>By Command:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl <span class="built_in">set</span>-hostname foobar.localdomain</span><br><span class="line">sed -i <span class="string">'1s/localhost/foobar/1'</span> /etc/hosts|sed -i <span class="string">'1s/localhost/foobar/2'</span> /etc/hosts</span><br></pre></td></tr></table></figure></p>
<p>Extra Library:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user ~]$ amazon-linux-extras list</span><br><span class="line">[ec2-user ~]$ sudo amazon-linux-extras install topic=version topic=version</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/aws/">aws</a><a href="/tags/linux/">linux</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/05/docker/" title="docker" itemprop="url">docker</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-05T06:47:47.000Z" itemprop="datePublished"> Published 2019-05-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="List-Docker-CLI-commands"><a href="#List-Docker-CLI-commands" class="headerlink" title="List Docker CLI commands"></a>List Docker CLI commands</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">docker</span><br><span class="line">docker container --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Display Docker version and info</span></span><br><span class="line">docker --version</span><br><span class="line">docker version</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"><span class="comment">## Execute Docker image</span></span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment">## List Docker images</span></span><br><span class="line">docker image ls</span><br><span class="line"></span><br><span class="line"><span class="comment">## List Docker containers (running, all, all in quiet mode)</span></span><br><span class="line">docker container ls</span><br><span class="line">docker container ls --all</span><br><span class="line">docker container ls -aq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker build -t friendlyhello .  <span class="comment"># Create image using this directory's Dockerfile</span></span><br><span class="line">docker run -p 4000:80 friendlyhello  <span class="comment"># Run "friendlyhello" mapping port 4000 to 80</span></span><br><span class="line">docker run -d -p 4000:80 friendlyhello         <span class="comment"># Same thing, but in detached mode</span></span><br><span class="line">docker container ls                                <span class="comment"># List all running containers</span></span><br><span class="line">docker container ls -a             <span class="comment"># List all containers, even those not running</span></span><br><span class="line">docker container stop &lt;<span class="built_in">hash</span>&gt;           <span class="comment"># Gracefully stop the specified container</span></span><br><span class="line">docker container <span class="built_in">kill</span> &lt;<span class="built_in">hash</span>&gt;         <span class="comment"># Force shutdown of the specified container</span></span><br><span class="line">docker container rm &lt;<span class="built_in">hash</span>&gt;        <span class="comment"># Remove specified container from this machine</span></span><br><span class="line">docker container rm $(docker container ls -a -q)         <span class="comment"># Remove all containers</span></span><br><span class="line">docker image ls -a                             <span class="comment"># List all images on this machine</span></span><br><span class="line">docker image rm &lt;image id&gt;            <span class="comment"># Remove specified image from this machine</span></span><br><span class="line">docker image rm $(docker image ls -a -q)   <span class="comment"># Remove all images from this machine</span></span><br><span class="line">docker login             <span class="comment"># Log in this CLI session using your Docker credentials</span></span><br><span class="line">docker tag &lt;image&gt; username/repository:tag  <span class="comment"># Tag &lt;image&gt; for upload to registry</span></span><br><span class="line">docker push username/repository:tag            <span class="comment"># Upload tagged image to registry</span></span><br><span class="line">docker run username/repository:tag                   <span class="comment"># Run image from a registry</span></span><br></pre></td></tr></table></figure>
<h1 id="Beginning-Devops-with-Docker"><a href="#Beginning-Devops-with-Docker" class="headerlink" title="Beginning Devops with Docker"></a>Beginning Devops with Docker</h1><h2 id="Chapter-1-Images-and-Containers"><a href="#Chapter-1-Images-and-Containers" class="headerlink" title="Chapter 1. Images and Containers"></a>Chapter 1. Images and Containers</h2><p><strong>Virtualization versus Containerization</strong><br><img src="https://i.imgur.com/KKfsLxn.png" alt="virtual machine block diagram"><br>In virtual machines, the physical hardware is abstracted, therefore we have may server running on one server. Virtual machines do sometimes take time to start up and are expensive in capacity (they can be GBs in size), although the greatest advantage they have over containers is the ability to run different Linux distributions such as CentOS instead of just Ubuntu.</p>
<p><img src="https://i.imgur.com/rWfUi8x.png" alt="containerization"><br>In containerization, it is only the app layer (where code and dependencies are packaged) that is abstracted, making it possible for many containers to run on the same OS kernel but on separate user space.</p>
<p>Containers use less space and boot fast.</p>
<ul>
<li>Describe how Docker improves a DevOps workflow<br>Normally, we have two pieces to a working application: the project code base and the provisioning script. The code base is the application code. It is managed by version control and hosted in GitHub, among other platforms.<br><img src="https://i.imgur.com/7bpoPrj.png" alt="Docker implements"><br>The <strong>Dockerfile</strong> takes the place of the provisioning script. The two combined (project code and Dockerfile) make a <strong>Docker image</strong>. A Docker image can be run as an application. This running application sourced from a Docker image is called a <strong>Docker container</strong>.</li>
</ul>
<p><strong>Basic Docker Terminal Commands</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">docker info ## displays system-wide information</span><br><span class="line">docker search &lt;term&gt; (foir example. docker search ubuntu) ##searches Docker Hub for Images</span><br><span class="line">docker pull ## pulls an image from the registry to your local machine eg docker pull ubuntu</span><br><span class="line">docker images ## lists the Docker images we have locally</span><br><span class="line">docker run &lt;image&gt; #will check whether the image by the name hello-world exists locally,if the image is</span><br><span class="line">not local, it will be pulled form the default registry, Docker Hub, and run as a container, by default</span><br><span class="line"></span><br><span class="line">docker ps ## lists the running containers</span><br><span class="line">docker stop &lt;container ID&gt;  ## stop the container </span><br><span class="line">docker rm &lt;container ID&gt; ## Delete the container and the image</span><br><span class="line"></span><br><span class="line">- Interpret Dockerfile syntax</span><br><span class="line">- Build images</span><br><span class="line">- Set up containers and images</span><br><span class="line">- Set up a local dynamic environment</span><br><span class="line">- Run applications in Docker containers</span><br><span class="line">- Obtain a basic overview of how Docker manages images via Docker Hub</span><br><span class="line">- Deploy a Docker image to Docker Hub</span><br><span class="line"></span><br><span class="line">** The Dockerfile**</span><br></pre></td></tr></table></figure></p>
<p>FROM openjdk:8-jre-alpine</p>
<p>ENV SPRING_OUTPUT_ANSI_ENABLED=ALWAYS \<br>    JHIPSTER_SLEEP=0 \<br>    JAVA_OPTS=””</p>
<p>CMD echo “The application will start in ${JHIPSTER_SLEEP}s…” &amp;&amp; \<br>    sleep ${JHIPSTER_SLEEP} &amp;&amp; \<br>    java ${JAVA_OPTS} -Djava.security.egd=file:/dev/./urandom -jar /app.war</p>
<p>EXPOSE 8080 5701/udp</p>
<p>ADD *.war /app.war<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">The **FROM** instruction specifies the base image to use while initializing the build. Here, we specify open JDK 8 as our Java runtime.</span><br><span class="line"></span><br><span class="line">The **ENV** instruction is used to set environment variables, and the **CMD** instruction is used to specify commands to be executed.</span><br><span class="line"></span><br><span class="line">The **EXPOSE** instruction is used to specify the port that the container listens to during runtime.</span><br><span class="line"></span><br><span class="line">**useful commands for Docker and Docker compose&quot;&quot;</span><br><span class="line">![commands1](https://i.imgur.com/FAExCVU.png)</span><br><span class="line">![commands2](https://i.imgur.com/LtTRrfD.png)</span><br><span class="line"></span><br><span class="line">## Docker-compose</span><br><span class="line">**Sample docker-compose file that will start a Rdis database on port 5000**</span><br></pre></td></tr></table></figure></p>
<p>version: ‘3’<br>services:<br>  web:<br>    build: .<br>    ports:</p>
<pre><code>- &quot;5000:5000&quot;
</code></pre><p>  redis:<br>    image: “redis:alpine”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">The first line of the *docker-compose* file should be the version of the *docker-compose* tool. </span><br><span class="line"></span><br><span class="line">Then we need to specify all the necessary services that we need for our application to run. They should be defined in the *services:* section.</span><br><span class="line"></span><br><span class="line">We can also define multiple services inside here, giving a name to each (*web* and *redis*).</span><br><span class="line"></span><br><span class="line">This is followed by how to build the *service* (either via a command to build or referring a Dockerfile). </span><br><span class="line"></span><br><span class="line">If the application needs any port access, we can configure it using *5000:5000* (that is internal port: external port). </span><br><span class="line"></span><br><span class="line">Then, we have to specify the volume information. This basically tells *docker-compose* to serve the files from the location specified.   </span><br><span class="line"></span><br><span class="line">Once we have specified the services required for our application, then we can start the application via *docker-compose*. This will start your entire application along with the services, and expose the *services* on the port specified. </span><br><span class="line"></span><br><span class="line">With *docker-compose*, we can perform the following operations:</span><br><span class="line"></span><br><span class="line">- **Start**: docker-compose -f &lt;docker_file&gt; up</span><br><span class="line">- **Stop**: docker-compose -f &lt;docker_file&gt; down  </span><br><span class="line">We can also perform the following operations:</span><br><span class="line"></span><br><span class="line">- **List the running services and their status**: *docker ps*</span><br><span class="line">- **Logs**: *docker log &lt;container_id&gt;*</span><br><span class="line"></span><br><span class="line">## Kubernetes</span><br><span class="line">A single deployable component is called a **pod** in Kubernetes. This can be as simple as a running process in the container. A group of pods can be combined together to form a **deployment**. </span><br><span class="line"></span><br><span class="line">The following code is a sample Kubernetes file that will start a Nginx server:</span><br></pre></td></tr></table></figure></p>
<p>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: nginxsvc<br>  labels:<br>    app: nginx<br>spec:<br>  type: NodePort<br>  ports:</p>
<ul>
<li>port: 80<br>protocol: TCP<br>name: http</li>
<li>port: 443<br>protocol: TCP<br>name: https<br>selector:<br>app: nginx<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. Start with an *apiVersion* in a Kubernetes deployment file.</span><br><span class="line"></span><br><span class="line">2. Followed by the type, which takes either a pod, deployment, namespace, ingress (load balancing the pods), role, and many more.</span><br><span class="line"></span><br><span class="line">Ingress forms a layer between the services and the internet so that all the inbound connections are controlled or configured with the ingress controller before sending them to Kubernetes services on the cluster. On the other hand, the egress controller controls or configures services going out of the Kubernetes cluster.</span><br><span class="line"></span><br><span class="line">3. This is followed by the metadata information, such as the type of environments, the application name (nginxsvc), and labels (Kubernetes uses this information to identify and segregate the pods). Kubernetes uses this metadata information to identify the particular pods or a group of pods, and we can manage the instances with this metadata. This is one of the key differences with docker-compose, where docker-compose doesn&apos;t have the flexibility of defining the metadata about the containers.</span><br><span class="line"></span><br><span class="line">4. This is followed by the spec, where we define the specification of the images or our application. We can also define the pull strategy for our images as well as define the environment variables along with the exposed ports. We can define the resource limitations on the machine (or VM) for a particular service. They provide health checks, that is, each service is monitored for the health and when some services fail, they are immediately replaced by newer ones. They also provide service discovery out of the box, by assigning each pod an IP, which makes it easier for the services to identify and interact with them. They also provide a better dashboard, to visualize your architecture and the status of the application. You can do most of the management via this dashboard, such as checking the status, logs, scale up, or down the services, and so on.</span><br><span class="line"></span><br><span class="line">## Docker ps command</span><br><span class="line">```bash</span><br><span class="line">docker ps --format &quot;table &#123;&#123;.ID&#125;&#125; \t &#123;&#123;.Image&#125;&#125; \t &#123;&#123;.Ports&#125;&#125; \t &#123;&#123;.Names&#125;&#125;&quot;</span><br><span class="line">CONTAINER ID         IMAGE                   PORTS                                                NAMES</span><br><span class="line">7d3a6d518e8e         jenkinsci/blueocean     0.0.0.0:8080-&gt;8080/tcp, 0.0.0.0:50000-&gt;50000/tcp     jenkins</span><br><span class="line">9655eb0e836e         alpine                                                                       quotes</span><br><span class="line">root@stan-OptiPlex-380:~|⇒  docker ps --format &quot;table &#123;&#123;.ID&#125;&#125; \t &#123;&#123;.Names &#125;&#125; \t &#123;&#123;.Status&#125;&#125;&quot;</span><br><span class="line">CONTAINER ID         NAMES               STATUS</span><br><span class="line">7d3a6d518e8e         jenkins             Up 2 minutes</span><br><span class="line">9655eb0e836e         quotes              Up 4 hours</span><br></pre></td></tr></table></figure>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/docker/">docker</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/06/redhat/" title="redhat" itemprop="url">redhat</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2017-09-06T07:49:54.000Z" itemprop="datePublished"> Published 2017-09-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Issue-1"><a href="#Issue-1" class="headerlink" title="Issue 1."></a>Issue 1.</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost stan]<span class="comment"># yum install -y ntp</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">There are no enabled repos.</span><br><span class="line"> Run <span class="string">"yum repolist all"</span> to see the repos you have.</span><br><span class="line"> You can <span class="built_in">enable</span> repos with yum-config-manager --<span class="built_in">enable</span> &lt;repo&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve:"></a>Solve:</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]<span class="comment"># mkdir /cdrom</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mount /dev/cdrom /cdrom</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># pwd</span></span><br><span class="line">/etc/yum.repos.d</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># vim dvd.repo</span></span><br><span class="line">[dvd-source]</span><br><span class="line">name=RHEL 7.2 dvd repo</span><br><span class="line">baseurl=file:///cdrom</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum repolist</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">dvd-source                                                                                     | 4.1 kB  00:00:00</span><br><span class="line">(1/2): dvd-source/group_gz                                                                     | 136 kB  00:00:00</span><br><span class="line">(2/2): dvd-source/primary_db                                                                   | 3.6 MB  00:00:00</span><br><span class="line">repo id                                             repo name                                                   status</span><br><span class="line">dvd-source                                          RHEL 7.2 dvd repo                                           4,620</span><br><span class="line">repolist: 4,620</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum install rpm-build</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package rpm-build.x86_64 0:4.11.3-17.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl(Thread::Queue) <span class="keyword">for</span> package: rpm-build-4.11.3-17.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: system-rpm-config <span class="keyword">for</span> package: rpm-build-4.11.3-17.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package perl-Thread-Queue.noarch 0:3.02-2.el7 will be installed</span><br><span class="line">---&gt; Package redhat-rpm-config.noarch 0:9.1.0-68.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: dwz &gt;= 0.4 <span class="keyword">for</span> package: redhat-rpm-config-9.1.0-68.el7.noarch</span><br><span class="line">--&gt; Processing Dependency: perl-srpm-macros <span class="keyword">for</span> package: redhat-rpm-config-9.1.0-68.el7.noarch</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package dwz.x86_64 0:0.11-3.el7 will be installed</span><br><span class="line">---&gt; Package perl-srpm-macros.noarch 0:1-8.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">======================================================================================================================</span><br><span class="line"> Package                          Arch                  Version                       Repository                 Size</span><br><span class="line">======================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> rpm-build                        x86_64                4.11.3-17.el7                 dvd-source                144 k</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> dwz                              x86_64                0.11-3.el7                    dvd-source                 99 k</span><br><span class="line"> perl-Thread-Queue                noarch                3.02-2.el7                    dvd-source                 17 k</span><br><span class="line"> perl-srpm-macros                 noarch                1-8.el7                       dvd-source                4.7 k</span><br><span class="line"> redhat-rpm-config                noarch                9.1.0-68.el7                  dvd-source                 77 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">======================================================================================================================</span><br><span class="line">Install  1 Package (+4 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 341 k</span><br><span class="line">Installed size: 734 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                 1.9 MB/s | 341 kB  00:00:00</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : perl-Thread-Queue-3.02-2.el7.noarch                                                                1/5</span><br><span class="line">  Installing : dwz-0.11-3.el7.x86_64                                                                              2/5</span><br><span class="line">  Installing : perl-srpm-macros-1-8.el7.noarch                                                                    3/5</span><br><span class="line">  Installing : redhat-rpm-config-9.1.0-68.el7.noarch                                                              4/5</span><br><span class="line">  Installing : rpm-build-4.11.3-17.el7.x86_64                                                                     5/5</span><br><span class="line">dvd-source/productid                                                                           | 1.6 kB  00:00:00</span><br><span class="line">  Verifying  : redhat-rpm-config-9.1.0-68.el7.noarch                                                              1/5</span><br><span class="line">  Verifying  : rpm-build-4.11.3-17.el7.x86_64                                                                     2/5</span><br><span class="line">  Verifying  : perl-srpm-macros-1-8.el7.noarch                                                                    3/5</span><br><span class="line">  Verifying  : dwz-0.11-3.el7.x86_64                                                                              4/5</span><br><span class="line">  Verifying  : perl-Thread-Queue-3.02-2.el7.noarch                                                                5/5</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  rpm-build.x86_64 0:4.11.3-17.el7</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  dwz.x86_64 0:0.11-3.el7                  perl-Thread-Queue.noarch 0:3.02-2.el7  perl-srpm-macros.noarch 0:1-8.el7</span><br><span class="line">  redhat-rpm-config.noarch 0:9.1.0-68.el7</span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/redhat/">redhat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/nginx01/" title="Nginx Deploy" itemprop="url">Nginx Deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T04:31:14.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Install-Nginx"><a href="#Install-Nginx" class="headerlink" title="Install Nginx"></a>Install Nginx</h2><h3 id="Install-Nginx-Package"><a href="#Install-Nginx-Package" class="headerlink" title="Install Nginx Package"></a>Install Nginx Package</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@huoq bin]<span class="comment"># yum install pcre pcre-devel -y</span></span><br><span class="line">check by:</span><br><span class="line">[root@huoq bin]<span class="comment"># rpm -qa pcre pcre-devel</span></span><br><span class="line">pcre-devel-8.32-15.el7_2.1.x86_64</span><br><span class="line">pcre-8.32-15.el7_2.1.x86_64</span><br><span class="line">[root@huoq tools]<span class="comment"># yum install -y openssl-devel openssl</span></span><br></pre></td></tr></table></figure>
<h3 id="Install-Nginx-1"><a href="#Install-Nginx-1" class="headerlink" title="Install Nginx"></a>Install Nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.6.3.tar.gz</span><br><span class="line">useradd nginx -s /sbin/nologin -M</span><br><span class="line">tar xf nginx-1.6.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.6.3/</span><br><span class="line">./configure --user=nginx --group=nginx --prefix=/application/nginx-1.6.3 --with-http_stub_status_module --with-http_ssl_module</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s /application/nginx-1.6.3 /application/nginx</span><br><span class="line">vim /application/nginx/conf/nginx.conf</span><br><span class="line">worker_processes  4;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">   </span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    upstream web_pools &#123;</span><br><span class="line">        server 127.0.0.1:8081;</span><br><span class="line">        server 127.0.0.1:8082;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            proxy_pass http://web_pools;</span><br><span class="line">        &#125;</span><br><span class="line">        location /nginx_status &#123;</span><br><span class="line">                stub_status on;</span><br><span class="line">                access_log off;</span><br><span class="line">                allow 127.0.0.1;</span><br><span class="line">                deny all;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/application/nginx/sbin/nginx -t</span><br><span class="line">vim /etc/init.d/nginx</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#chkconfig: - 85 15</span></span><br><span class="line"><span class="comment">#description: this script use to manage nginx process.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#set -x</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"></span><br><span class="line">procnum=`ps -ef |grep <span class="string">"/application/nginx/sbin/nginx"</span>|grep -v <span class="string">"grep"</span>|wc -l`</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  /application/nginx/sbin/nginx</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"$?"</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  failure</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 4</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  /application/nginx/sbin/nginx -s stop</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"$?"</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  failure</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 3</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">  start)</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  stop)</span><br><span class="line">  stop</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  restart)</span><br><span class="line">  stop</span><br><span class="line">  sleep 1</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  reload)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  /application/nginx/sbin/nginx -s reload</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is not running!please start nginx first..."</span></span><br><span class="line">  <span class="built_in">exit</span> 2</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  status)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is running..."</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is not running..."</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  *)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage : nginx [ start|stop|reload|restart|status ]"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">  ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">chmod +x /etc/init.d/nginx</span><br><span class="line">chkconfig nginx on</span><br><span class="line">/etc/init.d/nginx start</span><br><span class="line">Starting nginx:                                      [  OK  ]</span><br><span class="line">/etc/init.d/nginx status</span><br><span class="line">nginx is running...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/nginx/">nginx</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/tomcat01/" title="tomcat deploy" itemprop="url">tomcat deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T00:10:37.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="tomcat-deploy-on-centos"><a href="#tomcat-deploy-on-centos" class="headerlink" title="tomcat deploy on centos"></a>tomcat deploy on centos</h2><h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><h3 id="JDK下载："><a href="#JDK下载：" class="headerlink" title="JDK下载："></a>JDK下载：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate --no-cookies --header <span class="string">"Cookie: oraclelicense=accept-securebackup-cookie"</span> http://download.oracle.com/otn-pub/java/jdk/7u79-b15/jdk-7u79-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat下载"><a href="#Tomcat下载" class="headerlink" title="Tomcat下载:"></a><a href="http://tomcat.apache.org/">Tomcat下载</a>:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://toad.cwzhou.win/pub/apache-tomcat-7.0.70.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="部署java环境"><a href="#部署java环境" class="headerlink" title="部署java环境"></a>部署java环境</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tar xf jdk-8u91-linux-x64.tar.gz -C /application/</span><br><span class="line"></span><br><span class="line">ln -s /application/jdk1.8.0/ /application/jdk</span><br><span class="line">cp /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="comment"># sed -i.ori '$a export JAVA_HOME=/application/jdk\nexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH\nexport CLASSPATH=.$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$JAVA_HOME/lib/tools.jar' /etc/profile</span></span><br><span class="line"></span><br><span class="line">vimdiff /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<h2 id="Install-tomcat"><a href="#Install-tomcat" class="headerlink" title="Install tomcat"></a>Install tomcat</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tar xf apache-tomcat-8.0.27.tar.gz -C /application/</span><br><span class="line">ln -s /application/apache-tomcat-8.0.27 /application/tomcat</span><br><span class="line"><span class="built_in">echo</span>  <span class="string">'export TOMCAT_HOME=/application/tomcat'</span>&gt;&gt;/etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">chown -R root.root /application/jdk/ /application/tomcat/</span><br><span class="line">[root@tomcat ~]<span class="comment"># tail -4 /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> TOMCAT_HOME=/application/tomcat</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat目录介绍"><a href="#Tomcat目录介绍" class="headerlink" title="Tomcat目录介绍"></a>Tomcat目录介绍</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/tomcat/</span></span><br><span class="line">[root@tomcat tomcat]<span class="comment"># tree -L 1</span></span><br><span class="line">.</span><br><span class="line">├── bin <span class="comment">#→用以启动、关闭Tomcat或者其它功能的脚本（.bat文件和.sh文件）</span></span><br><span class="line">├── conf <span class="comment">#→用以配置Tomcat的XML及DTD文件</span></span><br><span class="line">├── lib <span class="comment">#→存放web应用能访问的JAR包</span></span><br><span class="line">├── LICENSE</span><br><span class="line">├── logs <span class="comment">#→Catalina和其它Web应用程序的日志文件</span></span><br><span class="line">├── NOTICE</span><br><span class="line">├── RELEASE-NOTES</span><br><span class="line">├── RUNNING.txt</span><br><span class="line">├── temp <span class="comment">#→临时文件</span></span><br><span class="line">├── webapps <span class="comment">#→Web应用程序根目录</span></span><br><span class="line">└── work <span class="comment">#→用以产生有JSP编译出的Servlet的.java和.class文件</span></span><br><span class="line">7 directories, 4 files</span><br><span class="line">[root@tomcat tomcat]<span class="comment"># cd webapps/</span></span><br><span class="line">[root@tomcat webapps]<span class="comment"># ll</span></span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 14 root root 4096 Oct 5 12:09 docs <span class="comment">#→tomcat帮助文档</span></span><br><span class="line">drwxr-xr-x 6 root root 4096 Oct 5 12:09 examples <span class="comment">#→web应用实例</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 host-manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct 5 12:09 ROOT <span class="comment">#→默认网站根目录</span></span><br></pre></td></tr></table></figure>
<h2 id="Tomcat多实例及集群架构"><a href="#Tomcat多实例及集群架构" class="headerlink" title="Tomcat多实例及集群架构"></a>Tomcat多实例及集群架构</h2><h3 id="Tomcat多实例"><a href="#Tomcat多实例" class="headerlink" title="Tomcat多实例"></a>Tomcat多实例</h3><p>复制Tomcat目录<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_1</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_2</span></span><br></pre></td></tr></table></figure></p>
<p>修改配置文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat application]<span class="comment"># mkdir -p /data/www/www/ROOT</span></span><br><span class="line">[root@tomcat application]<span class="comment"># cp /application/tomcat/webapps/memtest/meminfo.jsp /data/www/www/ROOT/</span></span><br><span class="line">sed -i <span class="string">'22s#8005#8011#;71s#8080#8081#;125s#appBase=".*"# appBase="/data/www/www"#'</span> /application/tomcat7_1/conf/server.xml</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'22s#8005#8012#;71s#8080#8082#;125s#appBase=".*"# appBase="/data/www/www"#'</span> /application/tomcat7_2/conf/server.xml</span><br></pre></td></tr></table></figure></p>
<h3 id="jvm调优"><a href="#jvm调优" class="headerlink" title="jvm调优"></a>jvm调优</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim catalina.sh insert</span></span><br><span class="line">JAVA_OPTS=<span class="string">"-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m -XX:MaxPermSize=512m"</span></span><br></pre></td></tr></table></figure>
<h3 id="service-startup-script"><a href="#service-startup-script" class="headerlink" title="service startup script"></a>service startup script</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/init.d</span><br><span class="line"></span><br><span class="line">vim tomcat</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># des: Tomcat Start Stop Restart</span></span><br><span class="line"><span class="comment"># processname: tomcat</span></span><br><span class="line"><span class="comment"># chkconfig: 234 20 80</span></span><br><span class="line">JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME</span><br><span class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line">CATALINA_HOME=/application/tomcat</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line">chkconfig --add tomcat</span><br><span class="line">chkconfig --level 234 tomcat on</span><br><span class="line">chkconfig --list tomcat</span><br><span class="line">groupadd tomcat</span><br><span class="line">useradd -g tomcat -d /home/tomcat -s /bin/sh tomcat</span><br><span class="line"><span class="built_in">cd</span> /etc/init.d/</span><br><span class="line"></span><br><span class="line">chown tomcat:tomcat  tomcat</span><br><span class="line"></span><br><span class="line">chmod +x tomcat</span><br><span class="line">service tomcat start</span><br><span class="line"></span><br><span class="line">check the <span class="built_in">log</span>:</span><br><span class="line">tail /application/tomcat/logs/catalina.out</span><br></pre></td></tr></table></figure>
<h3 id="Remove-default-content"><a href="#Remove-default-content" class="headerlink" title="Remove default content:"></a>Remove default content:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /root/apache-tomcat-7.0.70.tar.gz</span><br><span class="line">vim /tmp/run01.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> docs examples host-manager manager ROOT/RELEASE-NOTES.txt </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                rm -rf /application/tomcat7_<span class="variable">$i</span>/webapps/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Change-folder-ownership-and-permissions"><a href="#Change-folder-ownership-and-permissions" class="headerlink" title="Change folder ownership and permissions:"></a>Change folder ownership and permissions:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chown -R tomcat.tomcat /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run02.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> logs temp </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run03.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> bin webapps conf </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod 770 /application/tomcat7_<span class="variable">$i</span>/conf/catalina.policy; <span class="keyword">done</span></span><br><span class="line">vim /tmp/run04.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> catalina.properties context.xml logging.properties server.xml tomcat-users.xml web.xml</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/conf/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Remove-Server-Banner"><a href="#Remove-Server-Banner" class="headerlink" title="Remove Server Banner"></a>Remove Server Banner</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /application/tomcat/lib</span><br><span class="line">mkdir -p org/apache/catalina/util/</span><br><span class="line">jar xf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">ll org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">vim org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">server.info=Secure Web server</span><br><span class="line">server.number=1.0.0.0</span><br><span class="line">server.built=Jan 01 2000 00:00:00 UTC</span><br><span class="line">jar uf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">rm -rf /application/tomcat/lib/org</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/tomcat/">tomcat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/17/nginx/" title="optimize nginx performance" itemprop="url">optimize nginx performance</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-17T03:45:29.000Z" itemprop="datePublished"> Published 2016-10-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="1-优化worker进程个数"><a href="#1-优化worker进程个数" class="headerlink" title="1.优化worker进程个数"></a>1.优化worker进程个数</h3><p>查看cpu总核数<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep processor /proc/cpuinfo|wc -l</span></span><br><span class="line">2 <span class="comment">#表示为1颗CPU四核</span></span><br></pre></td></tr></table></figure></p>
<p>查看CPU总颗数：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep 'physical id' /proc/cpuinfo|sort|uniq|wc -l</span></span><br><span class="line">1 <span class="comment">#对physical id去重计数，表示1颗cpu</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim nginx.conf</span></span><br><span class="line">worker_processes 2;</span><br><span class="line"><span class="comment"># /application/nginx/sbin/nginx -t</span></span><br><span class="line"><span class="comment"># /application/nginx/sbin/nginx -s reload</span></span><br></pre></td></tr></table></figure>
<h3 id="2-访问日志配置实战"><a href="#2-访问日志配置实战" class="headerlink" title="2.访问日志配置实战"></a>2.访问日志配置实战</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">'21,23 s/#//gp'</span> ../conf/nginx.conf.default</span><br><span class="line">log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line"><span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line"><span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">vim nginx.con</span><br><span class="line">error_log  logs/error.log;</span><br><span class="line">...</span><br><span class="line">http &#123;</span><br><span class="line">...</span><br><span class="line">log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">		  <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">		  <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">access_log  logs/access.log  main;</span><br><span class="line">   </span><br><span class="line">...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>Nginx访问日志轮询切割<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /server/script/cut_nginx_log.sh</span></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">Dateformat=`date +%Y%m%d`</span><br><span class="line">Basedir=<span class="string">"/application/nginx"</span></span><br><span class="line">Nginxlogdir=<span class="string">"<span class="variable">$Basedir</span>/logs"</span></span><br><span class="line">Logname=<span class="string">"access"</span></span><br><span class="line">[ -d <span class="variable">$Nginxlogdir</span> ] &amp;&amp; <span class="built_in">cd</span> <span class="variable">$Nginxlogdir</span> || <span class="built_in">exit</span> 1</span><br><span class="line">[ -f <span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span> ]|| exit1</span><br><span class="line">/bin/mv <span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span> <span class="variable">$&#123;Dateformat&#125;</span>_<span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span></span><br><span class="line"><span class="variable">$Basedir</span>/sbin/nginx -s reload</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /var/spool/cron/root &lt;&lt;EOF</span><br><span class="line"><span class="comment">#cut nginx access log by cwzhou</span></span><br><span class="line">00 00 * * * /bin/sh /server/script/cut_nginx_log.sh &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#check result</span></span><br><span class="line"><span class="comment">#crontab -l</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Nginx并发连接数量"><a href="#Nginx并发连接数量" class="headerlink" title="Nginx并发连接数量"></a>Nginx并发连接数量</h3><blockquote>
<p>Reference <a href="http://nginx.org/en/docs/http/ngx_http_limit_conn_module.html">ngx_http_limit_conn_module</a><br>1.限制单ip并发连接数<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.conf</span><br><span class="line">...</span><br><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    limit_conn_zone <span class="variable">$binary_remote_addr</span> zone=addr:10m;</span><br><span class="line">    server&#123;</span><br><span class="line">	...</span><br><span class="line">	location / &#123;</span><br><span class="line">		...</span><br><span class="line">		limit_conn addr 1; <span class="comment">#限制单ip的并发连接为1</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ab -c 1 -n 10 http://10.0.0.3/  <span class="comment">#模拟并发连接1,访问10次服务器</span></span><br><span class="line"><span class="comment"># -c为并发数 -n为请求书 10.0.0.3为nginx的Ip地址</span></span><br></pre></td></tr></table></figure>
<p>应用场景之一是服务器下载：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /download/ &#123;</span><br><span class="line">	limit_conn add 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.限制虚拟主机总连接数<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.conf</span><br><span class="line">...</span><br><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    limit_conn_zone <span class="variable">$binary_remote_addr</span> zone=addr:10m;</span><br><span class="line">    limit_conn_zone <span class="variable">$server_name</span> zone=perserver:10m;</span><br><span class="line"></span><br><span class="line">    server&#123;</span><br><span class="line">	...</span><br><span class="line">	location / &#123;</span><br><span class="line">		...</span><br><span class="line">		limit_conn perserver 2; <span class="comment">#限制虚拟主机连接数为2</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/nginx/">nginx</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/13/sysadmintool/" title="system admin tools" itemprop="url">system admin tools</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-13T05:23:04.000Z" itemprop="datePublished"> Published 2016-10-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="system-admin-tool"><a href="#system-admin-tool" class="headerlink" title="system admin tool"></a>system admin tool</h2><p><a href="http://blog.chinaunix.net/uid-10915175-id-3246219.html%22iostat%E4%BB%8B%E7%BB%8D%22">iostat介绍</a><br><a href="http://blog.chinaunix.net/uid-10915175-id-4543091.html">全能系统监控工具dstat </a><br>most use:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@toad pxe]<span class="comment"># dstat -cmsdnl -D sda3 -N lo,eth0 100 5</span></span><br></pre></td></tr></table></figure></p>
<p>网络监控工具<br>本地服务器的网卡吞吐量：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptraf -d eth0</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># both</span></span><br><span class="line">wget ftp://ftp.netperf.org/netperf/netperf-2.7.0.tar.gz</span><br><span class="line">tar xf netperf-2.7.0.tar.gz</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务端：</span></span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># netserver</span></span><br><span class="line">Starting netserver with host <span class="string">'IN(6)ADDR_ANY'</span> port <span class="string">'12865'</span> and family AF_UNSPEC</span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># lsof -i :12865</span></span><br><span class="line">COMMAND     PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME</span><br><span class="line">netserver 18230 root    3u  IPv6 2815424      0t0  TCP *:12865 (LISTEN)</span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># ethtool eth0 |grep -i speed</span></span><br><span class="line">        Speed: 1000Mb/s</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端</span></span><br><span class="line">root@kali:~/Downloads/netperf-2.7.0<span class="comment">#  netperf -H 192.168.199.231 -l 60</span></span><br><span class="line">MIGRATED TCP STREAM TEST from 0.0.0.0 () port 0 AF_INET to 192.168.199.231 () port 0 AF_INET</span><br><span class="line">Recv   Send    Send</span><br><span class="line">Socket Socket  Message  Elapsed</span><br><span class="line">Size   Size    Size     Time     Throughput</span><br><span class="line">bytes  bytes   bytes    secs.    10^6bits/sec</span><br><span class="line"></span><br><span class="line">87380  16384  16384    60.02      94.13</span><br><span class="line">root@kali:~/Downloads/netperf-2.7.0<span class="comment"># ethtool eth0 |grep -i speed</span></span><br><span class="line">        Speed: 100Mb/s</span><br></pre></td></tr></table></figure>
<p>Netperf缺省情况下进行TCP批量传输，即-t TCP_STREAM。测试过程中，netperf向netserver发送批量的TCP数据分组，以确定数据传输过程中的吞吐量：<br> 从netperf的结果输出中，我们可以知道以下的一些信息：<br>1）    远端系统（即server）使用大小为87380字节的socket接收缓冲<br>2）    本地系统（即client）使用大小为16384字节的socket发送缓冲<br>3）    向远端系统发送的测试分组大小为16384字节<br>4）    测试经历的时间为60秒<br>5）    吞吐量的测试结果为94.13Mbits/秒</p>
<blockquote>
<p>Reference <a href="https://www.ibm.com/developerworks/cn/linux/l-netperf/">netperf 与网络性能测量</a></p>
</blockquote>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/system-admin/">system admin</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/12/zabbix/" title="zabbix" itemprop="url">zabbix</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-12T04:54:53.000Z" itemprop="datePublished"> Published 2016-10-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="zabbix"><a href="#zabbix" class="headerlink" title="zabbix"></a>zabbix</h2><table>
<thead>
<tr>
<th></th>
<th>IP address</th>
<th>Roles</th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>192.168.0.49(chatswood)</td>
<td>zabbix server</td>
<td>Centos 6.8 Zabbix 2.4.8</td>
<td></td>
</tr>
<tr>
<td></td>
<td>192.168.0.80(macadamina)</td>
<td>zabbix agent</td>
<td>Centos 6.8 Zabbix 2.4.8</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="server-setup"><a href="#server-setup" class="headerlink" title="server setup"></a>server setup</h2> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-server -y</span><br><span class="line">tar xf zabbix-2.4.8.tar.gz</span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8</span><br><span class="line">./configure --prefix=/opt/zabbix --<span class="built_in">enable</span>-server --<span class="built_in">enable</span>-agent --with-mysql</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">yum install httpd php-devel php php-mbstring -y</span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line"><span class="built_in">cd</span> /opt/zabbix/</span><br><span class="line">mv etc&#123;,_bak&#125;</span><br><span class="line">/bin/cp -rf etc_bak/ etc</span><br><span class="line">[root@chatswood ~]<span class="comment"># cat /opt/zabbix/etc/zabbix_server.conf|egrep -v "^#|^$"</span></span><br><span class="line">LogFile=/tmp/zabbix_server.log</span><br><span class="line">PidFile=/tmp/zabbix_server.pid</span><br><span class="line">DBSocket=/tmp/mysql.sock</span><br><span class="line">DBHost=chatswood</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=123456</span><br><span class="line">Timeout=30</span><br><span class="line">[root@chatswood ~]<span class="comment"># cat /opt/zabbix/etc/zabbix_agentd.conf|egrep -v "^#|^$"</span></span><br><span class="line">PidFile=/tmp/zabbix_agentd.pid</span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=chatswood</span><br><span class="line">ServerActive=chatswood</span><br><span class="line">Hostname=chatswood</span><br><span class="line">Timeout=30</span><br><span class="line"></span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line"><span class="comment"># mysql</span></span><br><span class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8;</span><br><span class="line">mysql&gt; grant all on zabbix.* to zabbix@<span class="string">'192.168.0.49'</span> identified by <span class="string">'123456'</span>;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8/database/mysql</span><br><span class="line">mysql zabbix &lt; ./schema.sql -p</span><br><span class="line">mysql zabbix &lt; ./images.sql -p</span><br><span class="line">mysql zabbix &lt; ./data.sql -p</span><br><span class="line"><span class="comment">## test database</span></span><br><span class="line">mysql -u zabbix -p -h192.168.0.49</span><br><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a zabbix user</span></span><br><span class="line">groupadd -g 508 zabbix</span><br><span class="line">useradd -g 508 -u 508 zabbix -M -s /sbin/nologin</span><br><span class="line"></span><br><span class="line">/opt/zabbix/sbin/zabbix_server -c /opt/zabbix/etc/zabbix_server.conf</span><br><span class="line">ps aux|grep zabbix</span><br><span class="line">/opt/zabbix/sbin/zabbix_agentd -c /opt/zabbix/etc/zabbix_agentd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">/opt/zabbix/bin/zabbix_get -s chatswood -k proc.num[]</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8</span><br><span class="line">mkdir /var/www/html/zabbix</span><br><span class="line">/bin/cp -rf frontends/php/* /var/www/html/zabbix/</span><br><span class="line">vim /etc/php.ini</span><br><span class="line">date.timezone = Asia/Shanghai</span><br><span class="line">post_max_size = 18M</span><br><span class="line">max_execution_time = 350</span><br><span class="line">max_input_time = 350</span><br><span class="line"></span><br><span class="line">yum install php-gd php-xml php-mysql php-bcmath -y</span><br><span class="line">/etc/init.d/httpd restart</span><br><span class="line">ps aux|grep apache</span><br><span class="line">/usr/sbin/ntpdate 3.cn.pool.ntp.org</span><br><span class="line">chown -R apache /var/www/html/zabbix/</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="agent-setup"><a href="#agent-setup" class="headerlink" title="agent setup"></a>agent setup</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line">./configure --prefix=/opt/zabbix --<span class="built_in">enable</span>-agent --with-net-snmp</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">groupadd -g 508 zabbix</span><br><span class="line">useradd -g 508 -u 508 zabbix -M -s /sbin/nologin</span><br><span class="line">cat /opt/zabbix/etc/zabbix_agentd.conf|egrep -v <span class="string">"^#|^$"</span></span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=chatswood</span><br><span class="line">ServerActive=chatswood</span><br><span class="line">Hostname=macadamina</span><br><span class="line"></span><br><span class="line">/opt/zabbix/sbin/zabbix_agentd -c /opt/zabbix/etc/zabbix_agentd.conf</span><br><span class="line">ps aux|grep zabbix</span><br><span class="line">lsof|grep zabbix</span><br></pre></td></tr></table></figure>
<p>Access <a href="http://192.168.0.49/zabbix">http://192.168.0.49/zabbix</a>,<br>default username: admin<br>password: zabbix</p>
<hr>
<h2 id="issue"><a href="#issue" class="headerlink" title="issue"></a>issue</h2><hr>
<p>checking for mysql_config… /usr/bin/mysql_config<br>checking for main in -lmysqlclient… no<br>configure: error: Not found mysqlclient library</p>
<p>#yum -y install mysql-devel</p>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/zabbix/">zabbix</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/10/web-security/" title="web security" itemprop="url">web security</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-10T00:03:50.000Z" itemprop="datePublished"> Published 2016-10-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="web安全"><a href="#web安全" class="headerlink" title="web安全"></a>web安全</h1><h3 id="Table-of-contents"><a href="#Table-of-contents" class="headerlink" title="Table of contents"></a>Table of contents</h3><p>You can insert a table of contents using the marker <code>[TOC]</code>:</p>
<p>[TOC]</p>
<h2 id="使用iptables防护网站安全"><a href="#使用iptables防护网站安全" class="headerlink" title="使用iptables防护网站安全"></a>使用iptables防护网站安全</h2><blockquote>
<p><strong>只允许特定流量通过，禁用其他流量</strong></p>
</blockquote>
<blockquote>
<ul>
<li>permit ssh<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>permit DNS<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -l INPUT 1 -p tcp --sport 53 -j ACCEPT</span><br><span class="line">iptables -l INPUT 1 -p udp --sport 53 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>permit service<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -l INPUT 1 -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>forbid all others<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -j DROP</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@toad ~]<span class="comment"># netstat -tn</span></span><br><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State</span><br><span class="line">tcp        0      0 192.168.199.231:61094       101.200.31.147:443          TIME_WAIT</span><br><span class="line">tcp        0     64 192.168.199.231:22          60.186.174.98:61241         ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.199.231:41795       192.168.199.1:445           ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.199.231:22          60.186.174.98:50722         ESTABLISHED</span><br><span class="line">tcp        0      0 ::1:19187                   ::1:10010                   TIME_WAIT</span><br><span class="line"></span><br><span class="line">[root@toad ~]<span class="comment"># netstat -tn|grep 192.168.199.231|awk '&#123;print $5&#125;'|awk -F ":" '&#123;print $1&#125;'|sort|uniq -c|sort -r -n</span></span><br><span class="line">      2 60.186.174.98</span><br><span class="line">      2 101.200.31.147</span><br><span class="line">      1 192.168.199.1</span><br><span class="line">[root@toad ~]<span class="comment"># iptables -l INPUT 1 -s 60.186.174.98 -j DROP</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="AIDE入侵检测系统"><a href="#AIDE入侵检测系统" class="headerlink" title="AIDE入侵检测系统"></a>AIDE入侵检测系统</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#install aide</span></span><br><span class="line">yum install -y aide</span><br><span class="line"></span><br><span class="line"><span class="comment">#config aide</span></span><br><span class="line">vim /etc/aide.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#init aide database</span></span><br><span class="line">aide --init</span><br><span class="line">mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#check monitor file</span></span><br><span class="line">aide --check</span><br><span class="line"></span><br><span class="line"><span class="comment">#update aide database</span></span><br><span class="line">aide --update</span><br><span class="line"></span><br><span class="line"><span class="comment">#setup cron job</span></span><br><span class="line">crontab -e</span><br><span class="line">* 3 * * * /usr/sbin/aide --check|mail -s <span class="string">"AIDE report "</span> sizemore@gmail.com</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/linux/">linux</a><a href="/tags/web-security/">web security</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/2/"><span></span>Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="stanosaka" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Devops/" title="Devops">Devops<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/aws/" title="aws">aws<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/centos/" title="centos">centos<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/CD-CI/" title="CD/CI">CD/CI<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tomcat/" title="tomcat">tomcat<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/saltstack/" title="saltstack">saltstack<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/zabbix/" title="zabbix">zabbix<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/backup/" title="backup">backup<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ec2/" title="ec2">ec2<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Pipeline/" title="Pipeline">Pipeline<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/agile/" title="agile">agile<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/software-development/" title="software development">software development<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/agile-development/" title="agile development">agile development<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://zety.com/mycv/00root" target="_blank" title="Stan&#39;s resume">Stan&#39;s resume</a>
            
          </li>
        
          <li>
            
            	<a href="https://cloud.ibm.com/docs/tutorials?topic=solution-tutorials-tutorials" target="_blank" title="IBM cloud solution tutorial">IBM cloud solution tutorial</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/aws-samples" target="_blank" title="AWS Samples">AWS Samples</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/bikrambora/devlab-launchpad" target="_blank" title="Welcome to Dev Labs">Dev Labs</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.python.org/" target="_blank" title="Python doc">Python doc</a>
            
          </li>
        
          <li>
            
            	<a href="http://rogerdudler.github.io/git-guide" target="_blank" title="Git commands">Git commands</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" title="Dockerfile reference">Dockerfile reference</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2mTQr8l" target="_blank" title="Linux Command line cheat sheet">Linux Command line cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2EPHxze" target="_blank" title="PowerShell Basic Cheat Sheet">PowerShell Basic Cheat Sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" title="sed cheatsheet">sed cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://obsavus1p.bkt.clouddn.com/vim_cheat_sheet_for_programmers_print.png" target="_blank" title="vim cheatsheet">vim cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.gitbook.com/book/yeasy/docker_practice/details" target="_blank" title="Learn Docker">Learn Docker</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.unixhot.com/page/ops" target="_blank" title="运维知识体系">运维知识体系</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.tecmint.com/" target="_blank" title="tecmint">tecmint</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.lib.uts.edu.au" target="_blank" title="shoujin.wang@student.uts.edu.au">UTS Library</a>
            
          </li>
        
          <li>
            
            	<a href="https://7esl.com" target="_blank" title="ESL">ESL</a>
            
          </li>
        
          <li>
            
            	<a href="https://stanchou.wordpress.com" target="_blank" title="Stan&#39;s wordpress">Stan&#39;s wordpress</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.00root.com" target="_blank" title="Stan&#39;s gitbook">Stan&#39;s gitbook</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Stan live in Sydney. <br/>
			I am a lifelong technology learner.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/stanosaka" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6724938" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/stanosaka" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/stan.osaka" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/00root" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/btw01v" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/stan-22-82" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:devops@cwzhou.win" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="Stan Zhou">Stan Zhou</a>
		
		
		</p>
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>


        
  	    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
               if (window.mermaid) {
                  mermaid.initialize({theme: 'forest'});
               }
            </script>
        












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
