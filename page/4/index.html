
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Stan Zhou&#39;s Hexo Technical Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stan Zhou">
    

    
    <meta name="description" content="a Site Reliability Engineer working and living in Sydney.">
<meta property="og:type" content="website">
<meta property="og:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:url" content="http://223.95.78.227/page/4/index.html">
<meta property="og:site_name" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:description" content="a Site Reliability Engineer working and living in Sydney.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta name="twitter:description" content="a Site Reliability Engineer working and living in Sydney.">
<meta name="twitter:creator" content="@stanosaka">

    
    <link rel="alternative" href="/atom.xml" title="Stan Zhou&#39;s Hexo Technical Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/toad.ico">
    
    
    <link rel="apple-touch-icon" href="/img/toadman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/toadman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/toadman.png" alt="Stan Zhou&#39;s Hexo Technical Blog" title="Stan Zhou&#39;s Hexo Technical Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Stan Zhou&#39;s Hexo Technical Blog">Stan Zhou&#39;s Hexo Technical Blog</a></h1>
				<h2 class="blog-motto">Innovation Evangelist</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:223.95.78.227">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/06/04/k8s/" title="k8s" itemprop="url">k8s</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-06-04T01:37:00.000Z" itemprop="datePublished"> Published 2019-06-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="K8S"><a href="#K8S" class="headerlink" title="K8S"></a>K8S</h1><p>Big example is google</p>
<p>orchestration (computing)<br>automcatic management of them</p>
<p>manifests system robust </p>
<p>common question why use k8s instead of docker swarm</p>
<p>number 1 ad: docker swarm is built in<br>K8S: far richer, deploy do different cloud platforms<br>K8S is just far more popular<br>is a orchestration of choice.<br>K8S is the most in demand container orchestration system out there.</p>
<p>A Java-based with angular on the front-end.</p>
<h1 id="Terminology"><a href="#Terminology" class="headerlink" title="Terminology"></a>Terminology</h1><ul>
<li>Cluster: A group of physical or virtual machines</li>
<li>Node: Ap hysical or virtual machine that is part of a cluster</li>
<li>Control Plane: The set of processes that run the core k8s services (e.g. APi, scheduler, etcd …)</li>
<li>Pod: The lowest compute unit in Kubernetes, a group of containers that run on a Node.</li>
</ul>
<h1 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h1><p><strong>Head Node</strong><br>That’s the brain of Kubernetes</p>
<ul>
<li>API server</li>
<li>Scheduler: to place the containers where they need to go</li>
<li>Controller manager: makes sure that the state of the system is what it should be</li>
<li>Etcd: data store, used to store the state of the system</li>
<li>Sometimes:<ul>
<li>kubelet: a process manage all of this</li>
<li>docker: container engine<br><strong>Worker node</strong></li>
</ul>
</li>
<li>kubelet<br>That’s the Kubernetes agent that runs on all the Kubernetes cluster nodes. Kubelet talks with the Kubernetes API server and then talks to the local Docker daemon to be able to manage the Docker containers running on the node.</li>
<li>kube-proxy: a system that allos you to manage the IP tables in that node so that the traffic between the pods and the nodes is what it should be</li>
<li>docker<h1 id="Installing-k8s-in-3-easy-ways"><a href="#Installing-k8s-in-3-easy-ways" class="headerlink" title="Installing k8s in 3 easy ways"></a>Installing k8s in 3 easy ways</h1></li>
<li>minikube</li>
<li>gcloud container clusters</li>
<li>kubeadm<h1 id="Installing-Minikube"><a href="#Installing-Minikube" class="headerlink" title="Installing Minikube"></a>Installing Minikube</h1>cut-down version-minikube<br><a href="https://kubernetes.io/docs/tasks/tools/install-minikube/">https://kubernetes.io/docs/tasks/tools/install-minikube/</a></li>
</ul>
<p>You might have an incompatibility between your distribution and the one that Minikube is expecting.<br>two command line tools: kubectl is the controller pogramme for k8s. and Minikube</p>
<p>Enable the Hyper-V role throught settings<br>when enable don’t use oracle virtual box</p>
<p>goo.gl/4yEFbF    for win 10 Professional</p>
<p>minikube start hangs forever on mac #2765</p>
<p>If you’re completely stuck then do ask me</p>
<h1 id="Docker-Overview"><a href="#Docker-Overview" class="headerlink" title="Docker Overview"></a>Docker Overview</h1><p>Difference between Docker Images and Container:<br>A container is an instance of docker images.<br>Docker container is the run time instance of images.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker image pull richardchesterwood/k8s-fleetman-webapp-angular:release0-5</span><br><span class="line">docker image ls</span><br><span class="line">docker container run -p 8080:80 -d richardchesterwood/k8s-fleetman-webapp-angular:release0-5</span><br><span class="line">docker container ls</span><br><span class="line">minikube ip</span><br><span class="line">docker container stop 2c5</span><br><span class="line">docker container rm 2c5</span><br></pre></td></tr></table></figure></p>
<h1 id="Pods"><a href="#Pods" class="headerlink" title="Pods"></a>Pods</h1><p>A pod is a group of one or more containers, with shared storage/network, and a specification for how to run the containers.</p>
<p>basic concept is Pod. A pod and a container are in a one to one relationship.</p>
<h2 id="writing-a-Pod"><a href="#writing-a-Pod" class="headerlink" title="writing a Pod"></a>writing a Pod</h2><p><code>kubectl get all</code> show everything we have defined in our Kubernetes cluster.</p>
<p><code>kubectl apply -f first-pod.yaml</code></p>
<p><code>kubectl describe pod webapp</code></p>
<p><code>kubectl exec webapp ls</code></p>
<p><code>kubectl -it exec webapp sh</code> it means get in interactively with teletype emulation. interactive</p>
<h2 id="Services"><a href="#Services" class="headerlink" title="Services"></a>Services</h2><p>Pods are not visible outside the cluster<br>Pods are designed to be very throw away things. Pods have short lifetimes. Pods regularly die.</p>
<p>Service has stable port, with a service we can connect to kubernetes cluster.</p>
<p>key vaule pairs app with some value.</p>
<p><img src="https://i.imgur.com/Vv0KFxA.png" alt="Services"></p>
<h2 id="NodePort-and-ClusterIP"><a href="#NodePort-and-ClusterIP" class="headerlink" title="NodePort and ClusterIP"></a>NodePort and ClusterIP</h2><p>ClusterIP</p>
<p>NodePort</p>
<h2 id="Pod-selection-with-Labels"><a href="#Pod-selection-with-Labels" class="headerlink" title="Pod selection with Labels"></a>Pod selection with Labels</h2><p><img src="https://i.imgur.com/nEb2kOH.png" alt="Pod secltion with Labels"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cat first-pod.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: webapp</span><br><span class="line">  labels:</span><br><span class="line">    app: webapp</span><br><span class="line">    release: &quot;0&quot;</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: webapp</span><br><span class="line">    image: richardchesterwood/k8s-fleetman-webapp-angular:release0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: webapp-release-0-5</span><br><span class="line">  labels:</span><br><span class="line">    app: webapp</span><br><span class="line">    release: &quot;0-5&quot;</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: webapp</span><br><span class="line">    image: richardchesterwood/k8s-fleetman-webapp-angular:release0-5</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat webapp-service.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: fleetman-webapp</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line"> # This defines which pods are going to be represented by this Service</span><br><span class="line"> # The service becomes a network endpoint for either other services</span><br><span class="line"> #  or maybe external users to connect to (eg browser)</span><br><span class="line"> selector:</span><br><span class="line">   app: webapp</span><br><span class="line">   release: &quot;0-5&quot;</span><br><span class="line"></span><br><span class="line"> ports:</span><br><span class="line">   - name: http</span><br><span class="line">     port: 80</span><br><span class="line">     nodePort: 30080</span><br><span class="line"></span><br><span class="line"> type: NodePort</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f webapp-service.yaml</span><br><span class="line"></span><br><span class="line">kubectl describe svc fleetman-webapp</span><br><span class="line">Name:                     fleetman-webapp</span><br><span class="line">Namespace:                default</span><br><span class="line">Labels:                   &lt;none&gt;</span><br><span class="line">Annotations:              kubectl.kubernetes.io/last-applied-configuration=&#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Service&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;name&quot;:&quot;fleetman-webapp&quot;,&quot;namespace&quot;:&quot;default&quot;&#125;,&quot;spec&quot;:&#123;&quot;ports&quot;:[&#123;&quot;name&quot;:&quot;http&quot;,&quot;nodeP...</span><br><span class="line">Selector:                 app=webapp,release=0</span><br><span class="line">Type:                     NodePort</span><br><span class="line">IP:                       10.108.217.186</span><br><span class="line">Port:                     http  80/TCP</span><br><span class="line">TargetPort:               80/TCP</span><br><span class="line">NodePort:                 http  30080/TCP</span><br><span class="line">Endpoints:                172.17.0.5:80</span><br><span class="line">Session Affinity:         None</span><br><span class="line">External Traffic Policy:  Cluster</span><br><span class="line">Events:                   &lt;none&gt;</span><br><span class="line"></span><br><span class="line">kubectl get po</span><br><span class="line">NAME                 READY     STATUS    RESTARTS   AGE</span><br><span class="line">webapp               1/1       Running   2          2h</span><br><span class="line">webapp-release-0-5   1/1       Running   0          8m</span><br><span class="line"></span><br><span class="line">kubectl get po --show-labels</span><br><span class="line">NAME                 READY     STATUS    RESTARTS   AGE       LABELS</span><br><span class="line">webapp               1/1       Running   2          2h        app=webapp,release=0</span><br><span class="line">webapp-release-0-5   1/1       Running   0          8m        app=webapp,release=0-5</span><br><span class="line"></span><br><span class="line">kubectl get po --show-labels -l release=0</span><br><span class="line">NAME      READY     STATUS    RESTARTS   AGE       LABELS</span><br><span class="line">webapp    1/1       Running   2          2h        app=webapp,release=0</span><br><span class="line"></span><br><span class="line">kubectl get po --show-labels -l release=1</span><br><span class="line">No resources found.</span><br></pre></td></tr></table></figure>
<h1 id="REPLICASETS"><a href="#REPLICASETS" class="headerlink" title="REPLICASETS"></a>REPLICASETS</h1><h2 id="ReplicaSets"><a href="#ReplicaSets" class="headerlink" title="ReplicaSets"></a>ReplicaSets</h2><p><img src="https://i.imgur.com/iUSOtXN.png" alt="ReplicaSets"><br>When Pod die, it will never come back.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get all</span><br><span class="line"></span><br><span class="line">kubectl describe svc fleetman-webapp</span><br><span class="line"></span><br><span class="line">kubectl delete po webapp-release-0-5</span><br></pre></td></tr></table></figure>
<p>ReplicaSets specify how many instances of this pod do we want k8s running on time</p>
<h2 id="Writing-a-ReplicaSet"><a href="#Writing-a-ReplicaSet" class="headerlink" title="Writing a ReplicaSet"></a>Writing a ReplicaSet</h2><p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#replicaset-v1-apps">ReplicaSet v1 apps</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat pods.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: ReplicaSet</span><br><span class="line">metadata:</span><br><span class="line">  name: webapp</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: webapp</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: webapp</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: webapp</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-webapp-angular:release0-5</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: queue</span><br><span class="line">  labels:</span><br><span class="line">    app: queue</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: queue</span><br><span class="line">    image: richardchesterwood/k8s-fleetman-queue:release1</span><br></pre></td></tr></table></figure></p>
<h3 id="Applying-a-ReplicaSet"><a href="#Applying-a-ReplicaSet" class="headerlink" title="Applying a ReplicaSet"></a>Applying a ReplicaSet</h3><p>Delete all the Pods:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete po --all</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f pods.yaml</span><br><span class="line">replicaset.apps &quot;webapp&quot; created</span><br><span class="line">pod &quot;queue&quot; created</span><br><span class="line"></span><br><span class="line">kubectl get all</span><br><span class="line">NAME               READY     STATUS    RESTARTS   AGE</span><br><span class="line">pod/queue          1/1       Running   0          58s</span><br><span class="line">pod/webapp-hzpcp   1/1       Running   0          58s</span><br><span class="line"></span><br><span class="line">NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">service/fleetman-queue    NodePort    10.106.99.143    &lt;none&gt;        8161:30010/TCP   3h</span><br><span class="line">service/fleetman-webapp   NodePort    10.108.217.186   &lt;none&gt;        80:30080/TCP     23h</span><br><span class="line">service/kubernetes        ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          1d</span><br><span class="line"></span><br><span class="line">NAME                     DESIRED   CURRENT   READY     AGE</span><br><span class="line">replicaset.apps/webapp   1         1         1         59s</span><br></pre></td></tr></table></figure>
<p>The difference between current and ready is, current is the number of containers that are running, and ready is the number of containers that are responding to requests.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe rs webapp</span><br><span class="line">Name:         webapp</span><br><span class="line">Namespace:    default</span><br><span class="line">Selector:     app=webapp</span><br><span class="line">Labels:       app=webapp</span><br><span class="line">Annotations:  kubectl.kubernetes.io/last-applied-configuration=&#123;&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;ReplicaSet&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;name&quot;:&quot;webapp&quot;,&quot;namespace&quot;:&quot;default&quot;&#125;,&quot;spec&quot;:&#123;&quot;replicas&quot;:1,&quot;selector&quot;:&#123;&quot;match...</span><br><span class="line">Replicas:     1 current / 1 desired</span><br><span class="line">Pods Status:  1 Running / 0 Waiting / 0 Succeeded / 0 Failed</span><br><span class="line">Pod Template:</span><br><span class="line">  Labels:  app=webapp</span><br><span class="line">  Containers:</span><br><span class="line">   webapp:</span><br><span class="line">    Image:        richardchesterwood/k8s-fleetman-webapp-angular:release0-5</span><br><span class="line">    Port:         &lt;none&gt;</span><br><span class="line">    Host Port:    &lt;none&gt;</span><br><span class="line">    Environment:  &lt;none&gt;</span><br><span class="line">    Mounts:       &lt;none&gt;</span><br><span class="line">  Volumes:        &lt;none&gt;</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason            Age   From                   Message</span><br><span class="line">  ----    ------            ----  ----                   -------</span><br><span class="line">  Normal  SuccessfulCreate  4m    replicaset-controller  Created pod: webapp-hzpcp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">kubectl get all</span><br><span class="line">NAME               READY     STATUS    RESTARTS   AGE</span><br><span class="line">pod/queue          1/1       Running   0          5m</span><br><span class="line">pod/webapp-hzpcp   1/1       Running   0          5m</span><br><span class="line"></span><br><span class="line">NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">service/fleetman-queue    NodePort    10.106.99.143    &lt;none&gt;        8161:30010/TCP   3h</span><br><span class="line">service/fleetman-webapp   NodePort    10.108.217.186   &lt;none&gt;        80:30080/TCP     23h</span><br><span class="line">service/kubernetes        ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          1d</span><br><span class="line"></span><br><span class="line">NAME                     DESIRED   CURRENT   READY     AGE</span><br><span class="line">replicaset.apps/webapp   1         1         1         5m</span><br><span class="line"></span><br><span class="line">kubectl delete po webapp-hzpcp</span><br><span class="line">pod &quot;webapp-hzpcp&quot; deleted</span><br><span class="line"></span><br><span class="line">kubectl get all</span><br><span class="line">NAME               READY     STATUS        RESTARTS   AGE</span><br><span class="line">pod/queue          1/1       Running       0          7m</span><br><span class="line">pod/webapp-hff5l   1/1       Running       0          3s</span><br><span class="line">pod/webapp-hzpcp   0/1       Terminating   0          7m</span><br><span class="line"></span><br><span class="line">NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">service/fleetman-queue    NodePort    10.106.99.143    &lt;none&gt;        8161:30010/TCP   3h</span><br><span class="line">service/fleetman-webapp   NodePort    10.108.217.186   &lt;none&gt;        80:30080/TCP     23h</span><br><span class="line">service/kubernetes        ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          1d</span><br><span class="line"></span><br><span class="line">NAME                     DESIRED   CURRENT   READY     AGE</span><br><span class="line">replicaset.apps/webapp   1         1         1         7m</span><br></pre></td></tr></table></figure>
<h1 id="Deployments"><a href="#Deployments" class="headerlink" title="Deployments"></a>Deployments</h1><p>It’s a replica set with one additional feature. With a deployment, we get automatic rolling updates with zero downtime.</p>
<p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#deployment-v1-apps">Deployment API reference guide</a></p>
<p>A deployment as being an entity in Kubernetes that manages the replica set for you.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">cat pods.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: webapp</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: webapp</span><br><span class="line">  replicas: 2</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: webapp</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: webapp</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-webapp-angular:release0</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: queue</span><br><span class="line">  labels:</span><br><span class="line">    app: queue</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: queue</span><br><span class="line">    image: richardchesterwood/k8s-fleetman-queue:release1</span><br><span class="line"></span><br><span class="line">kubectl apply -f pods.yaml</span><br><span class="line">deployment.apps &quot;webapp&quot; created</span><br><span class="line">pod &quot;queue&quot; unchanged</span><br><span class="line"></span><br><span class="line">kubectl get all</span><br><span class="line">NAME                          READY     STATUS    RESTARTS   AGE</span><br><span class="line">pod/queue                     1/1       Running   0          24m</span><br><span class="line">pod/webapp-7469fb7fd6-4mcth   1/1       Running   0          12s</span><br><span class="line">pod/webapp-7469fb7fd6-sv4rw   1/1       Running   0          12s</span><br><span class="line"></span><br><span class="line">NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">service/fleetman-queue    NodePort    10.106.99.143    &lt;none&gt;        8161:30010/TCP   3h</span><br><span class="line">service/fleetman-webapp   NodePort    10.108.217.186   &lt;none&gt;        80:30080/TCP     23h</span><br><span class="line">service/kubernetes        ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          1d</span><br><span class="line"></span><br><span class="line">NAME                     DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/webapp   2         2         2            2           12s</span><br><span class="line"></span><br><span class="line">NAME                                DESIRED   CURRENT   READY     AGE</span><br><span class="line">replicaset.apps/webapp-7469fb7fd6   2         2         2         12s</span><br></pre></td></tr></table></figure>
<h2 id="Managing-Rollouts"><a href="#Managing-Rollouts" class="headerlink" title="Managing Rollouts"></a>Managing Rollouts</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout status deploy webapp</span><br><span class="line">deployment &quot;webapp&quot; successfully rolled out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl rollout status deploy webapp</span><br><span class="line">Waiting for rollout to finish: 1 out of 2 new replicas have been updated...</span><br><span class="line">Waiting for rollout to finish: 1 out of 2 new replicas have been updated...</span><br><span class="line">Waiting for rollout to finish: 2 old replicas are pending termination...</span><br><span class="line">Waiting for rollout to finish: 1 old replicas are pending termination...</span><br><span class="line">Waiting for rollout to finish: 1 old replicas are pending termination...</span><br><span class="line">Waiting for rollout to finish: 1 old replicas are pending termination...</span><br><span class="line">deployment &quot;webapp&quot; successfully rolled out</span><br><span class="line"></span><br><span class="line">kubectl rollout history deploy webapp</span><br><span class="line">deployments &quot;webapp&quot;</span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">2         &lt;none&gt;</span><br><span class="line">3         &lt;none&gt;</span><br><span class="line"></span><br><span class="line"># Default command automatically go back to one version</span><br><span class="line"></span><br><span class="line">kubectl rollout undo deploy</span><br></pre></td></tr></table></figure>
<p>It’s really only for use in an emergency.</p>
<h1 id="Networking-and-service-discovery"><a href="#Networking-and-service-discovery" class="headerlink" title="Networking and service discovery"></a>Networking and service discovery</h1><h2 id="Networking-Overview"><a href="#Networking-Overview" class="headerlink" title="Networking Overview"></a>Networking Overview</h2><p><img src="https://i.imgur.com/G9GkqlS.png" alt="Networking Overview"></p>
<h2 id="Namespace-kube-system"><a href="#Namespace-kube-system" class="headerlink" title="Namespace-kube-system"></a>Namespace-kube-system</h2><p>A namespace is a way of partitioning your resources in Kubernetes into separate areas.</p>
<p><img src="https://i.imgur.com/9FRKlUT.png" alt="namespace"> </p>
<p><img src="https://i.imgur.com/9QF8vkE.png" alt="namespace"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">kubectl get ns</span><br><span class="line">NAME          STATUS    AGE</span><br><span class="line">default       Active    1d</span><br><span class="line">kube-public   Active    1d</span><br><span class="line">kube-system   Active    1d</span><br><span class="line"></span><br><span class="line">kubectl get po</span><br><span class="line">NAME                      READY     STATUS    RESTARTS   AGE</span><br><span class="line">queue                     1/1       Running   0          3h</span><br><span class="line">webapp-7469fb7fd6-sg87f   1/1       Running   0          1h</span><br><span class="line">webapp-7469fb7fd6-znbxx   1/1       Running   0          1h</span><br><span class="line"></span><br><span class="line">kubectl get po -n kube-system</span><br><span class="line">NAME                                    READY     STATUS    RESTARTS   AGE</span><br><span class="line">coredns-576cbf47c7-kwq7n                1/1       Running   0          1d</span><br><span class="line">coredns-576cbf47c7-vt56b                1/1       Running   0          1d</span><br><span class="line">etcd-minikube                           1/1       Running   0          1d</span><br><span class="line">kube-addon-manager-minikube             1/1       Running   0          1d</span><br><span class="line">kube-apiserver-minikube                 1/1       Running   0          1d</span><br><span class="line">kube-controller-manager-minikube        1/1       Running   0          1d</span><br><span class="line">kube-proxy-cn982                        1/1       Running   0          1d</span><br><span class="line">kube-scheduler-minikube                 1/1       Running   0          1d</span><br><span class="line">kubernetes-dashboard-5bff5f8fb8-mqz9z   1/1       Running   0          1d</span><br><span class="line">storage-provisioner                     1/1       Running   0          1d</span><br><span class="line"></span><br><span class="line">kubectl get all -n kube-system</span><br><span class="line">NAME                                        READY     STATUS    RESTARTS   AGE</span><br><span class="line">pod/coredns-576cbf47c7-kwq7n                1/1       Running   0          1d</span><br><span class="line">pod/coredns-576cbf47c7-vt56b                1/1       Running   0          1d</span><br><span class="line">pod/etcd-minikube                           1/1       Running   0          1d</span><br><span class="line">pod/kube-addon-manager-minikube             1/1       Running   0          1d</span><br><span class="line">pod/kube-apiserver-minikube                 1/1       Running   0          1d</span><br><span class="line">pod/kube-controller-manager-minikube        1/1       Running   0          1d</span><br><span class="line">pod/kube-proxy-cn982                        1/1       Running   0          1d</span><br><span class="line">pod/kube-scheduler-minikube                 1/1       Running   0          1d</span><br><span class="line">pod/kubernetes-dashboard-5bff5f8fb8-mqz9z   1/1       Running   0          1d</span><br><span class="line">pod/storage-provisioner                     1/1       Running   0          1d</span><br><span class="line"></span><br><span class="line">NAME                           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)         AGE</span><br><span class="line">service/kube-dns               ClusterIP   10.96.0.10     &lt;none&gt;        53/UDP,53/TCP   1d</span><br><span class="line">service/kubernetes-dashboard   ClusterIP   10.102.124.0   &lt;none&gt;        80/TCP          1d</span><br><span class="line"></span><br><span class="line">NAME                        DESIRED   CURRENT   READY     UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span><br><span class="line">daemonset.apps/kube-proxy   1         1         1         1            1           &lt;none&gt;          1d</span><br><span class="line"></span><br><span class="line">NAME                                   DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/coredns                2         2         2            2           1d</span><br><span class="line">deployment.apps/kubernetes-dashboard   1         1         1            1           1d</span><br><span class="line"></span><br><span class="line">NAME                                              DESIRED   CURRENT   READY     AGE</span><br><span class="line">replicaset.apps/coredns-576cbf47c7                2         2         2         1d</span><br><span class="line">replicaset.apps/kubernetes-dashboard-5bff5f8fb8   1         1         1         1d</span><br><span class="line"></span><br><span class="line">kubectl describe svc kube-dns -n kube-system</span><br><span class="line">Name:              kube-dns</span><br><span class="line">Namespace:         kube-system</span><br><span class="line">Labels:            k8s-app=kube-dns</span><br><span class="line">                   kubernetes.io/cluster-service=true</span><br><span class="line">                   kubernetes.io/name=KubeDNS</span><br><span class="line">Annotations:       prometheus.io/port=9153</span><br><span class="line">                   prometheus.io/scrape=true</span><br><span class="line">Selector:          k8s-app=kube-dns</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                10.96.0.10</span><br><span class="line">Port:              dns  53/UDP</span><br><span class="line">TargetPort:        53/UDP</span><br><span class="line">Endpoints:         172.17.0.2:53,172.17.0.3:53</span><br><span class="line">Port:              dns-tcp  53/TCP</span><br><span class="line">TargetPort:        53/TCP</span><br><span class="line">Endpoints:         172.17.0.2:53,172.17.0.3:53</span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Accessing-MySQL-from-a-Pod"><a href="#Accessing-MySQL-from-a-Pod" class="headerlink" title="Accessing MySQL from a Pod"></a>Accessing MySQL from a Pod</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">cat networking-tests.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql</span><br><span class="line">  labels:</span><br><span class="line">     app: mysql</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">   - name: mysql</span><br><span class="line">     image: mysql:5</span><br><span class="line">     env:</span><br><span class="line">      # Use secret in real life</span><br><span class="line">      - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">        value: password</span><br><span class="line">      - name: MYSQL_DATABASE</span><br><span class="line">        value: fleetman</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: database</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">     app: mysql</span><br><span class="line">  ports:</span><br><span class="line">  - port: 3306</span><br><span class="line">  type: ClusterIP</span><br><span class="line"></span><br><span class="line">kga</span><br><span class="line">NAME                          READY     STATUS    RESTARTS   AGE</span><br><span class="line">pod/mysql                     1/1       Running   0          3m</span><br><span class="line">pod/queue                     1/1       Running   0          18h</span><br><span class="line">pod/webapp-7469fb7fd6-sg87f   1/1       Running   0          17h</span><br><span class="line">pod/webapp-7469fb7fd6-znbxx   1/1       Running   0          17h</span><br><span class="line"></span><br><span class="line">NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">service/database          ClusterIP   10.101.3.159     &lt;none&gt;        3306/TCP         3m</span><br><span class="line">service/fleetman-queue    NodePort    10.106.99.143    &lt;none&gt;        8161:30010/TCP   21h</span><br><span class="line">service/fleetman-webapp   NodePort    10.108.217.186   &lt;none&gt;        80:30080/TCP     1d</span><br><span class="line">service/kubernetes        ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          1d</span><br><span class="line"></span><br><span class="line">NAME                     DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/webapp   2         2         2            2           17h</span><br><span class="line"></span><br><span class="line">NAME                                DESIRED   CURRENT   READY     AGE</span><br><span class="line">replicaset.apps/webapp-7469fb7fd6   2         2         2         17h</span><br><span class="line">replicaset.apps/webapp-74bd9697b4   0         0         0         17h</span><br><span class="line">replicaset.apps/webapp-8f948b66c    0         0         0         17h</span><br><span class="line"></span><br><span class="line">kubectl exec -it webapp-7469fb7fd6-sg87f sh</span><br><span class="line">/ # ls</span><br><span class="line">bin    etc    lib    mnt    root   sbin   sys    usr</span><br><span class="line">dev    home   media  proc   run    srv    tmp    var</span><br></pre></td></tr></table></figure>
<h2 id="Service-Discovery"><a href="#Service-Discovery" class="headerlink" title="Service Discovery"></a>Service Discovery</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">/ # cat /etc/resolv.conf</span><br><span class="line">nameserver 10.96.0.10</span><br><span class="line">search default.svc.cluster.local svc.cluster.local cluster.local</span><br><span class="line">options ndots:5</span><br><span class="line"></span><br><span class="line">/ # nslookup database</span><br><span class="line">nslookup: can&apos;t resolve &apos;(null)&apos;: Name does not resolve</span><br><span class="line"></span><br><span class="line">Name:      database</span><br><span class="line">Address 1: 10.101.3.159 database.default.svc.cluster.local</span><br><span class="line"></span><br><span class="line">kubectl exec -it webapp-7469fb7fd6-sg87f sh</span><br><span class="line">/ # mysql</span><br><span class="line">sh: mysql: not found</span><br><span class="line">/ # apk update</span><br><span class="line">fetch http://dl-cdn.alpinelinux.org/alpine/v3.7/main/x86_64/APKINDEX.tar.gz</span><br><span class="line">fetch http://dl-cdn.alpinelinux.org/alpine/v3.7/community/x86_64/APKINDEX.tar.gz</span><br><span class="line">v3.7.3-61-gd3d301001c [http://dl-cdn.alpinelinux.org/alpine/v3.7/main]</span><br><span class="line">v3.7.3-51-gf95d10fed7 [http://dl-cdn.alpinelinux.org/alpine/v3.7/community]</span><br><span class="line">OK: 9067 distinct packages available</span><br><span class="line">/ # apk add mysql-client</span><br><span class="line">(1/6) Installing mariadb-common (10.1.38-r1)</span><br><span class="line">(2/6) Installing ncurses-terminfo-base (6.0_p20171125-r1)</span><br><span class="line">(3/6) Installing ncurses-terminfo (6.0_p20171125-r1)</span><br><span class="line">(4/6) Installing ncurses-libs (6.0_p20171125-r1)</span><br><span class="line">(5/6) Installing mariadb-client (10.1.38-r1)</span><br><span class="line">(6/6) Installing mysql-client (10.1.38-r1)</span><br><span class="line">Executing busybox-1.27.2-r7.trigger</span><br><span class="line">OK: 53 MiB in 34 packages</span><br><span class="line"></span><br><span class="line"># mysql -h database -uroot -ppassword fleetman</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.26 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MySQL [fleetman]&gt; create table testable (test varchar(255));</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">MySQL [fleetman]&gt; show tables;</span><br><span class="line">+--------------------+</span><br><span class="line">| Tables_in_fleetman |</span><br><span class="line">+--------------------+</span><br><span class="line">| testable           |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>Can find the ip address of any service that we like just by its name. And that’s called service discovery.</p>
<h2 id="Fully-Qualified-Domain-Names-FQDN"><a href="#Fully-Qualified-Domain-Names-FQDN" class="headerlink" title="Fully Qualified Domain Names (FQDN)"></a>Fully Qualified Domain Names (FQDN)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># nslookup database</span><br><span class="line">nslookup: can&apos;t resolve &apos;(null)&apos;: Name does not resolve</span><br><span class="line"></span><br><span class="line">Name:      database</span><br><span class="line">Address 1: 10.101.3.159 database.default.svc.cluster.local</span><br></pre></td></tr></table></figure>
<h2 id="An-introduction-to-Microservices"><a href="#An-introduction-to-Microservices" class="headerlink" title="An introduction to Microservices"></a>An introduction to Microservices</h2><p>Each microservice should be  Highly Cohesive and Lossely Coupled.</p>
<p>highly cohesive: each microservice should handlng one business requirement. Cohesive means that a microservice should have a single set of reponsibilities.</p>
<p>Each microservice will maintain its own data store. And that microservice will be really the only poart of the system that can read or write that data.</p>
<h2 id="Fleetman-Microservices-setting-the-scene"><a href="#Fleetman-Microservices-setting-the-scene" class="headerlink" title="Fleetman Microservices- setting the scene"></a>Fleetman Microservices- setting the scene</h2><p><img src="https://i.imgur.com/fkwUIA0.png" alt="scene"><br>The logic in the API gateway is typically some kind of a mapping. So it would be something like if the incoming request ends with /vehicles, then delegate the call to,<br>in this case, the position tracker.</p>
<p><a href="https://microservices.io/patterns/apigateway.html">API gateway pattern</a></p>
<h2 id="Deploying-the-Queue"><a href="#Deploying-the-Queue" class="headerlink" title="Deploying the Queue"></a>Deploying the Queue</h2><p><img src="https://i.imgur.com/fkwUIA0.png" alt="scene"></p>
<p>API gateway: a web front end which is implemented in Java script</p>
<p>Position tracker: back end, calcuating the speeds of vehicles and storing the positions of all the vehicles.</p>
<p>Queue: which is going to store the messages that are received from the vehicles as they move around the country.</p>
<p>Positon simulator: a testing microservice which is going to generate some positions of vehicles.</p>
<p>Delete all the Pods:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f .</span><br><span class="line">pod &quot;mysql&quot; deleted</span><br><span class="line">service &quot;database&quot; deleted</span><br><span class="line">deployment.apps &quot;webapp&quot; deleted</span><br><span class="line">pod &quot;queue&quot; deleted</span><br><span class="line">service &quot;fleetman-webapp&quot; deleted</span><br><span class="line">service &quot;fleetman-queue&quot; deleted</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f workloads.yaml</span><br><span class="line">kubectl describe pod queue-6bf9fd876-4xrqx</span><br><span class="line">Name:               queue-6bf9fd876-4xrqx</span><br><span class="line">Namespace:          default</span><br><span class="line">Priority:           0</span><br><span class="line">PriorityClassName:  &lt;none&gt;</span><br><span class="line">Node:               minikube/10.0.2.15</span><br><span class="line">Start Time:         Wed, 05 Jun 2019 15:14:40 +1000</span><br><span class="line">Labels:             app=queue</span><br><span class="line">                    pod-template-hash=6bf9fd876</span><br><span class="line">Annotations:        &lt;none&gt;</span><br><span class="line">Status:             Running</span><br><span class="line">IP:                 172.17.0.5</span><br><span class="line">Controlled By:      ReplicaSet/queue-6bf9fd876</span><br><span class="line">Containers:</span><br><span class="line">  webapp:</span><br><span class="line">    Container ID:   docker://f306dda43b8bf2eaab70449ecac022bb0b98e37b8b2be0d1b2e1b25eea9db1ac</span><br><span class="line">    Image:          richardchesterwood/k8s-fleetman-queue:release1</span><br><span class="line">    Image ID:       docker-pullable://richardchesterwood/k8s-fleetman-queue@sha256:bc2cb90a09aecdd8bce5d5f3a8dac17281ec7883077ddcfb8b7acfe2ab3b6afa</span><br><span class="line">    Port:           &lt;none&gt;</span><br><span class="line">    Host Port:      &lt;none&gt;</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Wed, 05 Jun 2019 15:14:41 +1000</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:    &lt;none&gt;</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-nmqkz (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             True</span><br><span class="line">  ContainersReady   True</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  default-token-nmqkz:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-nmqkz</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  2m    default-scheduler  Successfully assigned default/queue-6bf9fd876-4xrqx to minikube</span><br><span class="line">  Normal  Pulled     2m    kubelet, minikube  Container image &quot;richardchesterwood/k8s-fleetman-queue:release1&quot; already present on machine</span><br><span class="line">  Normal  Created    2m    kubelet, minikube  Created container</span><br><span class="line">  Normal  Started    2m    kubelet, minikube  Started container</span><br><span class="line"></span><br><span class="line">kubectl apply -f services.yaml</span><br><span class="line">service &quot;fleetman-webapp&quot; created</span><br><span class="line">service &quot;fleetman-queue&quot; created</span><br><span class="line"></span><br><span class="line">kubectl apply -f services.yaml</span><br><span class="line">service &quot;fleetman-webapp&quot; created</span><br><span class="line">service &quot;fleetman-queue&quot; created</span><br><span class="line"></span><br><span class="line">minikube ip</span><br><span class="line">There is a newer version of minikube available (v1.1.0).  Download it here:</span><br><span class="line">https://github.com/kubernetes/minikube/releases/tag/v1.1.0</span><br><span class="line"></span><br><span class="line">To disable this notification, run the following:</span><br><span class="line">minikube config set WantUpdateNotification false</span><br><span class="line">192.168.99.118</span><br></pre></td></tr></table></figure>
<p>Open a web browser <a href="http://192.168.99.118:30010">http://192.168.99.118:30010</a>, click <strong>Manage ActiveMQ broker</strong>, enter username and password both admin.</p>
<h2 id="Deploying-the-Position-Simulator"><a href="#Deploying-the-Position-Simulator" class="headerlink" title="Deploying the Position Simulator"></a>Deploying the Position Simulator</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">cat workloads.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: queue</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: queue</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: queue</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: webapp</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-queue:release1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: position-simulator</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: position-simulator</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: position-simulator</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: webapp</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-position-simulator:release1</span><br><span class="line">        env:</span><br><span class="line">        - name: SPRING_PROFILES_ACTIVE</span><br><span class="line">          value: producadskfjsjfsislfslsj</span><br><span class="line"></span><br><span class="line">kubectl apply -f workloads.yaml</span><br><span class="line">deployment.apps &quot;queue&quot; unchanged</span><br><span class="line">deployment.apps &quot;position-simulator&quot; configured</span><br><span class="line"></span><br><span class="line">kga</span><br><span class="line">NAME                                      READY     STATUS              RESTARTS   AGE</span><br><span class="line">pod/position-simulator-6f97fd485f-gplr8   0/1       ContainerCreating   0          7s</span><br><span class="line">pod/position-simulator-dff7b7599-2vbdd    0/1       ImagePullBackOff    0          2m</span><br><span class="line">pod/queue-6bf9fd876-4xrqx                 1/1       Running             0          50m</span><br><span class="line"></span><br><span class="line">NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                          AGE</span><br><span class="line">service/fleetman-queue    NodePort    10.110.95.121    &lt;none&gt;        8161:30010/TCP,61616:30536/TCP   47m</span><br><span class="line">service/fleetman-webapp   NodePort    10.103.224.156   &lt;none&gt;        80:30080/TCP                     47m</span><br><span class="line">service/kubernetes        ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP                          2d</span><br><span class="line"></span><br><span class="line">NAME                                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/position-simulator   1         2         1            0           2m</span><br><span class="line">deployment.apps/queue                1         1         1            1           50m</span><br><span class="line"></span><br><span class="line">NAME                                            DESIRED   CURRENT   READY     AGE</span><br><span class="line">replicaset.apps/position-simulator-6f97fd485f   1         1         0         7s</span><br><span class="line">replicaset.apps/position-simulator-dff7b7599    1         1         0         2m</span><br><span class="line">replicaset.apps/queue-6bf9fd876                 1         1         1         50m</span><br><span class="line"></span><br><span class="line">kubectl describe pod position-simulator-6f97fd485f-gplr8</span><br><span class="line">Name:               position-simulator-6f97fd485f-gplr8</span><br><span class="line">Namespace:          default</span><br><span class="line">Priority:           0</span><br><span class="line">PriorityClassName:  &lt;none&gt;</span><br><span class="line">Node:               minikube/10.0.2.15</span><br><span class="line">Start Time:         Wed, 05 Jun 2019 16:05:27 +1000</span><br><span class="line">Labels:             app=position-simulator</span><br><span class="line">                    pod-template-hash=6f97fd485f</span><br><span class="line">Annotations:        &lt;none&gt;</span><br><span class="line">Status:             Running</span><br><span class="line">IP:                 172.17.0.7</span><br><span class="line">Controlled By:      ReplicaSet/position-simulator-6f97fd485f</span><br><span class="line">Containers:</span><br><span class="line">  webapp:</span><br><span class="line">    Container ID:   docker://2a4f677af3a8bd72f674543e13a4b84c3c86148791106a19270d86878091b09d</span><br><span class="line">    Image:          richardchesterwood/k8s-fleetman-position-simulator:release1</span><br><span class="line">    Image ID:       docker-pullable://richardchesterwood/k8s-fleetman-position-simulator@sha256:58ce4aa156469115a58be0bcfcec84bb7e42dd4552f83dcf5b6381234001108b</span><br><span class="line">    Port:           &lt;none&gt;</span><br><span class="line">    Host Port:      &lt;none&gt;</span><br><span class="line">    State:          Terminated</span><br><span class="line">      Reason:       Error</span><br><span class="line">      Exit Code:    1</span><br><span class="line">      Started:      Wed, 05 Jun 2019 16:05:56 +1000</span><br><span class="line">      Finished:     Wed, 05 Jun 2019 16:05:59 +1000</span><br><span class="line">    Ready:          False</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:</span><br><span class="line">      SPRING_PROFILES_ACTIVE:  producadskfjsjfsislfslsj</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-nmqkz (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             False</span><br><span class="line">  ContainersReady   False</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  default-token-nmqkz:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-nmqkz</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age              From               Message</span><br><span class="line">  ----    ------     ----             ----               -------</span><br><span class="line">  Normal  Scheduled  33s              default-scheduler  Successfully assigned default/position-simulator-6f97fd485f-gplr8 to minikube</span><br><span class="line">  Normal  Pulling    32s              kubelet, minikube  pulling image &quot;richardchesterwood/k8s-fleetman-position-simulator:release1&quot;</span><br><span class="line">  Normal  Pulled     4s               kubelet, minikube  Successfully pulled image &quot;richardchesterwood/k8s-fleetman-position-simulator:release1&quot;</span><br><span class="line">  Normal  Created    0s (x2 over 4s)  kubelet, minikube  Created container</span><br><span class="line">  Normal  Started    0s (x2 over 4s)  kubelet, minikube  Started container</span><br><span class="line">  Normal  Pulled     0s               kubelet, minikube  Container image &quot;richardchesterwood/k8s-fleetman-position-simulator:release1&quot; already present on machine</span><br></pre></td></tr></table></figure>
<h3 id="inspecting-Pod-Logs"><a href="#inspecting-Pod-Logs" class="headerlink" title="inspecting Pod Logs"></a>inspecting Pod Logs</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs position-simulator-6f97fd485f-gplr8</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&apos;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &apos;_ | &apos;_| | &apos;_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &apos;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"> :: Spring Boot ::        (v1.4.0.RELEASE)</span><br><span class="line"></span><br><span class="line">2019-06-05 06:09:06.044  INFO 1 --- [           main] c.v.s.PositionsimulatorApplication       : Starting PositionsimulatorApplication v0.0.1-SNAPSHOT on position-simulator-6f97fd485f-gplr8 with PID 1 (/webapp.jar started by root in /)</span><br><span class="line">2019-06-05 06:09:06.056  INFO 1 --- [           main] c.v.s.PositionsimulatorApplication       : The following profiles are active: producadskfjsjfsislfslsj</span><br><span class="line">2019-06-05 06:09:06.151  INFO 1 --- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@5f4da5c3: startup date [Wed Jun 05 06:09:06 UTC 2019]; root of context hierarchy</span><br><span class="line">2019-06-05 06:09:07.265  WARN 1 --- [           main] s.c.a.AnnotationConfigApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;journeySimulator&apos;: Injection of autowired dependencies failed; nested exception is java.lang.IllegalArgumentException: Could not resolve placeholder &apos;fleetman.position.queue&apos; in string value &quot;$&#123;fleetman.position.queue&#125;&quot;</span><br><span class="line">2019-06-05 06:09:07.273  INFO 1 --- [           main] utoConfigurationReportLoggingInitializer :</span><br><span class="line"></span><br><span class="line">Error starting ApplicationContext. To display the auto-configuration report enable debug logging (start with --debug)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2019-06-05 06:09:07.286 ERROR 1 --- [           main] o.s.boot.SpringApplication               : Application startup failed</span><br><span class="line"></span><br><span class="line">org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;journeySimulator&apos;: Injection of autowired dependencies failed; nested exception is java.lang.IllegalArgumentException: Could not resolve placeholder &apos;fleetman.position.queue&apos; in string value &quot;$&#123;fleetman.position.queue&#125;&quot;</span><br><span class="line">	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessPropertyValues(AutowiredAnnotationBeanPostProcessor.java:355) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1214) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:543) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:482) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:776) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:861) ~[spring-context-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:541) ~[spring-context-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:759) [spring-boot-1.4.0.RELEASE.jar!/:1.4.0.RELEASE]</span><br><span class="line">	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:369) [spring-boot-1.4.0.RELEASE.jar!/:1.4.0.RELEASE]</span><br><span class="line">	at org.springframework.boot.SpringApplication.run(SpringApplication.java:313) [spring-boot-1.4.0.RELEASE.jar!/:1.4.0.RELEASE]</span><br><span class="line">	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1185) [spring-boot-1.4.0.RELEASE.jar!/:1.4.0.RELEASE]</span><br><span class="line">	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1174) [spring-boot-1.4.0.RELEASE.jar!/:1.4.0.RELEASE]</span><br><span class="line">	at com.virtualpairprogrammers.simulator.PositionsimulatorApplication.main(PositionsimulatorApplication.java:28) [classes!/:0.0.1-SNAPSHOT]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_131]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_131]</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_131]</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_131]</span><br><span class="line">	at org.springframework.boot.loader.MainMethodRunner.run(MainMethodRunner.java:48) [webapp.jar:0.0.1-SNAPSHOT]</span><br><span class="line">	at org.springframework.boot.loader.Launcher.launch(Launcher.java:87) [webapp.jar:0.0.1-SNAPSHOT]</span><br><span class="line">	at org.springframework.boot.loader.Launcher.launch(Launcher.java:50) [webapp.jar:0.0.1-SNAPSHOT]</span><br><span class="line">	at org.springframework.boot.loader.JarLauncher.main(JarLauncher.java:58) [webapp.jar:0.0.1-SNAPSHOT]</span><br><span class="line">Caused by: java.lang.IllegalArgumentException: Could not resolve placeholder &apos;fleetman.position.queue&apos; in string value &quot;$&#123;fleetman.position.queue&#125;&quot;</span><br><span class="line">	at org.springframework.util.PropertyPlaceholderHelper.parseStringValue(PropertyPlaceholderHelper.java:174) ~[spring-core-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.util.PropertyPlaceholderHelper.replacePlaceholders(PropertyPlaceholderHelper.java:126) ~[spring-core-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.core.env.AbstractPropertyResolver.doResolvePlaceholders(AbstractPropertyResolver.java:219) ~[spring-core-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.core.env.AbstractPropertyResolver.resolveRequiredPlaceholders(AbstractPropertyResolver.java:193) ~[spring-core-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.context.support.PropertySourcesPlaceholderConfigurer$2.resolveStringValue(PropertySourcesPlaceholderConfigurer.java:172) ~[spring-context-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractBeanFactory.resolveEmbeddedValue(AbstractBeanFactory.java:813) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1039) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1019) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:566) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:88) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessPropertyValues(AutowiredAnnotationBeanPostProcessor.java:349) ~[spring-beans-4.3.2.RELEASE.jar!/:4.3.2.RELEASE]</span><br><span class="line">	... 24 common frames omitted</span><br></pre></td></tr></table></figure>
<p><code>kubectl logs -f position-simulator-6f97fd485f-gplr8</code> follow the log</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">cat workloads.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: queue</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: queue</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: queue</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: webapp</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-queue:release1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: position-simulator</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: position-simulator</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: position-simulator</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: webapp</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-position-simulator:release1</span><br><span class="line">        env:</span><br><span class="line">        - name: SPRING_PROFILES_ACTIVE</span><br><span class="line">          value: production-microservice</span><br><span class="line"></span><br><span class="line">kubectl apply -f workloads.yaml</span><br><span class="line">deployment.apps &quot;queue&quot; unchanged</span><br><span class="line">deployment.apps &quot;position-simulator&quot; configured</span><br><span class="line"></span><br><span class="line">kga</span><br><span class="line">NAME                                      READY     STATUS        RESTARTS   AGE</span><br><span class="line">pod/position-simulator-6d8769d8-ghtmw     1/1       Running       0          9s</span><br><span class="line">pod/position-simulator-6f97fd485f-gplr8   0/1       Terminating   6          8m</span><br><span class="line">pod/queue-6bf9fd876-4xrqx                 1/1       Running       0          59m</span><br><span class="line"></span><br><span class="line">NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                          AGE</span><br><span class="line">service/fleetman-queue    NodePort    10.110.95.121    &lt;none&gt;        8161:30010/TCP,61616:30536/TCP   55m</span><br><span class="line">service/fleetman-webapp   NodePort    10.103.224.156   &lt;none&gt;        80:30080/TCP                     55m</span><br><span class="line">service/kubernetes        ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP                          2d</span><br><span class="line"></span><br><span class="line">NAME                                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/position-simulator   1         1         1            1           10m</span><br><span class="line">deployment.apps/queue                1         1         1            1           59m</span><br><span class="line"></span><br><span class="line">NAME                                            DESIRED   CURRENT   READY     AGE</span><br><span class="line">replicaset.apps/position-simulator-6d8769d8     1         1         1         9s</span><br><span class="line">replicaset.apps/position-simulator-6f97fd485f   0         0         0         8m</span><br><span class="line">replicaset.apps/position-simulator-dff7b7599    0         0         0         10m</span><br><span class="line">replicaset.apps/queue-6bf9fd876                 1         1         1         59m</span><br><span class="line"></span><br><span class="line">kubectl logs -f position-simulator-6d8769d8-ghtmw</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&apos;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &apos;_ | &apos;_| | &apos;_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &apos;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"> :: Spring Boot ::        (v1.4.0.RELEASE)</span><br><span class="line"></span><br><span class="line">2019-06-05 06:13:36.205  INFO 1 --- [           main] c.v.s.PositionsimulatorApplication       : Starting PositionsimulatorApplication v0.0.1-SNAPSHOT on position-simulator-6d8769d8-ghtmw with PID 1 (/webapp.jar started by root in /)</span><br><span class="line">2019-06-05 06:13:36.213  INFO 1 --- [           main] c.v.s.PositionsimulatorApplication       : The following profiles are active: production-microservice</span><br><span class="line">2019-06-05 06:13:36.361  INFO 1 --- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@443b7951: startup date [Wed Jun 05 06:13:36 UTC 2019]; root of context hierarchy</span><br><span class="line">2019-06-05 06:13:38.011  INFO 1 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup</span><br><span class="line">2019-06-05 06:13:38.016  INFO 1 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 2147483647</span><br><span class="line">2019-06-05 06:13:38.041  INFO 1 --- [           main] c.v.s.PositionsimulatorApplication       : Started PositionsimulatorApplication in 2.487 seconds (JVM running for 3.201)</span><br><span class="line">2019-06-05 06:13:38.046  INFO 1 --- [           main] s.c.a.AnnotationConfigApplicationContext : Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@443b7951: startup date [Wed Jun 05 06:13:36 UTC 2019]; root of context hierarchy</span><br><span class="line">2019-06-05 06:13:38.048  INFO 1 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Stopping beans in phase 2147483647</span><br><span class="line">2019-06-05 06:13:38.049  INFO 1 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Unregistering JMX-exposed beans on shutdown</span><br><span class="line">ca^H^H^C</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/QhM7LEN.png" alt="Digram"></p>
<h2 id="Deploying-the-Position-Tracker"><a href="#Deploying-the-Position-Tracker" class="headerlink" title="Deploying the Position Tracker"></a>Deploying the Position Tracker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line">cat workloads.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: queue</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: queue</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: queue</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: queue</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-queue:release1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: position-simulator</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: position-simulator</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: position-simulator</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: position-simulator</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-position-simulator:release1</span><br><span class="line">        env:</span><br><span class="line">        - name: SPRING_PROFILES_ACTIVE</span><br><span class="line">          value: production-microservice</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: position-tracker</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: position-tracker</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: position-tracker</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: position-tracker</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-position-tracker:release1</span><br><span class="line">        env:</span><br><span class="line">        - name: SPRING_PROFILES_ACTIVE</span><br><span class="line">          value: production-microservice</span><br><span class="line"></span><br><span class="line">kubectl apply -f workloads.yaml</span><br><span class="line">deployment.apps &quot;queue&quot; configured</span><br><span class="line">deployment.apps &quot;position-simulator&quot; configured</span><br><span class="line">deployment.apps &quot;position-tracker&quot; created</span><br><span class="line"></span><br><span class="line">kga</span><br><span class="line">NAME                                      READY     STATUS        RESTARTS   AGE</span><br><span class="line">pod/position-simulator-6d8769d8-ghtmw     0/1       Terminating   0          13m</span><br><span class="line">pod/position-simulator-7889db8b94-49qz2   1/1       Running       0          10s</span><br><span class="line">pod/position-tracker-86d694f997-5j6fm     1/1       Running       0          10s</span><br><span class="line">pod/queue-6bf9fd876-4xrqx                 1/1       Terminating   0          1h</span><br><span class="line">pod/queue-9668b9bb4-4pqxr                 1/1       Running       0          10s</span><br><span class="line"></span><br><span class="line">NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                          AGE</span><br><span class="line">service/fleetman-queue    NodePort    10.110.95.121    &lt;none&gt;        8161:30010/TCP,61616:30536/TCP   1h</span><br><span class="line">service/fleetman-webapp   NodePort    10.103.224.156   &lt;none&gt;        80:30080/TCP                     1h</span><br><span class="line">service/kubernetes        ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP                          2d</span><br><span class="line"></span><br><span class="line">NAME                                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/position-simulator   1         1         1            1           24m</span><br><span class="line">deployment.apps/position-tracker     1         1         1            1           10s</span><br><span class="line">deployment.apps/queue                1         1         1            1           1h</span><br><span class="line"></span><br><span class="line">NAME                                            DESIRED   CURRENT   READY     AGE</span><br><span class="line">replicaset.apps/position-simulator-6d8769d8     0         0         0         13m</span><br><span class="line">replicaset.apps/position-simulator-6f97fd485f   0         0         0         21m</span><br><span class="line">replicaset.apps/position-simulator-7889db8b94   1         1         1         10s</span><br><span class="line">replicaset.apps/position-simulator-dff7b7599    0         0         0         24m</span><br><span class="line">replicaset.apps/position-tracker-86d694f997     1         1         1         10s</span><br><span class="line">replicaset.apps/queue-6bf9fd876                 0         0         0         1h</span><br><span class="line">replicaset.apps/queue-9668b9bb4                 1         1         1         10s</span><br><span class="line"></span><br><span class="line">kubectl describe pod position-tracker-86d694f997-5j6fm</span><br><span class="line">Name:               position-tracker-86d694f997-5j6fm</span><br><span class="line">Namespace:          default</span><br><span class="line">Priority:           0</span><br><span class="line">PriorityClassName:  &lt;none&gt;</span><br><span class="line">Node:               minikube/10.0.2.15</span><br><span class="line">Start Time:         Wed, 05 Jun 2019 16:26:58 +1000</span><br><span class="line">Labels:             app=position-tracker</span><br><span class="line">                    pod-template-hash=86d694f997</span><br><span class="line">Annotations:        &lt;none&gt;</span><br><span class="line">Status:             Running</span><br><span class="line">IP:                 172.17.0.7</span><br><span class="line">Controlled By:      ReplicaSet/position-tracker-86d694f997</span><br><span class="line">Containers:</span><br><span class="line">  position-tracker:</span><br><span class="line">    Container ID:   docker://c0203a7654c944a92f1b18b48d5c84917b9ecc791536429e6b02ca6248edb78f</span><br><span class="line">    Image:          richardchesterwood/k8s-fleetman-position-tracker:release1</span><br><span class="line">    Image ID:       docker-pullable://richardchesterwood/k8s-fleetman-position-tracker@sha256:5da78e936eb77677fbf30e528253a543badc76a5dd3a356b6d13e716da187298</span><br><span class="line">    Port:           &lt;none&gt;</span><br><span class="line">    Host Port:      &lt;none&gt;</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Wed, 05 Jun 2019 16:27:08 +1000</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:</span><br><span class="line">      SPRING_PROFILES_ACTIVE:  production-microservice</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-nmqkz (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             True</span><br><span class="line">  ContainersReady   True</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  default-token-nmqkz:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-nmqkz</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  1m    default-scheduler  Successfully assigned default/position-tracker-86d694f997-5j6fm to minikube</span><br><span class="line">  Normal  Pulling    1m    kubelet, minikube  pulling image &quot;richardchesterwood/k8s-fleetman-position-tracker:release1&quot;</span><br><span class="line">  Normal  Pulled     1m    kubelet, minikube  Successfully pulled image &quot;richardchesterwood/k8s-fleetman-position-tracker:release1&quot;</span><br><span class="line">  Normal  Created    1m    kubelet, minikube  Created container</span><br><span class="line">  Normal  Started    1m    kubelet, minikube  Started container</span><br><span class="line"></span><br><span class="line">kubectl logs -f position-tracker-86d694f997-5j6fm</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&apos;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &apos;_ | &apos;_| | &apos;_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &apos;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"> :: Spring Boot ::        (v1.4.0.RELEASE)</span><br><span class="line"></span><br><span class="line">2019-06-05 06:27:14.242  INFO 1 --- [           main] c.v.tracker.PositionTrackerApplication   : Starting PositionTrackerApplication v0.0.1-SNAPSHOT on position-tracker-86d694f997-5j6fm with PID 1 (/webapp.jar started by root in /)</span><br><span class="line">2019-06-05 06:27:14.297  INFO 1 --- [           main] c.v.tracker.PositionTrackerApplication   : The following profiles are active: production-microservice</span><br><span class="line">2019-06-05 06:27:15.147  INFO 1 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@108c4c35: startup date [Wed Jun 05 06:27:15 UTC 2019]; root of context hierarchy</span><br><span class="line">2019-06-05 06:27:25.787  INFO 1 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8080 (http)</span><br><span class="line">2019-06-05 06:27:25.852  INFO 1 --- [           main] o.apache.catalina.core.StandardService   : Starting service Tomcat</span><br><span class="line">2019-06-05 06:27:25.854  INFO 1 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/8.5.4</span><br><span class="line">2019-06-05 06:27:25.985  INFO 1 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2019-06-05 06:27:25.986  INFO 1 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 10877 ms</span><br><span class="line">2019-06-05 06:27:26.212  INFO 1 --- [ost-startStop-1] o.s.b.w.servlet.ServletRegistrationBean  : Mapping servlet: &apos;dispatcherServlet&apos; to [/]</span><br><span class="line">2019-06-05 06:27:26.221  INFO 1 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &apos;characterEncodingFilter&apos; to: [/*]</span><br><span class="line">2019-06-05 06:27:26.222  INFO 1 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &apos;hiddenHttpMethodFilter&apos; to: [/*]</span><br><span class="line">2019-06-05 06:27:26.223  INFO 1 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &apos;httpPutFormContentFilter&apos; to: [/*]</span><br><span class="line">2019-06-05 06:27:26.223  INFO 1 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &apos;requestContextFilter&apos; to: [/*]</span><br><span class="line">2019-06-05 06:27:26.789  INFO 1 --- [           main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@108c4c35: startup date [Wed Jun 05 06:27:15 UTC 2019]; root of context hierarchy</span><br><span class="line">2019-06-05 06:27:26.900  INFO 1 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;&#123;[/vehicles/&#123;vehicleName&#125;],methods=[GET]&#125;&quot; onto public org.springframework.http.ResponseEntity&lt;com.virtualpairprogrammers.tracker.domain.VehiclePosition&gt; com.virtualpairprogrammers.tracker.rest.PositionReportsController.getLatestReportForVehicle(java.lang.String)</span><br><span class="line">2019-06-05 06:27:26.901  INFO 1 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;&#123;[/vehicles/],methods=[GET]&#125;&quot; onto public java.util.Collection&lt;com.virtualpairprogrammers.tracker.domain.VehiclePosition&gt; com.virtualpairprogrammers.tracker.rest.PositionReportsController.getUpdatedPositions(java.util.Date)</span><br><span class="line">2019-06-05 06:27:26.903  INFO 1 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;&#123;[/error],produces=[text/html]&#125;&quot; onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)</span><br><span class="line">2019-06-05 06:27:26.904  INFO 1 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;&#123;[/error]&#125;&quot; onto public org.springframework.http.ResponseEntity&lt;java.util.Map&lt;java.lang.String, java.lang.Object&gt;&gt; org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)</span><br><span class="line">2019-06-05 06:27:26.948  INFO 1 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span><br><span class="line">2019-06-05 06:27:26.948  INFO 1 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span><br><span class="line">2019-06-05 06:27:26.991  INFO 1 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**/favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span><br><span class="line">2019-06-05 06:27:27.364  INFO 1 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup</span><br><span class="line">2019-06-05 06:27:27.414  INFO 1 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 2147483647</span><br><span class="line">2019-06-05 06:27:28.408  INFO 1 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)</span><br><span class="line">2019-06-05 06:27:28.436  INFO 1 --- [           main] c.v.tracker.PositionTrackerApplication   : Started PositionTrackerApplication in 17.136 seconds (JVM running for 20.295)</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/MrwaPyf.png" alt="ActiveMQ screenshot"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">cat services.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: fleetman-webapp</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line"> # This defines which pods are going to be represented by this Service</span><br><span class="line"> # The service becomes a network endpoint for either other services</span><br><span class="line"> #  or maybe external users to connect to (eg browser)</span><br><span class="line"> selector:</span><br><span class="line">   app: webapp</span><br><span class="line"></span><br><span class="line"> ports:</span><br><span class="line">   - name: http</span><br><span class="line">     port: 80</span><br><span class="line">     nodePort: 30080</span><br><span class="line"></span><br><span class="line"> type: NodePort</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: fleetman-queue</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line"> # This defines which pods are going to be represented by this Service</span><br><span class="line"> # The service becomes a network endpoint for either other services</span><br><span class="line"> #  or maybe external users to connect to (eg browser)</span><br><span class="line"> selector:</span><br><span class="line">   app: queue</span><br><span class="line"></span><br><span class="line"> ports:</span><br><span class="line">   - name: http</span><br><span class="line">     port: 8161</span><br><span class="line">     nodePort: 30010</span><br><span class="line"></span><br><span class="line">   - name: endpoint</span><br><span class="line">     port: 61616</span><br><span class="line"></span><br><span class="line"> type: NodePort</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: fleetman-position-tracker</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line"> # This defines which pods are going to be represented by this Service</span><br><span class="line"> # The service becomes a network endpoint for either other services</span><br><span class="line"> #  or maybe external users to connect to (eg browser)</span><br><span class="line"> selector:</span><br><span class="line">   app: position-tracker</span><br><span class="line"></span><br><span class="line"> ports:</span><br><span class="line">   - name: http</span><br><span class="line">     port: 8080</span><br><span class="line"></span><br><span class="line"> type: ClusterIP</span><br><span class="line"></span><br><span class="line">kubectl apply -f services.yaml</span><br><span class="line">service &quot;fleetman-webapp&quot; unchanged</span><br><span class="line">service &quot;fleetman-queue&quot; unchanged</span><br><span class="line">service &quot;fleetman-position-tracker&quot; configured</span><br><span class="line"></span><br><span class="line">kga</span><br><span class="line">NAME                                      READY     STATUS    RESTARTS   AGE</span><br><span class="line">pod/position-simulator-589c64887f-lhl8g   1/1       Running   0          38m</span><br><span class="line">pod/position-tracker-86d694f997-5j6fm     1/1       Running   0          45m</span><br><span class="line">pod/queue-9668b9bb4-4pqxr                 1/1       Running   0          45m</span><br><span class="line"></span><br><span class="line">NAME                                TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                          AGE</span><br><span class="line">service/fleetman-position-tracker   ClusterIP   10.104.177.133   &lt;none&gt;        8080/TCP                         3m</span><br><span class="line">service/fleetman-queue              NodePort    10.110.95.121    &lt;none&gt;        8161:30010/TCP,61616:30536/TCP   1h</span><br><span class="line">service/fleetman-webapp             NodePort    10.103.224.156   &lt;none&gt;        80:30080/TCP                     1h</span><br><span class="line">service/kubernetes                  ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP                          2d</span><br><span class="line"></span><br><span class="line">NAME                                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/position-simulator   1         1         1            1           1h</span><br><span class="line">deployment.apps/position-tracker     1         1         1            1           45m</span><br><span class="line">deployment.apps/queue                1         1         1            1           1h</span><br><span class="line"></span><br><span class="line">NAME                                            DESIRED   CURRENT   READY     AGE</span><br><span class="line">replicaset.apps/position-simulator-589c64887f   1         1         1         38m</span><br><span class="line">replicaset.apps/position-simulator-6d8769d8     0         0         0         58m</span><br><span class="line">replicaset.apps/position-simulator-6f97fd485f   0         0         0         1h</span><br><span class="line">replicaset.apps/position-simulator-7889db8b94   0         0         0         45m</span><br><span class="line">replicaset.apps/position-simulator-dff7b7599    0         0         0         1h</span><br><span class="line">replicaset.apps/position-tracker-86d694f997     1         1         1         45m</span><br><span class="line">replicaset.apps/queue-6bf9fd876                 0         0         0         1h</span><br><span class="line">replicaset.apps/queue-9668b9bb4                 1         1         1         45m</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/3tgbP7M.png" alt="Check"></p>
<h2 id="Deploying-the-API-Gateway"><a href="#Deploying-the-API-Gateway" class="headerlink" title="Deploying the API Gateway"></a>Deploying the API Gateway</h2><p>Add code in services.yaml file:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: fleetman-api-gateway</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line"> # This defines which pods are going to be represented by this Service</span><br><span class="line"> # The service becomes a network endpoint for either other services</span><br><span class="line"> #  or maybe external users to connect to (eg browser)</span><br><span class="line"> selector:</span><br><span class="line">   app: api-gateway</span><br><span class="line"></span><br><span class="line"> ports:</span><br><span class="line">   - name: http</span><br><span class="line">     port: 8080</span><br><span class="line"></span><br><span class="line"> type: ClusterIP</span><br></pre></td></tr></table></figure></p>
<p>Add code in workloads.yaml file:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: api-gateway</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: api-gateway</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: api-gateway</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: api-gateway</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-api-gateway:release1</span><br><span class="line">        env:</span><br><span class="line">        - name: SPRING_PROFILES_ACTIVE</span><br><span class="line">          value: production-microservice</span><br></pre></td></tr></table></figure></p>
<p><code>kubectl apply -f .</code></p>
<h2 id="Deploying-the-Webapp"><a href="#Deploying-the-Webapp" class="headerlink" title="Deploying the Webapp"></a>Deploying the Webapp</h2><p>Add for workloads.yaml file:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: webapp</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: webapp</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: webapp</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: webapp</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-webapp-angular:release1</span><br><span class="line">        env:</span><br><span class="line">        - name: SPRING_PROFILES_ACTIVE</span><br><span class="line">          value: production-microservice</span><br></pre></td></tr></table></figure></p>
<p>For serivce.yaml no change.</p>
<p><img src="https://i.imgur.com/dadMM2m.jpg" alt="final"></p>
<h1 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h1><h2 id="New-Release"><a href="#New-Release" class="headerlink" title="New Release!!"></a><strong>New Release!!</strong></h2><p>Release 2 is now available!</p>
<p>Please update all images to :release2 tag</p>
<p>New feature: vehicle tracking shows the history of each vehicle</p>
<hr>
<p>Change image in workloads.yaml from release1 to release2 by <code>:%s/release1/release2/g</code><br><img src="https://i.imgur.com/oOLbvYT.jpg" alt="release2"></p>
<h2 id="Upgrading-to-a-Mongo-Pod"><a href="#Upgrading-to-a-Mongo-Pod" class="headerlink" title="Upgrading to a Mongo Pod"></a>Upgrading to a Mongo Pod</h2><p><img src="https://i.imgur.com/zT2lk5f.jpg" alt="release3"></p>
<h2 id="Volume-Mounts"><a href="#Volume-Mounts" class="headerlink" title="Volume Mounts"></a>Volume Mounts</h2><p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#volume-v1-core">Volume v1 core</a></p>
<h2 id="PersistentVolumeClaims"><a href="#PersistentVolumeClaims" class="headerlink" title="PersistentVolumeClaims"></a>PersistentVolumeClaims</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat storage.yaml</span><br><span class="line"># What do want?</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClain</span><br><span class="line">metadata:</span><br><span class="line">  name: mongo-pvc</span><br><span class="line">spec:</span><br><span class="line">  accessMode:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resouces:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 20Gi</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"># How do we want it implemented</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolume</span><br><span class="line">metadata:</span><br><span class="line">  name: local-storage</span><br><span class="line">spec:</span><br><span class="line">  capacity:</span><br><span class="line">    storage: 20Gi</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  hostPath:</span><br><span class="line">    path: &quot;/mnt/somenew/dirctory/structure/&quot;</span><br><span class="line">    type: DirectoryOrCreate</span><br></pre></td></tr></table></figure>
<h2 id="StorageClasses-and-Binding"><a href="#StorageClasses-and-Binding" class="headerlink" title="StorageClasses and Binding"></a>StorageClasses and Binding</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"> cat mongo-stack.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: mongodb</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: mongodb</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: mongodb</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: mongodb</span><br><span class="line">        image: mongo:3.6.12-xenial</span><br><span class="line">        volumeMounts:</span><br><span class="line">          - name: mongo-persistent-storage</span><br><span class="line">            mountPath: /data/db</span><br><span class="line">      volumes:</span><br><span class="line">        - name: mongo-persistent-storage</span><br><span class="line">          # pointer to the configuration of HOW we want the mount to be implemented</span><br><span class="line">          persistentVolumeClaim:</span><br><span class="line">             claimName: mongo-pvc</span><br><span class="line">---</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: fleetman-mongodb</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: mongodb</span><br><span class="line">  ports:</span><br><span class="line">    - name: mongoport</span><br><span class="line">      port: 27017</span><br><span class="line">  type: ClusterIP</span><br><span class="line"></span><br><span class="line"> cat storage.yaml</span><br><span class="line"># What do want?</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: mongo-pvc</span><br><span class="line">spec:</span><br><span class="line">  storageClassName: mylocalstorage</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 20Gi</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"># How do we want it implemented</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolume</span><br><span class="line">metadata:</span><br><span class="line">  name: local-storage</span><br><span class="line">spec:</span><br><span class="line">  storageClassName: mylocalstorage</span><br><span class="line">  capacity:</span><br><span class="line">    storage: 20Gi</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  hostPath:</span><br><span class="line">    path: &quot;/mnt/somenew/dirctory/structure/&quot;</span><br><span class="line">    type: DirectoryOrCreate</span><br></pre></td></tr></table></figure>
<h1 id="DEPLOYING-TO-THE-AWS-CLOUD"><a href="#DEPLOYING-TO-THE-AWS-CLOUD" class="headerlink" title="DEPLOYING TO THE AWS CLOUD"></a>DEPLOYING TO THE AWS CLOUD</h1><h2 id="Getting-started-with-AWS"><a href="#Getting-started-with-AWS" class="headerlink" title="Getting started with AWS"></a>Getting started with AWS</h2><p><img src="https://i.imgur.com/FvK1lg2.png" alt="image1"></p>
<p><img src="https://i.imgur.com/1pQD2XE.png" alt="image2"></p>
<p><img src="https://i.imgur.com/KD5pigA.png" alt="image3"></p>
<p><img src="https://i.imgur.com/yZoC4kE.png" alt="ebs"></p>
<h2 id="Introducing-Kops"><a href="#Introducing-Kops" class="headerlink" title="Introducing Kops"></a>Introducing Kops</h2><p><a href="https://github.com/kubernetes/kops">Kops</a></p>
<p>This apparently is the easiest way to get a production-grade Kubernetes cluster up and running.</p>
<h2 id="Installing-the-Kops-Environment"><a href="#Installing-the-Kops-Environment" class="headerlink" title="Installing the Kops Environment"></a>Installing the Kops Environment</h2><p><a href="https://github.com/kubernetes/kops/blob/master/docs/aws.md">Deploy to aws</a></p>
<h2 id="Configuring-your-first-cluster"><a href="#Configuring-your-first-cluster" class="headerlink" title="Configuring your first cluster"></a>Configuring your first cluster</h2><p><a href="https://github.com/kubernetes/kops/blob/master/docs/aws.md#cluster-state-storage">Cluster State storage</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@foobar ~]$ export AWS_ACCESS_KEY_ID=$(aws configure get aws_access_key_id)</span><br><span class="line">[ec2-user@foobar ~]$ export AWS_SECRET_ACCESS_KEY=$(aws configure get aws_secret_access_key)</span><br><span class="line">[ec2-user@foobar ~]$ export NAME=fleetman.k8s.local</span><br><span class="line">[ec2-user@foobar ~]$ export KOPS_STATE_STORE=s3://stanzhou-state-storage</span><br><span class="line">[ec2-user@foobar ~]$ aws ec2 describe-availability-zones --region ap-southeast-2</span><br><span class="line">&#123;</span><br><span class="line">    &quot;AvailabilityZones&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;State&quot;: &quot;available&quot;,</span><br><span class="line">            &quot;ZoneName&quot;: &quot;ap-southeast-2a&quot;,</span><br><span class="line">            &quot;Messages&quot;: [],</span><br><span class="line">            &quot;ZoneId&quot;: &quot;apse2-az1&quot;,</span><br><span class="line">            &quot;RegionName&quot;: &quot;ap-southeast-2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;State&quot;: &quot;available&quot;,</span><br><span class="line">            &quot;ZoneName&quot;: &quot;ap-southeast-2b&quot;,</span><br><span class="line">            &quot;Messages&quot;: [],</span><br><span class="line">            &quot;ZoneId&quot;: &quot;apse2-az3&quot;,</span><br><span class="line">            &quot;RegionName&quot;: &quot;ap-southeast-2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;State&quot;: &quot;available&quot;,</span><br><span class="line">            &quot;ZoneName&quot;: &quot;ap-southeast-2c&quot;,</span><br><span class="line">            &quot;Messages&quot;: [],</span><br><span class="line">            &quot;ZoneId&quot;: &quot;apse2-az2&quot;,</span><br><span class="line">            &quot;RegionName&quot;: &quot;ap-southeast-2&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ kops create cluster --zones ap-southeast-2a,ap-southeast-2b,ap-southeast-2c $&#123;NAME&#125;</span><br><span class="line">I0607 06:10:02.189636    3468 create_cluster.go:519] Inferred --cloud=aws from zone &quot;ap-southeast-2a&quot;</span><br><span class="line">I0607 06:10:02.243690    3468 subnets.go:184] Assigned CIDR 172.20.32.0/19 to subnet ap-southeast-2a</span><br><span class="line">I0607 06:10:02.243802    3468 subnets.go:184] Assigned CIDR 172.20.64.0/19 to subnet ap-southeast-2b</span><br><span class="line">I0607 06:10:02.243857    3468 subnets.go:184] Assigned CIDR 172.20.96.0/19 to subnet ap-southeast-2c</span><br><span class="line">Previewing changes that will be made:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SSH public key must be specified when running with AWS (create with `kops create secret --name fleetman.k8s.local sshpublickey admin -i ~/.ssh/id_rsa.pub`)</span><br><span class="line"></span><br><span class="line">[ec2-user@foobar ~]$ ssh-keygen -b 2048 -t rsa -f ~/.ssh/id_rsa</span><br><span class="line">[ec2-user@foobar ~]$ kops create secret --name $&#123;NAME&#125; sshpublickey admin -i ~/.ssh/id_rsa.pub</span><br><span class="line">[ec2-user@foobar ~]$ kops edit ig nodes --name $&#123;NAME&#125;</span><br><span class="line">[ec2-user@foobar ~]$ kops get ig --name $&#123;NAME&#125;</span><br><span class="line">NAME                    ROLE    MACHINETYPE     MIN     MAX     ZONES</span><br><span class="line">master-ap-southeast-2a  Master  m3.medium       1       1       ap-southeast-2a</span><br><span class="line">nodes                   Node    t2.medium       3       5       ap-southeast-2a,ap-southeast-2b,ap-southeast-2c</span><br><span class="line">[ec2-user@foobar ~]$ kops edit ig master-ap-southeast-2a --name $&#123;NAME&#125;</span><br><span class="line">Edit cancelled, no changes made.</span><br></pre></td></tr></table></figure>
<h2 id="Running-the-Cluster"><a href="#Running-the-Cluster" class="headerlink" title="Running the Cluster"></a>Running the Cluster</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@i ~]$ kops update cluster $&#123;NAME&#125; --yes</span><br><span class="line">I0607 06:28:38.011102   32239 apply_cluster.go:559] Gossip DNS: skipping DNS validation</span><br><span class="line">I0607 06:28:38.263244   32239 executor.go:103] Tasks: 0 done / 94 total; 42 can run</span><br><span class="line">I0607 06:28:39.702035   32239 vfs_castore.go:729] Issuing new certificate: &quot;apiserver-aggregator-ca&quot;</span><br><span class="line">I0607 06:28:40.216189   32239 vfs_castore.go:729] Issuing new certificate: &quot;etcd-clients-ca&quot;</span><br><span class="line">I0607 06:28:40.356654   32239 vfs_castore.go:729] Issuing new certificate: &quot;etcd-peers-ca-main&quot;</span><br><span class="line">I0607 06:28:40.743191   32239 vfs_castore.go:729] Issuing new certificate: &quot;etcd-peers-ca-events&quot;</span><br><span class="line">I0607 06:28:40.824760   32239 vfs_castore.go:729] Issuing new certificate: &quot;etcd-manager-ca-events&quot;</span><br><span class="line">I0607 06:28:41.265388   32239 vfs_castore.go:729] Issuing new certificate: &quot;etcd-manager-ca-main&quot;</span><br><span class="line">I0607 06:28:41.373174   32239 vfs_castore.go:729] Issuing new certificate: &quot;ca&quot;</span><br><span class="line">I0607 06:28:41.551597   32239 executor.go:103] Tasks: 42 done / 94 total; 26 can run</span><br><span class="line">I0607 06:28:42.539134   32239 vfs_castore.go:729] Issuing new certificate: &quot;kube-scheduler&quot;</span><br><span class="line">I0607 06:28:42.891972   32239 vfs_castore.go:729] Issuing new certificate: &quot;kubecfg&quot;</span><br><span class="line">I0607 06:28:43.157916   32239 vfs_castore.go:729] Issuing new certificate: &quot;apiserver-proxy-client&quot;</span><br><span class="line">I0607 06:28:43.556052   32239 vfs_castore.go:729] Issuing new certificate: &quot;kubelet&quot;</span><br><span class="line">I0607 06:28:43.677894   32239 vfs_castore.go:729] Issuing new certificate: &quot;apiserver-aggregator&quot;</span><br><span class="line">I0607 06:28:43.748079   32239 vfs_castore.go:729] Issuing new certificate: &quot;kube-proxy&quot;</span><br><span class="line">I0607 06:28:44.025132   32239 vfs_castore.go:729] Issuing new certificate: &quot;kubelet-api&quot;</span><br><span class="line">I0607 06:28:44.589696   32239 vfs_castore.go:729] Issuing new certificate: &quot;kube-controller-manager&quot;</span><br><span class="line">I0607 06:28:44.730038   32239 vfs_castore.go:729] Issuing new certificate: &quot;kops&quot;</span><br><span class="line">I0607 06:28:44.864527   32239 executor.go:103] Tasks: 68 done / 94 total; 22 can run</span><br><span class="line">I0607 06:28:45.089177   32239 launchconfiguration.go:364] waiting for IAM instance profile &quot;masters.fleetman.k8s.local&quot; to be ready</span><br><span class="line">I0607 06:28:45.101954   32239 launchconfiguration.go:364] waiting for IAM instance profile &quot;nodes.fleetman.k8s.local&quot; to be ready</span><br><span class="line">I0607 06:28:55.483430   32239 executor.go:103] Tasks: 90 done / 94 total; 3 can run</span><br><span class="line">I0607 06:28:55.974524   32239 vfs_castore.go:729] Issuing new certificate: &quot;master&quot;</span><br><span class="line">I0607 06:28:56.119668   32239 executor.go:103] Tasks: 93 done / 94 total; 1 can run</span><br><span class="line">I0607 06:28:56.336766   32239 executor.go:103] Tasks: 94 done / 94 total; 0 can run</span><br><span class="line">I0607 06:28:56.407976   32239 update_cluster.go:291] Exporting kubecfg for cluster</span><br><span class="line">kops has set your kubectl context to fleetman.k8s.local</span><br><span class="line"></span><br><span class="line">Cluster is starting.  It should be ready in a few minutes.</span><br><span class="line"></span><br><span class="line">Suggestions:</span><br><span class="line"> * validate cluster: kops validate cluster</span><br><span class="line"> * list nodes: kubectl get nodes --show-labels</span><br><span class="line"> * ssh to the master: ssh -i ~/.ssh/id_rsa admin@api.fleetman.k8s.local</span><br><span class="line"> * the admin user is specific to Debian. If not using Debian please use the appropriate user based on your OS.</span><br><span class="line"> * read about installing addons at: https://github.com/kubernetes/kops/blob/master/docs/addons.md.</span><br><span class="line"></span><br><span class="line">[ec2-user@i ~]$ kops validate cluster</span><br><span class="line">Using cluster from kubectl context: fleetman.k8s.local</span><br><span class="line"></span><br><span class="line">Validating cluster fleetman.k8s.local</span><br><span class="line"></span><br><span class="line">INSTANCE GROUPS</span><br><span class="line">NAME                    ROLE    MACHINETYPE     MIN     MAX     SUBNETS</span><br><span class="line">master-ap-southeast-2a  Master  m3.medium       1       1       ap-southeast-2a</span><br><span class="line">nodes                   Node    t2.medium       3       5       ap-southeast-2a,ap-southeast-2b,ap-southeast-2c</span><br><span class="line"></span><br><span class="line">NODE STATUS</span><br><span class="line">NAME                                                    ROLE    READY</span><br><span class="line">ip-172-20-115-253.ap-southeast-2.compute.internal       node    True</span><br><span class="line">ip-172-20-39-212.ap-southeast-2.compute.internal        node    True</span><br><span class="line">ip-172-20-45-219.ap-southeast-2.compute.internal        master  True</span><br><span class="line">ip-172-20-89-8.ap-southeast-2.compute.internal          node    True</span><br><span class="line"></span><br><span class="line">Your cluster fleetman.k8s.local is ready</span><br><span class="line"></span><br><span class="line">[ec2-user@i ~]$ kubectl get all</span><br><span class="line">NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">service/kubernetes   ClusterIP   100.64.0.1   &lt;none&gt;        443/TCP   4m50s</span><br></pre></td></tr></table></figure>
<h2 id="Provisioning-SSD-drives-with-a-StorageClass"><a href="#Provisioning-SSD-drives-with-a-StorageClass" class="headerlink" title="Provisioning SSD drives with a StorageClass"></a>Provisioning SSD drives with a StorageClass</h2><p>We have a workloads yaml file, where we’d be finding the pods that we want to deploy to our cluster. We have mongostack which is a specialist file, just for the mongo database. We have storage.yaml, which is currently defining that we want to store the mongo data in a local directory on the host machine. And we have a yaml file for the services.</p>
<p>[aws ebs])<a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#aws-ebs">https://kubernetes.io/docs/concepts/storage/storage-classes/#aws-ebs</a>)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@i ~]$ cat storage-aws.yaml</span><br><span class="line"># What do want?</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: mongo-pvc</span><br><span class="line">spec:</span><br><span class="line">  storageClassName: cloud-ssd</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 7Gi</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"># How do we want it implemented</span><br><span class="line">apiVersion: storage.k8s.io/v1</span><br><span class="line">kind: StorageClass</span><br><span class="line">metadata:</span><br><span class="line">  name: cloud-ssd</span><br><span class="line">provisioner: kubernetes.io/aws-ebs</span><br><span class="line">parameters:</span><br><span class="line">  type: gp2</span><br><span class="line"></span><br><span class="line">[ec2-user@ip-1 ~]$ kubectl get pvc</span><br><span class="line">NAME        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">mongo-pvc   Bound    pvc-b2ed286e-88f3-11e9-b509-02985f983814   7Gi        RWO            cloud-ssd      3m45s</span><br><span class="line"></span><br><span class="line">[ec2-user@ip-1 ~]$ kubectl get pv</span><br><span class="line">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM               STORAGECLASS   REASON   AGE</span><br><span class="line">pvc-b2ed286e-88f3-11e9-b509-02985f983814   7Gi        RWO            Delete           Bound    default/mongo-pvc   cloud-ssd               18s</span><br></pre></td></tr></table></figure></p>
<p><img src="https://i.imgur.com/91K0spE.png" alt="ebs volume created"></p>
<h2 id="Deploying-the-Fleetman-Workload"><a href="#Deploying-the-Fleetman-Workload" class="headerlink" title="Deploying the Fleetman Workload"></a>Deploying the Fleetman Workload</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-1-9 ~]$ cat services.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: fleetman-webapp</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line"> # This defines which pods are going to be represented by this Service</span><br><span class="line"> # The service becomes a network endpoint for either other services</span><br><span class="line"> #  or maybe external users to connect to (eg browser)</span><br><span class="line"> selector:</span><br><span class="line">   app: webapp</span><br><span class="line"></span><br><span class="line"> ports:</span><br><span class="line">   - name: http</span><br><span class="line">     port: 80</span><br><span class="line"> type: LoadBalancer</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: fleetman-queue</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line"> # This defines which pods are going to be represented by this Service</span><br><span class="line"> # The service becomes a network endpoint for either other services</span><br><span class="line"> #  or maybe external users to connect to (eg browser)</span><br><span class="line"> selector:</span><br><span class="line">   app: queue</span><br><span class="line"></span><br><span class="line"> ports:</span><br><span class="line">   - name: http</span><br><span class="line">     port: 8161</span><br><span class="line"></span><br><span class="line">   - name: endpoint</span><br><span class="line">     port: 61616</span><br><span class="line"></span><br><span class="line"> type: ClusterIP</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: fleetman-position-tracker</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line"> # This defines which pods are going to be represented by this Service</span><br><span class="line"> # The service becomes a network endpoint for either other services</span><br><span class="line"> #  or maybe external users to connect to (eg browser)</span><br><span class="line"> selector:</span><br><span class="line">   app: position-tracker</span><br><span class="line"></span><br><span class="line"> ports:</span><br><span class="line">   - name: http</span><br><span class="line">     port: 8080</span><br><span class="line"></span><br><span class="line"> type: ClusterIP</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: fleetman-api-gateway</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line"> # This defines which pods are going to be represented by this Service</span><br><span class="line"> # The service becomes a network endpoint for either other services</span><br><span class="line"> #  or maybe external users to connect to (eg browser)</span><br><span class="line"> selector:</span><br><span class="line">   app: api-gateway</span><br><span class="line"></span><br><span class="line"> ports:</span><br><span class="line">   - name: http</span><br><span class="line">     port: 8080</span><br><span class="line"></span><br><span class="line"> type: ClusterIP</span><br><span class="line"></span><br><span class="line">[ec2-user@ip-1-4-9 ~]$ cat workloads.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: queue</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: queue</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: queue</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: queue</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-queue:release2</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: position-simulator</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: position-simulator</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: position-simulator</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: position-simulator</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-position-simulator:release2</span><br><span class="line">        env:</span><br><span class="line">        - name: SPRING_PROFILES_ACTIVE</span><br><span class="line">          value: production-microservice</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: position-tracker</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: position-tracker</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: position-tracker</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: position-tracker</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-position-tracker:release3</span><br><span class="line">        env:</span><br><span class="line">        - name: SPRING_PROFILES_ACTIVE</span><br><span class="line">          value: production-microservice</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: api-gateway</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: api-gateway</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: api-gateway</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: api-gateway</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-api-gateway:release2</span><br><span class="line">        env:</span><br><span class="line">        - name: SPRING_PROFILES_ACTIVE</span><br><span class="line">          value: production-microservice</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: webapp</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: webapp</span><br><span class="line">  replicas: 1</span><br><span class="line">  template: # template for the pods</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: webapp</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: webapp</span><br><span class="line">        image: richardchesterwood/k8s-fleetman-webapp-angular:release2</span><br><span class="line">        env:</span><br><span class="line">        - name: SPRING_PROFILES_ACTIVE</span><br><span class="line">          value: production-microservice</span><br><span class="line">[ec2-user@-4-9 ~]$ kubectl apply -f .</span><br><span class="line">deployment.apps/mongodb unchanged</span><br><span class="line">service/fleetman-mongodb unchanged</span><br><span class="line">service/fleetman-webapp unchanged</span><br><span class="line">service/fleetman-queue unchanged</span><br><span class="line">service/fleetman-position-tracker unchanged</span><br><span class="line">service/fleetman-api-gateway unchanged</span><br><span class="line">persistentvolumeclaim/mongo-pvc unchanged</span><br><span class="line">storageclass.storage.k8s.io/cloud-ssd unchanged</span><br><span class="line">deployment.apps/queue configured</span><br><span class="line">deployment.apps/position-simulator configured</span><br><span class="line">deployment.apps/position-tracker unchanged</span><br><span class="line">deployment.apps/api-gateway configured</span><br><span class="line">deployment.apps/webapp configured</span><br><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kubectl get all</span><br><span class="line">NAME                                      READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/api-gateway-5d445d6f69-5gmm4          1/1     Running   0          82s</span><br><span class="line">pod/mongodb-5559556bf-jjkpw               1/1     Running   0          20m</span><br><span class="line">pod/position-simulator-7ffd4f8f68-2gnjr   1/1     Running   0          82s</span><br><span class="line">pod/position-tracker-5ff4fb7479-jjj9f     1/1     Running   0          11m</span><br><span class="line">pod/queue-75f4ddd795-6vn9d                1/1     Running   0          82s</span><br><span class="line">pod/webapp-689dd9b4f4-ntdpz               1/1     Running   0          82s</span><br><span class="line"></span><br><span class="line">NAME                                TYPE           CLUSTER-IP       EXTERNAL-IP                                                                    PORT(S)              AGE</span><br><span class="line">service/fleetman-api-gateway        ClusterIP      100.65.245.184   &lt;none&gt;                                                                         8080/TCP             11m</span><br><span class="line">service/fleetman-mongodb            ClusterIP      100.70.242.251   &lt;none&gt;                                                                         27017/TCP            20m</span><br><span class="line">service/fleetman-position-tracker   ClusterIP      100.70.48.51     &lt;none&gt;                                                                         8080/TCP             11m</span><br><span class="line">service/fleetman-queue              ClusterIP      100.65.176.119   &lt;none&gt;                                                                         8161/TCP,61616/TCP   11m</span><br><span class="line">service/fleetman-webapp             LoadBalancer   100.70.56.219    a660e0c5e88f611e9b50902985f98381-1044209190.ap-southeast-2.elb.amazonaws.com   80:30149/TCP         11m</span><br><span class="line">service/kubernetes                  ClusterIP      100.64.0.1       &lt;none&gt;                                                                         443/TCP              68m</span><br><span class="line"></span><br><span class="line">NAME                                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/api-gateway          1         1         1            1           11m</span><br><span class="line">deployment.apps/mongodb              1         1         1            1           20m</span><br><span class="line">deployment.apps/position-simulator   1         1         1            1           11m</span><br><span class="line">deployment.apps/position-tracker     1         1         1            1           11m</span><br><span class="line">deployment.apps/queue                1         1         1            1           11m</span><br><span class="line">deployment.apps/webapp               1         1         1            1           11m</span><br><span class="line"></span><br><span class="line">NAME                                            DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/api-gateway-5d445d6f69          1         1         1       82s</span><br><span class="line">replicaset.apps/api-gateway-6d7dccc464          0         0         0       11m</span><br><span class="line">replicaset.apps/mongodb-5559556bf               1         1         1       20m</span><br><span class="line">replicaset.apps/position-simulator-549554f4d9   0         0         0       11m</span><br><span class="line">replicaset.apps/position-simulator-7ffd4f8f68   1         1         1       82s</span><br><span class="line">replicaset.apps/position-tracker-5ff4fb7479     1         1         1       11m</span><br><span class="line">replicaset.apps/queue-75f4ddd795                1         1         1       82s</span><br><span class="line">replicaset.apps/queue-b46577b46                 0         0         0       11m</span><br><span class="line">replicaset.apps/webapp-689dd9b4f4               1         1         1       82s</span><br><span class="line">replicaset.apps/webapp-6cdd565c5                0         0         0       11m</span><br><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kubectl log -f pod/position-tracker-5ff4fb7479-jjj9f</span><br><span class="line">log is DEPRECATED and will be removed in a future version. Use logs instead.</span><br><span class="line">2019-06-07 07:42:40.878 ERROR 1 --- [enerContainer-1] o.s.j.l.DefaultMessageListenerContainer  : Could not refresh JMS Connection for destination &apos;positionQueue&apos; - retrying using FixedBackOff&#123;interval=5000, currentAttempts=15, maxAttempts=unlimited&#125;. Cause: Could not connect to broker URL: tcp://fleetman-queue.default.svc.cluster.local:61616. Reason: java.net.SocketException: Socket closed</span><br><span class="line">2019-06-07 07:42:46.002  INFO 1 --- [enerContainer-1] o.s.j.l.DefaultMessageListenerContainer  : Successfully refreshed JMS Connection</span><br><span class="line">2019-06-07 07:42:47.440  INFO 1 --- [nio-8080-exec-8] org.mongodb.driver.connection            : Opened connection [connectionId&#123;localValue:3, serverValue:3&#125;] to fleetman-mongodb.default.svc.cluster.local:27017</span><br><span class="line">illljffkkkkerror: unexpected EOF</span><br></pre></td></tr></table></figure>
<p>Docker swarm uses a concept called a rooting, or routing, mesh to find the node that your web application is running on. None of that is used here, it uses a standard AWS load balancer to find the correct node.</p>
<h2 id="Setting-up-a-real-Domain-Name"><a href="#Setting-up-a-real-Domain-Name" class="headerlink" title="Setting up a real Domain Name"></a>Setting up a real Domain Name</h2><p>Add a CNAME record in your own domain to ELB address.</p>
<h2 id="Surviving-Node-Failure"><a href="#Surviving-Node-Failure" class="headerlink" title="Surviving Node Failure"></a>Surviving Node Failure</h2><h3 id="Requirement"><a href="#Requirement" class="headerlink" title="Requirement"></a>Requirement</h3><hr>
<p>Even in the vent of a Node (or Availability Zone) failure, the web site must be accessible</p>
<p>It doesn’t matter if reports from vehicles stop coming in, as long as service is restored within a few minutes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@foobar ~]$ kubectl get pods</span><br><span class="line">NAME                                  READY   STATUS    RESTARTS   AGE</span><br><span class="line">api-gateway-5d445d6f69-5gmm4          1/1     Running   0          93m</span><br><span class="line">mongodb-5559556bf-jjkpw               1/1     Running   0          112m</span><br><span class="line">position-simulator-7ffd4f8f68-2gnjr   1/1     Running   0          93m</span><br><span class="line">position-tracker-5ff4fb7479-jjj9f     1/1     Running   0          103m</span><br><span class="line">queue-75f4ddd795-6vn9d                1/1     Running   0          93m</span><br><span class="line">webapp-689dd9b4f4-ntdpz               1/1     Running   0          93m</span><br><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kubectl get pods -o wide</span><br><span class="line">NAME                                  READY   STATUS    RESTARTS   AGE    IP           NODE                                                NOMINATED NODE</span><br><span class="line">api-gateway-5d445d6f69-5gmm4          1/1     Running   0          93m    100.96.3.5   ip-172-20-39-212.ap-southeast-2.compute.internal    &lt;none&gt;</span><br><span class="line">mongodb-5559556bf-jjkpw               1/1     Running   0          112m   100.96.1.4   ip-172-20-89-8.ap-southeast-2.compute.internal      &lt;none&gt;</span><br><span class="line">position-simulator-7ffd4f8f68-2gnjr   1/1     Running   0          93m    100.96.2.5   ip-172-20-115-253.ap-southeast-2.compute.internal   &lt;none&gt;</span><br><span class="line">position-tracker-5ff4fb7479-jjj9f     1/1     Running   0          103m   100.96.3.4   ip-172-20-39-212.ap-southeast-2.compute.internal    &lt;none&gt;</span><br><span class="line">queue-75f4ddd795-6vn9d                1/1     Running   0          93m    100.96.1.5   ip-172-20-89-8.ap-southeast-2.compute.internal      &lt;none&gt;</span><br><span class="line">webapp-689dd9b4f4-ntdpz               1/1     Running   0          93m    100.96.2.6   ip-172-20-115-253.ap-southeast-2.compute.internal   &lt;none&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Replicating-Pods"><a href="#Replicating-Pods" class="headerlink" title="Replicating Pods"></a>Replicating Pods</h2><p>For our example, take the queue pod, give it two replicas and therefore, in the event of a node failure, one of the nodes will always survive. Unfortunately you can’t do that because this particular pod, the queue pod is stateful. In other words, it contains data. And because it contains data, if you replicate it, you’re going to end up with a kind of a split brain situation, where half the data is in one part, half the data is in the other part. And all kinds of chaos will follow on from that. Really what you’re aiming for with any pod is to make it stateless, so it’s not holding data.</p>
<h2 id="Deleting-the-Cluster"><a href="#Deleting-the-Cluster" class="headerlink" title="Deleting the Cluster"></a>Deleting the Cluster</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@foobar ~]$ export NAME=fleetman.k8s.local</span><br><span class="line">[ec2-user@foobar ~]$ kops delete cluster --name $&#123;NAME&#125; --yes</span><br><span class="line"></span><br><span class="line">State Store: Required value: Please set the --state flag or export KOPS_STATE_STORE.</span><br><span class="line">For example, a valid value follows the format s3://&lt;bucket&gt;.</span><br><span class="line">You can find the supported stores in https://github.com/kubernetes/kops/blob/master/docs/state.md.</span><br><span class="line">[ec2-user@ip-172-31-4-9 ~]$ export KOPS_STATE_STORE=s3://stanzhou-state-storage</span><br><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kops delete cluster --name $&#123;NAME&#125; --yes</span><br><span class="line">TYPE                    NAME                                                                            ID</span><br><span class="line">autoscaling-config      master-ap-southeast-2a.masters.fleetman.k8s.local-20190607062844                master-ap-southeast-2a.masters.fleetman.k8s.local-20190607062844</span><br><span class="line">autoscaling-config      nodes.fleetman.k8s.local-20190607062844                                         nodes.fleetman.k8s.local-20190607062844</span><br><span class="line">autoscaling-group       master-ap-southeast-2a.masters.fleetman.k8s.local                               master-ap-southeast-2a.masters.fleetman.k8s.local</span><br><span class="line">autoscaling-group       nodes.fleetman.k8s.local                                                        nodes.fleetman.k8s.local</span><br><span class="line">dhcp-options            fleetman.k8s.local                                                              dopt-0a0be88814a0c83a9</span><br><span class="line">iam-instance-profile    masters.fleetman.k8s.local                                                      masters.fleetman.k8s.local</span><br><span class="line">iam-instance-profile    nodes.fleetman.k8s.local                                                        nodes.fleetman.k8s.local</span><br><span class="line">iam-role                masters.fleetman.k8s.local                                                      masters.fleetman.k8s.local</span><br><span class="line">iam-role                nodes.fleetman.k8s.local                                                        nodes.fleetman.k8s.local</span><br><span class="line">instance                master-ap-southeast-2a.masters.fleetman.k8s.local                               i-012c7c446b65343d4</span><br><span class="line">instance                nodes.fleetman.k8s.local                                                        i-07583ee103342be9a</span><br><span class="line">instance                nodes.fleetman.k8s.local                                                        i-079cea61e4a7736b9</span><br><span class="line">instance                nodes.fleetman.k8s.local                                                        i-0bf949dbd290d81c3</span><br><span class="line">internet-gateway        fleetman.k8s.local                                                              igw-0a939d66d6e93e0d5</span><br><span class="line">keypair                 kubernetes.fleetman.k8s.local-fc:11:5b:a8:1d:16:4a:36:36:15:2d:9f:f3:69:d2:0a   kubernetes.fleetman.k8s.local-fc:11:5b:a8:1d:16:4a:36:36:15:2d:9f:f3:69:d2:0a</span><br><span class="line">load-balancer                                                                                           a660e0c5e88f611e9b50902985f98381</span><br><span class="line">load-balancer           api.fleetman.k8s.local                                                          api-fleetman-k8s-local-tkmafs</span><br><span class="line">route-table             fleetman.k8s.local                                                              rtb-06b591f24a01973f6</span><br><span class="line">security-group                                                                                          sg-07b79756088cf753c</span><br><span class="line">security-group          api-elb.fleetman.k8s.local                                                      sg-005c9b49b63793004</span><br><span class="line">security-group          masters.fleetman.k8s.local                                                      sg-07ef00367ce1a7b62</span><br><span class="line">security-group          nodes.fleetman.k8s.local                                                        sg-01f81918cdbaba212</span><br><span class="line">subnet                  ap-southeast-2a.fleetman.k8s.local                                              subnet-060ec2db19027cf6a</span><br><span class="line">subnet                  ap-southeast-2b.fleetman.k8s.local                                              subnet-0def003bdbfd97915</span><br><span class="line">subnet                  ap-southeast-2c.fleetman.k8s.local                                              subnet-0016862a30fe5f443</span><br><span class="line">volume                  a.etcd-events.fleetman.k8s.local                                                vol-0d21c97044fcc06dd</span><br><span class="line">volume                  a.etcd-main.fleetman.k8s.local                                                  vol-0f1c9f3e983c5848a</span><br><span class="line">volume                  fleetman.k8s.local-dynamic-pvc-b2ed286e-88f3-11e9-b509-02985f983814             vol-074914e494e4b656d</span><br><span class="line">vpc                     fleetman.k8s.local                                                              vpc-0775d4b463932d2f7</span><br><span class="line"></span><br><span class="line">load-balancer:api-fleetman-k8s-local-tkmafs     ok</span><br><span class="line">load-balancer:a660e0c5e88f611e9b50902985f98381  ok</span><br><span class="line">autoscaling-group:nodes.fleetman.k8s.local      ok</span><br><span class="line">keypair:kubernetes.fleetman.k8s.local-fc:11:5b:a8:1d:16:4a:36:36:15:2d:9f:f3:69:d2:0a   ok</span><br><span class="line">internet-gateway:igw-0a939d66d6e93e0d5  still has dependencies, will retry</span><br><span class="line">autoscaling-group:master-ap-southeast-2a.masters.fleetman.k8s.local     ok</span><br><span class="line">instance:i-012c7c446b65343d4    ok</span><br><span class="line">instance:i-07583ee103342be9a    ok</span><br><span class="line">instance:i-0bf949dbd290d81c3    ok</span><br><span class="line">instance:i-079cea61e4a7736b9    ok</span><br><span class="line">iam-instance-profile:nodes.fleetman.k8s.local   ok</span><br><span class="line">iam-instance-profile:masters.fleetman.k8s.local ok</span><br><span class="line">iam-role:nodes.fleetman.k8s.local       ok</span><br><span class="line">iam-role:masters.fleetman.k8s.local     ok</span><br><span class="line">subnet:subnet-0def003bdbfd97915 still has dependencies, will retry</span><br><span class="line">subnet:subnet-0016862a30fe5f443 still has dependencies, will retry</span><br><span class="line">autoscaling-config:nodes.fleetman.k8s.local-20190607062844      ok</span><br><span class="line">volume:vol-0d21c97044fcc06dd    still has dependencies, will retry</span><br><span class="line">autoscaling-config:master-ap-southeast-2a.masters.fleetman.k8s.local-20190607062844     ok</span><br><span class="line">volume:vol-0f1c9f3e983c5848a    still has dependencies, will retry</span><br><span class="line">subnet:subnet-060ec2db19027cf6a still has dependencies, will retry</span><br><span class="line">volume:vol-074914e494e4b656d    still has dependencies, will retry</span><br><span class="line">security-group:sg-005c9b49b63793004     still has dependencies, will retry</span><br><span class="line">security-group:sg-01f81918cdbaba212     still has dependencies, will retry</span><br><span class="line">security-group:sg-07b79756088cf753c     still has dependencies, will retry</span><br><span class="line">security-group:sg-07ef00367ce1a7b62     still has dependencies, will retry</span><br><span class="line">Not all resources deleted; waiting before reattempting deletion</span><br><span class="line">        route-table:rtb-06b591f24a01973f6</span><br><span class="line">        internet-gateway:igw-0a939d66d6e93e0d5</span><br><span class="line">        security-group:sg-005c9b49b63793004</span><br><span class="line">        subnet:subnet-060ec2db19027cf6a</span><br><span class="line">        security-group:sg-07b79756088cf753c</span><br><span class="line">        subnet:subnet-0016862a30fe5f443</span><br><span class="line">        subnet:subnet-0def003bdbfd97915</span><br><span class="line">        security-group:sg-07ef00367ce1a7b62</span><br><span class="line">        volume:vol-0d21c97044fcc06dd</span><br><span class="line">        dhcp-options:dopt-0a0be88814a0c83a9</span><br><span class="line">        volume:vol-074914e494e4b656d</span><br><span class="line">        security-group:sg-01f81918cdbaba212</span><br><span class="line">        volume:vol-0f1c9f3e983c5848a</span><br><span class="line">        vpc:vpc-0775d4b463932d2f7</span><br><span class="line">subnet:subnet-060ec2db19027cf6a still has dependencies, will retry</span><br><span class="line">subnet:subnet-0def003bdbfd97915 still has dependencies, will retry</span><br><span class="line">subnet:subnet-0016862a30fe5f443 still has dependencies, will retry</span><br><span class="line">volume:vol-074914e494e4b656d    still has dependencies, will retry</span><br><span class="line">volume:vol-0f1c9f3e983c5848a    still has dependencies, will retry</span><br><span class="line">internet-gateway:igw-0a939d66d6e93e0d5  still has dependencies, will retry</span><br><span class="line">volume:vol-0d21c97044fcc06dd    still has dependencies, will retry</span><br><span class="line">security-group:sg-01f81918cdbaba212     still has dependencies, will retry</span><br><span class="line">security-group:sg-005c9b49b63793004     still has dependencies, will retry</span><br><span class="line">security-group:sg-07ef00367ce1a7b62     still has dependencies, will retry</span><br><span class="line">security-group:sg-07b79756088cf753c     still has dependencies, will retry</span><br><span class="line">Not all resources deleted; waiting before reattempting deletion</span><br><span class="line">        volume:vol-074914e494e4b656d</span><br><span class="line">        security-group:sg-01f81918cdbaba212</span><br><span class="line">        volume:vol-0f1c9f3e983c5848a</span><br><span class="line">        vpc:vpc-0775d4b463932d2f7</span><br><span class="line">        route-table:rtb-06b591f24a01973f6</span><br><span class="line">        internet-gateway:igw-0a939d66d6e93e0d5</span><br><span class="line">        security-group:sg-005c9b49b63793004</span><br><span class="line">        subnet:subnet-060ec2db19027cf6a</span><br><span class="line">        subnet:subnet-0016862a30fe5f443</span><br><span class="line">        security-group:sg-07b79756088cf753c</span><br><span class="line">        volume:vol-0d21c97044fcc06dd</span><br><span class="line">        subnet:subnet-0def003bdbfd97915</span><br><span class="line">        security-group:sg-07ef00367ce1a7b62</span><br><span class="line">        dhcp-options:dopt-0a0be88814a0c83a9</span><br><span class="line">subnet:subnet-060ec2db19027cf6a still has dependencies, will retry</span><br><span class="line">subnet:subnet-0def003bdbfd97915 still has dependencies, will retry</span><br><span class="line">volume:vol-0f1c9f3e983c5848a    still has dependencies, will retry</span><br><span class="line">volume:vol-0d21c97044fcc06dd    still has dependencies, will retry</span><br><span class="line">internet-gateway:igw-0a939d66d6e93e0d5  still has dependencies, will retry</span><br><span class="line">volume:vol-074914e494e4b656d    still has dependencies, will retry</span><br><span class="line">subnet:subnet-0016862a30fe5f443 still has dependencies, will retry</span><br><span class="line">security-group:sg-07b79756088cf753c     still has dependencies, will retry</span><br><span class="line">security-group:sg-01f81918cdbaba212     still has dependencies, will retry</span><br><span class="line">security-group:sg-07ef00367ce1a7b62     still has dependencies, will retry</span><br><span class="line">security-group:sg-005c9b49b63793004     still has dependencies, will retry</span><br><span class="line">Not all resources deleted; waiting before reattempting deletion</span><br><span class="line">        route-table:rtb-06b591f24a01973f6</span><br><span class="line">        internet-gateway:igw-0a939d66d6e93e0d5</span><br><span class="line">        security-group:sg-005c9b49b63793004</span><br><span class="line">        subnet:subnet-060ec2db19027cf6a</span><br><span class="line">        subnet:subnet-0016862a30fe5f443</span><br><span class="line">        security-group:sg-07b79756088cf753c</span><br><span class="line">        volume:vol-0d21c97044fcc06dd</span><br><span class="line">        subnet:subnet-0def003bdbfd97915</span><br><span class="line">        security-group:sg-07ef00367ce1a7b62</span><br><span class="line">        dhcp-options:dopt-0a0be88814a0c83a9</span><br><span class="line">        volume:vol-074914e494e4b656d</span><br><span class="line">        security-group:sg-01f81918cdbaba212</span><br><span class="line">        volume:vol-0f1c9f3e983c5848a</span><br><span class="line">        vpc:vpc-0775d4b463932d2f7</span><br><span class="line">subnet:subnet-0def003bdbfd97915 still has dependencies, will retry</span><br><span class="line">subnet:subnet-060ec2db19027cf6a still has dependencies, will retry</span><br><span class="line">internet-gateway:igw-0a939d66d6e93e0d5  still has dependencies, will retry</span><br><span class="line">volume:vol-074914e494e4b656d    still has dependencies, will retry</span><br><span class="line">volume:vol-0d21c97044fcc06dd    ok</span><br><span class="line">volume:vol-0f1c9f3e983c5848a    ok</span><br><span class="line">security-group:sg-01f81918cdbaba212     still has dependencies, will retry</span><br><span class="line">subnet:subnet-0016862a30fe5f443 ok</span><br><span class="line">security-group:sg-07b79756088cf753c     still has dependencies, will retry</span><br><span class="line">security-group:sg-07ef00367ce1a7b62     still has dependencies, will retry</span><br><span class="line">security-group:sg-005c9b49b63793004     still has dependencies, will retry</span><br><span class="line">Not all resources deleted; waiting before reattempting deletion</span><br><span class="line">        dhcp-options:dopt-0a0be88814a0c83a9</span><br><span class="line">        volume:vol-074914e494e4b656d</span><br><span class="line">        security-group:sg-01f81918cdbaba212</span><br><span class="line">        vpc:vpc-0775d4b463932d2f7</span><br><span class="line">        route-table:rtb-06b591f24a01973f6</span><br><span class="line">        internet-gateway:igw-0a939d66d6e93e0d5</span><br><span class="line">        security-group:sg-005c9b49b63793004</span><br><span class="line">        subnet:subnet-060ec2db19027cf6a</span><br><span class="line">        security-group:sg-07b79756088cf753c</span><br><span class="line">        subnet:subnet-0def003bdbfd97915</span><br><span class="line">        security-group:sg-07ef00367ce1a7b62</span><br><span class="line">internet-gateway:igw-0a939d66d6e93e0d5  still has dependencies, will retry</span><br><span class="line">volume:vol-074914e494e4b656d    ok</span><br><span class="line">subnet:subnet-060ec2db19027cf6a still has dependencies, will retry</span><br><span class="line">security-group:sg-01f81918cdbaba212     still has dependencies, will retry</span><br><span class="line">security-group:sg-005c9b49b63793004     still has dependencies, will retry</span><br><span class="line">security-group:sg-07b79756088cf753c     still has dependencies, will retry</span><br><span class="line">subnet:subnet-0def003bdbfd97915 ok</span><br><span class="line">security-group:sg-07ef00367ce1a7b62     ok</span><br><span class="line">Not all resources deleted; waiting before reattempting deletion</span><br><span class="line">        security-group:sg-01f81918cdbaba212</span><br><span class="line">        vpc:vpc-0775d4b463932d2f7</span><br><span class="line">        route-table:rtb-06b591f24a01973f6</span><br><span class="line">        internet-gateway:igw-0a939d66d6e93e0d5</span><br><span class="line">        security-group:sg-005c9b49b63793004</span><br><span class="line">        subnet:subnet-060ec2db19027cf6a</span><br><span class="line">        security-group:sg-07b79756088cf753c</span><br><span class="line">        dhcp-options:dopt-0a0be88814a0c83a9</span><br><span class="line">subnet:subnet-060ec2db19027cf6a still has dependencies, will retry</span><br><span class="line">security-group:sg-005c9b49b63793004     still has dependencies, will retry</span><br><span class="line">security-group:sg-07b79756088cf753c     still has dependencies, will retry</span><br><span class="line">internet-gateway:igw-0a939d66d6e93e0d5  ok</span><br><span class="line">security-group:sg-01f81918cdbaba212     ok</span><br><span class="line">Not all resources deleted; waiting before reattempting deletion</span><br><span class="line">        dhcp-options:dopt-0a0be88814a0c83a9</span><br><span class="line">        vpc:vpc-0775d4b463932d2f7</span><br><span class="line">        route-table:rtb-06b591f24a01973f6</span><br><span class="line">        security-group:sg-005c9b49b63793004</span><br><span class="line">        subnet:subnet-060ec2db19027cf6a</span><br><span class="line">        security-group:sg-07b79756088cf753c</span><br><span class="line">subnet:subnet-060ec2db19027cf6a ok</span><br><span class="line">security-group:sg-005c9b49b63793004     ok</span><br><span class="line">security-group:sg-07b79756088cf753c     ok</span><br><span class="line">route-table:rtb-06b591f24a01973f6       ok</span><br><span class="line">vpc:vpc-0775d4b463932d2f7       ok</span><br><span class="line">dhcp-options:dopt-0a0be88814a0c83a9     ok</span><br><span class="line">Deleted kubectl config for fleetman.k8s.local</span><br><span class="line"></span><br><span class="line">Deleted cluster: &quot;fleetman.k8s.local&quot;</span><br></pre></td></tr></table></figure>
<h3 id="Restarting-the-Cluster"><a href="#Restarting-the-Cluster" class="headerlink" title="Restarting the Cluster"></a>Restarting the Cluster</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@foobar ~]$ history|grep export</span><br><span class="line">    4  export NAME=fleetman.k8s.local</span><br><span class="line">    6  export KOPS_STATE_STORE=s3://stanzhou-state-storage</span><br><span class="line"></span><br><span class="line">kops create cluster --zones ap-southeast-2a,ap-southeast-2b,ap-southeast-2c $&#123;NAME&#125;</span><br><span class="line"></span><br><span class="line">kops edit ig --name=fleetman.k8s.local nodes</span><br><span class="line">kops update cluster $&#123;NAME&#125; --yes</span><br><span class="line">kops validate cluster</span><br><span class="line">kubectl apply -f .</span><br><span class="line">kubectl get svc</span><br><span class="line">kubectl describe svc fleetman-webapp</span><br></pre></td></tr></table></figure>
<h1 id="Logging-a-Cluster"><a href="#Logging-a-Cluster" class="headerlink" title="Logging a Cluster"></a>Logging a Cluster</h1><h2 id="Introducing-the-ELK-ElasticStack"><a href="#Introducing-the-ELK-ElasticStack" class="headerlink" title="Introducing the ELK/ElasticStack"></a>Introducing the ELK/ElasticStack</h2><p><img src="https://i.imgur.com/YRocsbG.png" alt="ELK Stack"><br><img src="https://i.imgur.com/VZihLCY.png" alt="ELK Stack2"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kubectl get po</span><br><span class="line">NAME                                  READY   STATUS    RESTARTS   AGE</span><br><span class="line">api-gateway-5d445d6f69-kg68n          1/1     Running   0          19h</span><br><span class="line">mongodb-5559556bf-ghq5p               1/1     Running   0          19h</span><br><span class="line">position-simulator-7ffd4f8f68-kwlcb   1/1     Running   0          19h</span><br><span class="line">position-tracker-5ff4fb7479-2ctzt     1/1     Running   0          19h</span><br><span class="line">queue-75f4ddd795-wp2mh                1/1     Running   0          10h</span><br><span class="line">webapp-689dd9b4f4-php92               1/1     Running   0          19h</span><br><span class="line">webapp-689dd9b4f4-vgtpg               1/1     Running   0          19h</span><br><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kubectl get svc</span><br><span class="line">NAME                        TYPE           CLUSTER-IP       EXTERNAL-IP                                                                    PORT(S)              AGE</span><br><span class="line">fleetman-api-gateway        ClusterIP      100.67.195.111   &lt;none&gt;                                                                         8080/TCP             20h</span><br><span class="line">fleetman-mongodb            ClusterIP      100.68.143.136   &lt;none&gt;                                                                         27017/TCP            20h</span><br><span class="line">fleetman-position-tracker   ClusterIP      100.69.119.23    &lt;none&gt;                                                                         8080/TCP             20h</span><br><span class="line">fleetman-queue              ClusterIP      100.65.16.172    &lt;none&gt;                                                                         8161/TCP,61616/TCP   20h</span><br><span class="line">fleetman-webapp             LoadBalancer   100.70.168.148   ac185d1638c0311e9bef7028ed3b83c9-1696162465.ap-southeast-2.elb.amazonaws.com   80:31504/TCP         20h</span><br><span class="line">kubernetes                  ClusterIP      100.64.0.1       &lt;none&gt;                                                                         443/TCP              20h</span><br><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kubectl get svc -n kube-system</span><br><span class="line">NAME                    TYPE           CLUSTER-IP       EXTERNAL-IP                                                                   PORT(S)          AGE</span><br><span class="line">elasticsearch-logging   ClusterIP      100.68.193.244   &lt;none&gt;                                                                        9200/TCP         19h</span><br><span class="line">kibana-logging          LoadBalancer   100.67.153.183   a3c20f00a8c0811e9bef7028ed3b83c9-306741856.ap-southeast-2.elb.amazonaws.com   5601:32716/TCP   19h</span><br><span class="line">kube-dns                ClusterIP      100.64.0.10      &lt;none&gt;                                                                        53/UDP,53/TCP    20h</span><br><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kubectl describe svc kibana-logging -n kube-system</span><br><span class="line">Name:                     kibana-logging</span><br><span class="line">Namespace:                kube-system</span><br><span class="line">Labels:                   addonmanager.kubernetes.io/mode=Reconcile</span><br><span class="line">                          k8s-app=kibana-logging</span><br><span class="line">                          kubernetes.io/cluster-service=true</span><br><span class="line">                          kubernetes.io/name=Kibana</span><br><span class="line">Annotations:              kubectl.kubernetes.io/last-applied-configuration:</span><br><span class="line">                            &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Service&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;labels&quot;:&#123;&quot;addonmanager.kubernetes.io/mode&quot;:&quot;Reconcile&quot;,&quot;k8s-app&quot;:&quot;kibana...</span><br><span class="line">Selector:                 k8s-app=kibana-logging</span><br><span class="line">Type:                     LoadBalancer</span><br><span class="line">IP:                       100.67.153.183</span><br><span class="line">LoadBalancer Ingress:     a3c20f00a8c0811e9bef7028ed3b83c9-306741856.ap-southeast-2.elb.amazonaws.com</span><br><span class="line">Port:                     &lt;unset&gt;  5601/TCP</span><br><span class="line">TargetPort:               ui/TCP</span><br><span class="line">NodePort:                 &lt;unset&gt;  32716/TCP</span><br><span class="line">Endpoints:                100.96.1.5:5601</span><br><span class="line">Session Affinity:         None</span><br><span class="line">External Traffic Policy:  Cluster</span><br><span class="line">Events:                   &lt;none&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="MONITORING-WITH-PROMETHEUS-AND-GRAFANA"><a href="#MONITORING-WITH-PROMETHEUS-AND-GRAFANA" class="headerlink" title="MONITORING WITH PROMETHEUS AND GRAFANA"></a>MONITORING WITH PROMETHEUS AND GRAFANA</h1><h2 id="Monitoring-a-Cluster"><a href="#Monitoring-a-Cluster" class="headerlink" title="Monitoring a Cluster"></a>Monitoring a Cluster</h2><p><a href="https://prometheus.io/">Prometheus</a><br><a href="https://grafana.com">Grafana</a><br>Concerntrate solely on integrating Grafana with Prometheus.</p>
<h2 id="Helm-Package-Manager"><a href="#Helm-Package-Manager" class="headerlink" title="Helm Package Manager"></a>Helm Package Manager</h2><p>The Kubernetes package manager <a href="https://helm.sh">Helm</a></p>
<p>Install Helm:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">wget https://get.helm.sh/helm-v2.14.1-linux-amd64.tar.gz</span><br><span class="line">tar zxvf helm-v2.14.1-linux-amd64.tar.gz</span><br><span class="line">sudo mv linux-amd64/helm /usr/local/bin/</span><br><span class="line">rm helm-v2.14.1-linux-amd64.tar.gz</span><br><span class="line">rm -rf ./linux-amd64/</span><br><span class="line">helm --help</span><br><span class="line">helm version</span><br><span class="line">helm init</span><br><span class="line"></span><br><span class="line">kubectl create serviceaccount --namespace kube-system tiller</span><br><span class="line"></span><br><span class="line">kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller</span><br><span class="line"></span><br><span class="line">kubectl patch deploy --namespace kube-system tiller-deploy -p &apos;&#123;&quot;spec&quot;:&#123;&quot;template&quot;:&#123;&quot;spec&quot;:&#123;&quot;serviceAccount&quot;:&quot;tiller&quot;&#125;&#125;&#125;&#125;&apos;</span><br></pre></td></tr></table></figure></p>
<p>Delete Helm:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">helm ls</span><br><span class="line">helm delete --purge my-special-installation</span><br><span class="line">kubectl get po</span><br></pre></td></tr></table></figure></p>
<h2 id="Installing-Prometheus-Operator"><a href="#Installing-Prometheus-Operator" class="headerlink" title="Installing Prometheus Operator"></a>Installing Prometheus Operator</h2><p><a href="https://github.com/helm/charts/tree/master/stable/prometheus-operator">install</a></p>
<p><code>helm install --name monitoring --namespace monitoring stable/prometheus-operator</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kubectl get all -n monitoring</span><br><span class="line">NAME                                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/alertmanager-monitoring-prometheus-oper-alertmanager-0   2/2     Running   0          4m</span><br><span class="line">pod/monitoring-grafana-c768bb86f-cgmj8                       2/2     Running   0          4m27s</span><br><span class="line">pod/monitoring-kube-state-metrics-6488587c6-zrjmg            1/1     Running   0          4m27s</span><br><span class="line">pod/monitoring-prometheus-node-exporter-5cp7v                1/1     Running   0          4m27s</span><br><span class="line">pod/monitoring-prometheus-node-exporter-75v99                1/1     Running   0          4m27s</span><br><span class="line">pod/monitoring-prometheus-node-exporter-jcl7r                1/1     Running   0          4m27s</span><br><span class="line">pod/monitoring-prometheus-node-exporter-vptns                1/1     Running   0          4m27s</span><br><span class="line">pod/monitoring-prometheus-oper-operator-7b54f56766-j8k6c     1/1     Running   0          4m27s</span><br><span class="line">pod/prometheus-monitoring-prometheus-oper-prometheus-0       3/3     Running   1          3m52s</span><br><span class="line"></span><br><span class="line">NAME                                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE</span><br><span class="line">service/alertmanager-operated                     ClusterIP   None             &lt;none&gt;        9093/TCP,6783/TCP   4m</span><br><span class="line">service/monitoring-grafana                        ClusterIP   100.70.116.236   &lt;none&gt;        80/TCP              4m28s</span><br><span class="line">service/monitoring-kube-state-metrics             ClusterIP   100.67.183.154   &lt;none&gt;        8080/TCP            4m28s</span><br><span class="line">service/monitoring-prometheus-node-exporter       ClusterIP   100.68.145.110   &lt;none&gt;        9100/TCP            4m28s</span><br><span class="line">service/monitoring-prometheus-oper-alertmanager   ClusterIP   100.70.75.68     &lt;none&gt;        9093/TCP            4m28s</span><br><span class="line">service/monitoring-prometheus-oper-operator       ClusterIP   100.66.237.147   &lt;none&gt;        8080/TCP            4m28s</span><br><span class="line">service/monitoring-prometheus-oper-prometheus     ClusterIP   100.67.205.22    &lt;none&gt;        9090/TCP            4m28s</span><br><span class="line">service/prometheus-operated                       ClusterIP   None             &lt;none&gt;        9090/TCP            3m53s</span><br><span class="line"></span><br><span class="line">NAME                                                 DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span><br><span class="line">daemonset.apps/monitoring-prometheus-node-exporter   4         4         4       4            4           &lt;none&gt;          4m27s</span><br><span class="line"></span><br><span class="line">NAME                                                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/monitoring-grafana                    1         1         1            1           4m27s</span><br><span class="line">deployment.apps/monitoring-kube-state-metrics         1         1         1            1           4m27s</span><br><span class="line">deployment.apps/monitoring-prometheus-oper-operator   1         1         1            1           4m27s</span><br><span class="line"></span><br><span class="line">NAME                                                             DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/monitoring-grafana-c768bb86f                     1         1         1       4m27s</span><br><span class="line">replicaset.apps/monitoring-kube-state-metrics-6488587c6          1         1         1       4m27s</span><br><span class="line">replicaset.apps/monitoring-prometheus-oper-operator-7b54f56766   1         1         1       4m27s</span><br><span class="line"></span><br><span class="line">NAME                                                                    DESIRED   CURRENT   AGE</span><br><span class="line">statefulset.apps/alertmanager-monitoring-prometheus-oper-alertmanager   1         1         4m</span><br><span class="line">statefulset.apps/prometheus-monitoring-prometheus-oper-prometheus       1         1         3m53s</span><br><span class="line"></span><br><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kubectl edit -n monitoring service/monitoring-prometheus-oper-prometheus</span><br><span class="line"></span><br><span class="line">Change type from ClusterIP to LoadBalancer</span><br><span class="line"></span><br><span class="line">[ec2-user@ip-172-31-4-9 ~]$ kubectl get all -n monitoring</span><br><span class="line">NAME                                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/alertmanager-monitoring-prometheus-oper-alertmanager-0   2/2     Running   0          16m</span><br><span class="line">pod/monitoring-grafana-c768bb86f-cgmj8                       2/2     Running   0          17m</span><br><span class="line">pod/monitoring-kube-state-metrics-6488587c6-zrjmg            1/1     Running   0          17m</span><br><span class="line">pod/monitoring-prometheus-node-exporter-5cp7v                1/1     Running   0          17m</span><br><span class="line">pod/monitoring-prometheus-node-exporter-75v99                1/1     Running   0          17m</span><br><span class="line">pod/monitoring-prometheus-node-exporter-jcl7r                1/1     Running   0          17m</span><br><span class="line">pod/monitoring-prometheus-node-exporter-vptns                1/1     Running   0          17m</span><br><span class="line">pod/monitoring-prometheus-oper-operator-7b54f56766-j8k6c     1/1     Running   0          17m</span><br><span class="line">pod/prometheus-monitoring-prometheus-oper-prometheus-0       3/3     Running   1          16m</span><br><span class="line"></span><br><span class="line">NAME                                              TYPE           CLUSTER-IP       EXTERNAL-IP                                                                    PORT(S)             AGE</span><br><span class="line">service/alertmanager-operated                     ClusterIP      None             &lt;none&gt;                                                                         9093/TCP,6783/TCP   16m</span><br><span class="line">service/monitoring-grafana                        ClusterIP      100.70.116.236   &lt;none&gt;                                                                         80/TCP              17m</span><br><span class="line">service/monitoring-kube-state-metrics             ClusterIP      100.67.183.154   &lt;none&gt;                                                                         8080/TCP            17m</span><br><span class="line">service/monitoring-prometheus-node-exporter       ClusterIP      100.68.145.110   &lt;none&gt;                                                                         9100/TCP            17m</span><br><span class="line">service/monitoring-prometheus-oper-alertmanager   ClusterIP      100.70.75.68     &lt;none&gt;                                                                         9093/TCP            17m</span><br><span class="line">service/monitoring-prometheus-oper-operator       ClusterIP      100.66.237.147   &lt;none&gt;                                                                         8080/TCP            17m</span><br><span class="line">service/monitoring-prometheus-oper-prometheus     LoadBalancer   100.67.205.22    a86903ccd8ce211e9bef7028ed3b83c9-1698452662.ap-southeast-2.elb.amazonaws.com   9090:32096/TCP      17m</span><br><span class="line">service/prometheus-operated                       ClusterIP      None             &lt;none&gt;                                                                         9090/TCP            16m</span><br><span class="line"></span><br><span class="line">NAME                                                 DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span><br><span class="line">daemonset.apps/monitoring-prometheus-node-exporter   4         4         4       4            4           &lt;none&gt;          17m</span><br><span class="line"></span><br><span class="line">NAME                                                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/monitoring-grafana                    1         1         1            1           17m</span><br><span class="line">deployment.apps/monitoring-kube-state-metrics         1         1         1            1           17m</span><br><span class="line">deployment.apps/monitoring-prometheus-oper-operator   1         1         1            1           17m</span><br><span class="line"></span><br><span class="line">NAME                                                             DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/monitoring-grafana-c768bb86f                     1         1         1       17m</span><br><span class="line">replicaset.apps/monitoring-kube-state-metrics-6488587c6          1         1         1       17m</span><br><span class="line">replicaset.apps/monitoring-prometheus-oper-operator-7b54f56766   1         1         1       17m</span><br><span class="line"></span><br><span class="line">NAME                                                                    DESIRED   CURRENT   AGE</span><br><span class="line">statefulset.apps/alertmanager-monitoring-prometheus-oper-alertmanager   1         1         16m</span><br><span class="line">statefulset.apps/prometheus-monitoring-prometheus-oper-prometheus       1         1         16m</span><br></pre></td></tr></table></figure>
<h2 id="Working-with-Grafana"><a href="#Working-with-Grafana" class="headerlink" title="Working with Grafana"></a>Working with Grafana</h2><p>change back from LoadBalancer to ClusterIP on service/monitoring-prometheus-oper-prometheus<br>change from ClusterIP to LoadBalancer on service/monitoring-grafana </p>
<h1 id="The-Alert-Manager"><a href="#The-Alert-Manager" class="headerlink" title="The Alert Manager"></a>The Alert Manager</h1><h2 id="Alerting"><a href="#Alerting" class="headerlink" title="Alerting"></a>Alerting</h2>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/kubernetes/">kubernetes</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/08/beginningDevOpsWithDocker/" title="Beginning DevOps with Docker" itemprop="url">Beginning DevOps with Docker</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-08T13:20:43.000Z" itemprop="datePublished"> Published 2019-05-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="https://docs.00root.com">see</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Devops/">Devops</a><a href="/tags/Docker/">Docker</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/08/vim/" title="vim" itemprop="url">vim</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-08T12:13:36.000Z" itemprop="datePublished"> Published 2019-05-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Multiple-file-edit"><a href="#Multiple-file-edit" class="headerlink" title="Multiple file edit"></a>Multiple file edit</h3><p>Open multiple files in separate tab via <code>vim -p file1.txt file2.txt</code>.<br>If already open just use <code>:tabe file2.txt</code>.<br>Just 1gt, 2gt, use <code>gt</code> to view.<br>Close tabs using <code>:tabc</code></p>
<h3 id="Replace-string-globally"><a href="#Replace-string-globally" class="headerlink" title="Replace string globally"></a>Replace string globally</h3><p>:%s/release1/release2/g</p>
<h3 id="evil-tutor"><a href="#evil-tutor" class="headerlink" title="evil-tutor"></a>evil-tutor</h3><p>/ followed by a phrase searches FORWARD for the phrase<br>? followed by a phrase searches BACKWARD for the phrase<br>After a search type n to find the next occurrence in the same direction<br>or N to search in the opposite direction.</p>
<p>Type % to find a matching ),], or }<br>The cursor should be on the matching parenthesis or bracket.</p>
<h1 id="a-way-to-change-errors"><a href="#a-way-to-change-errors" class="headerlink" title="a way to change errors"></a>a way to change errors</h1><p>:s/old/new to substitute ‘new’ for first ‘old’s on a line type<br>:s/old/new/g to substitute ‘new’ for all ‘old’s on a line type<br>:#,#s/old/new/g to substitute phrases between two line #’s type<br>:%s/old/new/g to substitute all occurrences in the file type<br>:%s/old/new/gc to ask for confirmation each time add ‘c’</p>
<h1 id="execute-an-external-command"><a href="#execute-an-external-command" class="headerlink" title="execute an external command"></a>execute an external command</h1><p>:! external command</p>
<h1 id="writing-files"><a href="#writing-files" class="headerlink" title="writing files"></a>writing files</h1><p>:w TEST </p>
<h1 id="remove-the-file"><a href="#remove-the-file" class="headerlink" title="remove the file"></a>remove the file</h1><p>:!rm TEST</p>
<h1 id="to-save-part-of-the-file"><a href="#to-save-part-of-the-file" class="headerlink" title="to save part of the file"></a>to save part of the file</h1><p>:#,# w FILENAME</p>
<h1 id="retrieves-disk-file-FILENAME-and-inserts-it-into-the-current-buffer-following-the-cursor-position"><a href="#retrieves-disk-file-FILENAME-and-inserts-it-into-the-current-buffer-following-the-cursor-position" class="headerlink" title="retrieves disk file FILENAME and inserts it into the current buffer following the cursor position"></a>retrieves disk file FILENAME and inserts it into the current buffer following the cursor position</h1><p>:r FILENAME</p>
<h1 id="opens-a-line-BELOW-the-cursor-and-places-the-cursor-on-the-open-line-in-insert-state"><a href="#opens-a-line-BELOW-the-cursor-and-places-the-cursor-on-the-open-line-in-insert-state" class="headerlink" title="opens a line BELOW the cursor and places the cursor on the open line in insert state"></a>opens a line BELOW the cursor and places the cursor on the open line in insert state</h1><p>o</p>
<h1 id="opens-a-line-ABOVE-the-cursor-and-places-the-cursor-on-the-open-line-in-insert-state"><a href="#opens-a-line-ABOVE-the-cursor-and-places-the-cursor-on-the-open-line-in-insert-state" class="headerlink" title="opens a line ABOVE the cursor and places the cursor on the open line in insert state"></a>opens a line ABOVE the cursor and places the cursor on the open line in insert state</h1><p>O</p>
<h1 id="R-to-replace-more-than-on-character"><a href="#R-to-replace-more-than-on-character" class="headerlink" title="R to replace more than on character"></a>R to replace more than on character</h1><p>R enters Repace mode until <ESC> is pressed to exit.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/vim/">vim</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/08/JenkinsForProfessionals/" title="Jenkins For Professionals" itemprop="url">Jenkins For Professionals</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-08T11:26:40.000Z" itemprop="datePublished"> Published 2019-05-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Jenkins-for-Professionals"><a href="#Jenkins-for-Professionals" class="headerlink" title="Jenkins for Professionals"></a>Jenkins for Professionals</h1><h2 id="Jenkins’s-architecture"><a href="#Jenkins’s-architecture" class="headerlink" title="Jenkins’s architecture"></a>Jenkins’s architecture</h2><p>Github repository –&gt; Master -&gt; slave<br>                             -&gt; slave</p>
<p>Why distributed architecture for Jenkins?</p>
<ul>
<li>Sometime, several different environments needed</li>
<li>If a larger project gets build, a single server cannot handle entire load<br>Jenkins Master:</li>
<li>Scheduling jobs</li>
<li>Communicating with the slaves</li>
<li>Monitor the slaves</li>
<li>Present the results</li>
<li>Master can also execute build jobs</li>
</ul>
<p>Jenkins Slave:</p>
<ul>
<li>Communicates with Jenkins Master</li>
<li>Can run in different OS</li>
<li>Execute jobs</li>
<li>Flexibility</li>
</ul>
<h2 id="Jenkins-Freestyle-job"><a href="#Jenkins-Freestyle-job" class="headerlink" title="Jenkins Freestyle job"></a>Jenkins Freestyle job</h2><ul>
<li>Central feature of Jenkins</li>
<li>Using jenkins UI to create a CI Pipeline</li>
</ul>
<p><a href="https://github.com/ravikiran-srini/springExample">https://github.com/ravikiran-srini/springExample</a></p>
<h2 id="Scheduling-a-Jenkins-job"><a href="#Scheduling-a-Jenkins-job" class="headerlink" title="Scheduling a Jenkins job"></a>Scheduling a Jenkins job</h2><ul>
<li>Scheduling is one of the options of a Build Trigger</li>
<li>Use CRON expressions to schedule a job<ul>
<li>Each line consists of 5 fields sparated by TAB or whitespace</li>
<li>MINUTE HOUR DOM MONTH DOW<br>0 refers to Sunday</li>
</ul>
</li>
<li>To specify multiple values, use the following:<ul>
<li><ul>
<li>for all valid values</li>
</ul>
</li>
<li>0-9 specify a range of values</li>
<li>2,3,4,5 to enumerate multiple values</li>
</ul>
</li>
<li>Use Hash system for automatic balancing<ul>
<li>Use H H <em> </em> <em> instead of 0 0 </em> <em> </em></li>
</ul>
</li>
<li>Use aliases like @yearly, @monthly, @weekly<ul>
<li>@hourly is the same as H <em> </em> <em> </em></li>
</ul>
</li>
</ul>
<p>Under Source Code Management of Project,<br>in Build Triggers, tick Build periodically, put five starts.</p>
<h2 id="Triggering-builds-remotely"><a href="#Triggering-builds-remotely" class="headerlink" title="Triggering builds remotely"></a>Triggering builds remotely</h2><p>Build Triggers-&gt; tick ‘Tigger build remotely’, put Authenication Token value.</p>
<h2 id="Parameterizing-build"><a href="#Parameterizing-build" class="headerlink" title="Parameterizing build"></a>Parameterizing build</h2><ul>
<li>Allow you to prompt users for one or more inputs</li>
<li>Each parameter has a name and a value</li>
<li>Can be accessed using $paramater or %parameter%</li>
<li>‘Build Now’ will be replaced by “Build with Parameters”</li>
</ul>
<p>Types of Parameters</p>
<ul>
<li>Boolean Parameter</li>
<li>Choice Parameter</li>
<li>Credentials Parameter</li>
<li>File Parameter</li>
<li>List Subversion tags</li>
<li>Password Parameter</li>
<li>Run Parameter</li>
<li>String Parameter</li>
</ul>
<h2 id="Creating-a-user"><a href="#Creating-a-user" class="headerlink" title="Creating a user"></a>Creating a user</h2><h2 id="Installing-Plugins"><a href="#Installing-Plugins" class="headerlink" title="Installing Plugins"></a>Installing Plugins</h2><p>Plugin name: Role-based Authorization Strategy</p>
<h2 id="Implementing-Role-based-access"><a href="#Implementing-Role-based-access" class="headerlink" title="Implementing Role based access"></a>Implementing Role based access</h2><p>Enabling role based access<br>Manage Jenkins-&gt; Configure Global Security, tick ‘Enable security’<br>Authorization select ‘Role-Based Strategy’</p>
<p>Under Manage Jenkins you will have a new ‘Manage and Assign Roles’-&gt; Manage roles</p>
<p>In ‘Global roles’ add role ‘team’ with overall read permission.<br>In “Project roles” add role ‘dev’ with ‘Pattern’ ‘Dev.*’, and tick all the boxes.<br>Same for ‘test’ and ‘ops’.<br><img src="https://i.imgur.com/MSJOKSL.png" alt="ManageRoles"></p>
<h3 id="Assign-Roles"><a href="#Assign-Roles" class="headerlink" title="Assign Roles"></a>Assign Roles</h3><p>Click “Assign Roles”, in ‘Global roles’ add ‘dev’, ‘test’ and ‘ops’ into group ‘team’.<br>Under ‘Item roles’ add user ‘dev’,’test’ and ‘ops’ and assign to its own role. </p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="https://i.imgur.com/ml63iH6.png" alt="AssignRoles"></h2><h2 id="Jenkins-in-Docker"><a href="#Jenkins-in-Docker" class="headerlink" title="Jenkins in Docker"></a>Jenkins in Docker</h2><h3 id="Running-jenkins-in-docker"><a href="#Running-jenkins-in-docker" class="headerlink" title="Running jenkins in docker"></a>Running jenkins in docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull jenkins</span><br><span class="line">docker run -p 8080:8080 -p 50000:50000 jenkins</span><br></pre></td></tr></table></figure>
<h3 id="Persisting-Jenkins-data-in-a-Volume"><a href="#Persisting-Jenkins-data-in-a-Volume" class="headerlink" title="Persisting Jenkins data in a Volume"></a>Persisting Jenkins data in a Volume</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker volume create volume1</span><br><span class="line">docker volume volume ls</span><br><span class="line">docker run -p 8080:8080 -p 50000:50000 -v  volume1:/var/jenkins_home jenkins #v means bond a volume</span><br></pre></td></tr></table></figure>
<p><code>docker stop $(docker ps -aq) #stop all the containers</code><br><code>docker rm $(docker ps -aq) #remove the container</code></p>
<h3 id="Running-multiple-Jenkins-instances-in-Docker"><a href="#Running-multiple-Jenkins-instances-in-Docker" class="headerlink" title="Running multiple Jenkins instances in Docker"></a>Running multiple Jenkins instances in Docker</h3><p><img src="https://i.imgur.com/0yAeBkU.png" alt="demo"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:8080 -p 50000:50000 -v  volume1:/var/jenkins_home jenkins</span><br><span class="line">docker run -p 8081:8080 -p 50001:50000 -v  volume1:/var/jenkins_home jenkins</span><br></pre></td></tr></table></figure></p>
<h2 id="Jenkins-Plugins"><a href="#Jenkins-Plugins" class="headerlink" title="Jenkins Plugins"></a>Jenkins Plugins</h2><h3 id="Create-build-monitor-view"><a href="#Create-build-monitor-view" class="headerlink" title="Create build monitor view"></a>Create build monitor view</h3><p>Install pugin: build monitor view</p>
<h3 id="Using-catlight"><a href="#Using-catlight" class="headerlink" title="Using catlight"></a>Using <a href="https://catlight.io">catlight</a></h3><p><strong>Catlight</strong></p>
<ul>
<li>A notification app for developers</li>
<li>Available for wind, mac &amp; Linux os</li>
<li>Monitor Busg, tasks, builds</li>
<li>See status in the tray and get notified</li>
<li>This is a jenkins plugin</li>
</ul>
<h3 id="Using-Jenkins-CLI"><a href="#Using-Jenkins-CLI" class="headerlink" title="Using Jenkins CLI"></a>Using Jenkins CLI</h3><ul>
<li>Jenkins has a built-in CLI<br>Manage Jenkins-&gt; Jenkins CLI-&gt; Download jenkins-cli.jar</li>
</ul>
<p><code>java -jar jenkins-cli.jar -s http://localhost:8080/ build pipeline -f --username stanadmin --password mario54321</code></p>
<p>Change ‘Configure Global Security’ -&gt; ‘Authorization’-&gt; Logged-in users can do anything-Allow anonymous read access</p>
<p><code>java -jar jenkins-cli.jar -s http://localhost:8080/ build Parameterized-build -f -p environment=&#39;dev&#39;</code></p>
<h3 id="Jenkins-Multibranch-Pipeline"><a href="#Jenkins-Multibranch-Pipeline" class="headerlink" title="Jenkins Multibranch Pipeline"></a>Jenkins Multibranch Pipeline</h3><ul>
<li>Implement different Jenkinsfile for different branches<br>New iteam-&gt; Select Multibranch Pipline-&gt; Scan multibranch pipleline Now<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git remote add proj1 https://github.com/szhouchoice/springExample.git</span><br><span class="line">git branch</span><br><span class="line">git branch -a</span><br><span class="line">git branch feature2</span><br><span class="line">git checkout feature2 # Switched to branch &apos;feature2&apos;</span><br><span class="line">git push origin feature2</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Integrating-Jenkins-with-Slack"><a href="#Integrating-Jenkins-with-Slack" class="headerlink" title="Integrating Jenkins with Slack"></a>Integrating Jenkins with Slack</h3><p>Install: Jenkins-&gt;Plugin Manager-&gt; Slack Notification</p>
<h3 id="Jenkins-Metrics-and-Trends"><a href="#Jenkins-Metrics-and-Trends" class="headerlink" title="Jenkins Metrics and Trends"></a>Jenkins Metrics and Trends</h3><p><strong>Build History Metrics Plugin</strong></p>
<ul>
<li>Mean Time To Failure (MTTF)</li>
<li>Mean Time To Recovery (MTTR)</li>
<li>Standard Deviation<br>Install: Plugin Manager-&gt;Build history metrics<br><img src="https://i.imgur.com/C9aaE74.png" alt="Build History Metrics"><br><strong>Global Build Stats</strong><br>Install: Plugin Manager-&gt;global-build-stats<br>Manage Jenkins-&gt;Global Build Stats-&gt;Initalize stats-&gt;Create new chart-&gt;<br>Title: foobar<br>600*400<br>Hourly<br>24 hours<br><img src="https://i.imgur.com/tRfhyNR.png" alt="Global Build Stats"></li>
</ul>
<h2 id="Introduction-to-Jenkins-Pipeline"><a href="#Introduction-to-Jenkins-Pipeline" class="headerlink" title="Introduction to Jenkins Pipeline"></a>Introduction to Jenkins Pipeline</h2><ul>
<li>A suite of plugins that support continuous delivery pipelines</li>
<li>They provide tools for modeling delivery pipelines as</li>
<li>Definition is written into a text file called ‘Jenkinsfile’</li>
</ul>
<p>Benefits of pipelines</p>
<ul>
<li>Automatically creates a Pipeline build process</li>
<li>Code review of the Pipeline</li>
<li>Audit trail of the Pipeline </li>
<li>Single source of truth</li>
</ul>
<p>Declarative vs Scripted Pipeline </p>
<ul>
<li>Jenkinsfile can be written using:<ul>
<li>Declarative</li>
<li>Scripted</li>
</ul>
</li>
<li>Declarative is a more recent feature<ul>
<li>provides rich syntactical feature</li>
<li>designed to make reading &amp; writing Pipelines easier</li>
</ul>
</li>
</ul>
<p>Why pipeline?</p>
<ul>
<li>Pipelines add a powerful set of automation tolls onto Jenkins</li>
<li>Features of Pipeline are:<ul>
<li>Pipelines are implemented in code </li>
<li>Pipelines support complex real-world CD requirements</li>
<li>Pipelines can survive both planned and unplanned restarts</li>
<li>Pipeline plugin supports custom extensions</li>
<li>Pipelines can stop and wait</li>
</ul>
</li>
</ul>
<h2 id="Pipeline-concepts"><a href="#Pipeline-concepts" class="headerlink" title="Pipeline concepts"></a>Pipeline concepts</h2><ul>
<li>Pipeline</li>
<li>Node</li>
<li>Stage: build, test, deploy</li>
<li>Step</li>
</ul>
<p>Declarative Pipeline syntax<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pipeline&#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages&#123;</span><br><span class="line">    stage(&apos;Build&apos;)&#123;</span><br><span class="line">	steps &#123;</span><br><span class="line">	   //</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Test&apos;)&#123;</span><br><span class="line">	steps &#123;</span><br><span class="line">	   //</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Deploy&apos;)&#123;</span><br><span class="line">	steps &#123;</span><br><span class="line">	   //</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Declarative Pipeline syntax<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">  stage(&apos;Build&apos;)&#123;</span><br><span class="line">    //</span><br><span class="line">  &#125;</span><br><span class="line">  stage(&apos;Test&apos;)&#123;</span><br><span class="line">    //</span><br><span class="line">  &#125;</span><br><span class="line">  stage(&apos;Deploy&apos;)&#123;</span><br><span class="line">   //</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Creating-a-simple-Pipeline"><a href="#Creating-a-simple-Pipeline" class="headerlink" title="Creating a simple Pipeline"></a>Creating a simple Pipeline</h2><ul>
<li>Pipeline can be created in any of the following ways:<ul>
<li>Blue Ocean</li>
<li>Through Classic UI</li>
<li>In SCM(Source Code Managment)</li>
</ul>
</li>
</ul>
<h2 id="Building-a-project-with-jenkins-pipeline"><a href="#Building-a-project-with-jenkins-pipeline" class="headerlink" title="Building a project with jenkins pipeline"></a>Building a project with jenkins pipeline</h2><p>pipeline script:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pipeline&#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages&#123;</span><br><span class="line">    stage(&apos;Build&apos;)&#123;</span><br><span class="line">        steps &#123;</span><br><span class="line">           bat &quot;rm -rf springExample&quot;</span><br><span class="line">           bat &quot;git clone https://github.com/ravikiran-srini/springExample.git&quot;</span><br><span class="line">           bat &quot;mvn clean -f springExample&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Test&apos;)&#123;</span><br><span class="line">        steps &#123;</span><br><span class="line">           bat &quot;mvn test -f springExample&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Deploy&apos;)&#123;</span><br><span class="line">        steps &#123;</span><br><span class="line">           bat &quot;mvn package -f springExample&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Building-a-Pipeline-with-Jenkinsfile"><a href="#Building-a-Pipeline-with-Jenkinsfile" class="headerlink" title="Building a Pipeline with Jenkinsfile"></a>Building a Pipeline with Jenkinsfile</h2><p>Jenkinsfile</p>
<ul>
<li>Complex Pipelines are difficult to write and maintain</li>
<li>You can write Jenkinsfile in an IDE and commit to source control</li>
</ul>
<ol>
<li><p>In <a href="https://github.com/szhouchoice/springExample">https://github.com/szhouchoice/springExample</a> add a Jenksinsfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(&apos;Build&apos;) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        sh &apos;mvn clean&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Test&apos;) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        sh &apos;mvn test&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&apos;Deploy&apos;) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        sh &apos;mvn package&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Pipeline<br><img src="https://i.imgur.com/EsJCtWv.png" alt="Pipeline script from SCM"></p>
</li>
</ol>
<h2 id="Using-environment-variables"><a href="#Using-environment-variables" class="headerlink" title="Using environment variables"></a>Using environment variables</h2><p><strong>Environment variables</strong></p>
<ul>
<li>Jenkins exposes environment variables through the variable ‘env’</li>
<li>Entire list of environment variables is accessible from <a href="localhost:8080/pipeline-syntax/globals#env">env variables</a></li>
</ul>
<p>example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&apos;stage1&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo &quot;Build ID: $&#123;env.BUILD_ID&#125;, Jenkins URL: $&#123;env.JENKINS_URL&#125;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Console Ouput:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Started by user Stan Zhou</span><br><span class="line">Running in Durability level: MAX_SURVIVABILITY</span><br><span class="line">[Pipeline] Start of Pipeline</span><br><span class="line">[Pipeline] node</span><br><span class="line">Running on Jenkins in /Users/szhou/.jenkins/workspace/stanpipeline</span><br><span class="line">[Pipeline] &#123;</span><br><span class="line">[Pipeline] stage</span><br><span class="line">[Pipeline] &#123; (stage1)</span><br><span class="line">[Pipeline] echo</span><br><span class="line">Build ID: 1, Jenkins URL: http://localhost:8080/</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // node</span><br><span class="line">[Pipeline] End of Pipeline</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure></p>
<h2 id="Setting-environment-variables"><a href="#Setting-environment-variables" class="headerlink" title="Setting environment variables"></a>Setting environment variables</h2><ul>
<li>Declarative Pipeline<ul>
<li>use ‘environment’ directive</li>
</ul>
</li>
<li>Scripted Pipeline<ul>
<li>use ‘withEnv’ step</li>
</ul>
</li>
<li>environment directive in top-level pipeline block will apply to all steps</li>
<li>environment directive within a stage will only apply with the stage</li>
</ul>
<p>example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    environment &#123;</span><br><span class="line">        mainenv = &apos;test&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&apos;stage1&apos;) &#123;</span><br><span class="line">            environment &#123;</span><br><span class="line">                subenv = &apos;test1&apos;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo mainenv</span><br><span class="line">                echo subenv</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&apos;stage2&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo mainenv</span><br><span class="line">                echo subenv  # will pro error</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="Jenkins-Blue-Ocean"><a href="#Jenkins-Blue-Ocean" class="headerlink" title="Jenkins Blue Ocean"></a>Jenkins Blue Ocean</h1><h2 id="Getting-started-with-blue-ocean"><a href="#Getting-started-with-blue-ocean" class="headerlink" title="Getting started with blue ocean"></a>Getting started with blue ocean</h2><p>What is blue ocean?</p>
<ul>
<li>Blue Ocean refefines the user experience of Jenkins</li>
<li>Features of Blue Ocean are:<ul>
<li>Visualization</li>
<li>Pipeline editor</li>
<li>Personalization</li>
<li>Precision</li>
<li>Native integration for branch</li>
</ul>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Jenkins/">Jenkins</a><a href="/tags/Devops/">Devops</a><a href="/tags/CD-CI/">CD/CI</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/06/git/" title="Complete Git and Github Masterclass" itemprop="url">Complete Git and Github Masterclass</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-05T14:25:42.000Z" itemprop="datePublished"> Published 2019-05-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Rebase-with-a-pull"><a href="#Rebase-with-a-pull" class="headerlink" title="Rebase with a pull"></a>Rebase with a pull</h1><p><code>git pull --rebase origin master</code></p>
<p>It essentially puts the new commits in the master of the remote in your hisotry, and then superimpose your commits on them.</p>
<h1 id="Squash-commits-together"><a href="#Squash-commits-together" class="headerlink" title="Squash commits together"></a>Squash commits together</h1><p><code>git rebase -i HEAD~2</code></p>
<p>Squash the last two commits.<br>The HEAD~2 refers to the last two commits in the current branch, and the -i option stands for interactive.<br><a href="https://i.imgur.com/AaMM1KK.png">pick and squash</a><br>Pick the old commit and squash the latest commit.</p>
<h1 id="Aborting-a-squash"><a href="#Aborting-a-squash" class="headerlink" title="Aborting a squash"></a>Aborting a squash</h1><p><code>git rebase --abort</code><br>get back to the pre-squash state</p>
<h1 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a>git log</h1><p><code>git log --oneline --decorate --graph --all</code></p>
<h1 id="Complete-Git-and-Github-Masterclass"><a href="#Complete-Git-and-Github-Masterclass" class="headerlink" title="Complete Git and Github Masterclass"></a>Complete Git and Github Masterclass</h1><h2 id="How-Git-works-3-main-states-of-artifact"><a href="#How-Git-works-3-main-states-of-artifact" class="headerlink" title="How Git works - 3 main states of artifact"></a>How Git works - 3 main states of artifact</h2><p>Modified: Here, the artifact goes through chaneg made by the user </p>
<p>Staged: Here, the user/developer adds the artifact to Git index or staging area</p>
<p>Committed: Here, the artifact gets safely stored in Gt database.</p>
<h3 id="git-add-files-moved-from-modified-state-to-staged-state"><a href="#git-add-files-moved-from-modified-state-to-staged-state" class="headerlink" title="git add: files moved from modified state to staged state"></a>git add: files moved from modified state to staged state</h3><h3 id="git-commit-files-moved-from-staged-state-to-committed-state"><a href="#git-commit-files-moved-from-staged-state-to-committed-state" class="headerlink" title="git commit: files moved from staged state to committed state"></a>git commit: files moved from staged state to committed state</h3><p>natural state progression is from modified-&gt; staged-&gt; committed</p>
<p>express commit: git commit -am “commiting readme.md”</p>
<h2 id="3-sections-of-a-Git-project"><a href="#3-sections-of-a-Git-project" class="headerlink" title="3 sections of a Git project"></a>3 sections of a Git project</h2><p>Working directory: this is the root directory of your Git project</p>
<p>Staging area: Also called index, this is where all related changes are build up</p>
<p>Commit area: this is where all artifacts are stacked safely in Git Database</p>
<h2 id="3-ways-of-setting-up-Git-repository"><a href="#3-ways-of-setting-up-Git-repository" class="headerlink" title="3 ways of setting up Git repository"></a>3 ways of setting up Git repository</h2><p>From scratch: we will create a repository from absolutely blank state</p>
<p>Existing project: here we will convert an existing unversioned project to a Git repository</p>
<p>By Copying: we will copy an existing Git repository from Github</p>
<h2 id="Git-Help-system"><a href="#Git-Help-system" class="headerlink" title="Git Help system"></a>Git Help system</h2><p><code>git help -a</code> and <code>git help -g</code> list available subcommands and some concept guides</p>
<h2 id="What-is-Fork-and-how-to-do-it"><a href="#What-is-Fork-and-how-to-do-it" class="headerlink" title="What is Fork and how to do it"></a>What is Fork and how to do it</h2><p>What it means: Creating a project from another existing project</p>
<p>Encouragement: encourages project advancement &amp; collaboration</p>
<p>Contribution: encourages outside contribution</p>
<p>Updates: Forks can updated</p>
<p>Command <code>git status</code>: tells us the status of the working directory and staging area</p>
<p>Command <code>git log</code>: displays committed snapshots or commit history</p>
<p><img src="https://i.imgur.com/NKpsqvI.png" alt="Real world branching scenario"></p>
<h2 id="Git-branching"><a href="#Git-branching" class="headerlink" title="Git branching"></a>Git branching</h2><p>Show branch: <code>git branch</code></p>
<p>Create a new branch: <code>git branch demobranch</code></p>
<p>Switch to the new branch: <code>git checkout demobranch</code></p>
<p>checkout git branches: <code>git checkout; git checkout -b</code></p>
<p>list git branches: <code>git branch; git branch -a</code></p>
<p>rename a git branch: <code>git branch -m</code></p>
<p>delete a git branch: <code>git branch -d; git branch -D</code></p>
<h2 id="Undoing-changes-in-a-Git-repository"><a href="#Undoing-changes-in-a-Git-repository" class="headerlink" title="Undoing changes in a Git repository"></a>Undoing changes in a Git repository</h2><h3 id="Checking-out-commits-in-a-Git-repository"><a href="#Checking-out-commits-in-a-Git-repository" class="headerlink" title="Checking out commits in a Git repository"></a>Checking out commits in a Git repository</h3><p><code>vim robot.txt</code></p>
<p>Express git add and commit command:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git commit -am <span class="string">"1st commit - robot.txt"</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">log</span> --oneline</span><br><span class="line"></span><br><span class="line">git check 265fbe5</span><br></pre></td></tr></table></figure>
<p>Create a new branch:</p>
<p><code>git checkout -b newbranch</code></p>
<p>Switch branch:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line"></span><br><span class="line">git checkout newbranch</span><br></pre></td></tr></table></figure>
<h3 id="Checking-out-files-in-a-Git-repository"><a href="#Checking-out-files-in-a-Git-repository" class="headerlink" title="Checking out files in a Git repository"></a>Checking out files in a Git repository</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --oneline</span><br><span class="line"></span><br><span class="line">git checkout bb3d025 checkoutfile.txt</span><br><span class="line"></span><br><span class="line">git checkout HEAD checkoutfile.txt</span><br><span class="line"></span><br><span class="line">git status</span><br></pre></td></tr></table></figure>
<h3 id="Reverting-changes-in-a-Git-repository"><a href="#Reverting-changes-in-a-Git-repository" class="headerlink" title="Reverting changes in a Git repository"></a>Reverting changes in a Git repository</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git add . </span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">"commit file to revert"</span></span><br><span class="line"></span><br><span class="line">git revert HEAD</span><br></pre></td></tr></table></figure>
<h3 id="Resetting-Git-repository"><a href="#Resetting-Git-repository" class="headerlink" title="Resetting Git repository"></a>Resetting Git repository</h3><p><code>git reset --hard</code></p>
<blockquote>
<p>resets the staging area and working directory to match the most recent commit.</p>
</blockquote>
<p><img src="https://i.imgur.com/XxVvIOm.png" alt="git reset --hard"></p>
<p><code>git reset --hard hash_vaule</code></p>
<blockquote>
<p>moves the current branch id backward to commit id we are using and reset the both the staging area and work dir to match, this destroy not the current change and both the commit id as well.</p>
</blockquote>
<p><img src="https://i.imgur.com/hDkx3Z8.png" alt="git reset --hard hash_vaule"></p>
<h3 id="Cleaning-Git-repository"><a href="#Cleaning-Git-repository" class="headerlink" title="Cleaning Git repository"></a>Cleaning Git repository</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git clean -n</span><br><span class="line"></span><br><span class="line">git clean -f</span><br><span class="line"></span><br><span class="line">git clean -fd</span><br><span class="line"></span><br><span class="line">vim .gitignore</span><br><span class="line"></span><br><span class="line">git add .gitignore</span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">"committing .gitignore"</span></span><br><span class="line"></span><br><span class="line">git clean -xf</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  ####  ######   ######  ##     ## ######## </span></span><br><span class="line"><span class="comment">#   ##  ##    ## ##    ## ##     ## ##       </span></span><br><span class="line"><span class="comment">#   ##  ##       ##       ##     ## ##       </span></span><br><span class="line"><span class="comment">#   ##   ######   ######  ##     ## ######   </span></span><br><span class="line"><span class="comment">#   ##        ##       ## ##     ## ##       </span></span><br><span class="line"><span class="comment">#   ##  ##    ## ##    ## ##     ## ##       </span></span><br><span class="line"><span class="comment">#  ####  ######   ######   #######  ######## </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  ██╗███████╗███████╗██╗   ██╗███████╗</span></span><br><span class="line"><span class="comment">#  ██║██╔════╝██╔════╝██║   ██║██╔════╝</span></span><br><span class="line"><span class="comment">#  ██║███████╗███████╗██║   ██║█████╗  </span></span><br><span class="line"><span class="comment">#  ██║╚════██║╚════██║██║   ██║██╔══╝  </span></span><br><span class="line"><span class="comment">#  ██║███████║███████║╚██████╔╝███████╗</span></span><br><span class="line"><span class="comment">#  ╚═╝╚══════╝╚══════╝ ╚═════╝ ╚══════╝</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>If github ask for username and password:</p>
<blockquote>
<p><code>git remote set-url origin git@github.com:szhouchoice/EffectiveDevOpsTerraform.git</code></p>
</blockquote>
<p><img src="https://i.imgur.com/iIbiZSY.png" alt="git flow"></p>
<p><strong>Merge branch into master</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ...develop some code...</span><br><span class="line">$ git add –A</span><br><span class="line">$ git commit –m &quot;Some commit message&quot;</span><br><span class="line">$ git checkout master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br><span class="line">$ git merge new-branch</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">git add foobar/foobar.php</span><br><span class="line">git status</span><br><span class="line">git reset HEAD foobar/foobar.php ## unstaged changes after reset</span><br><span class="line">git diff</span><br><span class="line">git log</span><br><span class="line"></span><br><span class="line">## branching and merging</span><br><span class="line">git checkout -b newfunction</span><br><span class="line">vim foobar</span><br><span class="line">git add *</span><br><span class="line">git diff</span><br><span class="line">git commit -m &quot;Adds newfunction&quot;</span><br><span class="line">git log</span><br><span class="line">git checkout master</span><br><span class="line">git merge newfunction</span><br><span class="line">git branch -D newfunction</span><br></pre></td></tr></table></figure>
<h1 id="Git-Fundamentals"><a href="#Git-Fundamentals" class="headerlink" title="Git Fundamentals"></a>Git Fundamentals</h1><h2 id="Initalizing-a-Repo-and-Adding-Files-commands"><a href="#Initalizing-a-Repo-and-Adding-Files-commands" class="headerlink" title="Initalizing a Repo and Adding Files (commands)"></a>Initalizing a Repo and Adding Files (commands)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line"># for creating a repository in a directory with existing files</span><br><span class="line"># creates repository skeletion in .git directory</span><br><span class="line">git add</span><br><span class="line"># Tells git to start tracking files</span><br><span class="line"># Patterns: git add *.c or git add. (.= files and dirs recursively)</span><br><span class="line">git commit</span><br><span class="line"># Promotes files into the local repository</span><br><span class="line"># Uses -m to supply a comment</span><br><span class="line"># Commits everthing unless told otherwise</span><br></pre></td></tr></table></figure>
<h2 id="Undoing-updating-things"><a href="#Undoing-updating-things" class="headerlink" title="Undoing/updating things"></a>Undoing/updating things</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend</span><br><span class="line"># allows you to &quot;fix&quot; last commit</span><br><span class="line"># updates last commit using staging area</span><br><span class="line"># with nothing new in staging area, just updates comment(commit message)</span><br><span class="line"># example</span><br><span class="line">  &gt;&gt; git commit -m &quot;my first update&quot;</span><br><span class="line">  &gt;&gt; git add newfile.txt (add command stages it into staging area)</span><br><span class="line">  &gt;&gt; git commit --amend</span><br><span class="line">  &gt;&gt; This updated commit takes the place of the first (updates instead of adding adding another in the chain)</span><br></pre></td></tr></table></figure>
<h2 id="Getting-help"><a href="#Getting-help" class="headerlink" title="Getting help"></a>Getting help</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git &lt;command&gt; -h</span><br><span class="line"># brings up on screen list of options</span><br><span class="line">git hlep &lt;command&gt;</span><br><span class="line"># brings up html man page</span><br></pre></td></tr></table></figure>
<h2 id="Git-config-file"><a href="#Git-config-file" class="headerlink" title="Git config file"></a>Git config file</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Scope</span><br><span class="line">  Local (repo)</span><br><span class="line">    &gt;&gt;.git/config</span><br><span class="line">  Global (user)</span><br><span class="line">    &gt;&gt; ~/.gitconfig</span><br><span class="line">  System (all users on a system)</span><br><span class="line">    &gt;&gt; &lt;usr|usr/local&gt;/etc/gitconfig</span><br><span class="line">Divied into sections</span><br><span class="line">Can have user settings, aliases, etc.</span><br><span class="line">Text file that can be edited, but safer to use git config</span><br></pre></td></tr></table></figure>
<h2 id="Git-Status"><a href="#Git-Status" class="headerlink" title="Git Status"></a>Git Status</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Command: git status</span><br><span class="line">  Primary tool fo showing which files are in which state</span><br><span class="line">  -s is short option - output&lt;1 or more characters&gt;&lt;filename&gt;</span><br><span class="line">    &gt;&gt; ?? = untracked</span><br><span class="line">    &gt;&gt; M = modified</span><br><span class="line">    &gt;&gt; A = added</span><br><span class="line">    &gt;&gt; D = deleted</span><br><span class="line">    &gt;&gt; R = renamed</span><br><span class="line">    &gt;&gt; C = copied</span><br><span class="line">    &gt;&gt; U = updated but unmerged</span><br><span class="line">  -b option - lways show branch and tracking info</span><br><span class="line">Common usage: git status -sb</span><br></pre></td></tr></table></figure>
<h2 id="Git-special-references-Head-and-Index"><a href="#Git-special-references-Head-and-Index" class="headerlink" title="Git special references: Head and Index"></a>Git special references: Head and Index</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Head</span><br><span class="line">  snapshot of your last commit</span><br><span class="line">  next parent (in chain of commits)</span><br><span class="line">  pointer to current branch reference (reference = SHA1)</span><br><span class="line">  Think of HEAD as pointer to last commit on current branch</span><br><span class="line">Index (Staging Area)</span><br><span class="line">  place where changes for the next commit get registered</span><br><span class="line">  temporary staging area for what you&apos;re working on</span><br><span class="line">  proposed next commit</span><br><span class="line">Cache - old name for index</span><br><span class="line">Think of cache, index, and staging area as all the same</span><br></pre></td></tr></table></figure>
<h2 id="Showing-differences"><a href="#Showing-differences" class="headerlink" title="Showing differences"></a>Showing differences</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">command: git diff</span><br><span class="line">default is to show changes in the workfing directory that are not yet staged</span><br><span class="line">if sth is staged, shows diff between working directory and staging area</span><br><span class="line">option of  --cached or --staged shows difference between staging area and last commit (HEAD)</span><br><span class="line">git diff &lt;reference&gt; shows differences between working directory and what &lt;reference&gt; points to - example &quot;git diff HEAD&quot;</span><br></pre></td></tr></table></figure>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">command: git log</span><br><span class="line">with no options, shows name, sha1, email, commit message in reverse chronological order (newest first)</span><br><span class="line">-p option shows patch - or differences in each commit </span><br><span class="line">   Shortcut: git show</span><br><span class="line">-# -shows last # commits</span><br><span class="line">--stat - shows statistics on number of changes</span><br><span class="line">--pretty=oneline|short|full|fuller</span><br><span class="line">--format - allows you to specify your own output format</span><br><span class="line">--oneline and --format can be very useful for machine parsing</span><br><span class="line">Time-limiting options --since|until|after|before (i.e. --since=2.weeks or --before=3.19.2011)</span><br><span class="line">gitk tool also has history visualizer</span><br><span class="line">git log --oneline &lt;since&gt;..&lt;until&gt;  e.g. foobar..barfoo</span><br><span class="line">git log --oneline &lt;file-name&gt;   e.g. teststatusfile</span><br><span class="line">git log --oneline -n &lt;limit&gt; e.g. 2</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/git/">git</a><a href="/tags/github/">github</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/05/amazon-linux2/" title="amazon linux 2" itemprop="url">amazon linux 2</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-05T10:46:16.000Z" itemprop="datePublished"> Published 2019-05-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Amazon-Linux-2"><a href="#Amazon-Linux-2" class="headerlink" title="Amazon Linux 2"></a>Amazon Linux 2</h3><p>Change hostname use init-cloud:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/cloud/cloud.cfg.d/11_changehostname.cfg</span><br><span class="line"><span class="comment">#cloud-config</span></span><br><span class="line">preserve_hostname: <span class="literal">false</span></span><br><span class="line">hostname: myhostname</span><br><span class="line">fqdn: myhostname.example.com</span><br><span class="line">manage_etc_hosts: <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<p>By Command:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl <span class="built_in">set</span>-hostname foobar.localdomain</span><br><span class="line">sed -i <span class="string">'1s/localhost/foobar/1'</span> /etc/hosts|sed -i <span class="string">'1s/localhost/foobar/2'</span> /etc/hosts</span><br></pre></td></tr></table></figure></p>
<p>Extra Library:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user ~]$ amazon-linux-extras list</span><br><span class="line">[ec2-user ~]$ sudo amazon-linux-extras install topic=version topic=version</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/aws/">aws</a><a href="/tags/linux/">linux</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/05/docker/" title="docker" itemprop="url">docker</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2019-05-05T06:47:47.000Z" itemprop="datePublished"> Published 2019-05-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>what is docker</strong></p>
<ul>
<li>Open platform</li>
<li>Build, ship, and run applications</li>
<li>Popular because:<ul>
<li>Flexible</li>
<li>Lightweight</li>
<li>Interchangeable</li>
<li>Portable</li>
<li>Scalable<h2 id="List-Docker-CLI-commands"><a href="#List-Docker-CLI-commands" class="headerlink" title="List Docker CLI commands"></a>List Docker CLI commands</h2></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">docker</span><br><span class="line">docker container --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Display Docker version and info</span></span><br><span class="line">docker --version</span><br><span class="line">docker version</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"><span class="comment">## Execute Docker image</span></span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment">## List Docker images</span></span><br><span class="line">docker image ls</span><br><span class="line"></span><br><span class="line"><span class="comment">## List Docker containers (running, all, all in quiet mode)</span></span><br><span class="line">docker container ls</span><br><span class="line">docker container ls --all</span><br><span class="line">docker container ls -aq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker build -t friendlyhello .  <span class="comment"># Create image using this directory's Dockerfile</span></span><br><span class="line">docker run -p 4000:80 friendlyhello  <span class="comment"># Run "friendlyhello" mapping port 4000 to 80</span></span><br><span class="line">docker run -d -p 4000:80 friendlyhello         <span class="comment"># Same thing, but in detached mode</span></span><br><span class="line">docker container ls                                <span class="comment"># List all running containers</span></span><br><span class="line">docker container ls -a             <span class="comment"># List all containers, even those not running</span></span><br><span class="line">docker container stop &lt;<span class="built_in">hash</span>&gt;           <span class="comment"># Gracefully stop the specified container</span></span><br><span class="line">docker container <span class="built_in">kill</span> &lt;<span class="built_in">hash</span>&gt;         <span class="comment"># Force shutdown of the specified container</span></span><br><span class="line">docker container rm &lt;<span class="built_in">hash</span>&gt;        <span class="comment"># Remove specified container from this machine</span></span><br><span class="line">docker container rm $(docker container ls -a -q)         <span class="comment"># Remove all containers</span></span><br><span class="line">docker image ls -a                             <span class="comment"># List all images on this machine</span></span><br><span class="line">docker image rm &lt;image id&gt;            <span class="comment"># Remove specified image from this machine</span></span><br><span class="line">docker image rm $(docker image ls -a -q)   <span class="comment"># Remove all images from this machine</span></span><br><span class="line">docker login             <span class="comment"># Log in this CLI session using your Docker credentials</span></span><br><span class="line">docker tag &lt;image&gt; username/repository:tag  <span class="comment"># Tag &lt;image&gt; for upload to registry</span></span><br><span class="line">docker push username/repository:tag            <span class="comment"># Upload tagged image to registry</span></span><br><span class="line">docker run username/repository:tag                   <span class="comment"># Run image from a registry</span></span><br></pre></td></tr></table></figure>
<h1 id="Beginning-Devops-with-Docker"><a href="#Beginning-Devops-with-Docker" class="headerlink" title="Beginning Devops with Docker"></a>Beginning Devops with Docker</h1><h2 id="Chapter-1-Images-and-Containers"><a href="#Chapter-1-Images-and-Containers" class="headerlink" title="Chapter 1. Images and Containers"></a>Chapter 1. Images and Containers</h2><p><strong>Virtualization versus Containerization</strong><br><img src="https://i.imgur.com/KKfsLxn.png" alt="virtual machine block diagram"><br>In virtual machines, the physical hardware is abstracted, therefore we have may server running on one server. Virtual machines do sometimes take time to start up and are expensive in capacity (they can be GBs in size), although the greatest advantage they have over containers is the ability to run different Linux distributions such as CentOS instead of just Ubuntu.</p>
<p><img src="https://i.imgur.com/rWfUi8x.png" alt="containerization"><br>In containerization, it is only the app layer (where code and dependencies are packaged) that is abstracted, making it possible for many containers to run on the same OS kernel but on separate user space.</p>
<p>Containers use less space and boot fast.</p>
<ul>
<li>Describe how Docker improves a DevOps workflow<br>Normally, we have two pieces to a working application: the project code base and the provisioning script. The code base is the application code. It is managed by version control and hosted in GitHub, among other platforms.<br><img src="https://i.imgur.com/7bpoPrj.png" alt="Docker implements"><br>The <strong>Dockerfile</strong> takes the place of the provisioning script. The two combined (project code and Dockerfile) make a <strong>Docker image</strong>. A Docker image can be run as an application. This running application sourced from a Docker image is called a <strong>Docker container</strong>.</li>
</ul>
<p><strong>Basic Docker Terminal Commands</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker info ## displays system-wide information</span><br><span class="line">docker search &lt;term&gt; (foir example. docker search ubuntu) ##searches Docker Hub for Images</span><br><span class="line">docker pull ## pulls an image from the registry to your local machine eg docker pull ubuntu</span><br><span class="line">docker images ## lists the Docker images we have locally</span><br><span class="line">docker run &lt;image&gt; #will check whether the image by the name hello-world exists locally,if the image is</span><br><span class="line">not local, it will be pulled form the default registry, Docker Hub, and run as a container, by default</span><br><span class="line"></span><br><span class="line">docker ps ## lists the running containers</span><br><span class="line">docker stop &lt;container ID&gt;  ## stop the container </span><br><span class="line">docker rm &lt;container ID&gt; ## Delete the container and the image</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Interpret Dockerfile syntax</li>
<li>Build images</li>
<li>Set up containers and images</li>
<li>Set up a local dynamic environment</li>
<li>Run applications in Docker containers</li>
<li>Obtain a basic overview of how Docker manages images via Docker Hub</li>
<li>Deploy a Docker image to Docker Hub</li>
</ul>
<p><strong>The Dockerfile</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8-jre-alpine</span><br><span class="line"></span><br><span class="line">ENV SPRING_OUTPUT_ANSI_ENABLED=ALWAYS \</span><br><span class="line">    JHIPSTER_SLEEP=0 \</span><br><span class="line">    JAVA_OPTS=&quot;&quot;</span><br><span class="line"></span><br><span class="line">CMD echo &quot;The application will start in $&#123;JHIPSTER_SLEEP&#125;s...&quot; &amp;&amp; \</span><br><span class="line">    sleep $&#123;JHIPSTER_SLEEP&#125; &amp;&amp; \</span><br><span class="line">    java $&#123;JAVA_OPTS&#125; -Djava.security.egd=file:/dev/./urandom -jar /app.war</span><br><span class="line"></span><br><span class="line">EXPOSE 8080 5701/udp</span><br><span class="line"></span><br><span class="line">ADD *.war /app.war</span><br></pre></td></tr></table></figure></p>
<p>The <strong>FROM</strong> instruction specifies the base image to use while initializing the build. Here, we specify open JDK 8 as our Java runtime.</p>
<p>The <strong>ENV</strong> instruction is used to set environment variables, and the <strong>CMD</strong> instruction is used to specify commands to be executed.</p>
<p>The <strong>EXPOSE</strong> instruction is used to specify the port that the container listens to during runtime.</p>
<p><strong>useful commands for Docker and Docker compose</strong><br><img src="https://i.imgur.com/FAExCVU.png" alt="commands1"><br><img src="https://i.imgur.com/LtTRrfD.png" alt="commands2"></p>
<h2 id="Docker-compose"><a href="#Docker-compose" class="headerlink" title="Docker-compose"></a>Docker-compose</h2><p><strong>Sample docker-compose file that will start a Rdis database on port 5000</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: &apos;3&apos;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">     - &quot;5000:5000&quot;</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br></pre></td></tr></table></figure></p>
<p>The first line of the <em>docker-compose</em> file should be the version of the <em>docker-compose</em> tool. </p>
<p>Then we need to specify all the necessary services that we need for our application to run. They should be defined in the <em>services:</em> section.</p>
<p>We can also define multiple services inside here, giving a name to each (<em>web</em> and <em>redis</em>).</p>
<p>This is followed by how to build the <em>service</em> (either via a command to build or referring a Dockerfile). </p>
<p>If the application needs any port access, we can configure it using <em>5000:5000</em> (that is internal port: external port). </p>
<p>Then, we have to specify the volume information. This basically tells <em>docker-compose</em> to serve the files from the location specified.   </p>
<p>Once we have specified the services required for our application, then we can start the application via <em>docker-compose</em>. This will start your entire application along with the services, and expose the <em>services</em> on the port specified. </p>
<p>With <em>docker-compose</em>, we can perform the following operations:</p>
<ul>
<li><strong>Start</strong>: docker-compose -f &lt;docker_file&gt; up</li>
<li><p><strong>Stop</strong>: docker-compose -f &lt;docker_file&gt; down<br>We can also perform the following operations:</p>
</li>
<li><p><strong>List the running services and their status</strong>: <em>docker ps</em></p>
</li>
<li><strong>Logs</strong>: <em>docker log &lt;container_id&gt;</em></li>
</ul>
<h2 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h2><p>A single deployable component is called a <strong>pod</strong> in Kubernetes. This can be as simple as a running process in the container. A group of pods can be combined together to form a <strong>deployment</strong>. </p>
<p>The following code is a sample Kubernetes file that will start a Nginx server:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginxsvc</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    name: http</span><br><span class="line">  - port: 443</span><br><span class="line">    protocol: TCP</span><br><span class="line">    name: https</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>Start with an <em>apiVersion</em> in a Kubernetes deployment file.</p>
</li>
<li><p>Followed by the type, which takes either a pod, deployment, namespace, ingress (load balancing the pods), role, and many more.</p>
</li>
</ol>
<p>Ingress forms a layer between the services and the internet so that all the inbound connections are controlled or configured with the ingress controller before sending them to Kubernetes services on the cluster. On the other hand, the egress controller controls or configures services going out of the Kubernetes cluster.</p>
<ol start="3">
<li><p>This is followed by the metadata information, such as the type of environments, the application name (nginxsvc), and labels (Kubernetes uses this information to identify and segregate the pods). Kubernetes uses this metadata information to identify the particular pods or a group of pods, and we can manage the instances with this metadata. This is one of the key differences with docker-compose, where docker-compose doesn’t have the flexibility of defining the metadata about the containers.</p>
</li>
<li><p>This is followed by the spec, where we define the specification of the images or our application. We can also define the pull strategy for our images as well as define the environment variables along with the exposed ports. We can define the resource limitations on the machine (or VM) for a particular service. They provide health checks, that is, each service is monitored for the health and when some services fail, they are immediately replaced by newer ones. They also provide service discovery out of the box, by assigning each pod an IP, which makes it easier for the services to identify and interact with them. They also provide a better dashboard, to visualize your architecture and the status of the application. You can do most of the management via this dashboard, such as checking the status, logs, scale up, or down the services, and so on.</p>
</li>
</ol>
<h2 id="Docker-ps-command"><a href="#Docker-ps-command" class="headerlink" title="Docker ps command"></a>Docker ps command</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker ps --format <span class="string">"table &#123;&#123;.ID&#125;&#125; \t &#123;&#123;.Image&#125;&#125; \t &#123;&#123;.Ports&#125;&#125; \t &#123;&#123;.Names&#125;&#125;"</span></span><br><span class="line">CONTAINER ID         IMAGE                   PORTS                                                NAMES</span><br><span class="line">7d3a6d518e8e         jenkinsci/blueocean     0.0.0.0:8080-&gt;8080/tcp, 0.0.0.0:50000-&gt;50000/tcp     jenkins</span><br><span class="line">9655eb0e836e         alpine                                                                       quotes</span><br><span class="line">root@stan-OptiPlex-380:~|⇒  docker ps --format <span class="string">"table &#123;&#123;.ID&#125;&#125; \t &#123;&#123;.Names &#125;&#125; \t &#123;&#123;.Status&#125;&#125;"</span></span><br><span class="line">CONTAINER ID         NAMES               STATUS</span><br><span class="line">7d3a6d518e8e         jenkins             Up 2 minutes</span><br><span class="line">9655eb0e836e         quotes              Up 4 hours</span><br></pre></td></tr></table></figure>
<h2 id="Docker-networking"><a href="#Docker-networking" class="headerlink" title="Docker networking"></a>Docker networking</h2><p>-Mostly used types</p>
<ul>
<li>Bridge networks<ul>
<li>The default network driver</li>
<li>Applications run in standalone containers that need to communicate</li>
</ul>
</li>
<li>Overlay networks:<ul>
<li>Connect multiple Docker daemons together</li>
<li>Enable swarm services to communicate with each other</li>
</ul>
</li>
</ul>
<p><strong>Docker basic networking</strong></p>
<ul>
<li>Step 1: create a network and volume</li>
</ul>
<p>Listing and creating a network:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br><span class="line">docker network create net1</span><br></pre></td></tr></table></figure></p>
<p>Listing and creating a volume:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker volume ls</span><br><span class="line">docker volume create --driver=local --name=volume1</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>Step 2: start docker containers</p>
<ul>
<li>Starting docker containers:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=container1 -v volume1:/opt --network=net1 busybox sh</span><br><span class="line">docker run -it --name=container2 -v volume1:/opt --network=net1 busybox sh</span><br><span class="line">#-t is used for interactive session and t will give you the terminal</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Step 3: test connectivity between these containers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ping container2</span><br><span class="line">PING container2 (172.19.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.19.0.3: seq=0 ttl=64 time=0.170 ms</span><br><span class="line">64 bytes from 172.19.0.3: seq=1 ttl=64 time=0.134 ms</span><br><span class="line">64 bytes from 172.19.0.3: seq=2 ttl=64 time=0.133 ms</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>Overlay networking</strong></p>
<p><strong>What does an overlay network do?</strong></p>
<ul>
<li>Containers only connect to other containers on the same network </li>
<li>Connecting to containers on other hosts requires that the container publish the needed port </li>
<li>Overlay network allows containers running on different hosts to connect on a private network<br><img src="https://i.imgur.com/KjgJtA0.png" alt="overlay networking"></li>
<li>Step 1: Initiate docker swarm<blockquote>
<p>Host1: Check networks and initiate docker swarm:<br> docker network ls<br> docker swarm init<br>Host2: Initiate swarm worker and check its networks:<br> docker swarm join –toaken foobar 192.168.10.91:2377<br> docker network ls</p>
</blockquote>
</li>
<li><p>Step 2: Create overlay network and spin a docker container on host1</p>
<blockquote>
<p>Create an overlay network:<br> docker network create -d overlay –atachable=true swarmnet</p>
<ul>
<li>List networks:<br>docker network ls</li>
<li>Spin a Docker container:<br>docker run -itd –name container1 –network swarmnet busybox</li>
</ul>
</blockquote>
</li>
<li><p>Step 3: Spin a container on host2 and check its networks</p>
<blockquote>
<p>List networks:<br> docker network ls</p>
<ul>
<li>Spin a Docker container:<br>docker run -itd –name container2 –network swarmnet busybox</li>
<li>List networks and see new network:<br>docker network ls</li>
</ul>
</blockquote>
</li>
<li><p>Step 4: Login to the containers check its networks and sing each other</p>
<blockquote>
<p>Host1: Log in to the container, check IPs, and ping container on Host2:<br>   docker exec -it container1 sh<br>   ifconfig<br>   ping container2<br>Host2:  Log in to the container, check IPs, and ping container on Host1:<br>   docker exec -it container2 sh<br>   ifconfig<br>   ping container1</p>
</blockquote>
</li>
</ul>
<h1 id="upload-that-new-image-to-dockerhub"><a href="#upload-that-new-image-to-dockerhub" class="headerlink" title="upload that new image to dockerhub"></a>upload that new image to dockerhub</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag helloworld stanosaka/helloworld</span><br><span class="line">docker push stanosaka/helloworld</span><br></pre></td></tr></table></figure>
<p>Cleaning up containers:We can clean up everything by stopping and removing all containers with these two handy one-line commands:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop $(docker ps -a -q)</span><br><span class="line">$ docker system prune</span><br></pre></td></tr></table></figure></p>
<h1 id="Amazon-web-services-and-docker-development"><a href="#Amazon-web-services-and-docker-development" class="headerlink" title="Amazon web services and docker development"></a>Amazon web services and docker development</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install     apt-transport-https     ca-certificates     curl</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key</span><br><span class="line">add-apt-repository    &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span><br><span class="line">   $(lsb_release -cs) \</span><br><span class="line">   stable&quot;</span><br><span class="line">apt update</span><br><span class="line">apt-get install docker-ce docker-ce-cli containerd.io</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl status docker</span><br><span class="line"></span><br><span class="line">root@ip-172-31-6-219:~# cat dockerfile</span><br><span class="line">FROM ubuntu:16.04</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RUN apt update</span><br><span class="line">RUN apt install -y apache2</span><br><span class="line">RUN echo &quot;Welcome to my web site&quot; &gt; /var/www/html/index.html</span><br><span class="line">CMD /usr/sbin/apache2ctl -D FOREGROUND</span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker info</span><br><span class="line">docker run -it --detach=true ubuntu bash</span><br><span class="line">docker ps</span><br><span class="line">docker renmae nervous_visvesvaraya newname</span><br><span class="line">docker network inspect newnet|less</span><br><span class="line">docker network connect newnet newname</span><br><span class="line">docker inspect newname|less</span><br><span class="line">ping 172.18.0.2</span><br><span class="line">ping 172.17.0.2</span><br><span class="line">docker build -t &quot;webserver&quot; .</span><br><span class="line">docker images</span><br><span class="line">docker run -d -p 80:80 webserver /usr/sbin/apache2ctl -D FOREGROUND</span><br><span class="line">docker ps</span><br><span class="line">curl localhost</span><br><span class="line"> aws iam create-service-linked-role --aws-service-name ecs.amazonaws.com</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Role&quot;: &#123;</span><br><span class="line">        &quot;AssumeRolePolicyDocument&quot;: &#123;</span><br><span class="line">            &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">            &quot;Statement&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Action&quot;: [</span><br><span class="line">                        &quot;sts:AssumeRole&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">                    &quot;Principal&quot;: &#123;</span><br><span class="line">                        &quot;Service&quot;: [</span><br><span class="line">                            &quot;ecs.amazonaws.com&quot;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;RoleId&quot;: &quot;AROAYYRUPCKTK7Z2M2PLO&quot;,</span><br><span class="line">        &quot;CreateDate&quot;: &quot;2019-09-02T02:28:51Z&quot;,</span><br><span class="line">        &quot;RoleName&quot;: &quot;AWSServiceRoleForECS&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/aws-service-role/ecs.amazonaws.com/&quot;,</span><br><span class="line">        &quot;Arn&quot;: &quot;arn:aws:iam::602479202982:role/aws-service-role/ecs.amazonaws.com/AWSServiceRoleForECS&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Working-with-ecs-throught-the-aws-cli"><a href="#Working-with-ecs-throught-the-aws-cli" class="headerlink" title="Working with ecs throught the aws cli"></a>Working with ecs throught the aws cli</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aws ecs list-clusters</span><br><span class="line">aws ecs describe-clusters</span><br><span class="line">aws ecs create-cluster --cluster-name newcluster</span><br></pre></td></tr></table></figure>
<p><strong>Configure ECS to authenticate with Docker Hub</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#1.ssh to ecs server</span><br><span class="line">cd /etc/ecs</span><br><span class="line">[root@ip-172-31-13-18 ecs]# vim ecs.config</span><br><span class="line">ECS_ENGINE_AUTH_TYPE=docker</span><br><span class="line">ECS_ENGINE_AUTH_DATA=&#123;&quot;https://index.docker.io/v1/&quot;:&#123;&quot;username&quot;:&quot;foobar&quot;,&quot;password&quot;:&quot;badpassword&quot;,&quot;email&quot;:&quot;foo.bar@gmail.com&quot;&#125;&#125;</span><br><span class="line">[root@ip-172-31-13-18 ecs]# stop ecs</span><br><span class="line">ecs stop/waiting</span><br><span class="line">[root@ip-172-31-13-18 ecs]# start ecs</span><br><span class="line">ecs start/running, process 4996</span><br><span class="line">[root@ip-172-31-13-18 ecs]# docker inspect ecs-agent|grep ECS_DATADIR</span><br><span class="line">                &quot;ECS_DATADIR=/data&quot;,</span><br><span class="line">#2. make repo private in docker hub</span><br><span class="line">#3. configure in aws console about ecs</span><br></pre></td></tr></table></figure></p>
<p><strong>working with ec2 container registry (ECR)</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aws ecr get-login help</span><br><span class="line">docker login -u AWS -p badpassword https://602479202982.dkr.ecr.ap-southeast-2.amazonaws.com</span><br><span class="line">docker images</span><br><span class="line">docker tag c0a44e0f3831 602479202982.dkr.ecr.ap-southeast-2.amazonaws.com/myrepo</span><br><span class="line">docker push 602479202982.dkr.ecr.ap-southeast-2.amazonaws.com/myrepo</span><br></pre></td></tr></table></figure></p>
<h2 id="Docker-registry"><a href="#Docker-registry" class="headerlink" title="Docker registry"></a>Docker registry</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --restart always --name registry registry:2</span><br><span class="line">docker pull hello-world</span><br><span class="line">docker tag hello-world localhost:5000/hello-world</span><br><span class="line">docker push localhost:5000/hello-world</span><br><span class="line">docker exec -it registry /bin/sh</span><br><span class="line">docker images</span><br><span class="line">docker rmi hello-world</span><br><span class="line">docker rmi localhost:5000/hello-world</span><br><span class="line">docker images</span><br><span class="line">docker pull localhost:5000/hello-world</span><br><span class="line">docker run \</span><br><span class="line">  -d \</span><br><span class="line">  -e ENV_DOCKER_REGISTRY_HOST=registry \</span><br><span class="line">  -e ENV_DOCKER_REGISTRY_PORT=5000 \</span><br><span class="line">  -p 8080:80 \</span><br><span class="line">  --link registry:registry \</span><br><span class="line">  konradkleine/docker-registry-frontend:v2</span><br></pre></td></tr></table></figure>
<h2 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h2><ol>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> docker login 127.0.0.1:5000</span><br><span class="line">Username: myuser</span><br><span class="line">Password:</span><br><span class="line">** Message: 17:25:24.126: Remote error from secret service: org.freedesktop.Secret.Error.IsLocked: Cannot create an item in a locked collection</span><br><span class="line">Error saving credentials: error storing credentials - err: exit status 1, out: `Cannot create an item in a locked collection`</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Fix by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker logout</span><br><span class="line">Removing login credentials for https://index.docker.io/v1/</span><br><span class="line">➜  outyet git:(master) mv ~/.docker/config.json ~/.docker/config_old.json</span><br><span class="line">➜  outyet git:(master) docke login</span><br><span class="line">zsh: command not found: docke</span><br><span class="line">➜  outyet git:(master) docker login 127.0.0.1:5000</span><br><span class="line">Username: myuser</span><br><span class="line">Password:</span><br><span class="line">WARNING! Your password will be stored unencrypted in /home/stan/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/docker/">docker</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/06/redhat/" title="redhat" itemprop="url">redhat</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2017-09-06T07:49:54.000Z" itemprop="datePublished"> Published 2017-09-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Issue-1"><a href="#Issue-1" class="headerlink" title="Issue 1."></a>Issue 1.</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost stan]<span class="comment"># yum install -y ntp</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">There are no enabled repos.</span><br><span class="line"> Run <span class="string">"yum repolist all"</span> to see the repos you have.</span><br><span class="line"> You can <span class="built_in">enable</span> repos with yum-config-manager --<span class="built_in">enable</span> &lt;repo&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve:"></a>Solve:</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]<span class="comment"># mkdir /cdrom</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mount /dev/cdrom /cdrom</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># pwd</span></span><br><span class="line">/etc/yum.repos.d</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># vim dvd.repo</span></span><br><span class="line">[dvd-source]</span><br><span class="line">name=RHEL 7.2 dvd repo</span><br><span class="line">baseurl=file:///cdrom</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum repolist</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">dvd-source                                                                                     | 4.1 kB  00:00:00</span><br><span class="line">(1/2): dvd-source/group_gz                                                                     | 136 kB  00:00:00</span><br><span class="line">(2/2): dvd-source/primary_db                                                                   | 3.6 MB  00:00:00</span><br><span class="line">repo id                                             repo name                                                   status</span><br><span class="line">dvd-source                                          RHEL 7.2 dvd repo                                           4,620</span><br><span class="line">repolist: 4,620</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum install rpm-build</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package rpm-build.x86_64 0:4.11.3-17.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl(Thread::Queue) <span class="keyword">for</span> package: rpm-build-4.11.3-17.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: system-rpm-config <span class="keyword">for</span> package: rpm-build-4.11.3-17.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package perl-Thread-Queue.noarch 0:3.02-2.el7 will be installed</span><br><span class="line">---&gt; Package redhat-rpm-config.noarch 0:9.1.0-68.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: dwz &gt;= 0.4 <span class="keyword">for</span> package: redhat-rpm-config-9.1.0-68.el7.noarch</span><br><span class="line">--&gt; Processing Dependency: perl-srpm-macros <span class="keyword">for</span> package: redhat-rpm-config-9.1.0-68.el7.noarch</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package dwz.x86_64 0:0.11-3.el7 will be installed</span><br><span class="line">---&gt; Package perl-srpm-macros.noarch 0:1-8.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">======================================================================================================================</span><br><span class="line"> Package                          Arch                  Version                       Repository                 Size</span><br><span class="line">======================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> rpm-build                        x86_64                4.11.3-17.el7                 dvd-source                144 k</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> dwz                              x86_64                0.11-3.el7                    dvd-source                 99 k</span><br><span class="line"> perl-Thread-Queue                noarch                3.02-2.el7                    dvd-source                 17 k</span><br><span class="line"> perl-srpm-macros                 noarch                1-8.el7                       dvd-source                4.7 k</span><br><span class="line"> redhat-rpm-config                noarch                9.1.0-68.el7                  dvd-source                 77 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">======================================================================================================================</span><br><span class="line">Install  1 Package (+4 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 341 k</span><br><span class="line">Installed size: 734 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                 1.9 MB/s | 341 kB  00:00:00</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : perl-Thread-Queue-3.02-2.el7.noarch                                                                1/5</span><br><span class="line">  Installing : dwz-0.11-3.el7.x86_64                                                                              2/5</span><br><span class="line">  Installing : perl-srpm-macros-1-8.el7.noarch                                                                    3/5</span><br><span class="line">  Installing : redhat-rpm-config-9.1.0-68.el7.noarch                                                              4/5</span><br><span class="line">  Installing : rpm-build-4.11.3-17.el7.x86_64                                                                     5/5</span><br><span class="line">dvd-source/productid                                                                           | 1.6 kB  00:00:00</span><br><span class="line">  Verifying  : redhat-rpm-config-9.1.0-68.el7.noarch                                                              1/5</span><br><span class="line">  Verifying  : rpm-build-4.11.3-17.el7.x86_64                                                                     2/5</span><br><span class="line">  Verifying  : perl-srpm-macros-1-8.el7.noarch                                                                    3/5</span><br><span class="line">  Verifying  : dwz-0.11-3.el7.x86_64                                                                              4/5</span><br><span class="line">  Verifying  : perl-Thread-Queue-3.02-2.el7.noarch                                                                5/5</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  rpm-build.x86_64 0:4.11.3-17.el7</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  dwz.x86_64 0:0.11-3.el7                  perl-Thread-Queue.noarch 0:3.02-2.el7  perl-srpm-macros.noarch 0:1-8.el7</span><br><span class="line">  redhat-rpm-config.noarch 0:9.1.0-68.el7</span><br><span class="line"></span><br><span class="line">omplete!</span><br><span class="line"></span><br><span class="line">$(!!) to recompute the output of the last <span class="built_in">command</span></span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/redhat/">redhat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/nginx01/" title="Nginx Deploy" itemprop="url">Nginx Deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T04:31:14.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Install-Nginx"><a href="#Install-Nginx" class="headerlink" title="Install Nginx"></a>Install Nginx</h2><h3 id="Install-Nginx-Package"><a href="#Install-Nginx-Package" class="headerlink" title="Install Nginx Package"></a>Install Nginx Package</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@huoq bin]<span class="comment"># yum install pcre pcre-devel -y</span></span><br><span class="line">check by:</span><br><span class="line">[root@huoq bin]<span class="comment"># rpm -qa pcre pcre-devel</span></span><br><span class="line">pcre-devel-8.32-15.el7_2.1.x86_64</span><br><span class="line">pcre-8.32-15.el7_2.1.x86_64</span><br><span class="line">[root@huoq tools]<span class="comment"># yum install -y openssl-devel openssl</span></span><br></pre></td></tr></table></figure>
<h3 id="Install-Nginx-1"><a href="#Install-Nginx-1" class="headerlink" title="Install Nginx"></a>Install Nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.6.3.tar.gz</span><br><span class="line">useradd nginx -s /sbin/nologin -M</span><br><span class="line">tar xf nginx-1.6.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.6.3/</span><br><span class="line">./configure --user=nginx --group=nginx --prefix=/application/nginx-1.6.3 --with-http_stub_status_module --with-http_ssl_module</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s /application/nginx-1.6.3 /application/nginx</span><br><span class="line">vim /application/nginx/conf/nginx.conf</span><br><span class="line">worker_processes  4;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">   </span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    upstream web_pools &#123;</span><br><span class="line">        server 127.0.0.1:8081;</span><br><span class="line">        server 127.0.0.1:8082;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            proxy_pass http://web_pools;</span><br><span class="line">        &#125;</span><br><span class="line">        location /nginx_status &#123;</span><br><span class="line">                stub_status on;</span><br><span class="line">                access_log off;</span><br><span class="line">                allow 127.0.0.1;</span><br><span class="line">                deny all;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/application/nginx/sbin/nginx -t</span><br><span class="line">vim /etc/init.d/nginx</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#chkconfig: - 85 15</span></span><br><span class="line"><span class="comment">#description: this script use to manage nginx process.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#set -x</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"></span><br><span class="line">procnum=`ps -ef |grep <span class="string">"/application/nginx/sbin/nginx"</span>|grep -v <span class="string">"grep"</span>|wc -l`</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  /application/nginx/sbin/nginx</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"$?"</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Starting nginx:"</span></span><br><span class="line">  failure</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 4</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  /application/nginx/sbin/nginx -s stop</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"$?"</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  failure</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 3</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Stopping nginx:"</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">  start)</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  stop)</span><br><span class="line">  stop</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  restart)</span><br><span class="line">  stop</span><br><span class="line">  sleep 1</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  reload)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  /application/nginx/sbin/nginx -s reload</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is not running!please start nginx first..."</span></span><br><span class="line">  <span class="built_in">exit</span> 2</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  status)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$procnum</span>"</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is running..."</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"nginx is not running..."</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  *)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage : nginx [ start|stop|reload|restart|status ]"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">  ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">chmod +x /etc/init.d/nginx</span><br><span class="line">chkconfig nginx on</span><br><span class="line">/etc/init.d/nginx start</span><br><span class="line">Starting nginx:                                      [  OK  ]</span><br><span class="line">/etc/init.d/nginx status</span><br><span class="line">nginx is running...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/nginx/">nginx</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/tomcat01/" title="tomcat deploy" itemprop="url">tomcat deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T00:10:37.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="tomcat-deploy-on-centos"><a href="#tomcat-deploy-on-centos" class="headerlink" title="tomcat deploy on centos"></a>tomcat deploy on centos</h2><h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><h3 id="JDK下载："><a href="#JDK下载：" class="headerlink" title="JDK下载："></a>JDK下载：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate --no-cookies --header <span class="string">"Cookie: oraclelicense=accept-securebackup-cookie"</span> http://download.oracle.com/otn-pub/java/jdk/7u79-b15/jdk-7u79-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat下载"><a href="#Tomcat下载" class="headerlink" title="Tomcat下载:"></a><a href="http://tomcat.apache.org/">Tomcat下载</a>:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://toad.cwzhou.win/pub/apache-tomcat-7.0.70.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="部署java环境"><a href="#部署java环境" class="headerlink" title="部署java环境"></a>部署java环境</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tar xf jdk-8u91-linux-x64.tar.gz -C /application/</span><br><span class="line"></span><br><span class="line">ln -s /application/jdk1.8.0/ /application/jdk</span><br><span class="line">cp /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="comment"># sed -i.ori '$a export JAVA_HOME=/application/jdk\nexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH\nexport CLASSPATH=.$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$JAVA_HOME/lib/tools.jar' /etc/profile</span></span><br><span class="line"></span><br><span class="line">vimdiff /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<h2 id="Install-tomcat"><a href="#Install-tomcat" class="headerlink" title="Install tomcat"></a>Install tomcat</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tar xf apache-tomcat-8.0.27.tar.gz -C /application/</span><br><span class="line">ln -s /application/apache-tomcat-8.0.27 /application/tomcat</span><br><span class="line"><span class="built_in">echo</span>  <span class="string">'export TOMCAT_HOME=/application/tomcat'</span>&gt;&gt;/etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">chown -R root.root /application/jdk/ /application/tomcat/</span><br><span class="line">[root@tomcat ~]<span class="comment"># tail -4 /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> TOMCAT_HOME=/application/tomcat</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat目录介绍"><a href="#Tomcat目录介绍" class="headerlink" title="Tomcat目录介绍"></a>Tomcat目录介绍</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/tomcat/</span></span><br><span class="line">[root@tomcat tomcat]<span class="comment"># tree -L 1</span></span><br><span class="line">.</span><br><span class="line">├── bin <span class="comment">#→用以启动、关闭Tomcat或者其它功能的脚本（.bat文件和.sh文件）</span></span><br><span class="line">├── conf <span class="comment">#→用以配置Tomcat的XML及DTD文件</span></span><br><span class="line">├── lib <span class="comment">#→存放web应用能访问的JAR包</span></span><br><span class="line">├── LICENSE</span><br><span class="line">├── logs <span class="comment">#→Catalina和其它Web应用程序的日志文件</span></span><br><span class="line">├── NOTICE</span><br><span class="line">├── RELEASE-NOTES</span><br><span class="line">├── RUNNING.txt</span><br><span class="line">├── temp <span class="comment">#→临时文件</span></span><br><span class="line">├── webapps <span class="comment">#→Web应用程序根目录</span></span><br><span class="line">└── work <span class="comment">#→用以产生有JSP编译出的Servlet的.java和.class文件</span></span><br><span class="line">7 directories, 4 files</span><br><span class="line">[root@tomcat tomcat]<span class="comment"># cd webapps/</span></span><br><span class="line">[root@tomcat webapps]<span class="comment"># ll</span></span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 14 root root 4096 Oct 5 12:09 docs <span class="comment">#→tomcat帮助文档</span></span><br><span class="line">drwxr-xr-x 6 root root 4096 Oct 5 12:09 examples <span class="comment">#→web应用实例</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 host-manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct 5 12:09 ROOT <span class="comment">#→默认网站根目录</span></span><br></pre></td></tr></table></figure>
<h2 id="Tomcat多实例及集群架构"><a href="#Tomcat多实例及集群架构" class="headerlink" title="Tomcat多实例及集群架构"></a>Tomcat多实例及集群架构</h2><h3 id="Tomcat多实例"><a href="#Tomcat多实例" class="headerlink" title="Tomcat多实例"></a>Tomcat多实例</h3><p>复制Tomcat目录<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_1</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_2</span></span><br></pre></td></tr></table></figure></p>
<p>修改配置文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat application]<span class="comment"># mkdir -p /data/www/www/ROOT</span></span><br><span class="line">[root@tomcat application]<span class="comment"># cp /application/tomcat/webapps/memtest/meminfo.jsp /data/www/www/ROOT/</span></span><br><span class="line">sed -i <span class="string">'22s#8005#8011#;71s#8080#8081#;125s#appBase=".*"# appBase="/data/www/www"#'</span> /application/tomcat7_1/conf/server.xml</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'22s#8005#8012#;71s#8080#8082#;125s#appBase=".*"# appBase="/data/www/www"#'</span> /application/tomcat7_2/conf/server.xml</span><br></pre></td></tr></table></figure></p>
<h3 id="jvm调优"><a href="#jvm调优" class="headerlink" title="jvm调优"></a>jvm调优</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim catalina.sh insert</span></span><br><span class="line">JAVA_OPTS=<span class="string">"-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m -XX:MaxPermSize=512m"</span></span><br></pre></td></tr></table></figure>
<h3 id="service-startup-script"><a href="#service-startup-script" class="headerlink" title="service startup script"></a>service startup script</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/init.d</span><br><span class="line"></span><br><span class="line">vim tomcat</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># des: Tomcat Start Stop Restart</span></span><br><span class="line"><span class="comment"># processname: tomcat</span></span><br><span class="line"><span class="comment"># chkconfig: 234 20 80</span></span><br><span class="line">JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME</span><br><span class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line">CATALINA_HOME=/application/tomcat</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line">chkconfig --add tomcat</span><br><span class="line">chkconfig --level 234 tomcat on</span><br><span class="line">chkconfig --list tomcat</span><br><span class="line">groupadd tomcat</span><br><span class="line">useradd -g tomcat -d /home/tomcat -s /bin/sh tomcat</span><br><span class="line"><span class="built_in">cd</span> /etc/init.d/</span><br><span class="line"></span><br><span class="line">chown tomcat:tomcat  tomcat</span><br><span class="line"></span><br><span class="line">chmod +x tomcat</span><br><span class="line">service tomcat start</span><br><span class="line"></span><br><span class="line">check the <span class="built_in">log</span>:</span><br><span class="line">tail /application/tomcat/logs/catalina.out</span><br></pre></td></tr></table></figure>
<h3 id="Remove-default-content"><a href="#Remove-default-content" class="headerlink" title="Remove default content:"></a>Remove default content:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /root/apache-tomcat-7.0.70.tar.gz</span><br><span class="line">vim /tmp/run01.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> docs examples host-manager manager ROOT/RELEASE-NOTES.txt </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                rm -rf /application/tomcat7_<span class="variable">$i</span>/webapps/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Change-folder-ownership-and-permissions"><a href="#Change-folder-ownership-and-permissions" class="headerlink" title="Change folder ownership and permissions:"></a>Change folder ownership and permissions:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chown -R tomcat.tomcat /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run02.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> logs temp </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run03.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> bin webapps conf </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod 770 /application/tomcat7_<span class="variable">$i</span>/conf/catalina.policy; <span class="keyword">done</span></span><br><span class="line">vim /tmp/run04.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> catalina.properties context.xml logging.properties server.xml tomcat-users.xml web.xml</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/conf/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Remove-Server-Banner"><a href="#Remove-Server-Banner" class="headerlink" title="Remove Server Banner"></a>Remove Server Banner</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /application/tomcat/lib</span><br><span class="line">mkdir -p org/apache/catalina/util/</span><br><span class="line">jar xf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">ll org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">vim org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">server.info=Secure Web server</span><br><span class="line">server.number=1.0.0.0</span><br><span class="line">server.built=Jan 01 2000 00:00:00 UTC</span><br><span class="line">jar uf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">rm -rf /application/tomcat/lib/org</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/tomcat/">tomcat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/3/"><span></span>Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="stanosaka" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Devops/" title="Devops">Devops<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/aws/" title="aws">aws<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/centos/" title="centos">centos<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/CD-CI/" title="CD/CI">CD/CI<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tomcat/" title="tomcat">tomcat<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/saltstack/" title="saltstack">saltstack<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/zabbix/" title="zabbix">zabbix<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ec2/" title="ec2">ec2<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/backup/" title="backup">backup<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Pipeline/" title="Pipeline">Pipeline<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Blue-Ocean/" title="Blue Ocean">Blue Ocean<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/SRE/" title="SRE">SRE<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://github.com/kahun/awesome-sysadmin" target="_blank" title="Awesome-sysadmin">Awesome-sysadmin</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/crazy-canux/awesome-monitoring" target="_blank" title="Awesome-monitoring">Awesome-monitoring</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.opsschool.org/index.html" target="_blank" title="Ops School Curriculum">Ops School Curriculum</a>
            
          </li>
        
          <li>
            
            	<a href="https://kupczynski.info/2018/04/18/spacemacs.html" target="_blank" title="Learning Spacemacs">Learning Spacemacs</a>
            
          </li>
        
          <li>
            
            	<a href="https://landing.google.com/sre/books/" target="_blank" title="SRE Books">SRE Books</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/aws-samples" target="_blank" title="AWS Samples">AWS Samples</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/bikrambora/devlab-launchpad" target="_blank" title="Welcome to Dev Labs">Dev Labs</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/ansible/ansible-examples" target="_blank" title="Ansible GitHub repo">Ansible GitHub repo</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" title="Ansible Best Practices">Ansible Best Practices</a>
            
          </li>
        
          <li>
            
            	<a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" title="kubectl cheat sheet">kubectl cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://rogerdudler.github.io/git-guide" target="_blank" title="Git commands">Git commands</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" title="Dockerfile reference">Dockerfile reference</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2mTQr8l" target="_blank" title="Linux Command line cheat sheet">Linux Command line cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2EPHxze" target="_blank" title="PowerShell Basic Cheat Sheet">PowerShell Basic Cheat Sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" title="sed cheatsheet">sed cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://obsavus1p.bkt.clouddn.com/vim_cheat_sheet_for_programmers_print.png" target="_blank" title="vim cheatsheet">vim cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.gitbook.com/book/yeasy/docker_practice/details" target="_blank" title="Learn Docker">Learn Docker</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.unixhot.com/page/ops" target="_blank" title="运维知识体系">运维知识体系</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.tecmint.com/" target="_blank" title="tecmint">tecmint</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.lib.uts.edu.au" target="_blank" title="shoujin.wang@student.uts.edu.au">UTS Library</a>
            
          </li>
        
          <li>
            
            	<a href="https://7esl.com" target="_blank" title="ESL">ESL</a>
            
          </li>
        
          <li>
            
            	<a href="https://stanchou.wordpress.com" target="_blank" title="Stan&#39;s wordpress">Stan&#39;s wordpress</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.00root.com" target="_blank" title="Stan&#39;s gitbook">Stan&#39;s gitbook</a>
            
          </li>
        
          <li>
            
            	<a href="https://api.ipify.org" target="_blank" title="Your IP address">Your IP address</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/stanosaka/oreilly_sql_fundamentals_for_data/blob/master/notes_and_slides/sql_fundamentals_notes.md" target="_blank" title="sql fundamentials">sql fundamentials</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.nerdfonts.com" target="_blank" title="Nred Fonts">Nred Fonts</a>
            
          </li>
        
          <li>
            
            	<a href="http://cb.vu/unixtoolbox.xhtml" target="_blank" title="UNIX TOOLBOX">UNIX TOOLBOX</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/Ben-PH/spacemacs-cheatsheet" target="_blank" title="spacemacs-cheatsheet">spacemacs-cheatsheet</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Stan. <br/>
			I am a Site Reliability Engineer working and living in Sydney.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/stanosaka" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6724938" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/stanosaka" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/stan.osaka" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/00root" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/btw01v" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/stan-22-82" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:devops@cwzhou.win" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="Stan Zhou">Stan Zhou</a>
		
		
		</p>
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>


        
  	    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
               if (window.mermaid) {
                  mermaid.initialize({theme: 'forest'});
               }
            </script>
        












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
