
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Stan Zhou&#39;s Hexo Technical Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stan Zhou">
    

    
    <meta name="description" content="Infrastructure as code">
<meta property="og:type" content="website">
<meta property="og:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:url" content="http://223.95.78.227/page/4/index.html">
<meta property="og:site_name" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:description" content="Infrastructure as code">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta name="twitter:description" content="Infrastructure as code">
<meta name="twitter:creator" content="@stanosaka">

    
    <link rel="alternative" href="/atom.xml" title="Stan Zhou&#39;s Hexo Technical Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/toad.ico">
    
    
    <link rel="apple-touch-icon" href="/img/toadman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/toadman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/toadman.png" alt="Stan Zhou&#39;s Hexo Technical Blog" title="Stan Zhou&#39;s Hexo Technical Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Stan Zhou&#39;s Hexo Technical Blog">Stan Zhou&#39;s Hexo Technical Blog</a></h1>
				<h2 class="blog-motto">Innovation Evangelist</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:223.95.78.227">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/tomcat01/" title="tomcat deploy" itemprop="url">tomcat deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T00:10:37.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="tomcat-deploy-on-centos"><a href="#tomcat-deploy-on-centos" class="headerlink" title="tomcat deploy on centos"></a>tomcat deploy on centos</h2><h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><h3 id="JDK下载："><a href="#JDK下载：" class="headerlink" title="JDK下载："></a>JDK下载：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate --no-cookies --header <span class="string">"Cookie: oraclelicense=accept-securebackup-cookie"</span> http://download.oracle.com/otn-pub/java/jdk/7u79-b15/jdk-7u79-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat下载"><a href="#Tomcat下载" class="headerlink" title="Tomcat下载:"></a><a href="http://tomcat.apache.org/">Tomcat下载</a>:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://toad.cwzhou.win/pub/apache-tomcat-7.0.70.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="部署java环境"><a href="#部署java环境" class="headerlink" title="部署java环境"></a>部署java环境</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tar xf jdk-8u91-linux-x64.tar.gz -C /application/</span><br><span class="line"></span><br><span class="line">ln -s /application/jdk1.8.0/ /application/jdk</span><br><span class="line">cp /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="comment"># sed -i.ori '$a export JAVA_HOME=/application/jdk\nexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH\nexport CLASSPATH=.$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$JAVA_HOME/lib/tools.jar' /etc/profile</span></span><br><span class="line"></span><br><span class="line">vimdiff /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<h2 id="Install-tomcat"><a href="#Install-tomcat" class="headerlink" title="Install tomcat"></a>Install tomcat</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tar xf apache-tomcat-8.0.27.tar.gz -C /application/</span><br><span class="line">ln -s /application/apache-tomcat-8.0.27 /application/tomcat</span><br><span class="line"><span class="built_in">echo</span>  <span class="string">'export TOMCAT_HOME=/application/tomcat'</span>&gt;&gt;/etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">chown -R root.root /application/jdk/ /application/tomcat/</span><br><span class="line">[root@tomcat ~]<span class="comment"># tail -4 /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> TOMCAT_HOME=/application/tomcat</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat目录介绍"><a href="#Tomcat目录介绍" class="headerlink" title="Tomcat目录介绍"></a>Tomcat目录介绍</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/tomcat/</span></span><br><span class="line">[root@tomcat tomcat]<span class="comment"># tree -L 1</span></span><br><span class="line">.</span><br><span class="line">├── bin <span class="comment">#→用以启动、关闭Tomcat或者其它功能的脚本（.bat文件和.sh文件）</span></span><br><span class="line">├── conf <span class="comment">#→用以配置Tomcat的XML及DTD文件</span></span><br><span class="line">├── lib <span class="comment">#→存放web应用能访问的JAR包</span></span><br><span class="line">├── LICENSE</span><br><span class="line">├── logs <span class="comment">#→Catalina和其它Web应用程序的日志文件</span></span><br><span class="line">├── NOTICE</span><br><span class="line">├── RELEASE-NOTES</span><br><span class="line">├── RUNNING.txt</span><br><span class="line">├── temp <span class="comment">#→临时文件</span></span><br><span class="line">├── webapps <span class="comment">#→Web应用程序根目录</span></span><br><span class="line">└── work <span class="comment">#→用以产生有JSP编译出的Servlet的.java和.class文件</span></span><br><span class="line">7 directories, 4 files</span><br><span class="line">[root@tomcat tomcat]<span class="comment"># cd webapps/</span></span><br><span class="line">[root@tomcat webapps]<span class="comment"># ll</span></span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 14 root root 4096 Oct 5 12:09 docs <span class="comment">#→tomcat帮助文档</span></span><br><span class="line">drwxr-xr-x 6 root root 4096 Oct 5 12:09 examples <span class="comment">#→web应用实例</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 host-manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct 5 12:09 ROOT <span class="comment">#→默认网站根目录</span></span><br></pre></td></tr></table></figure>
<h2 id="Tomcat多实例及集群架构"><a href="#Tomcat多实例及集群架构" class="headerlink" title="Tomcat多实例及集群架构"></a>Tomcat多实例及集群架构</h2><h3 id="Tomcat多实例"><a href="#Tomcat多实例" class="headerlink" title="Tomcat多实例"></a>Tomcat多实例</h3><p>复制Tomcat目录<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_1</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_2</span></span><br></pre></td></tr></table></figure></p>
<p>修改配置文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat application]<span class="comment"># mkdir -p /data/www/www/ROOT</span></span><br><span class="line">[root@tomcat application]<span class="comment"># cp /application/tomcat/webapps/memtest/meminfo.jsp /data/www/www/ROOT/</span></span><br><span class="line">sed -i <span class="string">'22s#8005#8011#;71s#8080#8081#;125s#appBase=".*"# appBase="/data/www/www"#'</span> /application/tomcat7_1/conf/server.xml</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'22s#8005#8012#;71s#8080#8082#;125s#appBase=".*"# appBase="/data/www/www"#'</span> /application/tomcat7_2/conf/server.xml</span><br></pre></td></tr></table></figure></p>
<h3 id="jvm调优"><a href="#jvm调优" class="headerlink" title="jvm调优"></a>jvm调优</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim catalina.sh insert</span></span><br><span class="line">JAVA_OPTS=<span class="string">"-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m -XX:MaxPermSize=512m"</span></span><br></pre></td></tr></table></figure>
<h3 id="service-startup-script"><a href="#service-startup-script" class="headerlink" title="service startup script"></a>service startup script</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/init.d</span><br><span class="line"></span><br><span class="line">vim tomcat</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># des: Tomcat Start Stop Restart</span></span><br><span class="line"><span class="comment"># processname: tomcat</span></span><br><span class="line"><span class="comment"># chkconfig: 234 20 80</span></span><br><span class="line">JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME</span><br><span class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line">CATALINA_HOME=/application/tomcat</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line">chkconfig --add tomcat</span><br><span class="line">chkconfig --level 234 tomcat on</span><br><span class="line">chkconfig --list tomcat</span><br><span class="line">groupadd tomcat</span><br><span class="line">useradd -g tomcat -d /home/tomcat -s /bin/sh tomcat</span><br><span class="line"><span class="built_in">cd</span> /etc/init.d/</span><br><span class="line"></span><br><span class="line">chown tomcat:tomcat  tomcat</span><br><span class="line"></span><br><span class="line">chmod +x tomcat</span><br><span class="line">service tomcat start</span><br><span class="line"></span><br><span class="line">check the <span class="built_in">log</span>:</span><br><span class="line">tail /application/tomcat/logs/catalina.out</span><br></pre></td></tr></table></figure>
<h3 id="Remove-default-content"><a href="#Remove-default-content" class="headerlink" title="Remove default content:"></a>Remove default content:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /root/apache-tomcat-7.0.70.tar.gz</span><br><span class="line">vim /tmp/run01.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> docs examples host-manager manager ROOT/RELEASE-NOTES.txt </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                rm -rf /application/tomcat7_<span class="variable">$i</span>/webapps/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Change-folder-ownership-and-permissions"><a href="#Change-folder-ownership-and-permissions" class="headerlink" title="Change folder ownership and permissions:"></a>Change folder ownership and permissions:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chown -R tomcat.tomcat /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run02.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> logs temp </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run03.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> bin webapps conf </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod 770 /application/tomcat7_<span class="variable">$i</span>/conf/catalina.policy; <span class="keyword">done</span></span><br><span class="line">vim /tmp/run04.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> catalina.properties context.xml logging.properties server.xml tomcat-users.xml web.xml</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/conf/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Remove-Server-Banner"><a href="#Remove-Server-Banner" class="headerlink" title="Remove Server Banner"></a>Remove Server Banner</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /application/tomcat/lib</span><br><span class="line">mkdir -p org/apache/catalina/util/</span><br><span class="line">jar xf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">ll org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">vim org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">server.info=Secure Web server</span><br><span class="line">server.number=1.0.0.0</span><br><span class="line">server.built=Jan 01 2000 00:00:00 UTC</span><br><span class="line">jar uf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">rm -rf /application/tomcat/lib/org</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/tomcat/">tomcat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/17/nginx/" title="optimize nginx performance" itemprop="url">optimize nginx performance</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-17T03:45:29.000Z" itemprop="datePublished"> Published 2016-10-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="1-优化worker进程个数"><a href="#1-优化worker进程个数" class="headerlink" title="1.优化worker进程个数"></a>1.优化worker进程个数</h3><p>查看cpu总核数<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep processor /proc/cpuinfo|wc -l</span></span><br><span class="line">2 <span class="comment">#表示为1颗CPU四核</span></span><br></pre></td></tr></table></figure></p>
<p>查看CPU总颗数：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep 'physical id' /proc/cpuinfo|sort|uniq|wc -l</span></span><br><span class="line">1 <span class="comment">#对physical id去重计数，表示1颗cpu</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim nginx.conf</span></span><br><span class="line">worker_processes 2;</span><br><span class="line"><span class="comment"># /application/nginx/sbin/nginx -t</span></span><br><span class="line"><span class="comment"># /application/nginx/sbin/nginx -s reload</span></span><br></pre></td></tr></table></figure>
<h3 id="2-访问日志配置实战"><a href="#2-访问日志配置实战" class="headerlink" title="2.访问日志配置实战"></a>2.访问日志配置实战</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">'21,23 s/#//gp'</span> ../conf/nginx.conf.default</span><br><span class="line">log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line"><span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line"><span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">vim nginx.con</span><br><span class="line">error_log  logs/error.log;</span><br><span class="line">...</span><br><span class="line">http &#123;</span><br><span class="line">...</span><br><span class="line">log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">		  <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">		  <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">access_log  logs/access.log  main;</span><br><span class="line">   </span><br><span class="line">...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>Nginx访问日志轮询切割<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /server/script/cut_nginx_log.sh</span></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">Dateformat=`date +%Y%m%d`</span><br><span class="line">Basedir=<span class="string">"/application/nginx"</span></span><br><span class="line">Nginxlogdir=<span class="string">"<span class="variable">$Basedir</span>/logs"</span></span><br><span class="line">Logname=<span class="string">"access"</span></span><br><span class="line">[ -d <span class="variable">$Nginxlogdir</span> ] &amp;&amp; <span class="built_in">cd</span> <span class="variable">$Nginxlogdir</span> || <span class="built_in">exit</span> 1</span><br><span class="line">[ -f <span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span> ]|| exit1</span><br><span class="line">/bin/mv <span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span> <span class="variable">$&#123;Dateformat&#125;</span>_<span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span></span><br><span class="line"><span class="variable">$Basedir</span>/sbin/nginx -s reload</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /var/spool/cron/root &lt;&lt;EOF</span><br><span class="line"><span class="comment">#cut nginx access log by cwzhou</span></span><br><span class="line">00 00 * * * /bin/sh /server/script/cut_nginx_log.sh &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#check result</span></span><br><span class="line"><span class="comment">#crontab -l</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Nginx并发连接数量"><a href="#Nginx并发连接数量" class="headerlink" title="Nginx并发连接数量"></a>Nginx并发连接数量</h3><blockquote>
<p>Reference <a href="http://nginx.org/en/docs/http/ngx_http_limit_conn_module.html">ngx_http_limit_conn_module</a><br>1.限制单ip并发连接数<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.conf</span><br><span class="line">...</span><br><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    limit_conn_zone <span class="variable">$binary_remote_addr</span> zone=addr:10m;</span><br><span class="line">    server&#123;</span><br><span class="line">	...</span><br><span class="line">	location / &#123;</span><br><span class="line">		...</span><br><span class="line">		limit_conn addr 1; <span class="comment">#限制单ip的并发连接为1</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ab -c 1 -n 10 http://10.0.0.3/  <span class="comment">#模拟并发连接1,访问10次服务器</span></span><br><span class="line"><span class="comment"># -c为并发数 -n为请求书 10.0.0.3为nginx的Ip地址</span></span><br></pre></td></tr></table></figure>
<p>应用场景之一是服务器下载：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /download/ &#123;</span><br><span class="line">	limit_conn add 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.限制虚拟主机总连接数<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.conf</span><br><span class="line">...</span><br><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    limit_conn_zone <span class="variable">$binary_remote_addr</span> zone=addr:10m;</span><br><span class="line">    limit_conn_zone <span class="variable">$server_name</span> zone=perserver:10m;</span><br><span class="line"></span><br><span class="line">    server&#123;</span><br><span class="line">	...</span><br><span class="line">	location / &#123;</span><br><span class="line">		...</span><br><span class="line">		limit_conn perserver 2; <span class="comment">#限制虚拟主机连接数为2</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/nginx/">nginx</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/13/sysadmintool/" title="system admin tools" itemprop="url">system admin tools</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-13T05:23:04.000Z" itemprop="datePublished"> Published 2016-10-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="system-admin-tool"><a href="#system-admin-tool" class="headerlink" title="system admin tool"></a>system admin tool</h2><p><a href="http://blog.chinaunix.net/uid-10915175-id-3246219.html%22iostat%E4%BB%8B%E7%BB%8D%22">iostat介绍</a><br><a href="http://blog.chinaunix.net/uid-10915175-id-4543091.html">全能系统监控工具dstat </a><br>most use:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@toad pxe]<span class="comment"># dstat -cmsdnl -D sda3 -N lo,eth0 100 5</span></span><br></pre></td></tr></table></figure></p>
<p>网络监控工具<br>本地服务器的网卡吞吐量：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptraf -d eth0</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># both</span></span><br><span class="line">wget ftp://ftp.netperf.org/netperf/netperf-2.7.0.tar.gz</span><br><span class="line">tar xf netperf-2.7.0.tar.gz</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务端：</span></span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># netserver</span></span><br><span class="line">Starting netserver with host <span class="string">'IN(6)ADDR_ANY'</span> port <span class="string">'12865'</span> and family AF_UNSPEC</span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># lsof -i :12865</span></span><br><span class="line">COMMAND     PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME</span><br><span class="line">netserver 18230 root    3u  IPv6 2815424      0t0  TCP *:12865 (LISTEN)</span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># ethtool eth0 |grep -i speed</span></span><br><span class="line">        Speed: 1000Mb/s</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端</span></span><br><span class="line">root@kali:~/Downloads/netperf-2.7.0<span class="comment">#  netperf -H 192.168.199.231 -l 60</span></span><br><span class="line">MIGRATED TCP STREAM TEST from 0.0.0.0 () port 0 AF_INET to 192.168.199.231 () port 0 AF_INET</span><br><span class="line">Recv   Send    Send</span><br><span class="line">Socket Socket  Message  Elapsed</span><br><span class="line">Size   Size    Size     Time     Throughput</span><br><span class="line">bytes  bytes   bytes    secs.    10^6bits/sec</span><br><span class="line"></span><br><span class="line">87380  16384  16384    60.02      94.13</span><br><span class="line">root@kali:~/Downloads/netperf-2.7.0<span class="comment"># ethtool eth0 |grep -i speed</span></span><br><span class="line">        Speed: 100Mb/s</span><br></pre></td></tr></table></figure>
<p>Netperf缺省情况下进行TCP批量传输，即-t TCP_STREAM。测试过程中，netperf向netserver发送批量的TCP数据分组，以确定数据传输过程中的吞吐量：<br> 从netperf的结果输出中，我们可以知道以下的一些信息：<br>1）    远端系统（即server）使用大小为87380字节的socket接收缓冲<br>2）    本地系统（即client）使用大小为16384字节的socket发送缓冲<br>3）    向远端系统发送的测试分组大小为16384字节<br>4）    测试经历的时间为60秒<br>5）    吞吐量的测试结果为94.13Mbits/秒</p>
<blockquote>
<p>Reference <a href="https://www.ibm.com/developerworks/cn/linux/l-netperf/">netperf 与网络性能测量</a></p>
</blockquote>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/system-admin/">system admin</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/12/zabbix/" title="zabbix" itemprop="url">zabbix</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-12T04:54:53.000Z" itemprop="datePublished"> Published 2016-10-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="zabbix"><a href="#zabbix" class="headerlink" title="zabbix"></a>zabbix</h2><table>
<thead>
<tr>
<th></th>
<th>IP address</th>
<th>Roles</th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>192.168.0.49(chatswood)</td>
<td>zabbix server</td>
<td>Centos 6.8 Zabbix 2.4.8</td>
<td></td>
</tr>
<tr>
<td></td>
<td>192.168.0.80(macadamina)</td>
<td>zabbix agent</td>
<td>Centos 6.8 Zabbix 2.4.8</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="server-setup"><a href="#server-setup" class="headerlink" title="server setup"></a>server setup</h2> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-server -y</span><br><span class="line">tar xf zabbix-2.4.8.tar.gz</span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8</span><br><span class="line">./configure --prefix=/opt/zabbix --<span class="built_in">enable</span>-server --<span class="built_in">enable</span>-agent --with-mysql</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">yum install httpd php-devel php php-mbstring -y</span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line"><span class="built_in">cd</span> /opt/zabbix/</span><br><span class="line">mv etc&#123;,_bak&#125;</span><br><span class="line">/bin/cp -rf etc_bak/ etc</span><br><span class="line">[root@chatswood ~]<span class="comment"># cat /opt/zabbix/etc/zabbix_server.conf|egrep -v "^#|^$"</span></span><br><span class="line">LogFile=/tmp/zabbix_server.log</span><br><span class="line">PidFile=/tmp/zabbix_server.pid</span><br><span class="line">DBSocket=/tmp/mysql.sock</span><br><span class="line">DBHost=chatswood</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=123456</span><br><span class="line">Timeout=30</span><br><span class="line">[root@chatswood ~]<span class="comment"># cat /opt/zabbix/etc/zabbix_agentd.conf|egrep -v "^#|^$"</span></span><br><span class="line">PidFile=/tmp/zabbix_agentd.pid</span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=chatswood</span><br><span class="line">ServerActive=chatswood</span><br><span class="line">Hostname=chatswood</span><br><span class="line">Timeout=30</span><br><span class="line"></span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line"><span class="comment"># mysql</span></span><br><span class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8;</span><br><span class="line">mysql&gt; grant all on zabbix.* to zabbix@<span class="string">'192.168.0.49'</span> identified by <span class="string">'123456'</span>;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8/database/mysql</span><br><span class="line">mysql zabbix &lt; ./schema.sql -p</span><br><span class="line">mysql zabbix &lt; ./images.sql -p</span><br><span class="line">mysql zabbix &lt; ./data.sql -p</span><br><span class="line"><span class="comment">## test database</span></span><br><span class="line">mysql -u zabbix -p -h192.168.0.49</span><br><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a zabbix user</span></span><br><span class="line">groupadd -g 508 zabbix</span><br><span class="line">useradd -g 508 -u 508 zabbix -M -s /sbin/nologin</span><br><span class="line"></span><br><span class="line">/opt/zabbix/sbin/zabbix_server -c /opt/zabbix/etc/zabbix_server.conf</span><br><span class="line">ps aux|grep zabbix</span><br><span class="line">/opt/zabbix/sbin/zabbix_agentd -c /opt/zabbix/etc/zabbix_agentd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">/opt/zabbix/bin/zabbix_get -s chatswood -k proc.num[]</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8</span><br><span class="line">mkdir /var/www/html/zabbix</span><br><span class="line">/bin/cp -rf frontends/php/* /var/www/html/zabbix/</span><br><span class="line">vim /etc/php.ini</span><br><span class="line">date.timezone = Asia/Shanghai</span><br><span class="line">post_max_size = 18M</span><br><span class="line">max_execution_time = 350</span><br><span class="line">max_input_time = 350</span><br><span class="line"></span><br><span class="line">yum install php-gd php-xml php-mysql php-bcmath -y</span><br><span class="line">/etc/init.d/httpd restart</span><br><span class="line">ps aux|grep apache</span><br><span class="line">/usr/sbin/ntpdate 3.cn.pool.ntp.org</span><br><span class="line">chown -R apache /var/www/html/zabbix/</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="agent-setup"><a href="#agent-setup" class="headerlink" title="agent setup"></a>agent setup</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line">./configure --prefix=/opt/zabbix --<span class="built_in">enable</span>-agent --with-net-snmp</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">groupadd -g 508 zabbix</span><br><span class="line">useradd -g 508 -u 508 zabbix -M -s /sbin/nologin</span><br><span class="line">cat /opt/zabbix/etc/zabbix_agentd.conf|egrep -v <span class="string">"^#|^$"</span></span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=chatswood</span><br><span class="line">ServerActive=chatswood</span><br><span class="line">Hostname=macadamina</span><br><span class="line"></span><br><span class="line">/opt/zabbix/sbin/zabbix_agentd -c /opt/zabbix/etc/zabbix_agentd.conf</span><br><span class="line">ps aux|grep zabbix</span><br><span class="line">lsof|grep zabbix</span><br></pre></td></tr></table></figure>
<p>Access <a href="http://192.168.0.49/zabbix">http://192.168.0.49/zabbix</a>,<br>default username: admin<br>password: zabbix</p>
<hr>
<h2 id="issue"><a href="#issue" class="headerlink" title="issue"></a>issue</h2><hr>
<p>checking for mysql_config… /usr/bin/mysql_config<br>checking for main in -lmysqlclient… no<br>configure: error: Not found mysqlclient library</p>
<p>#yum -y install mysql-devel</p>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/zabbix/">zabbix</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/10/web-security/" title="web security" itemprop="url">web security</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-10-10T00:03:50.000Z" itemprop="datePublished"> Published 2016-10-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="web安全"><a href="#web安全" class="headerlink" title="web安全"></a>web安全</h1><h3 id="Table-of-contents"><a href="#Table-of-contents" class="headerlink" title="Table of contents"></a>Table of contents</h3><p>You can insert a table of contents using the marker <code>[TOC]</code>:</p>
<p>[TOC]</p>
<h2 id="使用iptables防护网站安全"><a href="#使用iptables防护网站安全" class="headerlink" title="使用iptables防护网站安全"></a>使用iptables防护网站安全</h2><blockquote>
<p><strong>只允许特定流量通过，禁用其他流量</strong></p>
</blockquote>
<blockquote>
<ul>
<li>permit ssh<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>permit DNS<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -l INPUT 1 -p tcp --sport 53 -j ACCEPT</span><br><span class="line">iptables -l INPUT 1 -p udp --sport 53 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>permit service<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -l INPUT 1 -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>forbid all others<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -j DROP</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@toad ~]<span class="comment"># netstat -tn</span></span><br><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State</span><br><span class="line">tcp        0      0 192.168.199.231:61094       101.200.31.147:443          TIME_WAIT</span><br><span class="line">tcp        0     64 192.168.199.231:22          60.186.174.98:61241         ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.199.231:41795       192.168.199.1:445           ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.199.231:22          60.186.174.98:50722         ESTABLISHED</span><br><span class="line">tcp        0      0 ::1:19187                   ::1:10010                   TIME_WAIT</span><br><span class="line"></span><br><span class="line">[root@toad ~]<span class="comment"># netstat -tn|grep 192.168.199.231|awk '&#123;print $5&#125;'|awk -F ":" '&#123;print $1&#125;'|sort|uniq -c|sort -r -n</span></span><br><span class="line">      2 60.186.174.98</span><br><span class="line">      2 101.200.31.147</span><br><span class="line">      1 192.168.199.1</span><br><span class="line">[root@toad ~]<span class="comment"># iptables -l INPUT 1 -s 60.186.174.98 -j DROP</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="AIDE入侵检测系统"><a href="#AIDE入侵检测系统" class="headerlink" title="AIDE入侵检测系统"></a>AIDE入侵检测系统</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#install aide</span></span><br><span class="line">yum install -y aide</span><br><span class="line"></span><br><span class="line"><span class="comment">#config aide</span></span><br><span class="line">vim /etc/aide.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#init aide database</span></span><br><span class="line">aide --init</span><br><span class="line">mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#check monitor file</span></span><br><span class="line">aide --check</span><br><span class="line"></span><br><span class="line"><span class="comment">#update aide database</span></span><br><span class="line">aide --update</span><br><span class="line"></span><br><span class="line"><span class="comment">#setup cron job</span></span><br><span class="line">crontab -e</span><br><span class="line">* 3 * * * /usr/sbin/aide --check|mail -s <span class="string">"AIDE report "</span> sizemore@gmail.com</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/linux/">linux</a><a href="/tags/web-security/">web security</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/21/ubuntu/" title="ubuntu" itemprop="url">ubuntu</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-09-21T13:19:19.000Z" itemprop="datePublished"> Published 2016-09-21</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Setup-Java-Development-Environment-in-Ubuntu"><a href="#Setup-Java-Development-Environment-in-Ubuntu" class="headerlink" title="Setup Java Development Environment in Ubuntu"></a>Setup Java Development Environment in Ubuntu</h1><p>Ubuntu: ubuntu-16.04-desktop-amd64</p>
<h2 id="Install-Oracle-Java-on-Ubuntu-Linux"><a href="#Install-Oracle-Java-on-Ubuntu-Linux" class="headerlink" title="Install Oracle Java on Ubuntu Linux"></a>Install Oracle Java on Ubuntu Linux</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get upgrade -y</span></span><br><span class="line"><span class="comment"># apt-get install ssh -y</span></span><br></pre></td></tr></table></figure>
<h2 id="1-Check-to-see-if-your-Ubuntu-Linux-operating-system-architecture-is-32-bit-or-64-bit"><a href="#1-Check-to-see-if-your-Ubuntu-Linux-operating-system-architecture-is-32-bit-or-64-bit" class="headerlink" title="1. Check to see if your Ubuntu Linux operating system architecture is 32-bit or 64-bit"></a>1. Check to see if your Ubuntu Linux operating system architecture is 32-bit or 64-bit</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@stan-virtual-machine:~<span class="comment"># file /sbin/init</span></span><br><span class="line">/sbin/init: symbolic link to /lib/systemd/systemd</span><br><span class="line">root@stan-virtual-machine:~<span class="comment"># file /lib/systemd/systemd</span></span><br><span class="line">/lib/systemd/systemd: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="keyword">for</span> GNU/Linux 2.6.32, BuildID[sha1]=03b9d43299696aa6b67b92f1225fa6045b978cb2, stripped</span><br></pre></td></tr></table></figure>
<h2 id="2-Check-if-you-have-Java-installed-on-your-system"><a href="#2-Check-if-you-have-Java-installed-on-your-system" class="headerlink" title="2. Check if you have Java installed on your system"></a>2. Check if you have Java installed on your system</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@stan-virtual-machine:~<span class="comment"># java -version</span></span><br><span class="line">The program <span class="string">'java'</span> can be found <span class="keyword">in</span> the following packages:</span><br><span class="line"> * default-jre</span><br><span class="line"> * gcj-5-jre-headless</span><br><span class="line"> * openjdk-8-jre-headless</span><br><span class="line"> * gcj-4.8-jre-headless</span><br><span class="line"> * gcj-4.9-jre-headless</span><br><span class="line"> * openjdk-9-jre-headless</span><br><span class="line">Try: apt install &lt;selected package&gt;</span><br></pre></td></tr></table></figure>
<h2 id="3-Completely-remove-the-OpenJDK-JRE-from-your-system-and-create-a-directory-to-hold-your-Oracle-Java-JDK-JRE-binaries"><a href="#3-Completely-remove-the-OpenJDK-JRE-from-your-system-and-create-a-directory-to-hold-your-Oracle-Java-JDK-JRE-binaries" class="headerlink" title="3. Completely remove the OpenJDK/JRE from your system and create a directory to hold your Oracle Java JDK/JRE binaries."></a>3. Completely remove the OpenJDK/JRE from your system and create a directory to hold your Oracle Java JDK/JRE binaries.</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@stan-virtual-machine:~<span class="comment"># apt-get purge openjdk-\*</span></span><br><span class="line">root@stan-virtual-machine:~<span class="comment"># mkdir -p /usr/local/java</span></span><br></pre></td></tr></table></figure>
<p>Go to link: <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a><br>download <a href="http://download.oracle.com/otn-pub/java/jdk/8u101-b13/jdk-8u101-linux-x64.tar.gz">http://download.oracle.com/otn-pub/java/jdk/8u101-b13/jdk-8u101-linux-x64.tar.gz</a><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@stan-virtual-machine:/home/stan/Downloads<span class="comment"># cp -r jdk-8u101-linux-x64.tar.gz /usr/local/java</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tar xvzf jdk-8u101-linux-x64.tar.gz</span></span><br><span class="line"><span class="comment"># vim /etc/profile     #add into end of the file</span></span><br><span class="line">JAVA_HOME=/usr/<span class="built_in">local</span>/java/jdk1.8.0_101</span><br><span class="line">JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME</span><br><span class="line"><span class="built_in">export</span> JRE_HOME</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line"><span class="comment"># update-alternatives --install "/usr/bin/java" "java" "/usr/local/java/jdk1.8.0_101/jre/bin/java" 1</span></span><br><span class="line"><span class="comment"># update-alternatives --install "/usr/bin/javac" "javac" "/usr/local/java/jdk1.8.0_101/bin/javac" 1</span></span><br><span class="line"><span class="comment"># update-alternatives --set java /usr/local/java/jdk1.8.0_101/jre/bin/java</span></span><br><span class="line"><span class="comment"># update-alternatives --set javac /usr/local/java/jdk1.8.0_101/bin/javac</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p>
<h2 id="4-Check"><a href="#4-Check" class="headerlink" title="4.Check"></a>4.Check</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@stan-virtual-machine:/usr/<span class="built_in">local</span>/java<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">"1.8.0_101"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_101-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.101-b13, mixed mode)</span><br><span class="line">root@stan-virtual-machine:/usr/<span class="built_in">local</span>/java<span class="comment"># javac -version</span></span><br><span class="line">javac 1.8.0_101</span><br></pre></td></tr></table></figure>
<hr>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/ubuntu/">ubuntu</a><a href="/tags/java/">java</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/18/saltstackminion/" title="saltstack minion" itemprop="url">saltstack minion</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-09-18T07:58:08.000Z" itemprop="datePublished"> Published 2016-09-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="1-Install-minion"><a href="#1-Install-minion" class="headerlink" title="1. Install minion:"></a>1. Install minion:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@chatswood ~]<span class="comment"># rpm -ivh http://mirrors.aliyun.com/epel/epel-release-latest-6.noarch.rpm</span></span><br><span class="line">Retrieving http://mirrors.aliyun.com/epel/epel-release-latest-6.noarch.rpm</span><br><span class="line">warning: /var/tmp/rpm-tmp.nKEP1w: Header V3 RSA/SHA256 Signature, key ID 0608b895: NOKEY</span><br><span class="line">Preparing...                <span class="comment">########################################### [100%]</span></span><br><span class="line">   1:epel-release           <span class="comment">########################################### [100%]</span></span><br><span class="line">   </span><br><span class="line">[root@chatswood ~]<span class="comment"># yum install -y salt-minion</span></span><br><span class="line">[root@chatswood ~]<span class="comment"># chkconfig salt-minion on</span></span><br></pre></td></tr></table></figure>
<h3 id="2-Configuration"><a href="#2-Configuration" class="headerlink" title="2. Configuration:"></a>2. Configuration:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@chatswood ~]<span class="comment"># sed -n 16p /etc/salt/minion</span></span><br><span class="line"><span class="comment">#master: salt</span></span><br><span class="line">[root@chatswood ~]<span class="comment"># sed -i '16s#\#master: salt#master: 192.168.0.100#' /etc/salt/minion</span></span><br><span class="line">[root@chatswood ~]<span class="comment"># sed -n 16p /etc/salt/minion</span></span><br><span class="line">master: 192.168.0.100</span><br><span class="line">[root@chatswood ~]<span class="comment"># cat /etc/hosts</span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.0.100   toad</span><br><span class="line">192.168.0.168   salt-minion01</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line">[root@chatswood ~]<span class="comment"># /etc/init.d/salt-minion start</span></span><br></pre></td></tr></table></figure>
<p>On salt master side:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@toad tomcat-formula]<span class="comment"># cat /etc/hosts</span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.0.100   toad</span><br><span class="line">192.168.0.168   salt-minion01</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line">[root@toad tomcat-formula]<span class="comment"># service salt-master restart</span></span><br><span class="line">Stopping salt-master daemon:                               [  OK  ]</span><br><span class="line">Starting salt-master daemon:                               [  OK  ]</span><br><span class="line">[root@toad tomcat-formula]<span class="comment"># salt-key</span></span><br><span class="line">Accepted Keys:</span><br><span class="line">macadamina</span><br><span class="line">salt-minion01</span><br><span class="line">Denied Keys:</span><br><span class="line">Unaccepted Keys:</span><br><span class="line">chatswood</span><br><span class="line">Rejected Keys:</span><br><span class="line">[root@toad tomcat-formula]<span class="comment"># salt-key -A</span></span><br><span class="line">The following keys are going to be accepted:</span><br><span class="line">Unaccepted Keys:</span><br><span class="line">chatswood</span><br><span class="line">Proceed? [n/Y] Y</span><br><span class="line">Key <span class="keyword">for</span> minion chatswood accepted.</span><br><span class="line">[root@toad tomcat-formula]<span class="comment"># salt-key</span></span><br><span class="line">Accepted Keys:</span><br><span class="line">chatswood</span><br><span class="line">macadamina</span><br><span class="line">salt-minion01</span><br><span class="line">Denied Keys:</span><br><span class="line">Unaccepted Keys:</span><br><span class="line">Rejected Keys:</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/saltstack/">saltstack</a><a href="/tags/minion/">minion</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/18/saltstackformula/" title="saltstack formula" itemprop="url">saltstack formula</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-09-18T04:23:21.000Z" itemprop="datePublished"> Published 2016-09-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="1-Get-formulat"><a href="#1-Get-formulat" class="headerlink" title="1. Get formulat:"></a>1. Get formulat:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@toad formulas]<span class="comment"># cd /srv/formulas</span></span><br><span class="line">    </span><br><span class="line">[root@toad formulas]<span class="comment"># git clone https://github.com/saltstack-formulas/nginx-formula</span></span><br></pre></td></tr></table></figure>
<h3 id="2-Setup-top-file"><a href="#2-Setup-top-file" class="headerlink" title="2. Setup top file:"></a>2. Setup top file:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@toad salt]<span class="comment"># cat top.sls</span></span><br><span class="line">base:</span><br><span class="line">   <span class="string">'*'</span>:</span><br><span class="line">       - nginx</span><br><span class="line">```       </span><br><span class="line">Add the new directory to file_roots:</span><br><span class="line">```sh</span><br><span class="line">[root@toad salt]<span class="comment"># vim /etc/salt/master</span></span><br><span class="line">file_roots:</span><br><span class="line">  base:</span><br><span class="line">    - /srv/salt</span><br><span class="line">    - /srv/formulas/tomcat-formula</span><br><span class="line">    - /srv/formulas/mysql-formula</span><br><span class="line">    - /srv/formulas/nginx-formula</span><br></pre></td></tr></table></figure>
<p>Restart the Salt Master.</p>
<h3 id="3-Run"><a href="#3-Run" class="headerlink" title="3. Run:"></a>3. Run:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br></pre></td><td class="code"><pre><span class="line">[root@toad formulas]<span class="comment"># salt 'macadamina' state.highstate</span></span><br><span class="line">macadamina:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx</span><br><span class="line">    Function: pkg.installed</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Package nginx is already installed.</span><br><span class="line">     Started: 11:45:55.019357</span><br><span class="line">    Duration: 3498.284 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /var/www</span><br><span class="line">    Function: file.directory</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Directory /var/www is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.518393</span><br><span class="line">    Duration: 1.548 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /usr/share/nginx</span><br><span class="line">    Function: file.directory</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Directory /usr/share/nginx is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.520140</span><br><span class="line">    Duration: 0.699 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx/conf.d/default.conf</span><br><span class="line">    Function: file.absent</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/nginx/conf.d/default.conf is not present</span><br><span class="line">     Started: 11:45:58.520983</span><br><span class="line">    Duration: 0.554 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx/conf.d/example_ssl.conf</span><br><span class="line">    Function: file.absent</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/nginx/conf.d/example_ssl.conf is not present</span><br><span class="line">     Started: 11:45:58.521693</span><br><span class="line">    Duration: 0.486 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx</span><br><span class="line">    Function: file.directory</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Directory /etc/nginx is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.522309</span><br><span class="line">    Duration: 1.041 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx/nginx.conf</span><br><span class="line">    Function: file.managed</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/nginx/nginx.conf updated</span><br><span class="line">     Started: 11:45:58.524655</span><br><span class="line">    Duration: 132.936 ms</span><br><span class="line">     Changes:</span><br><span class="line">              ----------</span><br><span class="line">              diff:</span><br><span class="line">                  ---</span><br><span class="line">                  +++</span><br><span class="line">                  @@ -41,15 +41,7 @@</span><br><span class="line">                               allow 127.0.0.1;</span><br><span class="line">                               deny all;</span><br><span class="line">                           &#125;</span><br><span class="line">                  -     location / &#123;</span><br><span class="line">                  -             root html;</span><br><span class="line">                  -             index index.jsp index.html index.htm;</span><br><span class="line">                  -             proxy_pass http://web_server;</span><br><span class="line">                  -     &#125;</span><br><span class="line">                       &#125;</span><br><span class="line">                  -    upstream web_server &#123;</span><br><span class="line">                  -     server 127.0.0.1:8080;</span><br><span class="line">                  -     &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                       include /etc/nginx/conf.d/*.conf;</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx/sites-enabled</span><br><span class="line">    Function: file.directory</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Directory /etc/nginx/sites-enabled is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.657818</span><br><span class="line">    Duration: 1.969 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx/sites-available</span><br><span class="line">    Function: file.directory</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Directory /etc/nginx/sites-available is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.659985</span><br><span class="line">    Duration: 1.662 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">    Function: file.absent</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /var/<span class="built_in">log</span>/nginx/access.log is not present</span><br><span class="line">     Started: 11:45:58.661843</span><br><span class="line">    Duration: 0.709 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-logger-access</span><br><span class="line">    Function: file.managed</span><br><span class="line">        Name: /etc/init/nginx-logger-access.conf</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/init/nginx-logger-access.conf is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.662778</span><br><span class="line">    Duration: 26.583 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-logger-access</span><br><span class="line">    Function: service.running</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Service nginx-logger-access is already enabled, and is running</span><br><span class="line">     Started: 11:45:58.712813</span><br><span class="line">    Duration: 32.548 ms</span><br><span class="line">     Changes:</span><br><span class="line">              ----------</span><br><span class="line">              nginx-logger-access:</span><br><span class="line">                  True</span><br><span class="line">----------</span><br><span class="line">          ID: /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">    Function: file.absent</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Removed file /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">     Started: 11:45:58.745946</span><br><span class="line">    Duration: 2.21 ms</span><br><span class="line">     Changes:</span><br><span class="line">              ----------</span><br><span class="line">              removed:</span><br><span class="line">                  /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-logger-error</span><br><span class="line">    Function: file.managed</span><br><span class="line">        Name: /etc/init/nginx-logger-error.conf</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/init/nginx-logger-error.conf is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.748406</span><br><span class="line">    Duration: 26.15 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-logger-error</span><br><span class="line">    Function: service.running</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Service nginx-logger-error is already enabled, and is running</span><br><span class="line">     Started: 11:45:58.776206</span><br><span class="line">    Duration: 28.481 ms</span><br><span class="line">     Changes:</span><br><span class="line">              ----------</span><br><span class="line">              nginx-logger-error:</span><br><span class="line">                  True</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/logrotate.d/nginx</span><br><span class="line">    Function: file.absent</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/logrotate.d/nginx is not present</span><br><span class="line">     Started: 11:45:58.805766</span><br><span class="line">    Duration: 1.142 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: htpasswd</span><br><span class="line">    Function: pkg.installed</span><br><span class="line">        Name: httpd-tools</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Package httpd-tools is already installed.</span><br><span class="line">     Started: 11:45:58.807193</span><br><span class="line">    Duration: 1.447 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-old-init</span><br><span class="line">    Function: file.rename</span><br><span class="line">        Name: /usr/share/nginx/init.d</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Source file <span class="string">"/etc/init.d/nginx"</span> has already been moved out of place</span><br><span class="line">     Started: 11:45:58.809509</span><br><span class="line">    Duration: 0.872 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-old-init-disable</span><br><span class="line">    Function: cmd.run</span><br><span class="line">        Name: chkconfig --del nginx</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: onlyif execution failed</span><br><span class="line">     Started: 11:45:58.822906</span><br><span class="line">    Duration: 10.906 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-old-init</span><br><span class="line">    Function: module.wait</span><br><span class="line">        Name: cmd.run</span><br><span class="line">      Result: True</span><br><span class="line">     Comment:</span><br><span class="line">     Started: 11:45:58.835556</span><br><span class="line">    Duration: 1.147 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx</span><br><span class="line">    Function: file.managed</span><br><span class="line">        Name: /etc/init/nginx.conf</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/init/nginx.conf is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.839171</span><br><span class="line">    Duration: 41.314 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx</span><br><span class="line">    Function: service.running</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Service nginx is already enabled, and is running</span><br><span class="line">     Started: 11:45:58.886379</span><br><span class="line">    Duration: 53.53 ms</span><br><span class="line">     Changes:</span><br><span class="line">              ----------</span><br><span class="line">              nginx:</span><br><span class="line">                  True</span><br><span class="line"></span><br><span class="line">Summary</span><br><span class="line">-------------</span><br><span class="line">Succeeded: 22 (changed=5)</span><br><span class="line">Failed:     0</span><br><span class="line">-------------</span><br><span class="line">Total states run:     22</span><br><span class="line"></span><br><span class="line">```    </span><br><span class="line"><span class="comment">### 4. Test</span></span><br><span class="line">``` sh</span><br><span class="line">[root@macadamina ~]<span class="comment"># /usr/share/nginx/init.d status</span></span><br><span class="line">nginx (pid  2092) is running...</span><br><span class="line">[root@macadamina ~]<span class="comment"># lsof -i :80</span></span><br><span class="line">COMMAND  PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">nginx   2092  root    6u  IPv4  13922      0t0  TCP localhost:http (LISTEN)</span><br><span class="line">nginx   2093 nginx    6u  IPv4  13922      0t0  TCP localhost:http (LISTEN)</span><br><span class="line">[root@macadamina ~]<span class="comment"># wget 127.0.0.1</span></span><br><span class="line">--2016-09-18 14:19:32--  http://127.0.0.1/</span><br><span class="line">Connecting to 127.0.0.1:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 3698 (3.6K) [text/html]</span><br><span class="line">Saving to: “index.html”</span><br><span class="line"></span><br><span class="line">100%[========================================================================================================&gt;] 3,698       --.-K/s   <span class="keyword">in</span> 0.007s</span><br><span class="line"></span><br><span class="line">2016-09-18 14:19:32 (545 KB/s) - “index.html” saved [3698/3698]</span><br><span class="line">[root@macadamina ~]<span class="comment"># curl 127.0.0.1</span></span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD XHTML 1.1//EN"</span> <span class="string">"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;html xmlns=<span class="string">"http://www.w3.org/1999/xhtml"</span> xml:lang=<span class="string">"en"</span>&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Test Page <span class="keyword">for</span> the Nginx HTTP Server on EPEL&lt;/title&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span><br><span class="line">        &lt;style <span class="built_in">type</span>=<span class="string">"text/css"</span>&gt;</span><br><span class="line">            /*&lt;![CDATA[*/</span><br><span class="line">            body &#123;</span><br><span class="line">                background-color: <span class="comment">#fff;</span></span><br><span class="line">                color: <span class="comment">#000;</span></span><br><span class="line">                font-size: 0.9em;</span><br><span class="line">                font-family: sans-serif,helvetica;</span><br><span class="line">                margin: 0;</span><br><span class="line">                padding: 0;</span><br><span class="line">            &#125;</span><br><span class="line">            :link &#123;</span><br><span class="line">                color: <span class="comment">#c00;</span></span><br><span class="line">            &#125;</span><br><span class="line">            :visited &#123;</span><br><span class="line">                color: <span class="comment">#c00;</span></span><br><span class="line">            &#125;</span><br><span class="line">            a:hover &#123;</span><br><span class="line">                color: <span class="comment">#f50;</span></span><br><span class="line">            &#125;</span><br><span class="line">            h1 &#123;</span><br><span class="line">                text-align: center;</span><br><span class="line">                margin: 0;</span><br><span class="line">                padding: 0.6em 2em 0.4em;</span><br><span class="line">                background-color: <span class="comment">#294172;</span></span><br><span class="line">                color: <span class="comment">#fff;</span></span><br><span class="line">                font-weight: normal;</span><br><span class="line">                font-size: 1.75em;</span><br><span class="line">                border-bottom: 2px solid <span class="comment">#000;</span></span><br><span class="line">            &#125;</span><br><span class="line">            h1 strong &#123;</span><br><span class="line">                font-weight: bold;</span><br><span class="line">                font-size: 1.5em;</span><br><span class="line">            &#125;</span><br><span class="line">            h2 &#123;</span><br><span class="line">                text-align: center;</span><br><span class="line">                background-color: <span class="comment">#3C6EB4;</span></span><br><span class="line">                font-size: 1.1em;</span><br><span class="line">                font-weight: bold;</span><br><span class="line">                color: <span class="comment">#fff;</span></span><br><span class="line">                margin: 0;</span><br><span class="line">                padding: 0.5em;</span><br><span class="line">                border-bottom: 2px solid <span class="comment">#294172;</span></span><br><span class="line">            &#125;</span><br><span class="line">            hr &#123;</span><br><span class="line">                display: none;</span><br><span class="line">            &#125;</span><br><span class="line">            .content &#123;</span><br><span class="line">                padding: 1em 5em;</span><br><span class="line">            &#125;</span><br><span class="line">            .alert &#123;</span><br><span class="line">                border: 2px solid <span class="comment">#000;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            img &#123;</span><br><span class="line">                border: 2px solid <span class="comment">#fff;</span></span><br><span class="line">                padding: 2px;</span><br><span class="line">                margin: 2px;</span><br><span class="line">            &#125;</span><br><span class="line">            a:hover img &#123;</span><br><span class="line">                border: 2px solid <span class="comment">#294172;</span></span><br><span class="line">            &#125;</span><br><span class="line">            .logos &#123;</span><br><span class="line">                margin: 1em;</span><br><span class="line">                text-align: center;</span><br><span class="line">            &#125;</span><br><span class="line">            /*]]&gt;*/</span><br><span class="line">        &lt;/style&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Welcome to &lt;strong&gt;nginx&lt;/strong&gt; on EPEL!&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=<span class="string">"content"</span>&gt;</span><br><span class="line">            &lt;p&gt;This page is used to <span class="built_in">test</span> the proper operation of the</span><br><span class="line">            &lt;strong&gt;nginx&lt;/strong&gt; HTTP server after it has been</span><br><span class="line">            installed. If you can <span class="built_in">read</span> this page, it means that the</span><br><span class="line">            web server installed at this site is working</span><br><span class="line">            properly.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div class=<span class="string">"alert"</span>&gt;</span><br><span class="line">                &lt;h2&gt;Website Administrator&lt;/h2&gt;</span><br><span class="line">                &lt;div class=<span class="string">"content"</span>&gt;</span><br><span class="line">                    &lt;p&gt;This is the default &lt;tt&gt;index.html&lt;/tt&gt; page that</span><br><span class="line">                    is distributed with &lt;strong&gt;nginx&lt;/strong&gt; on</span><br><span class="line">                    EPEL.  It is located <span class="keyword">in</span></span><br><span class="line">                    &lt;tt&gt;/usr/share/nginx/html&lt;/tt&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;p&gt;You should now put your content <span class="keyword">in</span> a location of</span><br><span class="line">                    your choice and edit the &lt;tt&gt;root&lt;/tt&gt; configuration</span><br><span class="line">                    directive <span class="keyword">in</span> the &lt;strong&gt;nginx&lt;/strong&gt;</span><br><span class="line">                    configuration file</span><br><span class="line">                    &lt;tt&gt;/etc/nginx/nginx.conf&lt;/tt&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div class=<span class="string">"logos"</span>&gt;</span><br><span class="line">                &lt;a href=<span class="string">"http://nginx.net/"</span>&gt;&lt;img</span><br><span class="line">                    src=<span class="string">"nginx-logo.png"</span></span><br><span class="line">                    alt=<span class="string">"[ Powered by nginx ]"</span></span><br><span class="line">                    width=<span class="string">"121"</span> height=<span class="string">"32"</span> /&gt;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">                &lt;a href=<span class="string">"http://fedoraproject.org/"</span>&gt;&lt;img</span><br><span class="line">                    src=<span class="string">"poweredby.png"</span></span><br><span class="line">                    alt=<span class="string">"[ Powered by Fedora EPEL ]"</span></span><br><span class="line">                    width=<span class="string">"88"</span> height=<span class="string">"31"</span> /&gt;&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/saltstack/">saltstack</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/15/saltstack/" title="saltstack" itemprop="url">saltstack</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-09-15T01:28:58.000Z" itemprop="datePublished"> Published 2016-09-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="bug-01"><a href="#bug-01" class="headerlink" title="bug 01:"></a>bug 01:</h2><pre><code>[root@toad salt]# salt &apos;*&apos; state.sls upload_data
salt-minion01:
Data failed to compile:
----------
Pillar failed to render with the following messages:
----------
Error encountered while render pillar top file.
macadamina:
Data failed to compile:
----------
Pillar failed to render with the following messages:
----------
Error encountered while render pillar top file.
</code></pre><h2 id="Fix-01"><a href="#Fix-01" class="headerlink" title="Fix 01:"></a>Fix 01:</h2><pre><code>[root@toad salt]# salt &quot;*&quot; saltutil.refresh_pillar
macadamina:
True
salt-minion01:
True
</code></pre><hr>
<h2 id="copy-the-file-to-spe-location"><a href="#copy-the-file-to-spe-location" class="headerlink" title="copy the file to spe. location:"></a>copy the file to spe. location:</h2><pre><code>[root@toad salt]# tree
.
├── contab.sls
├── createdir.sls
├── createuser.sls
├── del_cron.sls
├── files
│   ├── hosts
│   ├── wgzy.sql
│   └── zfgtai.zip
├── host_file.sls
├── nginx_install.sls
├── top.sls
├── upload_data.sls
└── upload_mysql.sls

[root@toad salt]# cat upload_mysql.sls
/usr/share/tomcat/webapps/wgzy.sql:
  file.managed:
- source: salt://files/wgzy.sql
- user: root
- group: root
- mode: 644

[root@toad salt]# salt &apos;*&apos; state.sls upload_mysql
salt-minion01:
----------
  ID: /usr/share/tomcat/webapps/wgzy.sql
Function: file.managed
  Result: True
 Comment: File /usr/share/tomcat/webapps/wgzy.sql updated
 Started: 17:11:02.739156
Duration: 298.114 ms
 Changes:
  ----------
  diff:
  New file
  mode:
  0644

Summary
------------
Succeeded: 1 (changed=1)
Failed:0
------------
Total states run: 1
macadamina:
----------
  ID: /usr/share/tomcat/webapps/wgzy.sql
Function: file.managed
  Result: True
 Comment: File /usr/share/tomcat/webapps/wgzy.sql updated
 Started: 17:11:05.274496
Duration: 254.31 ms
 Changes:
  ----------
  diff:
  New file
  mode:
  0644

Summary
------------
Succeeded: 1 (changed=1)
Failed:0
------------
Total states run: 1
</code></pre><p>Modify /etc/tomcat/server.xml<br> <Host name="localhost"  appBase="webapps"
            unpackWARs="true" autoDeploy="true"></p>
<p>to<br> <Host name="localhost"  appBase="/deploy/source/aofa_pro"
            unpackWARs="true" autoDeploy="true"></p>
<hr>
<h2 id="saltstack-run-command"><a href="#saltstack-run-command" class="headerlink" title="saltstack run command:"></a>saltstack run command:</h2><pre><code>[root@toad salt]# cat modscript.sls
sed -i &apos;125s#appBase=&quot;.*&quot;# appBase=&quot;/deploy/source/aofa_pro&quot;#&apos; /etc/tomcat/server.xml:
  cmd.run


[root@toad salt]# salt &apos;*&apos; state.sls modscript
macadamina:
----------
  ID: sed -i &apos;125s#appBase=&quot;.*&quot;# appBase=&quot;/deploy/source/aofa_pro&quot;#&apos; /etc/tomcat/server.xml
Function: cmd.run
  Result: True
 Comment: Command &quot;sed -i &apos;125s#appBase=&quot;.*&quot;# appBase=&quot;/deploy/source/aofa_pro&quot;#&apos; /etc/tomcat/server.xml&quot; run
 Started: 11:06:15.245454
Duration: 38.108 ms
 Changes:
  ----------
  pid:
  38516
  retcode:
  0
  stderr:
  stdout:

Summary
------------
Succeeded: 1 (changed=1)
Failed:0
------------
Total states run: 1
salt-minion01:
----------
  ID: sed -i &apos;125s#appBase=&quot;.*&quot;# appBase=&quot;/deploy/source/aofa_pro&quot;#&apos; /etc/tomcat/server.xml
Function: cmd.run
  Result: True
 Comment: Command &quot;sed -i &apos;125s#appBase=&quot;.*&quot;# appBase=&quot;/deploy/source/aofa_pro&quot;#&apos; /etc/tomcat/server.xml&quot; run
 Started: 11:06:16.505044
Duration: 28.841 ms
 Changes:
  ----------
  pid:
  37702
  retcode:
  0
  stderr:
  stdout:

Summary
------------
Succeeded: 1 (changed=1)
Failed:0
------------
Total states run: 1
</code></pre><p>check result:<br>    [root@toad salt]# salt ‘*’ cmd.run ‘sed -n 125p /etc/tomcat/server.xml’<br>    macadamina:<br>      &lt;Host name=”localhost”   appBase=”/deploy/source/aofa_pro”<br>    salt-minion01:<br>      &lt;Host name=”localhost”   appBase=”/deploy/source/aofa_pro”</p>
<hr>
<p>copy the file form master to minion:<br>    [root@toad salt]# salt ‘macadamina’ cp.get_file salt://files/zfgtai.zip /deploy/source/aofa_pro/zfgtai.zip<br>    macadamina:<br>    /deploy/source/aofa_pro/zfgtai.zip</p>
<p>Append text into file:</p>
<pre><code>[root@salt-minion01 ~]# sed -i &apos;34 a&lt;Valve className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot; /&gt; &lt;Manager className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot; host=&quot;localhost&quot; port=&quot;6379&quot; database=&quot;0&quot; maxInactiveInterval=&quot;60&quot; /&gt;&apos; context.xml
</code></pre>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/saltstack/">saltstack</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/29/unattend-install/" title="PXE + kickstart unattend install centos 6" itemprop="url">PXE + kickstart unattend install centos 6</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-08-29T06:25:00.000Z" itemprop="datePublished"> Published 2016-08-29</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="PXE-kickstart-unattend-install-centos-6"><a href="#PXE-kickstart-unattend-install-centos-6" class="headerlink" title="PXE + kickstart unattend install centos 6"></a>PXE + kickstart unattend install centos 6</h3><h5 id="Step-1-Install-and-configure-DNSMASQ-Server"><a href="#Step-1-Install-and-configure-DNSMASQ-Server" class="headerlink" title="Step 1: Install and configure DNSMASQ Server"></a>Step 1: Install and configure DNSMASQ Server</h5><h6 id="1-INSTALL-DNSMASQ-DEAMON"><a href="#1-INSTALL-DNSMASQ-DEAMON" class="headerlink" title="1. INSTALL DNSMASQ DEAMON"></a>1. INSTALL DNSMASQ DEAMON</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#yum install dnsmasq</span><br></pre></td></tr></table></figure>
<h6 id="2-Edit-dnsmasq-conf-file"><a href="#2-Edit-dnsmasq-conf-file" class="headerlink" title="2. Edit dnsmasq conf file"></a>2. Edit dnsmasq conf file</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># mv /etc/dnsmasq.conf  /etc/dnsmasq.conf.backup</span><br><span class="line"># vim /etc/dnsmasq.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">interface=eth0,lo</span><br><span class="line">#bind-interfaces</span><br><span class="line">domain=centos6.lan</span><br><span class="line"># DHCP range-leases</span><br><span class="line">dhcp-range= eth0,192.168.0.3,192.168.0.253,255.255.255.0,1h</span><br><span class="line"># PXE</span><br><span class="line">dhcp-boot=pxelinux.0,pxeserver,192.168.0.132</span><br><span class="line"># Gateway</span><br><span class="line">dhcp-option=3,192.168.0.1</span><br><span class="line"># DNS</span><br><span class="line">dhcp-option=6,192.168.0.1, 8.8.8.8</span><br><span class="line">server=8.8.4.4</span><br><span class="line"># Broadcast Address</span><br><span class="line">dhcp-option=28,192.168.0.255</span><br><span class="line"># NTP Server</span><br><span class="line">dhcp-option=42,0.0.0.0</span><br><span class="line">pxe-prompt=&quot;Press F8 for menu.&quot;, 60</span><br><span class="line">pxe-service=x86PC, &quot;Install CentOS 6 from network server 192.168.0.132&quot;, pxelinux</span><br><span class="line">enable-tftp</span><br><span class="line">tftp-root=/var/lib/tftpboot</span><br></pre></td></tr></table></figure>
<p>interface – Interfaces that the server should listen and provide services.</p>
<p>bind-interfaces – Uncomment to bind only on this interface.</p>
<p>domain – Replace it with your domain name.</p>
<p>dhcp-range – Replace it with IP range defined by your network mask on this segment.</p>
<p>dhcp-boot – Replace the IP statement with your interface IP Address.</p>
<p>dhcp-option=3,192.168.0.1 – Replace the IP Address with your network segment Gateway.</p>
<p>dhcp-option=6,92.168.0.1 – Replace the IP Address with your DNS Server IP – several DNS IPs can be defined.</p>
<p>server=8.8.4.4 – Put your DNS forwarders IPs Addresses.</p>
<p>dhcp-option=28,192.168.0.255 – Replace the IP Address with network broadcast address –optionally.</p>
<p>dhcp-option=42,0.0.0.0 – Put your network time servers – optionally (0.0.0.0 Address is for self-reference).</p>
<p>pxe-prompt – Leave it as default – means to hit F8 key for entering menu 60 with seconds wait time..</p>
<p>pxe=service – Use x86PC for 32-bit/64-bit architectures and enter a menu description prompt under string quotes. Other values types can be: PC98, IA64EFI, Alpha, Arcx86, IntelLeanClient, IA32EFI, BCEFI, XscaleEFI and X86-64EFI.</p>
<p>enable-tftp – Enables the build-in TFTP server.</p>
<p>tftp-root – Use /var/lib/tftpboot – the location for all netbooting files.</p>
<p>read more dnsmasq manual</p>
<h5 id="STEP-2-INSTALL-SYSLINUX-BOOTLOADERS"><a href="#STEP-2-INSTALL-SYSLINUX-BOOTLOADERS" class="headerlink" title="STEP 2: INSTALL SYSLINUX BOOTLOADERS"></a>STEP 2: INSTALL SYSLINUX BOOTLOADERS</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum install syslinux</span><br><span class="line"># ls /usr/share/syslinux</span><br></pre></td></tr></table></figure>
<h5 id="STEP-3-INSTALL-TFTP-SERVER-AND-POPULATE-IT-WITH-SYSLINUX-BOOTLOADERS"><a href="#STEP-3-INSTALL-TFTP-SERVER-AND-POPULATE-IT-WITH-SYSLINUX-BOOTLOADERS" class="headerlink" title="STEP 3: INSTALL TFTP-SERVER AND POPULATE IT WITH SYSLINUX BOOTLOADERS"></a>STEP 3: INSTALL TFTP-SERVER AND POPULATE IT WITH SYSLINUX BOOTLOADERS</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum install tftp-server</span><br><span class="line"># cp -r /usr/share/syslinux/* /var/lib/tftpboot</span><br></pre></td></tr></table></figure>
<h5 id="STEP-4-SETUP-PXE-SERVER-CONFIGURATION-FILE"><a href="#STEP-4-SETUP-PXE-SERVER-CONFIGURATION-FILE" class="headerlink" title="STEP 4: SETUP PXE SERVER CONFIGURATION FILE"></a>STEP 4: SETUP PXE SERVER CONFIGURATION FILE</h5><p>Typically the PXE Server reads its configuration from a group of specific files (GUID files – first, MAC files – next, Default file – last) hosted in a folder called pxelinux.cfg, which must be located in the directory specified in tftp-root statement from DNSMASQ main configuration file.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># mkdir /var/lib/tftpboot/pxelinux.cfg</span><br><span class="line"># vim /var/lib/tftpboot/pxelinux.cfg/default</span><br><span class="line">default menu.c32</span><br><span class="line">prompt 0</span><br><span class="line">timeout 300# 30 seconds</span><br><span class="line">ONTIMEOUT local</span><br><span class="line">menu title ########## PXE Boot Menu ##########</span><br><span class="line">label 1</span><br><span class="line">menu label ^1) Install or upgrade CentOS 6 x64 </span><br><span class="line">kernel centos6/vmlinuz</span><br><span class="line">append initrd=centos6/initrd.img ks=ftp://192.168.0.132/ks.cfg</span><br><span class="line">label 2</span><br><span class="line">menu label ^2) Install CentOS 6 x64 with http://mirror.centos.org Repo</span><br><span class="line">kernel centos6/vmlinuz</span><br><span class="line">append initrd=centos6/initrd.img method=http://mirror.centos.org/centos/6/os/x86_64/ devfs=nomount ip=dhcp</span><br><span class="line">label 3</span><br><span class="line">menu label ^3) Install CentOS 6 x64 with Local Repo using VNC</span><br><span class="line">kernel centos6/vmlinuz</span><br><span class="line">append  initrd=centos6/initrd.img method=ftp://192.168.0.132/pub devfs=nomount inst.vnc inst.vncpassword=password</span><br><span class="line">label 4</span><br><span class="line">menu label ^4) Boot from local drive</span><br></pre></td></tr></table></figure>
<h5 id="STEP-5-ADD-CENTOS-7-BOOT-IMAGES-TO-PXE-SERVER"><a href="#STEP-5-ADD-CENTOS-7-BOOT-IMAGES-TO-PXE-SERVER" class="headerlink" title="STEP 5: ADD CENTOS 7 BOOT IMAGES TO PXE SERVER"></a>STEP 5: ADD CENTOS 7 BOOT IMAGES TO PXE SERVER</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mount -o loop /root/CentOS-6.8-x86-bin-DVD1.iso  /mnt</span><br><span class="line"># ls /mnt</span><br><span class="line"># mkdir /var/lib/tftpboot/centos6</span><br><span class="line"># cp /mnt/images/pxeboot/vmlinuz  /var/lib/tftpboot/centos6</span><br><span class="line"># cp /mnt/images/pxeboot/initrd.img  /var/lib/tftpboot/centos6</span><br></pre></td></tr></table></figure>
<h5 id="STEP-6-CREATE-CENTOS-7-LOCAL-MIRROR-INSTALLATION-SOURCE"><a href="#STEP-6-CREATE-CENTOS-7-LOCAL-MIRROR-INSTALLATION-SOURCE" class="headerlink" title="STEP 6: CREATE CENTOS 7 LOCAL MIRROR INSTALLATION SOURCE"></a>STEP 6: CREATE CENTOS 7 LOCAL MIRROR INSTALLATION SOURCE</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum install vsftpd</span><br><span class="line"># cp -r /mnt/*  /var/ftp/pub/</span><br><span class="line"># chmod -R 755 /var/ftp/pub</span><br></pre></td></tr></table></figure>
<p>Prepare local repo file<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># wget -O /var/ftp/pub/Centos-6.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br></pre></td></tr></table></figure></p>
<h5 id="STEP-7-CREATE-KS-CFG-FILE"><a href="#STEP-7-CREATE-KS-CFG-FILE" class="headerlink" title="STEP 7: CREATE KS.CFG FILE"></a>STEP 7: CREATE KS.CFG FILE</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"># vim /var/ftp/ks.cfg</span><br><span class="line">#platform=x86, AMD64, or Intel EM64T</span><br><span class="line">#version=DEVEL</span><br><span class="line"># Firewall configuration</span><br><span class="line">firewall --disabled</span><br><span class="line"># Install OS instead of upgrade</span><br><span class="line">install</span><br><span class="line"># Use network installation</span><br><span class="line">url --url=&quot;ftp://192.168.0.132/pub&quot;</span><br><span class="line"># Root password</span><br><span class="line">rootpw --iscrypted $1$MzJZISZ7$wX0pW3sFy/5y80l2BAQD81</span><br><span class="line"># System authorization information</span><br><span class="line">auth  --useshadow  --passalgo=sha512</span><br><span class="line"># Use graphical install</span><br><span class="line">#graphical</span><br><span class="line">text</span><br><span class="line"></span><br><span class="line">%include /tmp/network.ks</span><br><span class="line"></span><br><span class="line">firstboot --disable</span><br><span class="line"># System keyboard</span><br><span class="line">keyboard us</span><br><span class="line"># System language</span><br><span class="line">lang en_US</span><br><span class="line"># SELinux configuration</span><br><span class="line">selinux --disabled</span><br><span class="line"># Installation logging level</span><br><span class="line">logging --level=info</span><br><span class="line"># Reboot after installation</span><br><span class="line">#reboot</span><br><span class="line"># System timezone</span><br><span class="line">timezone  Australia/Sydney</span><br><span class="line"># Network information</span><br><span class="line">network  --bootproto=dhcp --device=eth0 --onboot=on</span><br><span class="line"># System bootloader configuration</span><br><span class="line">bootloader --location=mbr</span><br><span class="line"># Clear the Master Boot Record</span><br><span class="line">zerombr</span><br><span class="line"># Partition clearing information</span><br><span class="line">clearpart --all --initlabel </span><br><span class="line"># Disk partitioning information</span><br><span class="line">part /boot --asprimary --fstype=&quot;ext4&quot; --size=250</span><br><span class="line">part swap --asprimary --fstype=&quot;swap&quot; --size=1024</span><br><span class="line">part / --asprimary --fstype=&quot;ext4&quot; --grow --size=1</span><br><span class="line"></span><br><span class="line">%packages</span><br><span class="line">@base</span><br><span class="line">@chinese-support</span><br><span class="line">@compat-libraries</span><br><span class="line">@debugging</span><br><span class="line">@development</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%pre</span><br><span class="line">#!/bin/sh</span><br><span class="line">exec &lt; /dev/tty3 &gt; /dev/tty3 2&gt;&amp;1</span><br><span class="line">chvt 3</span><br><span class="line">hn=&quot;&quot;</span><br><span class="line"></span><br><span class="line">while [ &quot;$hn&quot; == &quot;&quot; ]; do</span><br><span class="line"> clear</span><br><span class="line"> echo &quot; *** Please enter the following details: *** &quot;</span><br><span class="line"> echo</span><br><span class="line"> read -p &quot;Hostname: &quot; hn</span><br><span class="line">done</span><br><span class="line">clear</span><br><span class="line">chvt 1</span><br><span class="line">echo &quot;network --device eth0 --bootproto dhcp --hostname $&#123;hn&#125;&quot; &gt; /tmp/network.ks</span><br><span class="line"></span><br><span class="line">%post</span><br><span class="line">sed -i &apos;s#ONBOOT=no#ONEBOOT=yes#g&apos; /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">cp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.old</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo ftp://192.168.0.132/pub/Centos-6.repo</span><br><span class="line">rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY*</span><br><span class="line">yum update -y</span><br><span class="line">sleep 30</span><br><span class="line">runlevel</span><br><span class="line">chkconfig --list|grep 3:on |grep -vE &quot;crond|sshd|network|rsyslog|systat&quot; |awk &apos;&#123;print &quot;chkconfig &quot; $1 &quot; off&quot;&#125;&apos;|bash</span><br><span class="line">/etc/init.d/iptables stop</span><br><span class="line">service ntpd stop</span><br><span class="line">/usr/sbin/ntpdate au.pool.ntp.org</span><br><span class="line">date</span><br><span class="line">echo &apos;#time sync by stan zhou&apos; &gt;&gt; /var/spool/cron/root</span><br><span class="line">echo &apos;*/5 * * * * /usr/sbin/ntpdate au.pool.ntp.org &gt; /dev/null 2&gt;&amp;1&apos; &gt;&gt; /var/spool/cron/root</span><br><span class="line">crontab -l</span><br><span class="line">echo &quot;UseDNS no&quot; &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">echo &apos;*        -    nofile        65535&apos; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">echo &quot;net.ipv4.tcp_fin_timeout = 2</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_keepalive_time = 600</span><br><span class="line">net.ipv4.ip_local_port_range = 4000 65000</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 36000</span><br><span class="line">net.ipv4.route.gc_timeout = 100</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.core.somaxconn = 16384</span><br><span class="line">net.core.netdev_max_backlog = 16384</span><br><span class="line">net.ipv4.tcp_max_orphans = 16384&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line">wget http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span><br><span class="line">rpm -ivh epel-release-6-8.noarch.rpm</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>
<p>Read more about kickstart CentOS6</p>
<h5 id="STEP-7-START-AND-ENABLE-DAEMONS-SYSTEM-WIDE"><a href="#STEP-7-START-AND-ENABLE-DAEMONS-SYSTEM-WIDE" class="headerlink" title="STEP 7: START AND ENABLE DAEMONS SYSTEM-WIDE"></a>STEP 7: START AND ENABLE DAEMONS SYSTEM-WIDE</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#service dnsmasq start</span><br><span class="line">#service vsftpd start</span><br><span class="line">#chkconfig dnsmasq on</span><br><span class="line">#chkconfig vsftpd on</span><br></pre></td></tr></table></figure>
<h5 id="STEP-8-MYSQL-INSTALL-SCRIPT"><a href="#STEP-8-MYSQL-INSTALL-SCRIPT" class="headerlink" title="STEP 8: MYSQL INSTALL SCRIPT"></a>STEP 8: MYSQL INSTALL SCRIPT</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#vim /var/ftp/pub/install_mysql</span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -s /sbin/nologin -g mysql -M mysql</span><br><span class="line">tail -1 /etc/passwd</span><br><span class="line">id mysql</span><br><span class="line"># setup the tar file download add</span><br><span class="line">wget ftp://192.168.0.134/pub/mysql-5.5.50-linux2.6-x86_64.tar.gz</span><br><span class="line">tar xf mysql-5.5.50-linux2.6-x86_64.tar.gz</span><br><span class="line">mkdir -p /application/</span><br><span class="line">mv mysql-5.5.50-linux2.6-x86_64 /application/mysql-5.5.50</span><br><span class="line">ln -s /application/mysql-5.5.50/ /application/mysql</span><br><span class="line">ls -l /application/</span><br><span class="line">cd /application/mysql/</span><br><span class="line">ls -l support-files/*.cnf</span><br><span class="line">/bin/cp support-files/my-medium.cnf /etc/my.cnf</span><br><span class="line">mkdir -p /application/mysql/data</span><br><span class="line">chown -R mysql.mysql /application/mysql/</span><br><span class="line">/application/mysql/scripts/mysql_install_db --basedir=/application/mysql --datadir=/application/mysql/data/ --user=mysql</span><br><span class="line">/bin/cp support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">chmod +x /etc/init.d/mysqld</span><br><span class="line">sed -i &apos;s#/usr/local/mysql#/application/mysql#g&apos; /application/mysql/bin/mysqld_safe /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line">netstat -lntup|grep mysql</span><br><span class="line"></span><br><span class="line">chkconfig --add mysqld</span><br><span class="line">chkconfig mysqld on</span><br><span class="line">chkconfig --list mysqld</span><br><span class="line"></span><br><span class="line">echo &apos;export PATH=/application/mysql/bin:$PATH&apos; &gt;&gt; /etc/profile</span><br><span class="line">tail -1 /etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line">echo $PATH</span><br><span class="line"># after install run the following command</span><br><span class="line">#/application/mysql/bin/mysql_secure_installation</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/pxe/">pxe</a><a href="/tags/kickstart/">kickstart</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/3/"><span></span>Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="stanosaka" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Devops/" title="Devops">Devops<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/aws/" title="aws">aws<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/centos/" title="centos">centos<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/CD-CI/" title="CD/CI">CD/CI<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/saltstack/" title="saltstack">saltstack<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tomcat/" title="tomcat">tomcat<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/zabbix/" title="zabbix">zabbix<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ec2/" title="ec2">ec2<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/backup/" title="backup">backup<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Pipeline/" title="Pipeline">Pipeline<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Blue-Ocean/" title="Blue Ocean">Blue Ocean<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/containers/" title="containers">containers<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://zety.com/mycv/00root" target="_blank" title="Stan&#39;s resume">Stan&#39;s resume</a>
            
          </li>
        
          <li>
            
            	<a href="https://cloud.ibm.com/docs/tutorials?topic=solution-tutorials-tutorials" target="_blank" title="IBM cloud solution tutorial">IBM cloud solution tutorial</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/aws-samples" target="_blank" title="AWS Samples">AWS Samples</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/bikrambora/devlab-launchpad" target="_blank" title="Welcome to Dev Labs">Dev Labs</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/ansible/ansible-examples" target="_blank" title="Ansible GitHub repo">Ansible GitHub repo</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" title="Ansible Best Practices">Ansible Best Practices</a>
            
          </li>
        
          <li>
            
            	<a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" title="kubectl cheat sheet">kubectl cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://rogerdudler.github.io/git-guide" target="_blank" title="Git commands">Git commands</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" title="Dockerfile reference">Dockerfile reference</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2mTQr8l" target="_blank" title="Linux Command line cheat sheet">Linux Command line cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2EPHxze" target="_blank" title="PowerShell Basic Cheat Sheet">PowerShell Basic Cheat Sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" title="sed cheatsheet">sed cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://obsavus1p.bkt.clouddn.com/vim_cheat_sheet_for_programmers_print.png" target="_blank" title="vim cheatsheet">vim cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.gitbook.com/book/yeasy/docker_practice/details" target="_blank" title="Learn Docker">Learn Docker</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.unixhot.com/page/ops" target="_blank" title="运维知识体系">运维知识体系</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.tecmint.com/" target="_blank" title="tecmint">tecmint</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.lib.uts.edu.au" target="_blank" title="shoujin.wang@student.uts.edu.au">UTS Library</a>
            
          </li>
        
          <li>
            
            	<a href="https://7esl.com" target="_blank" title="ESL">ESL</a>
            
          </li>
        
          <li>
            
            	<a href="https://stanchou.wordpress.com" target="_blank" title="Stan&#39;s wordpress">Stan&#39;s wordpress</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.00root.com" target="_blank" title="Stan&#39;s gitbook">Stan&#39;s gitbook</a>
            
          </li>
        
          <li>
            
            	<a href="https://api.ipify.org" target="_blank" title="Your IP address">Your IP address</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/stanosaka/oreilly_sql_fundamentals_for_data/blob/master/notes_and_slides/sql_fundamentals_notes.md" target="_blank" title="sql fundamentials">sql fundamentials</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Stan live in Sydney. <br/>
			I am a lifelong technology learner.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/stanosaka" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6724938" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/stanosaka" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/stan.osaka" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/00root" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/btw01v" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/stan-22-82" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:devops@cwzhou.win" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="Stan Zhou">Stan Zhou</a>
		
		
		</p>
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>


        
  	    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
               if (window.mermaid) {
                  mermaid.initialize({theme: 'forest'});
               }
            </script>
        












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
