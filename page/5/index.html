
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Stan Zhou&#39;s Hexo Technical Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stan Zhou">
    

    
    <meta name="description" content="Infrastructure as code">
<meta property="og:type" content="website">
<meta property="og:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:url" content="http://223.95.78.227/page/5/index.html">
<meta property="og:site_name" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta property="og:description" content="Infrastructure as code">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Stan Zhou&#39;s Hexo Technical Blog">
<meta name="twitter:description" content="Infrastructure as code">
<meta name="twitter:creator" content="@stanosaka">

    
    <link rel="alternative" href="/atom.xml" title="Stan Zhou&#39;s Hexo Technical Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/toad.ico">
    
    
    <link rel="apple-touch-icon" href="/img/toadman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/toadman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/toadman.png" alt="Stan Zhou&#39;s Hexo Technical Blog" title="Stan Zhou&#39;s Hexo Technical Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Stan Zhou&#39;s Hexo Technical Blog">Stan Zhou&#39;s Hexo Technical Blog</a></h1>
				<h2 class="blog-motto">Innovation Evangelist</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:223.95.78.227">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/18/saltstackformula/" title="saltstack formula" itemprop="url">saltstack formula</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-09-18T04:23:21.000Z" itemprop="datePublished"> Published 2016-09-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="1-Get-formulat"><a href="#1-Get-formulat" class="headerlink" title="1. Get formulat:"></a>1. Get formulat:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@toad formulas]<span class="comment"># cd /srv/formulas</span></span><br><span class="line">    </span><br><span class="line">[root@toad formulas]<span class="comment"># git clone https://github.com/saltstack-formulas/nginx-formula</span></span><br></pre></td></tr></table></figure>
<h3 id="2-Setup-top-file"><a href="#2-Setup-top-file" class="headerlink" title="2. Setup top file:"></a>2. Setup top file:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@toad salt]<span class="comment"># cat top.sls</span></span><br><span class="line">base:</span><br><span class="line">   <span class="string">'*'</span>:</span><br><span class="line">       - nginx</span><br><span class="line">```       </span><br><span class="line">Add the new directory to file_roots:</span><br><span class="line">```sh</span><br><span class="line">[root@toad salt]<span class="comment"># vim /etc/salt/master</span></span><br><span class="line">file_roots:</span><br><span class="line">  base:</span><br><span class="line">    - /srv/salt</span><br><span class="line">    - /srv/formulas/tomcat-formula</span><br><span class="line">    - /srv/formulas/mysql-formula</span><br><span class="line">    - /srv/formulas/nginx-formula</span><br></pre></td></tr></table></figure>
<p>Restart the Salt Master.</p>
<h3 id="3-Run"><a href="#3-Run" class="headerlink" title="3. Run:"></a>3. Run:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br></pre></td><td class="code"><pre><span class="line">[root@toad formulas]<span class="comment"># salt 'macadamina' state.highstate</span></span><br><span class="line">macadamina:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx</span><br><span class="line">    Function: pkg.installed</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Package nginx is already installed.</span><br><span class="line">     Started: 11:45:55.019357</span><br><span class="line">    Duration: 3498.284 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /var/www</span><br><span class="line">    Function: file.directory</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Directory /var/www is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.518393</span><br><span class="line">    Duration: 1.548 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /usr/share/nginx</span><br><span class="line">    Function: file.directory</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Directory /usr/share/nginx is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.520140</span><br><span class="line">    Duration: 0.699 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx/conf.d/default.conf</span><br><span class="line">    Function: file.absent</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/nginx/conf.d/default.conf is not present</span><br><span class="line">     Started: 11:45:58.520983</span><br><span class="line">    Duration: 0.554 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx/conf.d/example_ssl.conf</span><br><span class="line">    Function: file.absent</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/nginx/conf.d/example_ssl.conf is not present</span><br><span class="line">     Started: 11:45:58.521693</span><br><span class="line">    Duration: 0.486 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx</span><br><span class="line">    Function: file.directory</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Directory /etc/nginx is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.522309</span><br><span class="line">    Duration: 1.041 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx/nginx.conf</span><br><span class="line">    Function: file.managed</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/nginx/nginx.conf updated</span><br><span class="line">     Started: 11:45:58.524655</span><br><span class="line">    Duration: 132.936 ms</span><br><span class="line">     Changes:</span><br><span class="line">              ----------</span><br><span class="line">              diff:</span><br><span class="line">                  ---</span><br><span class="line">                  +++</span><br><span class="line">                  @@ -41,15 +41,7 @@</span><br><span class="line">                               allow 127.0.0.1;</span><br><span class="line">                               deny all;</span><br><span class="line">                           &#125;</span><br><span class="line">                  -     location / &#123;</span><br><span class="line">                  -             root html;</span><br><span class="line">                  -             index index.jsp index.html index.htm;</span><br><span class="line">                  -             proxy_pass http://web_server;</span><br><span class="line">                  -     &#125;</span><br><span class="line">                       &#125;</span><br><span class="line">                  -    upstream web_server &#123;</span><br><span class="line">                  -     server 127.0.0.1:8080;</span><br><span class="line">                  -     &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                       include /etc/nginx/conf.d/*.conf;</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx/sites-enabled</span><br><span class="line">    Function: file.directory</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Directory /etc/nginx/sites-enabled is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.657818</span><br><span class="line">    Duration: 1.969 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/nginx/sites-available</span><br><span class="line">    Function: file.directory</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Directory /etc/nginx/sites-available is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.659985</span><br><span class="line">    Duration: 1.662 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">    Function: file.absent</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /var/<span class="built_in">log</span>/nginx/access.log is not present</span><br><span class="line">     Started: 11:45:58.661843</span><br><span class="line">    Duration: 0.709 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-logger-access</span><br><span class="line">    Function: file.managed</span><br><span class="line">        Name: /etc/init/nginx-logger-access.conf</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/init/nginx-logger-access.conf is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.662778</span><br><span class="line">    Duration: 26.583 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-logger-access</span><br><span class="line">    Function: service.running</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Service nginx-logger-access is already enabled, and is running</span><br><span class="line">     Started: 11:45:58.712813</span><br><span class="line">    Duration: 32.548 ms</span><br><span class="line">     Changes:</span><br><span class="line">              ----------</span><br><span class="line">              nginx-logger-access:</span><br><span class="line">                  True</span><br><span class="line">----------</span><br><span class="line">          ID: /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">    Function: file.absent</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Removed file /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">     Started: 11:45:58.745946</span><br><span class="line">    Duration: 2.21 ms</span><br><span class="line">     Changes:</span><br><span class="line">              ----------</span><br><span class="line">              removed:</span><br><span class="line">                  /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-logger-error</span><br><span class="line">    Function: file.managed</span><br><span class="line">        Name: /etc/init/nginx-logger-error.conf</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/init/nginx-logger-error.conf is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.748406</span><br><span class="line">    Duration: 26.15 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-logger-error</span><br><span class="line">    Function: service.running</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Service nginx-logger-error is already enabled, and is running</span><br><span class="line">     Started: 11:45:58.776206</span><br><span class="line">    Duration: 28.481 ms</span><br><span class="line">     Changes:</span><br><span class="line">              ----------</span><br><span class="line">              nginx-logger-error:</span><br><span class="line">                  True</span><br><span class="line">----------</span><br><span class="line">          ID: /etc/logrotate.d/nginx</span><br><span class="line">    Function: file.absent</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/logrotate.d/nginx is not present</span><br><span class="line">     Started: 11:45:58.805766</span><br><span class="line">    Duration: 1.142 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: htpasswd</span><br><span class="line">    Function: pkg.installed</span><br><span class="line">        Name: httpd-tools</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Package httpd-tools is already installed.</span><br><span class="line">     Started: 11:45:58.807193</span><br><span class="line">    Duration: 1.447 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-old-init</span><br><span class="line">    Function: file.rename</span><br><span class="line">        Name: /usr/share/nginx/init.d</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Source file <span class="string">"/etc/init.d/nginx"</span> has already been moved out of place</span><br><span class="line">     Started: 11:45:58.809509</span><br><span class="line">    Duration: 0.872 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-old-init-disable</span><br><span class="line">    Function: cmd.run</span><br><span class="line">        Name: chkconfig --del nginx</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: onlyif execution failed</span><br><span class="line">     Started: 11:45:58.822906</span><br><span class="line">    Duration: 10.906 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx-old-init</span><br><span class="line">    Function: module.wait</span><br><span class="line">        Name: cmd.run</span><br><span class="line">      Result: True</span><br><span class="line">     Comment:</span><br><span class="line">     Started: 11:45:58.835556</span><br><span class="line">    Duration: 1.147 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx</span><br><span class="line">    Function: file.managed</span><br><span class="line">        Name: /etc/init/nginx.conf</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: File /etc/init/nginx.conf is <span class="keyword">in</span> the correct state</span><br><span class="line">     Started: 11:45:58.839171</span><br><span class="line">    Duration: 41.314 ms</span><br><span class="line">     Changes:</span><br><span class="line">----------</span><br><span class="line">          ID: nginx</span><br><span class="line">    Function: service.running</span><br><span class="line">      Result: True</span><br><span class="line">     Comment: Service nginx is already enabled, and is running</span><br><span class="line">     Started: 11:45:58.886379</span><br><span class="line">    Duration: 53.53 ms</span><br><span class="line">     Changes:</span><br><span class="line">              ----------</span><br><span class="line">              nginx:</span><br><span class="line">                  True</span><br><span class="line"></span><br><span class="line">Summary</span><br><span class="line">-------------</span><br><span class="line">Succeeded: 22 (changed=5)</span><br><span class="line">Failed:     0</span><br><span class="line">-------------</span><br><span class="line">Total states run:     22</span><br><span class="line"></span><br><span class="line">```    </span><br><span class="line"><span class="comment">### 4. Test</span></span><br><span class="line">``` sh</span><br><span class="line">[root@macadamina ~]<span class="comment"># /usr/share/nginx/init.d status</span></span><br><span class="line">nginx (pid  2092) is running...</span><br><span class="line">[root@macadamina ~]<span class="comment"># lsof -i :80</span></span><br><span class="line">COMMAND  PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">nginx   2092  root    6u  IPv4  13922      0t0  TCP localhost:http (LISTEN)</span><br><span class="line">nginx   2093 nginx    6u  IPv4  13922      0t0  TCP localhost:http (LISTEN)</span><br><span class="line">[root@macadamina ~]<span class="comment"># wget 127.0.0.1</span></span><br><span class="line">--2016-09-18 14:19:32--  http://127.0.0.1/</span><br><span class="line">Connecting to 127.0.0.1:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 3698 (3.6K) [text/html]</span><br><span class="line">Saving to: “index.html”</span><br><span class="line"></span><br><span class="line">100%[========================================================================================================&gt;] 3,698       --.-K/s   <span class="keyword">in</span> 0.007s</span><br><span class="line"></span><br><span class="line">2016-09-18 14:19:32 (545 KB/s) - “index.html” saved [3698/3698]</span><br><span class="line">[root@macadamina ~]<span class="comment"># curl 127.0.0.1</span></span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD XHTML 1.1//EN"</span> <span class="string">"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;html xmlns=<span class="string">"http://www.w3.org/1999/xhtml"</span> xml:lang=<span class="string">"en"</span>&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Test Page <span class="keyword">for</span> the Nginx HTTP Server on EPEL&lt;/title&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span><br><span class="line">        &lt;style <span class="built_in">type</span>=<span class="string">"text/css"</span>&gt;</span><br><span class="line">            /*&lt;![CDATA[*/</span><br><span class="line">            body &#123;</span><br><span class="line">                background-color: <span class="comment">#fff;</span></span><br><span class="line">                color: <span class="comment">#000;</span></span><br><span class="line">                font-size: 0.9em;</span><br><span class="line">                font-family: sans-serif,helvetica;</span><br><span class="line">                margin: 0;</span><br><span class="line">                padding: 0;</span><br><span class="line">            &#125;</span><br><span class="line">            :link &#123;</span><br><span class="line">                color: <span class="comment">#c00;</span></span><br><span class="line">            &#125;</span><br><span class="line">            :visited &#123;</span><br><span class="line">                color: <span class="comment">#c00;</span></span><br><span class="line">            &#125;</span><br><span class="line">            a:hover &#123;</span><br><span class="line">                color: <span class="comment">#f50;</span></span><br><span class="line">            &#125;</span><br><span class="line">            h1 &#123;</span><br><span class="line">                text-align: center;</span><br><span class="line">                margin: 0;</span><br><span class="line">                padding: 0.6em 2em 0.4em;</span><br><span class="line">                background-color: <span class="comment">#294172;</span></span><br><span class="line">                color: <span class="comment">#fff;</span></span><br><span class="line">                font-weight: normal;</span><br><span class="line">                font-size: 1.75em;</span><br><span class="line">                border-bottom: 2px solid <span class="comment">#000;</span></span><br><span class="line">            &#125;</span><br><span class="line">            h1 strong &#123;</span><br><span class="line">                font-weight: bold;</span><br><span class="line">                font-size: 1.5em;</span><br><span class="line">            &#125;</span><br><span class="line">            h2 &#123;</span><br><span class="line">                text-align: center;</span><br><span class="line">                background-color: <span class="comment">#3C6EB4;</span></span><br><span class="line">                font-size: 1.1em;</span><br><span class="line">                font-weight: bold;</span><br><span class="line">                color: <span class="comment">#fff;</span></span><br><span class="line">                margin: 0;</span><br><span class="line">                padding: 0.5em;</span><br><span class="line">                border-bottom: 2px solid <span class="comment">#294172;</span></span><br><span class="line">            &#125;</span><br><span class="line">            hr &#123;</span><br><span class="line">                display: none;</span><br><span class="line">            &#125;</span><br><span class="line">            .content &#123;</span><br><span class="line">                padding: 1em 5em;</span><br><span class="line">            &#125;</span><br><span class="line">            .alert &#123;</span><br><span class="line">                border: 2px solid <span class="comment">#000;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            img &#123;</span><br><span class="line">                border: 2px solid <span class="comment">#fff;</span></span><br><span class="line">                padding: 2px;</span><br><span class="line">                margin: 2px;</span><br><span class="line">            &#125;</span><br><span class="line">            a:hover img &#123;</span><br><span class="line">                border: 2px solid <span class="comment">#294172;</span></span><br><span class="line">            &#125;</span><br><span class="line">            .logos &#123;</span><br><span class="line">                margin: 1em;</span><br><span class="line">                text-align: center;</span><br><span class="line">            &#125;</span><br><span class="line">            /*]]&gt;*/</span><br><span class="line">        &lt;/style&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Welcome to &lt;strong&gt;nginx&lt;/strong&gt; on EPEL!&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=<span class="string">"content"</span>&gt;</span><br><span class="line">            &lt;p&gt;This page is used to <span class="built_in">test</span> the proper operation of the</span><br><span class="line">            &lt;strong&gt;nginx&lt;/strong&gt; HTTP server after it has been</span><br><span class="line">            installed. If you can <span class="built_in">read</span> this page, it means that the</span><br><span class="line">            web server installed at this site is working</span><br><span class="line">            properly.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div class=<span class="string">"alert"</span>&gt;</span><br><span class="line">                &lt;h2&gt;Website Administrator&lt;/h2&gt;</span><br><span class="line">                &lt;div class=<span class="string">"content"</span>&gt;</span><br><span class="line">                    &lt;p&gt;This is the default &lt;tt&gt;index.html&lt;/tt&gt; page that</span><br><span class="line">                    is distributed with &lt;strong&gt;nginx&lt;/strong&gt; on</span><br><span class="line">                    EPEL.  It is located <span class="keyword">in</span></span><br><span class="line">                    &lt;tt&gt;/usr/share/nginx/html&lt;/tt&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;p&gt;You should now put your content <span class="keyword">in</span> a location of</span><br><span class="line">                    your choice and edit the &lt;tt&gt;root&lt;/tt&gt; configuration</span><br><span class="line">                    directive <span class="keyword">in</span> the &lt;strong&gt;nginx&lt;/strong&gt;</span><br><span class="line">                    configuration file</span><br><span class="line">                    &lt;tt&gt;/etc/nginx/nginx.conf&lt;/tt&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div class=<span class="string">"logos"</span>&gt;</span><br><span class="line">                &lt;a href=<span class="string">"http://nginx.net/"</span>&gt;&lt;img</span><br><span class="line">                    src=<span class="string">"nginx-logo.png"</span></span><br><span class="line">                    alt=<span class="string">"[ Powered by nginx ]"</span></span><br><span class="line">                    width=<span class="string">"121"</span> height=<span class="string">"32"</span> /&gt;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">                &lt;a href=<span class="string">"http://fedoraproject.org/"</span>&gt;&lt;img</span><br><span class="line">                    src=<span class="string">"poweredby.png"</span></span><br><span class="line">                    alt=<span class="string">"[ Powered by Fedora EPEL ]"</span></span><br><span class="line">                    width=<span class="string">"88"</span> height=<span class="string">"31"</span> /&gt;&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/saltstack/">saltstack</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/15/saltstack/" title="saltstack" itemprop="url">saltstack</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-09-15T01:28:58.000Z" itemprop="datePublished"> Published 2016-09-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="bug-01"><a href="#bug-01" class="headerlink" title="bug 01:"></a>bug 01:</h2><pre><code>[root@toad salt]# salt &apos;*&apos; state.sls upload_data
salt-minion01:
Data failed to compile:
----------
Pillar failed to render with the following messages:
----------
Error encountered while render pillar top file.
macadamina:
Data failed to compile:
----------
Pillar failed to render with the following messages:
----------
Error encountered while render pillar top file.
</code></pre><h2 id="Fix-01"><a href="#Fix-01" class="headerlink" title="Fix 01:"></a>Fix 01:</h2><pre><code>[root@toad salt]# salt &quot;*&quot; saltutil.refresh_pillar
macadamina:
True
salt-minion01:
True
</code></pre><hr>
<h2 id="copy-the-file-to-spe-location"><a href="#copy-the-file-to-spe-location" class="headerlink" title="copy the file to spe. location:"></a>copy the file to spe. location:</h2><pre><code>[root@toad salt]# tree
.
├── contab.sls
├── createdir.sls
├── createuser.sls
├── del_cron.sls
├── files
│   ├── hosts
│   ├── wgzy.sql
│   └── zfgtai.zip
├── host_file.sls
├── nginx_install.sls
├── top.sls
├── upload_data.sls
└── upload_mysql.sls

[root@toad salt]# cat upload_mysql.sls
/usr/share/tomcat/webapps/wgzy.sql:
  file.managed:
- source: salt://files/wgzy.sql
- user: root
- group: root
- mode: 644

[root@toad salt]# salt &apos;*&apos; state.sls upload_mysql
salt-minion01:
----------
  ID: /usr/share/tomcat/webapps/wgzy.sql
Function: file.managed
  Result: True
 Comment: File /usr/share/tomcat/webapps/wgzy.sql updated
 Started: 17:11:02.739156
Duration: 298.114 ms
 Changes:
  ----------
  diff:
  New file
  mode:
  0644

Summary
------------
Succeeded: 1 (changed=1)
Failed:0
------------
Total states run: 1
macadamina:
----------
  ID: /usr/share/tomcat/webapps/wgzy.sql
Function: file.managed
  Result: True
 Comment: File /usr/share/tomcat/webapps/wgzy.sql updated
 Started: 17:11:05.274496
Duration: 254.31 ms
 Changes:
  ----------
  diff:
  New file
  mode:
  0644

Summary
------------
Succeeded: 1 (changed=1)
Failed:0
------------
Total states run: 1
</code></pre><p>Modify /etc/tomcat/server.xml<br> <Host name="localhost"  appBase="webapps"
            unpackWARs="true" autoDeploy="true"></p>
<p>to<br> <Host name="localhost"  appBase="/deploy/source/aofa_pro"
            unpackWARs="true" autoDeploy="true"></p>
<hr>
<h2 id="saltstack-run-command"><a href="#saltstack-run-command" class="headerlink" title="saltstack run command:"></a>saltstack run command:</h2><pre><code>[root@toad salt]# cat modscript.sls
sed -i &apos;125s#appBase=&quot;.*&quot;# appBase=&quot;/deploy/source/aofa_pro&quot;#&apos; /etc/tomcat/server.xml:
  cmd.run


[root@toad salt]# salt &apos;*&apos; state.sls modscript
macadamina:
----------
  ID: sed -i &apos;125s#appBase=&quot;.*&quot;# appBase=&quot;/deploy/source/aofa_pro&quot;#&apos; /etc/tomcat/server.xml
Function: cmd.run
  Result: True
 Comment: Command &quot;sed -i &apos;125s#appBase=&quot;.*&quot;# appBase=&quot;/deploy/source/aofa_pro&quot;#&apos; /etc/tomcat/server.xml&quot; run
 Started: 11:06:15.245454
Duration: 38.108 ms
 Changes:
  ----------
  pid:
  38516
  retcode:
  0
  stderr:
  stdout:

Summary
------------
Succeeded: 1 (changed=1)
Failed:0
------------
Total states run: 1
salt-minion01:
----------
  ID: sed -i &apos;125s#appBase=&quot;.*&quot;# appBase=&quot;/deploy/source/aofa_pro&quot;#&apos; /etc/tomcat/server.xml
Function: cmd.run
  Result: True
 Comment: Command &quot;sed -i &apos;125s#appBase=&quot;.*&quot;# appBase=&quot;/deploy/source/aofa_pro&quot;#&apos; /etc/tomcat/server.xml&quot; run
 Started: 11:06:16.505044
Duration: 28.841 ms
 Changes:
  ----------
  pid:
  37702
  retcode:
  0
  stderr:
  stdout:

Summary
------------
Succeeded: 1 (changed=1)
Failed:0
------------
Total states run: 1
</code></pre><p>check result:<br>    [root@toad salt]# salt ‘*’ cmd.run ‘sed -n 125p /etc/tomcat/server.xml’<br>    macadamina:<br>      &lt;Host name=”localhost”   appBase=”/deploy/source/aofa_pro”<br>    salt-minion01:<br>      &lt;Host name=”localhost”   appBase=”/deploy/source/aofa_pro”</p>
<hr>
<p>copy the file form master to minion:<br>    [root@toad salt]# salt ‘macadamina’ cp.get_file salt://files/zfgtai.zip /deploy/source/aofa_pro/zfgtai.zip<br>    macadamina:<br>    /deploy/source/aofa_pro/zfgtai.zip</p>
<p>Append text into file:</p>
<pre><code>[root@salt-minion01 ~]# sed -i &apos;34 a&lt;Valve className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot; /&gt; &lt;Manager className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot; host=&quot;localhost&quot; port=&quot;6379&quot; database=&quot;0&quot; maxInactiveInterval=&quot;60&quot; /&gt;&apos; context.xml
</code></pre>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/saltstack/">saltstack</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/29/unattend-install/" title="PXE + kickstart unattend install centos 6" itemprop="url">PXE + kickstart unattend install centos 6</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-08-29T06:25:00.000Z" itemprop="datePublished"> Published 2016-08-29</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="PXE-kickstart-unattend-install-centos-6"><a href="#PXE-kickstart-unattend-install-centos-6" class="headerlink" title="PXE + kickstart unattend install centos 6"></a>PXE + kickstart unattend install centos 6</h3><h5 id="Step-1-Install-and-configure-DNSMASQ-Server"><a href="#Step-1-Install-and-configure-DNSMASQ-Server" class="headerlink" title="Step 1: Install and configure DNSMASQ Server"></a>Step 1: Install and configure DNSMASQ Server</h5><h6 id="1-INSTALL-DNSMASQ-DEAMON"><a href="#1-INSTALL-DNSMASQ-DEAMON" class="headerlink" title="1. INSTALL DNSMASQ DEAMON"></a>1. INSTALL DNSMASQ DEAMON</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#yum install dnsmasq</span><br></pre></td></tr></table></figure>
<h6 id="2-Edit-dnsmasq-conf-file"><a href="#2-Edit-dnsmasq-conf-file" class="headerlink" title="2. Edit dnsmasq conf file"></a>2. Edit dnsmasq conf file</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># mv /etc/dnsmasq.conf  /etc/dnsmasq.conf.backup</span><br><span class="line"># vim /etc/dnsmasq.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">interface=eth0,lo</span><br><span class="line">#bind-interfaces</span><br><span class="line">domain=centos6.lan</span><br><span class="line"># DHCP range-leases</span><br><span class="line">dhcp-range= eth0,192.168.0.3,192.168.0.253,255.255.255.0,1h</span><br><span class="line"># PXE</span><br><span class="line">dhcp-boot=pxelinux.0,pxeserver,192.168.0.132</span><br><span class="line"># Gateway</span><br><span class="line">dhcp-option=3,192.168.0.1</span><br><span class="line"># DNS</span><br><span class="line">dhcp-option=6,192.168.0.1, 8.8.8.8</span><br><span class="line">server=8.8.4.4</span><br><span class="line"># Broadcast Address</span><br><span class="line">dhcp-option=28,192.168.0.255</span><br><span class="line"># NTP Server</span><br><span class="line">dhcp-option=42,0.0.0.0</span><br><span class="line">pxe-prompt=&quot;Press F8 for menu.&quot;, 60</span><br><span class="line">pxe-service=x86PC, &quot;Install CentOS 6 from network server 192.168.0.132&quot;, pxelinux</span><br><span class="line">enable-tftp</span><br><span class="line">tftp-root=/var/lib/tftpboot</span><br></pre></td></tr></table></figure>
<p>interface – Interfaces that the server should listen and provide services.</p>
<p>bind-interfaces – Uncomment to bind only on this interface.</p>
<p>domain – Replace it with your domain name.</p>
<p>dhcp-range – Replace it with IP range defined by your network mask on this segment.</p>
<p>dhcp-boot – Replace the IP statement with your interface IP Address.</p>
<p>dhcp-option=3,192.168.0.1 – Replace the IP Address with your network segment Gateway.</p>
<p>dhcp-option=6,92.168.0.1 – Replace the IP Address with your DNS Server IP – several DNS IPs can be defined.</p>
<p>server=8.8.4.4 – Put your DNS forwarders IPs Addresses.</p>
<p>dhcp-option=28,192.168.0.255 – Replace the IP Address with network broadcast address –optionally.</p>
<p>dhcp-option=42,0.0.0.0 – Put your network time servers – optionally (0.0.0.0 Address is for self-reference).</p>
<p>pxe-prompt – Leave it as default – means to hit F8 key for entering menu 60 with seconds wait time..</p>
<p>pxe=service – Use x86PC for 32-bit/64-bit architectures and enter a menu description prompt under string quotes. Other values types can be: PC98, IA64EFI, Alpha, Arcx86, IntelLeanClient, IA32EFI, BCEFI, XscaleEFI and X86-64EFI.</p>
<p>enable-tftp – Enables the build-in TFTP server.</p>
<p>tftp-root – Use /var/lib/tftpboot – the location for all netbooting files.</p>
<p>read more dnsmasq manual</p>
<h5 id="STEP-2-INSTALL-SYSLINUX-BOOTLOADERS"><a href="#STEP-2-INSTALL-SYSLINUX-BOOTLOADERS" class="headerlink" title="STEP 2: INSTALL SYSLINUX BOOTLOADERS"></a>STEP 2: INSTALL SYSLINUX BOOTLOADERS</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum install syslinux</span><br><span class="line"># ls /usr/share/syslinux</span><br></pre></td></tr></table></figure>
<h5 id="STEP-3-INSTALL-TFTP-SERVER-AND-POPULATE-IT-WITH-SYSLINUX-BOOTLOADERS"><a href="#STEP-3-INSTALL-TFTP-SERVER-AND-POPULATE-IT-WITH-SYSLINUX-BOOTLOADERS" class="headerlink" title="STEP 3: INSTALL TFTP-SERVER AND POPULATE IT WITH SYSLINUX BOOTLOADERS"></a>STEP 3: INSTALL TFTP-SERVER AND POPULATE IT WITH SYSLINUX BOOTLOADERS</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum install tftp-server</span><br><span class="line"># cp -r /usr/share/syslinux/* /var/lib/tftpboot</span><br></pre></td></tr></table></figure>
<h5 id="STEP-4-SETUP-PXE-SERVER-CONFIGURATION-FILE"><a href="#STEP-4-SETUP-PXE-SERVER-CONFIGURATION-FILE" class="headerlink" title="STEP 4: SETUP PXE SERVER CONFIGURATION FILE"></a>STEP 4: SETUP PXE SERVER CONFIGURATION FILE</h5><p>Typically the PXE Server reads its configuration from a group of specific files (GUID files – first, MAC files – next, Default file – last) hosted in a folder called pxelinux.cfg, which must be located in the directory specified in tftp-root statement from DNSMASQ main configuration file.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># mkdir /var/lib/tftpboot/pxelinux.cfg</span><br><span class="line"># vim /var/lib/tftpboot/pxelinux.cfg/default</span><br><span class="line">default menu.c32</span><br><span class="line">prompt 0</span><br><span class="line">timeout 300# 30 seconds</span><br><span class="line">ONTIMEOUT local</span><br><span class="line">menu title ########## PXE Boot Menu ##########</span><br><span class="line">label 1</span><br><span class="line">menu label ^1) Install or upgrade CentOS 6 x64 </span><br><span class="line">kernel centos6/vmlinuz</span><br><span class="line">append initrd=centos6/initrd.img ks=ftp://192.168.0.132/ks.cfg</span><br><span class="line">label 2</span><br><span class="line">menu label ^2) Install CentOS 6 x64 with http://mirror.centos.org Repo</span><br><span class="line">kernel centos6/vmlinuz</span><br><span class="line">append initrd=centos6/initrd.img method=http://mirror.centos.org/centos/6/os/x86_64/ devfs=nomount ip=dhcp</span><br><span class="line">label 3</span><br><span class="line">menu label ^3) Install CentOS 6 x64 with Local Repo using VNC</span><br><span class="line">kernel centos6/vmlinuz</span><br><span class="line">append  initrd=centos6/initrd.img method=ftp://192.168.0.132/pub devfs=nomount inst.vnc inst.vncpassword=password</span><br><span class="line">label 4</span><br><span class="line">menu label ^4) Boot from local drive</span><br></pre></td></tr></table></figure>
<h5 id="STEP-5-ADD-CENTOS-7-BOOT-IMAGES-TO-PXE-SERVER"><a href="#STEP-5-ADD-CENTOS-7-BOOT-IMAGES-TO-PXE-SERVER" class="headerlink" title="STEP 5: ADD CENTOS 7 BOOT IMAGES TO PXE SERVER"></a>STEP 5: ADD CENTOS 7 BOOT IMAGES TO PXE SERVER</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mount -o loop /root/CentOS-6.8-x86-bin-DVD1.iso  /mnt</span><br><span class="line"># ls /mnt</span><br><span class="line"># mkdir /var/lib/tftpboot/centos6</span><br><span class="line"># cp /mnt/images/pxeboot/vmlinuz  /var/lib/tftpboot/centos6</span><br><span class="line"># cp /mnt/images/pxeboot/initrd.img  /var/lib/tftpboot/centos6</span><br></pre></td></tr></table></figure>
<h5 id="STEP-6-CREATE-CENTOS-7-LOCAL-MIRROR-INSTALLATION-SOURCE"><a href="#STEP-6-CREATE-CENTOS-7-LOCAL-MIRROR-INSTALLATION-SOURCE" class="headerlink" title="STEP 6: CREATE CENTOS 7 LOCAL MIRROR INSTALLATION SOURCE"></a>STEP 6: CREATE CENTOS 7 LOCAL MIRROR INSTALLATION SOURCE</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum install vsftpd</span><br><span class="line"># cp -r /mnt/*  /var/ftp/pub/</span><br><span class="line"># chmod -R 755 /var/ftp/pub</span><br></pre></td></tr></table></figure>
<p>Prepare local repo file<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># wget -O /var/ftp/pub/Centos-6.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br></pre></td></tr></table></figure></p>
<h5 id="STEP-7-CREATE-KS-CFG-FILE"><a href="#STEP-7-CREATE-KS-CFG-FILE" class="headerlink" title="STEP 7: CREATE KS.CFG FILE"></a>STEP 7: CREATE KS.CFG FILE</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"># vim /var/ftp/ks.cfg</span><br><span class="line">#platform=x86, AMD64, or Intel EM64T</span><br><span class="line">#version=DEVEL</span><br><span class="line"># Firewall configuration</span><br><span class="line">firewall --disabled</span><br><span class="line"># Install OS instead of upgrade</span><br><span class="line">install</span><br><span class="line"># Use network installation</span><br><span class="line">url --url=&quot;ftp://192.168.0.132/pub&quot;</span><br><span class="line"># Root password</span><br><span class="line">rootpw --iscrypted $1$MzJZISZ7$wX0pW3sFy/5y80l2BAQD81</span><br><span class="line"># System authorization information</span><br><span class="line">auth  --useshadow  --passalgo=sha512</span><br><span class="line"># Use graphical install</span><br><span class="line">#graphical</span><br><span class="line">text</span><br><span class="line"></span><br><span class="line">%include /tmp/network.ks</span><br><span class="line"></span><br><span class="line">firstboot --disable</span><br><span class="line"># System keyboard</span><br><span class="line">keyboard us</span><br><span class="line"># System language</span><br><span class="line">lang en_US</span><br><span class="line"># SELinux configuration</span><br><span class="line">selinux --disabled</span><br><span class="line"># Installation logging level</span><br><span class="line">logging --level=info</span><br><span class="line"># Reboot after installation</span><br><span class="line">#reboot</span><br><span class="line"># System timezone</span><br><span class="line">timezone  Australia/Sydney</span><br><span class="line"># Network information</span><br><span class="line">network  --bootproto=dhcp --device=eth0 --onboot=on</span><br><span class="line"># System bootloader configuration</span><br><span class="line">bootloader --location=mbr</span><br><span class="line"># Clear the Master Boot Record</span><br><span class="line">zerombr</span><br><span class="line"># Partition clearing information</span><br><span class="line">clearpart --all --initlabel </span><br><span class="line"># Disk partitioning information</span><br><span class="line">part /boot --asprimary --fstype=&quot;ext4&quot; --size=250</span><br><span class="line">part swap --asprimary --fstype=&quot;swap&quot; --size=1024</span><br><span class="line">part / --asprimary --fstype=&quot;ext4&quot; --grow --size=1</span><br><span class="line"></span><br><span class="line">%packages</span><br><span class="line">@base</span><br><span class="line">@chinese-support</span><br><span class="line">@compat-libraries</span><br><span class="line">@debugging</span><br><span class="line">@development</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%pre</span><br><span class="line">#!/bin/sh</span><br><span class="line">exec &lt; /dev/tty3 &gt; /dev/tty3 2&gt;&amp;1</span><br><span class="line">chvt 3</span><br><span class="line">hn=&quot;&quot;</span><br><span class="line"></span><br><span class="line">while [ &quot;$hn&quot; == &quot;&quot; ]; do</span><br><span class="line"> clear</span><br><span class="line"> echo &quot; *** Please enter the following details: *** &quot;</span><br><span class="line"> echo</span><br><span class="line"> read -p &quot;Hostname: &quot; hn</span><br><span class="line">done</span><br><span class="line">clear</span><br><span class="line">chvt 1</span><br><span class="line">echo &quot;network --device eth0 --bootproto dhcp --hostname $&#123;hn&#125;&quot; &gt; /tmp/network.ks</span><br><span class="line"></span><br><span class="line">%post</span><br><span class="line">sed -i &apos;s#ONBOOT=no#ONEBOOT=yes#g&apos; /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">cp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.old</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo ftp://192.168.0.132/pub/Centos-6.repo</span><br><span class="line">rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY*</span><br><span class="line">yum update -y</span><br><span class="line">sleep 30</span><br><span class="line">runlevel</span><br><span class="line">chkconfig --list|grep 3:on |grep -vE &quot;crond|sshd|network|rsyslog|systat&quot; |awk &apos;&#123;print &quot;chkconfig &quot; $1 &quot; off&quot;&#125;&apos;|bash</span><br><span class="line">/etc/init.d/iptables stop</span><br><span class="line">service ntpd stop</span><br><span class="line">/usr/sbin/ntpdate au.pool.ntp.org</span><br><span class="line">date</span><br><span class="line">echo &apos;#time sync by stan zhou&apos; &gt;&gt; /var/spool/cron/root</span><br><span class="line">echo &apos;*/5 * * * * /usr/sbin/ntpdate au.pool.ntp.org &gt; /dev/null 2&gt;&amp;1&apos; &gt;&gt; /var/spool/cron/root</span><br><span class="line">crontab -l</span><br><span class="line">echo &quot;UseDNS no&quot; &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">echo &apos;*        -    nofile        65535&apos; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">echo &quot;net.ipv4.tcp_fin_timeout = 2</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_keepalive_time = 600</span><br><span class="line">net.ipv4.ip_local_port_range = 4000 65000</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 36000</span><br><span class="line">net.ipv4.route.gc_timeout = 100</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.core.somaxconn = 16384</span><br><span class="line">net.core.netdev_max_backlog = 16384</span><br><span class="line">net.ipv4.tcp_max_orphans = 16384&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line">wget http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span><br><span class="line">rpm -ivh epel-release-6-8.noarch.rpm</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>
<p>Read more about kickstart CentOS6</p>
<h5 id="STEP-7-START-AND-ENABLE-DAEMONS-SYSTEM-WIDE"><a href="#STEP-7-START-AND-ENABLE-DAEMONS-SYSTEM-WIDE" class="headerlink" title="STEP 7: START AND ENABLE DAEMONS SYSTEM-WIDE"></a>STEP 7: START AND ENABLE DAEMONS SYSTEM-WIDE</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#service dnsmasq start</span><br><span class="line">#service vsftpd start</span><br><span class="line">#chkconfig dnsmasq on</span><br><span class="line">#chkconfig vsftpd on</span><br></pre></td></tr></table></figure>
<h5 id="STEP-8-MYSQL-INSTALL-SCRIPT"><a href="#STEP-8-MYSQL-INSTALL-SCRIPT" class="headerlink" title="STEP 8: MYSQL INSTALL SCRIPT"></a>STEP 8: MYSQL INSTALL SCRIPT</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#vim /var/ftp/pub/install_mysql</span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -s /sbin/nologin -g mysql -M mysql</span><br><span class="line">tail -1 /etc/passwd</span><br><span class="line">id mysql</span><br><span class="line"># setup the tar file download add</span><br><span class="line">wget ftp://192.168.0.134/pub/mysql-5.5.50-linux2.6-x86_64.tar.gz</span><br><span class="line">tar xf mysql-5.5.50-linux2.6-x86_64.tar.gz</span><br><span class="line">mkdir -p /application/</span><br><span class="line">mv mysql-5.5.50-linux2.6-x86_64 /application/mysql-5.5.50</span><br><span class="line">ln -s /application/mysql-5.5.50/ /application/mysql</span><br><span class="line">ls -l /application/</span><br><span class="line">cd /application/mysql/</span><br><span class="line">ls -l support-files/*.cnf</span><br><span class="line">/bin/cp support-files/my-medium.cnf /etc/my.cnf</span><br><span class="line">mkdir -p /application/mysql/data</span><br><span class="line">chown -R mysql.mysql /application/mysql/</span><br><span class="line">/application/mysql/scripts/mysql_install_db --basedir=/application/mysql --datadir=/application/mysql/data/ --user=mysql</span><br><span class="line">/bin/cp support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">chmod +x /etc/init.d/mysqld</span><br><span class="line">sed -i &apos;s#/usr/local/mysql#/application/mysql#g&apos; /application/mysql/bin/mysqld_safe /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line">netstat -lntup|grep mysql</span><br><span class="line"></span><br><span class="line">chkconfig --add mysqld</span><br><span class="line">chkconfig mysqld on</span><br><span class="line">chkconfig --list mysqld</span><br><span class="line"></span><br><span class="line">echo &apos;export PATH=/application/mysql/bin:$PATH&apos; &gt;&gt; /etc/profile</span><br><span class="line">tail -1 /etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line">echo $PATH</span><br><span class="line"># after install run the following command</span><br><span class="line">#/application/mysql/bin/mysql_secure_installation</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/pxe/">pxe</a><a href="/tags/kickstart/">kickstart</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/29/centos7/" title="centos7" itemprop="url">centos7</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-08-29T06:18:03.000Z" itemprop="datePublished"> Published 2016-08-29</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="CentOS-quck-start-guide"><a href="#CentOS-quck-start-guide" class="headerlink" title="CentOS quck start guide"></a>CentOS quck start guide</h3><h2 id="Analyzing-syslog-entries"><a href="#Analyzing-syslog-entries" class="headerlink" title="Analyzing syslog entries"></a>Analyzing syslog entries</h2><p><img src="https://i.imgur.com/X4FxDgT.png" alt="log file standard format"></p>
<h3 id="1-Stop-and-Start-RHEL7-firewall"><a href="#1-Stop-and-Start-RHEL7-firewall" class="headerlink" title="1. Stop and Start RHEL7 firewall"></a>1. Stop and Start RHEL7 firewall</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# service firewalld stop</span><br><span class="line">Redirecting to /bin/systemctl stop  firewalld.service</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# service firewalld start</span><br><span class="line">Redirecting to /bin/systemctl start  firewalld.service</span><br></pre></td></tr></table></figure>
<h3 id="2-Disable-and-Enable-RHEL7-firewall"><a href="#2-Disable-and-Enable-RHEL7-firewall" class="headerlink" title="2. Disable and Enable RHEL7 firewall"></a>2. Disable and Enable RHEL7 firewall</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# systemctl disable firewalld</span><br><span class="line">rm &apos;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&apos;</span><br><span class="line">rm &apos;/etc/systemd/system/basic.target.wants/firewalld.service&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# systemctl enable firewalld</span><br><span class="line">ln -s &apos;/usr/lib/systemd/system/firewalld.service&apos; &apos;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&apos;</span><br><span class="line">ln -s &apos;/usr/lib/systemd/system/firewalld.service&apos; &apos;/etc/systemd/system/basic.target.wants/firewalld.service&apos;</span><br></pre></td></tr></table></figure>
<h3 id="3-Set-hostname"><a href="#3-Set-hostname" class="headerlink" title="3. Set hostname"></a>3. Set hostname</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# hostnamectl</span><br><span class="line"></span><br><span class="line">[root@rhel7 ~]# hostnamectl set-hostname nameyoulike</span><br></pre></td></tr></table></figure>
<h1 id="Signals"><a href="#Signals" class="headerlink" title="Signals"></a>Signals</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-5-191 ~]# kill -l</span><br><span class="line"> 1) SIGHUP	 2) SIGINT	 3) SIGQUIT	 4) SIGILL	 5) SIGTRAP</span><br><span class="line"> 6) SIGABRT	 7) SIGBUS	 8) SIGFPE	 9) SIGKILL	10) SIGUSR1</span><br><span class="line">11) SIGSEGV	12) SIGUSR2	13) SIGPIPE	14) SIGALRM	15) SIGTERM</span><br><span class="line">16) SIGSTKFLT	17) SIGCHLD	18) SIGCONT	19) SIGSTOP	20) SIGTSTP</span><br><span class="line">21) SIGTTIN	22) SIGTTOU	23) SIGURG	24) SIGXCPU	25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM	27) SIGPROF	28) SIGWINCH	29) SIGIO	30) SIGPWR</span><br><span class="line">31) SIGSYS	34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1	64) SIGRTMAX</span><br></pre></td></tr></table></figure>
<h2 id="SIGKILL-signal"><a href="#SIGKILL-signal" class="headerlink" title="SIGKILL signal"></a>SIGKILL signal</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-5-191 ~]# sleep 10000 &amp;</span><br><span class="line">[1] 19559</span><br><span class="line">[root@ip-172-31-5-191 ~]# ps aux|grep sleep</span><br><span class="line">root     19559  0.0  0.0 107952   356 pts/0    S    07:48   0:00 sleep 10000</span><br><span class="line">root     19564  0.0  0.0 112708   976 pts/0    S+   07:48   0:00 grep --color=auto sleep</span><br><span class="line">[root@ip-172-31-5-191 ~]# kill -9 19559</span><br><span class="line">[1]+  Killed                  sleep 10000</span><br><span class="line">[root@ip-172-31-5-191 ~]# ps aux|grep sleep</span><br><span class="line">root     19596  0.0  0.0 112708   980 pts/0    S+   07:49   0:00 grep --color=auto sleep</span><br></pre></td></tr></table></figure>
<h2 id="SIGHUP-signal"><a href="#SIGHUP-signal" class="headerlink" title="SIGHUP signal"></a>SIGHUP signal</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-5-191 ~]# nohup sleep 1000 &amp;</span><br><span class="line">[1] 19786</span><br><span class="line">[root@ip-172-31-5-191 ~]# nohup: ignoring input and appending output to ‘nohup.out’</span><br></pre></td></tr></table></figure>
<h2 id="Bash-Shell-Variables"><a href="#Bash-Shell-Variables" class="headerlink" title="Bash Shell Variables"></a>Bash Shell Variables</h2><p>Put variable into the file <code>/etc/environment</code></p>
<p>Another very important rule is that a child process will never be able to change the parent’s environment variables, because the child and parent are independent from each other and the child only has a local copy of the parent’s environment:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-5-191 ~]# mkdir ~/scripts</span><br><span class="line">[root@ip-172-31-5-191 ~]# printf &apos;#!/bin/bash\nexport CHILDVAR=Hello_from_child\n&apos; &gt; ~/scripts/child.sh</span><br><span class="line">[root@ip-172-31-5-191 ~]# cat ~/scripts/child.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">export CHILDVAR=Hello_from_child</span><br><span class="line">[root@ip-172-31-5-191 ~]# chmod +x ~/scripts/child.sh</span><br><span class="line">[root@ip-172-31-5-191 ~]# ~/scripts/child.sh</span><br><span class="line">[root@ip-172-31-5-191 ~]# echo $CHILDVAR</span><br></pre></td></tr></table></figure>
<h2 id="Bash-Shell-Scripting"><a href="#Bash-Shell-Scripting" class="headerlink" title="Bash Shell Scripting"></a>Bash Shell Scripting</h2><h3 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-5-191 ~]# say_hello() &#123;</span><br><span class="line">&gt; echo &quot;My name is $1&quot;;</span><br><span class="line">&gt; &#125;</span><br><span class="line"></span><br><span class="line">[root@ip-172-31-5-191 ~]# say_hello Stan</span><br><span class="line">My name is Stan</span><br><span class="line">[root@ip-172-31-5-191 ~]# say_another_thing() &#123;</span><br><span class="line">&gt; say_hello Stan</span><br><span class="line">&gt; echo &quot;I like CentOS 7&quot;;</span><br><span class="line">&gt; &#125;</span><br><span class="line"></span><br><span class="line">[root@ip-172-31-5-191 ~]# say_another_thing</span><br><span class="line">My name is Stan</span><br><span class="line">I like CentOS 7</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-5-191 ~]# cat run.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">echo &quot;Hello world&quot;</span><br><span class="line">echo &quot;-----------&quot;</span><br><span class="line">if [[ $# -lt 2 ]]</span><br><span class="line">then</span><br><span class="line">  echo &quot;Usage $0 param1 param2&quot;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line">echo $1</span><br><span class="line">echo $2</span><br><span class="line">echo $0</span><br><span class="line">echo $#</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-5-191 ~]# PASSWORD=&quot;tt4321&quot;</span><br><span class="line">[root@ip-172-31-5-191 ~]# if [[ $PASSWORD -eq &quot;hello_world&quot; || $PASSWORD -eq &quot;tt4321&quot; ]]; then echo &quot;password correct&quot;; fi</span><br><span class="line">password correct</span><br></pre></td></tr></table></figure>
<h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if [[ $EXIT -eq 0 ]]</span><br><span class="line">if ! [[ $EXIT -eq 0 ]]</span><br><span class="line">if [[ $PASSWORD == &quot;Hello_world&quot; ]]</span><br><span class="line">if [[ $PASSWORD -eq &quot;hello_world&quot; || $PASSWORD -eq &quot;tt4321&quot; ]]</span><br><span class="line"></span><br><span class="line">STRING=&quot;Lorem ipsum dolor sit&quot;</span><br><span class="line">if [[ $STRING =~ ^..rem ]]</span><br><span class="line">if [[ $NUMBER -lt 10 ]]  ##-lt less than</span><br><span class="line">if [[ $NUMBER -gt 10 ]]  ##-gt greater than</span><br></pre></td></tr></table></figure>
<h3 id="file-or-diri-tests"><a href="#file-or-diri-tests" class="headerlink" title="file or diri tests"></a>file or diri tests</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if [[ -a $FILE ]]</span><br><span class="line">if [[ -d $DIR ]]</span><br></pre></td></tr></table></figure>
<p><strong>for read the bash manual</strong><br><code>man bash</code> /CONDITIONAL EXPRESSIONS</p>
<h3 id="else-statement"><a href="#else-statement" class="headerlink" title="else statement"></a>else statement</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if [[ $EXIT -eq 0 ]]</span><br><span class="line">then</span><br><span class="line">  echo &quot;whatever&quot;</span><br><span class="line">else</span><br><span class="line">  echo &quot;cannot access the files&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h3 id="if-elif-statement"><a href="#if-elif-statement" class="headerlink" title="if elif statement"></a>if elif statement</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if [[ $VALUE -gt 5 ]]</span><br><span class="line">then</span><br><span class="line">  echo &quot;value is bigger than 5&quot;</span><br><span class="line">elif [[ $VALUE -eq 5 ]]</span><br><span class="line">then </span><br><span class="line">  echo &quot;value is equal to 5&quot;</span><br><span class="line">elif [[ $VALUE -lt 5 ]]</span><br><span class="line">then</span><br><span class="line">  echo &quot;value is less than 5&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h3 id="Loops-statement"><a href="#Loops-statement" class="headerlink" title="Loops statement"></a>Loops statement</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">for count in 1 2 3 4</span><br><span class="line">do</span><br><span class="line">  echo $count</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for number in $(seq 1 20)</span><br><span class="line">do</span><br><span class="line"> echo &quot;This is $number&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for number in &#123;1..20&#125;</span><br><span class="line">do</span><br><span class="line"> echo &quot;This is $number&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>change multi file names<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/stuff</span><br><span class="line">touch ~/stuff/1.txt ~/stuff/2.txt ~/stuff/3.txt ~/stuff/4.txt ~/stuff/5.txt</span><br><span class="line">for file in ~/stuff/*.txt</span><br><span class="line">do</span><br><span class="line">  mv $file ~/stuff/$(basename $file .txt).doc</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<h3 id="Automate-script-execution"><a href="#Automate-script-execution" class="headerlink" title="Automate script execution"></a>Automate script execution</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat scripts/motd-commandlinefu-update.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">wget -O /etc/motd http://www.commandlinefu.com/commands/random/plaintext</span><br><span class="line">ls /etc/cron* -d</span><br><span class="line">/etc/cron.d  /etc/cron.daily  /etc/cron.hourly  /etc/cron.monthly  /etc/crontab  /etc/cron.weekly</span><br><span class="line">root@stan-OptiPlex-380:~|⇒  cd /etc/cron.daily</span><br><span class="line">root@stan-OptiPlex-380:/etc/cron.daily|</span><br><span class="line">⇒  ln -s /root/scripts/motd-commandlinefu-update.sh</span><br><span class="line">root@stan-OptiPlex-380:/etc/cron.daily|</span><br><span class="line">⇒  ll</span><br><span class="line">total 72</span><br><span class="line">drwxr-xr-x   2 root root  4096 Jun 20 10:47 ./</span><br><span class="line">drwxr-xr-x 150 root root 12288 Jun 20 10:44 ../</span><br><span class="line">-rwxr-xr-x   1 root root   311 May 30  2017 0anacron*</span><br><span class="line">-rwxr-xr-x   1 root root   539 Oct 11  2018 apache2*</span><br><span class="line">-rwxr-xr-x   1 root root   376 Nov 21  2017 apport*</span><br><span class="line">-rwxr-xr-x   1 root root  1478 Apr 20  2018 apt-compat*</span><br><span class="line">-rwxr-xr-x   1 root root   314 Jan 17  2018 aptitude*</span><br><span class="line">-rwxr-xr-x   1 root root   355 Dec 29  2017 bsdmainutils*</span><br><span class="line">-rwxr-xr-x   1 root root   384 Dec 13  2012 cracklib-runtime*</span><br><span class="line">-rwxr-xr-x   1 root root  1176 Nov  3  2017 dpkg*</span><br><span class="line">-rwxr-xr-x   1 root root   372 Aug 22  2017 logrotate*</span><br><span class="line">-rwxr-xr-x   1 root root  1065 Apr  7  2018 man-db*</span><br><span class="line">-rwxr-xr-x   1 root root   538 Mar  2  2018 mlocate*</span><br><span class="line">lrwxrwxrwx   1 root root    42 Jun 20 10:47 motd-commandlinefu-update.sh -&gt; /root/scripts/motd-commandlinefu-update.sh*</span><br><span class="line">-rwxr-xr-x   1 root root   249 Jan 26  2018 passwd*</span><br><span class="line">-rw-r--r--   1 root root   102 Nov 16  2017 .placeholder</span><br><span class="line">-rwxr-xr-x   1 root root   246 Mar 22  2018 ubuntu-advantage-tools*</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Working-in-the-shell-efficiently"><a href="#Working-in-the-shell-efficiently" class="headerlink" title="Working in the shell efficiently"></a>Working in the shell efficiently</h2><p>man bash /Commands for Moving</p>
<h3 id="Command-Editing-Shortcuts"><a href="#Command-Editing-Shortcuts" class="headerlink" title="Command Editing Shortcuts"></a>Command Editing Shortcuts</h3><ul>
<li><code>Ctrl + a</code> – go to the start of the command line</li>
<li><code>Ctrl + e</code> – go to the end of the command line</li>
<li><code>Ctrl + k</code> – delete from cursor to the end of the command line</li>
<li><code>Ctrl + u</code> – delete from cursor to the start of the command line</li>
<li><code>Ctrl + w</code> – delete from cursor to start of word (i.e. delete backwards one word)</li>
<li><code>Ctrl + y</code> – paste word or text that was cut using one of the deletion shortcuts (such as the one above) after the cursor</li>
<li><code>Ctrl + xx</code> – move between start of command line and current cursor position (and back again)</li>
<li><code>Alt + b</code> – move backward one word (or go to start of word the cursor is currently on)</li>
<li><code>Alt + f</code> – move forward one word (or go to end of word the cursor is currently on)</li>
<li><code>Alt + d</code> – delete to end of word starting at cursor (whole word if cursor is at the beginning of word)</li>
<li><code>Alt + c</code> – capitalize to end of word starting at cursor (whole word if cursor is at the beginning of word)</li>
<li><code>Alt + u</code> – make uppercase from cursor to end of word</li>
<li><code>Alt + l</code> – make lowercase from cursor to end of word</li>
<li><code>Alt + t</code> – swap current word with previous</li>
<li><code>Alt + .</code> – print previous command’s argument</li>
<li><code>Ctrl + f</code> – move forward one character</li>
<li><code>Ctrl + b</code> – move backward one character</li>
<li><code>Ctrl + d</code> – delete character under the cursor</li>
<li><code>Ctrl + h</code> – delete character before the cursor</li>
<li><code>Ctrl + t</code> – swap character under cursor with the previous one<h3 id="Command-Recall-Shortcuts"><a href="#Command-Recall-Shortcuts" class="headerlink" title="Command Recall Shortcuts"></a>Command Recall Shortcuts</h3></li>
<li><code>Ctrl + r</code> – search the history backwards</li>
<li><code>Ctrl + g</code> – escape from history searching mode</li>
<li><code>Ctrl + p</code> – previous command in history (i.e. walk back through the command history)</li>
<li><code>Ctrl + n</code> – next command in history (i.e. walk forward through the command history)</li>
<li><code>Alt + .</code> – use the last word of the previous command<h3 id="Command-Control-Shortcuts"><a href="#Command-Control-Shortcuts" class="headerlink" title="Command Control Shortcuts"></a>Command Control Shortcuts</h3></li>
<li><code>Ctrl + l</code> – clear the screen</li>
<li><code>Ctrl + s</code> – stops the output to the screen (for long running verbose command)</li>
<li><code>Ctrl + q</code> – allow output to the screen (if previously stopped using command above)</li>
<li><code>Ctrl + c</code> – terminate the command</li>
<li><code>Ctrl + z</code> – suspend/stop the command<h3 id="for-debuging-purpose"><a href="#for-debuging-purpose" class="headerlink" title="for debuging purpose"></a>for debuging purpose</h3></li>
<li><p><code>Ctrl + Alt + e</code> - $SHELL /bin/bash</p>
<h3 id="Bash-Bang-Commands"><a href="#Bash-Bang-Commands" class="headerlink" title="Bash Bang (!) Commands"></a>Bash Bang (!) Commands</h3><p>Bash also has some handy features that use the ! (bang) to allow you to do some funky stuff with bash commands.</p>
</li>
<li><p><code>!!</code> – run last command</p>
</li>
<li><code>!blah</code> – run the most recent command that starts with ‘blah’ (e.g. !ls)</li>
<li><code>!blah:p</code> – print out the command that !blah would run (also adds it as the latest command in the command history)</li>
<li><code>!$</code> – the last word of the previous command (same as Alt + .)</li>
<li><code>!$:p</code> – print out the word that !$ would substitute</li>
<li><code>!*</code> – the previous command except for the last word (e.g. if you type ‘_find somefile.txt /’, then !* would give you ‘_find somefile.txt’)</li>
<li><code>!*:p</code> – print out what !* would substitute</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/shell-script/">shell script</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/28/mysql-backup/" title="MySQL分库分表备份脚本" itemprop="url">MySQL分库分表备份脚本</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-08-28T06:46:20.000Z" itemprop="datePublished"> Published 2016-08-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Let’s cut to the chase<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@aofa-staging tools]# cat mysql_backup.sh</span><br><span class="line">#!/bin/sh</span><br><span class="line">MYUSER=root</span><br><span class="line">MYPASS=yourpasswd</span><br><span class="line">SOCKET=/tmp/mysql.sock</span><br><span class="line">MYLOGIN=&quot;mysql -u$MYUSER -p$MYPASS -S $SOCKET&quot;</span><br><span class="line">MYDUMP=&quot;mysqldump -u$MYUSER -p$MYPASS -S$SOCKET -B&quot;</span><br><span class="line">DATABASE=&quot;$($MYLOGIN -e &quot;show databases;&quot;|egrep -vi &quot;Data|_schema|mysql&quot;)&quot;</span><br><span class="line"></span><br><span class="line">for dbname in $DATABASE</span><br><span class="line">  do</span><br><span class="line">   MYDIR=/backup/mysql/$dbname</span><br><span class="line">   [ ! -d $MYDIR ] &amp;&amp; mkdir -p $MYDIR</span><br><span class="line"> $MYDUMP $dbname|gzip &gt;$MYDIR/$&#123;dbname&#125;_$(date +%F).sql.gz</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p>Output:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@aofa-staging backup]# tree mysql</span><br><span class="line">mysql</span><br><span class="line">├── allyoubank</span><br><span class="line">│   └── allyoubank_2016-08-28.sql.gz</span><br><span class="line">├── test</span><br><span class="line">│   └── test_2016-08-28.sql.gz</span><br><span class="line">└── wgzy</span><br><span class="line">    └── wgzy_2016-08-28.sql.gz</span><br><span class="line"></span><br><span class="line">3 directories, 3 files</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@aofa-staging tools]# cat mysql_table.sh</span><br><span class="line">#!/bin/sh</span><br><span class="line">USER=root</span><br><span class="line">PASSWD=xyz</span><br><span class="line">SOCKET=/tmp/mysql.sock</span><br><span class="line">MYLOGIN=&quot;mysql -u$USER -p$PASSWD -S$SOCKET&quot;</span><br><span class="line">MYDUMP=&quot;mysqldump -u$USER -p$PASSWD -S$SOCKET&quot;</span><br><span class="line">DATEBASE=&quot;$($MYLOGIN -e &quot;show databases;&quot;|egrep -vi &quot;Data|_schema|mysql&quot;)&quot;</span><br><span class="line"></span><br><span class="line">for dbname in $DATEBASE</span><br><span class="line">do</span><br><span class="line"> TABLE=&quot;$($MYLOGIN -e &quot;use $dbname;show tables;&quot;|sed &apos;1d&apos;)&quot;</span><br><span class="line">  for tname in $TABLE</span><br><span class="line">   do</span><br><span class="line">MYDIR=/backup/mysql02/$dbname/$&#123;dbname&#125;_$(date +%F)</span><br><span class="line">     [ ! -d $MYDIR ] &amp;&amp; mkdir -p $MYDIR</span><br><span class="line"> $MYDUMP $dbname $tname |gzip &gt;$MYDIR/$&#123;dbname&#125;_$&#123;tname&#125;_$(date +%F).sql.gz</span><br><span class="line">    done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>Output:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@aofa-staging mysql02]# tree</span><br><span class="line">.</span><br><span class="line">├── allyoubank</span><br><span class="line">│   └── allyoubank_2016-08-28</span><br><span class="line">│       ├── allyoubank_account_2016-08-28.sql.gz</span><br><span class="line">│       └── allyoubank_w_sign_in_2016-08-28.sql.gz</span><br><span class="line">└── wgzy</span><br><span class="line">    └── wgzy_2016-08-28</span><br><span class="line">        ├── wgzy_account_2016-08-28.sql.gz</span><br><span class="line">        └── wgzy_w_sign_in_2016-08-28.sql.gz</span><br><span class="line">4 directories, 172 files</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/backup/">backup</a><a href="/tags/mysql/">mysql</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/28/backup-script/" title="backup script" itemprop="url">backup script</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-08-28T06:13:25.000Z" itemprop="datePublished"> Published 2016-08-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="weekly-backup-script"><a href="#weekly-backup-script" class="headerlink" title="weekly backup script"></a>weekly backup script</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/backup/backupwk.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"># ====================================================================</span><br><span class="line"># user input backup location</span><br><span class="line"># basedir=backup dir</span><br><span class="line">basedir=/backup/weekly</span><br><span class="line"></span><br><span class="line"># ====================================================================</span><br><span class="line">#</span><br><span class="line">PATH=/bin:/usr/bin:/sbin:/usr/sbin; export PATH</span><br><span class="line">export LANG=C</span><br><span class="line"></span><br><span class="line"># backup folders</span><br><span class="line">#named=$basedir/named</span><br><span class="line">#postfixd=$basedir/postfix</span><br><span class="line">#vsftpd=$basedir/vsftp</span><br><span class="line">sshd=$basedir/ssh</span><br><span class="line">#sambad=$basedir/samba</span><br><span class="line">wwwd=$basedir/wwwd</span><br><span class="line">#others=$basedir/others</span><br><span class="line">userinfod=$basedir/userinfo</span><br><span class="line"># check if the file exists, if didn&apos;t create a dir</span><br><span class="line">for dirs in $sshd $wwwd $userinfod</span><br><span class="line">do</span><br><span class="line">        [ ! -d &quot;$dirs&quot; ] &amp;&amp; mkdir -p $dirs</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 1. service config file</span><br><span class="line">#cp -a /var/named/chroot/&#123;etc,var&#125;      $named</span><br><span class="line">#cp -a /etc/postfix /etc/dovecot.conf   $postfixd</span><br><span class="line">#cp -a /etc/vsftpd/*                    $vsftpd</span><br><span class="line">cp -a /etc/ssh/*                        $sshd</span><br><span class="line">#cp -a /etc/samba/*                     $sambad</span><br><span class="line">cp -a /etc/my.cnf       $wwwd</span><br><span class="line">cp -a /application/nginx/conf/nginx.conf        $wwwd</span><br><span class="line"></span><br><span class="line">cd /application</span><br><span class="line">  tar -jpc -f $wwwd/tomcat.tar.bz2     tomcat</span><br><span class="line">  tar -jpc -f $wwwd/nginx.tar.bz2     nginx</span><br><span class="line"></span><br><span class="line"># 2. about user par</span><br><span class="line">cp -a /etc/&#123;passwd,shadow,group&#125;        $userinfod</span><br><span class="line">cd /var/spool</span><br><span class="line">  tar -jpc -f $userinfod/mail.tar.bz2   mail</span><br><span class="line">cd /var/spool</span><br><span class="line">  tar -jpc -f $userinfod/cron.tar.bz2   cron at</span><br></pre></td></tr></table></figure>
<p>Every Sun 3.30 run weekly backup script:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/crontab</span><br><span class="line">30 3 * * 0 root /backup/backupwk.sh</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/backup/">backup</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/24/docker-tomcat7/" title="docker tomcat7" itemprop="url">docker tomcat7</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-08-24T01:15:59.000Z" itemprop="datePublished"> Published 2016-08-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="docker-container-with-centos-6-and-tomcat-7"><a href="#docker-container-with-centos-6-and-tomcat-7" class="headerlink" title="docker container with centos 6 and tomcat 7"></a>docker container with centos 6 and tomcat 7</h1><pre><code># docker search centos
# docker pull centos
</code></pre><p>Download the Oracle JDK</p>
<pre><code>wget --no-cookies --no-check-certificate --header &quot;Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie&quot; &quot;http://download.oracle.com/otn-pub/java/jdk/7u72-b14/jdk-7u72-linux-x64.tar.gz&quot;
</code></pre><p>Create a working folder and place both Tomcat tarball and Oracle JDK files in the same folder.</p>
<pre><code>[root@docker centos6]# ls
apache-tomcat-7.0.70.tar.gz  Dockerfile  jdk-7u72-linux-x64.tar.gz

[root@docker centos6]# cat Dockerfile
FROM centos:latest
MAINTAINER lreeder

#Helpful utils, but only sudo is required
#RUN yum -y install tar
#RUN yum -y install vim
#RUN yum -y install nc
RUN yum -y install sudo

######## JDK7

#Note that ADD uncompresses this tarball automatically
ADD jdk-7u72-linux-x64.tar.gz /opt
WORKDIR /opt/jdk1.7.0_72
RUN alternatives --install /usr/bin/java java /opt/jdk1.7.0_72/bin/java 1
RUN alternatives --install /usr/bin/jar jar /opt/jdk1.7.0_72/bin/jar 1
RUN alternatives --install /usr/bin/javac javac /opt/jdk1.7.0_72/bin/javac 1
RUN echo &quot;JAVA_HOME=/opt/jdk1.7.0_72&quot; &gt;&gt; /etc/environment

######## TOMCAT

#Note that ADD uncompresses this tarball automatically
ADD apache-tomcat-7.0.70.tar.gz /usr/share
WORKDIR /usr/share/
RUN mv  apache-tomcat-7.0.70 tomcat7
RUN echo &quot;JAVA_HOME=/opt/jdk1.7.0_72/&quot; &gt;&gt; /etc/default/tomcat7
RUN groupadd tomcat
RUN useradd -s /bin/bash -g tomcat tomcat
RUN chown -Rf tomcat.tomcat /usr/share/tomcat7
EXPOSE 8080
</code></pre><p>Build image</p>
<pre><code># docker build --rm=true -t centos6/tomcat7 .
</code></pre><p>Setup port forwarding and start tomcat</p>
<pre><code>[root@docker centos6]# docker run -p 80:8080 --rm=true -t -i --name tomcat7 centos6/tomcat7 /usr/bin/sudo -u tomcat /usr/share/tomcat7/bin/catalina.sh run
</code></pre><p>Find out the IP address for the running container:</p>
<pre><code>[root@docker centos6]# docker inspect --format &apos;{{ .NetworkSettings.IPAddress }}&apos; tomcat7
172.17.0.22
</code></pre>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/docker/">docker</a><a href="/tags/tomcat/">tomcat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/19/zabbix-client/" title="Install Zabbix Agent" itemprop="url">Install Zabbix Agent</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-08-19T05:41:50.000Z" itemprop="datePublished"> Published 2016-08-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>is required to install on all remote systems needs to be monitor through Zabbix server. The Zabbix Agent collects resource utilization data and applications data on client system and provide such information to Zabbix server on their requests.</p>
<p>There are two types of checks between Zabbix Server and Client.</p>
<ul>
<li>Passive Check : Zabbix Agent sent data to server on their request.</li>
<li>Active Check : Zabbix Agent sends data periodically to Server.</li>
</ul>
<p>After installing zabbix server on your server, Now we are moving to install agent on remote system’s. This article will help you to install zabbix agent on CentOS/RHEL 7/6/5 systems. After completing this step go to next article add Host in Zabbix Server.</p>
<h2 id="Installing-Zabbix-Agent"><a href="#Installing-Zabbix-Agent" class="headerlink" title="Installing Zabbix Agent"></a>Installing Zabbix Agent</h2><p>Follow the below instructions to install Zabbix Agent on CentOS, RHEL 7/6/5 systems.</p>
<h3 id="Step-1-–-Add-Required-Repository"><a href="#Step-1-–-Add-Required-Repository" class="headerlink" title="Step 1 – Add Required Repository"></a>Step 1 – Add Required Repository</h3><p>Before installing Zabbix Agent first configure zabbix yum repository using following commands as per your required version and operating system.</p>
<pre><code># rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm
</code></pre><h3 id="Step-2-–-Install-Zabbix-Agent"><a href="#Step-2-–-Install-Zabbix-Agent" class="headerlink" title="Step 2 – Install Zabbix Agent"></a>Step 2 – Install Zabbix Agent</h3><p>After installing yum repository packages in our system. Now use following command to install Zabbix agent on your Linux system.</p>
<pre><code># yum install zabbix zabbix-agent
</code></pre><h3 id="Step-3-–-Edit-Zabbix-Agent-Configuration"><a href="#Step-3-–-Edit-Zabbix-Agent-Configuration" class="headerlink" title="Step 3 – Edit Zabbix Agent Configuration"></a>Step 3 – Edit Zabbix Agent Configuration</h3><p>As zabbix agent has been successfully installed on our remote system. Now we just need to configure zabbix agent by adding zabbix server ip in its configuration file</p>
<pre><code>vim /etc/zabbix/zabbix_agentd.conf

Server=[IP of Zabbix Server]
ServerActive=[IP of Zabbix Server]
Hostname=[use the FQDN of the node where the agent runs]
</code></pre><h3 id="Step-4-–-Restarting-Zabbix-Agent"><a href="#Step-4-–-Restarting-Zabbix-Agent" class="headerlink" title="Step 4 – Restarting Zabbix Agent"></a>Step 4 – Restarting Zabbix Agent</h3><p>After adding zabbix server ip in configuration file, now restart agent service using below command.</p>
<pre><code># /etc/init.d/zabbix-agent start
# netstat -tulpn|grep zabbix
</code></pre><h3 id="Step-5-–-Test"><a href="#Step-5-–-Test" class="headerlink" title="Step 5 – Test"></a>Step 5 – Test</h3><p>Finally, in order to test if you can reach Zabbix Agent from Zabbix Server, use Telnet command from Zabbix server machine to the IP addresses of the machines that run the agents:</p>
<pre><code># telnet zabbix_agent_IP 10050
</code></pre><h3 id="Step-6-–-Add-Zabbix-Agent-Monitored-Host-to-Zabbix-Server"><a href="#Step-6-–-Add-Zabbix-Agent-Monitored-Host-to-Zabbix-Server" class="headerlink" title="Step 6 – Add Zabbix Agent Monitored Host to Zabbix Server"></a>Step 6 – Add Zabbix Agent Monitored Host to Zabbix Server</h3><p> <a href="http://www.tecmint.com/install-and-configure-zabbix-agents-on-centos-redhat-and-debian/" title="Step 3: Add Zabbix Agent Monitored Host to Zabbix Server">read</a> </p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/zabbix/">zabbix</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/19/zabbix-server/" title="Install zabbix server on aws ec2" itemprop="url">Install zabbix server on aws ec2</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-08-19T03:46:10.000Z" itemprop="datePublished"> Published 2016-08-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="1-First-install-Mysql"><a href="#1-First-install-Mysql" class="headerlink" title="1. First install Mysql:"></a>1. First install Mysql:</h2><pre><code>vim install_mysql
</code></pre><h3 id="Insert-the-following-lines"><a href="#Insert-the-following-lines" class="headerlink" title="Insert the following lines:"></a>Insert the following lines:</h3><pre><code>groupadd mysql
useradd -s /sbin/nologin -g mysql -M mysql
tail -1 /etc/passwd
id mysql
wget ftp://mysql.inspire.net.nz/mysql/Downloads/MySQL-5.5/mysql-5.5.53-linux2.6-x86_64.tar.gz    
tar xf mysql-5.5.53-linux2.6-x86_64.tar.gz
mkdir -p /application/
mv mysql-5.5.53-linux2.6-x86_64 /application/mysql-5.5.53
ln -s /application/mysql-5.5.53/ /application/mysql
ls -l /application/
cd /application/mysql/
ls -l support-files/*.cnf
/bin/cp support-files/my-medium.cnf /etc/my.cnf
mkdir -p /application/mysql/data
chown -R mysql.mysql /application/mysql/
/application/mysql/scripts/mysql_install_db --basedir=/application/mysql --datadir=/application/mysql/data/ --user=mysql
/bin/cp support-files/mysql.server /etc/init.d/mysqld
chmod +x /etc/init.d/mysqld


sed -i &apos;s#/usr/local/mysql#/application/mysql#g&apos; /application/mysql/bin/mysqld_safe /etc/init.d/mysqld

/etc/init.d/mysqld start
netstat -lntup|grep mysql


chkconfig --add mysqld
chkconfig mysqld on
chkconfig --list mysqld

echo &apos;export PATH=/application/mysql/bin:$PATH&apos; &gt;&gt; /etc/profile
tail -1 /etc/profile
source /etc/profile
echo $PATH
</code></pre><h3 id="Running-command"><a href="#Running-command" class="headerlink" title="Running command:"></a>Running command:</h3><pre><code>source install_mysql
/application/mysql/bin/mysql_secure_installation
</code></pre><h2 id="2-Installing-repository-configuration-package"><a href="#2-Installing-repository-configuration-package" class="headerlink" title="2. Installing repository configuration package"></a>2. Installing repository configuration package</h2><p>Zabbix 2.4 for RHEL6, Oracle Linux 6, CentOS 6:</p>
<pre><code>#  rpm -ivh http://mirrors.aliyun.com/epel/6/x86_64/epel-release-6-8.noarch.rpm
</code></pre><h2 id="rpm-ivh-http-repo-zabbix-com-zabbix-2-4-rhel-6-x86-64-zabbix-release-2-4-1-el6-noarch-rpm"><a href="#rpm-ivh-http-repo-zabbix-com-zabbix-2-4-rhel-6-x86-64-zabbix-release-2-4-1-el6-noarch-rpm" class="headerlink" title="rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm"></a>rpm -ivh <a href="http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm">http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm</a></h2><p>Installing Zabbix packages</p>
<pre><code># yum install zabbix-server-mysql zabbix-web-mysql
</code></pre><p>Creating initial database</p>
<pre><code>shell&gt; mysql -uroot -p
mysql&gt; create database zabbix character set utf8 collate utf8_bin;
mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &apos;zabbix&apos;;
mysql&gt; quit;
</code></pre><p>Import initial schema and data.</p>
<pre><code># cd /usr/share/doc/zabbix-server-mysql-2.4.8/create
# mysql -uroot -p zabbix &lt; schema.sql
# mysql -uroot -p zabbix &lt; images.sql
# mysql -uroot -p zabbix &lt; data.sql
</code></pre><p>Starting Zabbix server process</p>
<p>Edit database configuration in zabbix_server.conf</p>
<pre><code># vim /etc/zabbix/zabbix_server.conf
DBHost=localhost
DBName=zabbix
DBUser=zabbix
DBPassword=zabbix
DBSocket=/tmp/mysql.sock
</code></pre><p>Start Zabbix server process.</p>
<h1 id="service-zabbix-server-start"><a href="#service-zabbix-server-start" class="headerlink" title="service zabbix-server start"></a>service zabbix-server start</h1><p>Editing PHP configuration for Zabbix frontend</p>
<p>Apache configuration file for Zabbix frontend is located in /etc/httpd/conf.d/zabbix.conf. Some PHP settings are already configured.</p>
<pre><code># vim /etc/httpd/conf.d/zabbix.conf
php_value max_execution_time 300
php_value memory_limit 128M
php_value post_max_size 16M
php_value upload_max_filesize 2M
php_value max_input_time 300
php_value date.timezone Asia/Shanghai
</code></pre><p>It’s necessary to uncomment the “date.timezone” setting and set the right timezone for you. After changing the configuration file restart the apache web server.</p>
<pre><code># service httpd restart
</code></pre><p>Zabbix frontend is available at <a href="http://zabbix-frontend-hostname/zabbix">http://zabbix-frontend-hostname/zabbix</a> in the browser. Default username/password is Admin/zabbix.</p>
<h2 id="3-Troubleshooting"><a href="#3-Troubleshooting" class="headerlink" title="3. Troubleshooting"></a>3. Troubleshooting</h2><p><img src="http://obsavus1p.bkt.clouddn.com/error02.PNG" alt=""></p>
<p><code>mkdir -p /var/lib/mysql;
ln -s /tmp/mysql.sock /var/lib/mysql/mysql.sock</code></p>
<hr>
<p><img src="http://obsavus1p.bkt.clouddn.com/error03.PNG" alt=""><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/clock</span><br><span class="line"></span><br><span class="line">ZONE="Aisa/Shanghai"</span><br><span class="line"></span><br><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">echo '#time sync by stan zhou at `date`'&gt;&gt; /var/spool/cron/root</span><br><span class="line">echo '*/5 * * * * /usr/sbin/ntpdate 3.cn.pool.ntp.org &gt; /dev/null 2&gt;&amp;1' &gt;&gt; /var/spool/cron/root</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure></p>
<h2 id="read-more-Changing-the-Time-Zone"><a href="#read-more-Changing-the-Time-Zone" class="headerlink" title="read more Changing the Time Zone"></a>read more <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-time.html">Changing the Time Zone</a></h2><p>checking for mysql_config… /usr/bin/mysql_config<br>checking for main in -lmysqlclient… no<br>configure: error: Not found mysqlclient library</p>
<p>#yum -y install mysql-devel</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/ec2/">ec2</a><a href="/tags/zabbix/">zabbix</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/17/aws/" title="aws ec2 init setup" itemprop="url">aws ec2 init setup</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stan Zhou" target="_blank" itemprop="author">Stan Zhou</a>
		
  <p class="article-time">
    <time datetime="2016-08-17T04:07:13.000Z" itemprop="datePublished"> Published 2016-08-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="ASW-ec2-init-setup"><a href="#ASW-ec2-init-setup" class="headerlink" title="ASW ec2 init setup"></a>ASW ec2 init setup</h4><p>Managing User Accounts on Your Linux Instance<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-17-193 ~]$ sudo -i</span><br><span class="line">[root@ip-172-31-17-193 ~]# adduser stan</span><br><span class="line">[root@koopa ~]# passwd stan</span><br><span class="line">[root@ip-172-31-17-193 ~]# su - stan</span><br><span class="line">[stan@ip-172-31-17-193 ~]$ mkdir .ssh</span><br><span class="line">[stan@ip-172-31-17-193 ~]$ chmod 700 .ssh</span><br><span class="line">[stan@ip-172-31-17-193 ~]$ vim .ssh/authorized_keys</span><br><span class="line">[stan@ip-172-31-17-193 ~]$ chmod 600 .ssh/authorized_keys</span><br><span class="line">[root@ip-172-31-17-193 ~]# groupadd auegg</span><br><span class="line">[root@ip-172-31-17-193 ~]# usermod -a -G auegg stan</span><br><span class="line">[root@ip-172-31-17-193 ~]# visudo</span><br><span class="line">#add the following line</span><br><span class="line"></span><br><span class="line">%auegg ALL=(ALL) ALL</span><br><span class="line">[root@ip-172-31-17-193 ~]# service sshd restart</span><br></pre></td></tr></table></figure></p>
<h4 id="ssh-to-aws-without-key-pairs"><a href="#ssh-to-aws-without-key-pairs" class="headerlink" title="ssh to aws without key pairs"></a>ssh to aws without key pairs</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">PasswordAuthentication yes</span><br><span class="line">Reload ssh daemon</span><br><span class="line">service sshd reload</span><br></pre></td></tr></table></figure>
<h4 id="set-root-login"><a href="#set-root-login" class="headerlink" title="set root login"></a>set root login</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /root/.ssh/authorized_keys</span><br><span class="line">Delete the lines at the begining of the file until you get to the words ssh-rsa</span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">PermitRootLogin yes</span><br></pre></td></tr></table></figure>
<h1 id="the-5-pillars-of-aws-weel-architected-framework"><a href="#the-5-pillars-of-aws-weel-architected-framework" class="headerlink" title="the 5 pillars of aws weel-architected framework"></a>the 5 pillars of aws weel-architected framework</h1><ol>
<li>Operationa Excellence<br>Design Principles:</li>
</ol>
<ul>
<li>Perform operations as code</li>
<li>Annotate documentation</li>
<li>Make frequent, small, reversible changes</li>
<li>Refine operations procedures frequently</li>
<li>Anticipate failure</li>
<li>Learn from all operation failures<br>Best practices:<br>Operations teams need to understand their business and customer needs so they can support business outcomes.<br>Ops creates and uses procedures to repond to operational events, and validates their effectiveness to support<br>business needs. Ops also collects metrics that are used to measure the achievement of desired business outcomes.</li>
</ul>
<ol start="2">
<li>Security<br>Design Principles:</li>
</ol>
<ul>
<li>Implement a strong identity foundation</li>
<li>Enable traceability</li>
<li>Apply security at all layers</li>
<li>Automate security best practices</li>
<li>Protect data in transfit and at rest</li>
<li>Prepare for security events</li>
</ul>
<p>The <a href="https://aws.amazon.com/compliance/shared-responsibility-model/">AWS Shared Responsibility Model</a> enables organizations to achieve<br>security and compliance goals.</p>
<ol start="3">
<li>Reliability<br>Design Principles:</li>
</ol>
<ul>
<li>Test recovery procedures</li>
<li>Automatically recover from failure</li>
<li>Gtop guessing capacity</li>
<li>Manage change in automation</li>
</ul>
<ol start="4">
<li>Performance efficiency<br>Design principles:</li>
</ol>
<ul>
<li>Democratize advanced technologies</li>
<li>Go global in minutes</li>
<li>Use serverless architectures</li>
<li>Experiment more often</li>
<li>Mechanical sympathy</li>
</ul>
<ol start="5">
<li>Cost optimization</li>
</ol>
<ul>
<li>Adopt a consumption model</li>
<li>Measure overall efficiency</li>
<li>Stop spending monty on data center operations</li>
<li>Analyze and attribute expenditure</li>
<li>Use managed services to reduce cost of ownership</li>
</ul>
<h1 id="Identity-and-access-management"><a href="#Identity-and-access-management" class="headerlink" title="Identity and access management"></a>Identity and access management</h1><p><strong>IAM overview</strong><br>AWS API<br>Access ID + secret key</p>
<p>CLI, SDKs and Management console call API.</p>
<p>Users</p>
<ul>
<li>Are created and exist within IAM service</li>
<li>Login to management console</li>
<li>Can have long-term access keys</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/aws/">aws</a><a href="/tags/ec2/">ec2</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/4/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="stanosaka" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Devops/" title="Devops">Devops<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/aws/" title="aws">aws<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/centos/" title="centos">centos<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/CD-CI/" title="CD/CI">CD/CI<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tomcat/" title="tomcat">tomcat<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/saltstack/" title="saltstack">saltstack<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/zabbix/" title="zabbix">zabbix<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ec2/" title="ec2">ec2<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/backup/" title="backup">backup<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Pipeline/" title="Pipeline">Pipeline<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Blue-Ocean/" title="Blue Ocean">Blue Ocean<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/SRE/" title="SRE">SRE<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/agile/" title="agile">agile<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://kupczynski.info/2018/04/18/spacemacs.html" target="_blank" title="Learning Spacemacs">Learning Spacemacs</a>
            
          </li>
        
          <li>
            
            	<a href="https://cloud.ibm.com/docs/tutorials?topic=solution-tutorials-tutorials" target="_blank" title="IBM cloud solution tutorial">IBM cloud solution tutorial</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/aws-samples" target="_blank" title="AWS Samples">AWS Samples</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/bikrambora/devlab-launchpad" target="_blank" title="Welcome to Dev Labs">Dev Labs</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/ansible/ansible-examples" target="_blank" title="Ansible GitHub repo">Ansible GitHub repo</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" title="Ansible Best Practices">Ansible Best Practices</a>
            
          </li>
        
          <li>
            
            	<a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" title="kubectl cheat sheet">kubectl cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://rogerdudler.github.io/git-guide" target="_blank" title="Git commands">Git commands</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" title="Dockerfile reference">Dockerfile reference</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2mTQr8l" target="_blank" title="Linux Command line cheat sheet">Linux Command line cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2EPHxze" target="_blank" title="PowerShell Basic Cheat Sheet">PowerShell Basic Cheat Sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" title="sed cheatsheet">sed cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://obsavus1p.bkt.clouddn.com/vim_cheat_sheet_for_programmers_print.png" target="_blank" title="vim cheatsheet">vim cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.gitbook.com/book/yeasy/docker_practice/details" target="_blank" title="Learn Docker">Learn Docker</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.unixhot.com/page/ops" target="_blank" title="运维知识体系">运维知识体系</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.tecmint.com/" target="_blank" title="tecmint">tecmint</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.lib.uts.edu.au" target="_blank" title="shoujin.wang@student.uts.edu.au">UTS Library</a>
            
          </li>
        
          <li>
            
            	<a href="https://7esl.com" target="_blank" title="ESL">ESL</a>
            
          </li>
        
          <li>
            
            	<a href="https://stanchou.wordpress.com" target="_blank" title="Stan&#39;s wordpress">Stan&#39;s wordpress</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.00root.com" target="_blank" title="Stan&#39;s gitbook">Stan&#39;s gitbook</a>
            
          </li>
        
          <li>
            
            	<a href="https://api.ipify.org" target="_blank" title="Your IP address">Your IP address</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/stanosaka/oreilly_sql_fundamentals_for_data/blob/master/notes_and_slides/sql_fundamentals_notes.md" target="_blank" title="sql fundamentials">sql fundamentials</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.nerdfonts.com" target="_blank" title="Nred Fonts">Nred Fonts</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Stan living in Sydney. <br/>
			I am a lifelong technology learner.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/stanosaka" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6724938" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/stanosaka" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/stan.osaka" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/00root" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/btw01v" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/stan-22-82" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:devops@cwzhou.win" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="Stan Zhou">Stan Zhou</a>
		
		
		</p>
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>


        
  	    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
               if (window.mermaid) {
                  mermaid.initialize({theme: 'forest'});
               }
            </script>
        












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
